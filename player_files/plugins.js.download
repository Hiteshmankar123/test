//* GLE 2023-02-24 *//*
var GLEPlugins,__awaiter=this&&this.__awaiter||function(t,r,o,l){return new(o=o||Promise)(function(i,e){function s(t){try{n(l.next(t))}catch(t){e(t)}}function a(t){try{n(l.throw(t))}catch(t){e(t)}}function n(t){var e;t.done?i(t.value):((e=t.value)instanceof o?e:new o(function(t){t(e)})).then(s,a)}n((l=l.apply(t,r||[])).next())})};!function(t){var e=GLECore.IEventDispatcher;class i extends e{constructor(t){super(),this.api=null,this.content=null,this.parent=null,this.id="",this.dependencies={},this.props={},this.dependencies=t}build(t,e){return this.content=t,this.api=e,this.id=t.attributes.id,this.getDataProps(),""}rebuild(t,e){return this.build(t,e)}program(t){this.parent=t}reprogram(){}destroy(){super.destroy(),this.api=null,this.content=null,this.parent=null,this.id=null}getDataProps(){var t=this.content.getChildrenOfType("Data")[0];if(!_.isEmpty(t)&&!_.isEmpty(t.attributes))for(const e in t.attributes)Object.prototype.hasOwnProperty.call(t.attributes,e)&&(this.props[e]=t.attributes[e])}}t.IPluggable=i}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.IPluggable{constructor(t){super(t),this._zoneContainer=null,this._zoneData=null,this._isZone=!1,this._zoneSelector="",this._isLastZone=!1,this._isNestedInZone=!1,this.onExitZone=()=>{clearTimeout(this._advanceTimeout)},this.triggerButtonClick=()=>{$(this._zoneSelector+" .zone-button:not(.hidden)").click()}}get zonePosition(){return this._zonePosition}get isLastZone(){return this._isLastZone}get zoneId(){return this._zoneId}get zoneData(){return this._zoneData}set zoneData(t){this._zoneData=t}get $element(){return $(""+this._zoneSelector)}build(t,e){var i;return this._isZone=t.parent&&"Zone"===t.parent.type,this._zoneId=this._isZone?"z"+t.parent.attributes.zoneID:null,this._zoneSelector=this._isZone?"#"+this._zoneId:"",this._isZone&&(i=t.parent.parent.getChildrenOfType("Zone"),this._zonePosition=i.indexOf(t.parent)+1,this._isLastZone=i.length===this._zonePosition),this.zoneConfigurationOverride(t),super.build(t,e)}zoneConfigurationOverride(t){}unsetZone(){this._isZone=!1}program(t){super.program(t),this._isZone&&this.configureZone()}hasIncompleteRequiredLinks(){return!!$(this._zoneSelector+" [data-required-id]:not(.visited)").length}configureZone(){this._zoneContainer=_.isEmpty(t.MultiZone.activeZone)?null:t.MultiZone.activeZone,_.isEmpty(this._zoneContainer)||this._zoneContainer.register(this,this._zoneId),$(this._zoneSelector+" .zone-button.arrow").click(this.onExitZone)}advanceZone(t=!1,e=0){t?(clearTimeout(this._advanceTimeout),this._advanceTimeout=window.setTimeout(this.triggerButtonClick,e)):this.triggerButtonClick()}setZoneComplete(){t.MultiZone.activeZone.onZoneComplete(this)}}t.AbstractZone=e}(GLEPlugins=GLEPlugins||{}),function(e){var i=GLECore.MediaControls,s=GLECore.ViewingModeManager,a=GLECore.Trace,n=GLECore.DataUtil,r=GLECore.delay,o=GLECore.Platform;class t extends e.AbstractZone{constructor(t){super(t),this._video=null,this._$video=null,this._source=null,this._$captionsContent=null,this._inFullScreenMode=!1,this._captions=[],this._currentCaption=null,this._viewingMode=null,this._autoplay=!1,this._$vid=null,this._$replay=null,this._$mediaControls=null,this._data=null,this._state=null,this._tgOnly=!1,this._videoWasPaused=!1,this._inFallbackState=!1,this._iosAutoplayTriggered=!1,this._iosAutoplayProcessed=!1,this.prepareVTT=()=>{var i=this._video.addTextTrack("subtitles",this._LanguageManager.getCurrentLanguageLabel(),this._LanguageManager.getCurrentHTMLLanguageId());i.mode="hidden";for(let t=0,e=this._captions.length;t<e;t++){var s=this._captions[t],a=t<e-1?this._captions[t+1]:null,n=s.cuePoint,a=a?a.cuePoint:n+10;i.addCue(new window.VTTCue(n,n+(a-n),s.text))}},this.onWindowOrientationChange=t=>{this.onWindowResize(t)},this.onTimeChange=()=>{this.timeHandler()},this.onVideoComplete=()=>{this.completeHandler()},this.checkForFallback=()=>{4===this._video.error.code&&(this._inFallbackState?a.error("MediaPlayer: Unable to set media source."):(this._inFallbackState=!0,this.setMediaSource(),this._$video.removeAttr("autoplay"),this._$video.attr("src",this._source),!0===this._autoplay&&this.initMedia()))},this.pauseHandler=()=>{this.pauseActions()},this.playHandler=()=>{this.playActions()},this.progressHandler=()=>{try{let t=Math.floor(this._video.buffered.end(0))/Math.abs(this._video.duration);.95<t&&(t=1),this._MediaControls.setBuffering(t)}catch(t){}},this.startPlayback=()=>{var t=this._video.play();if(void 0===t)return this.playActions();t.then(()=>{this.playActions()}).catch(()=>{this.pauseActions()})},this.hideOverlay=()=>{this._$videoTitle.removeClass("showTitle"),this.startAutoplaying()},this.fullscreenChangeHandler=()=>{var t=this._$document.prop("fullscreen")||this._$document.prop("webkitIsFullScreen");r(t?()=>this.onWindowResize(null,!0):()=>{this._inFullScreenMode=!1,this.onWindowResize()},100)},this.apiEventHandler=t=>{},this.modalOpenedHandler=()=>{"playing"===this._state?(this._videoWasPaused=!1,this._video.pause(),this.pauseActions(),clearTimeout(this._autoplayTimeout)):"preparing"===this._state||"paused"===this._state?(clearTimeout(this._autoplayTimeout),this._timerRemaining=(new Date).getTime(),this._timerRemaining-=this._timerStarted.getTime()):this._videoWasPaused=!0},this.preferencesUpdateHandler=t=>{t=t.data.value;("on"===t.subtitles&&!this._MediaControls.captionsOn||"off"===t.subtitles&&this._MediaControls.captionsOn)&&this._MediaControls.toggleCaptions(),("on"===t.audio&&this.api.model.isMuted||"off"===t.audio&&!this.api.model.isMuted)&&this._MediaControls.toggleVolume()},this._dependencies=t,this._ViewingModeManager=t.ViewingModeManager,this._LanguageManager=t.LanguageManager,this._LaunchDataManager=t.LaunchDataManager}build(t,e){return super.build(t,e),this._MediaControls=new i(e),this.configureSettings(),this.setMediaSource(),this.buildComponentHTML()}configureSettings(){this._data=this.content.getChildrenOfType("Data")[0],this._tgOnly="true"===this.props.tgOnly,this._autoplay=this.determineAutoplayConfiguration(),this._viewingMode=this._tgOnly?s.VIEWING_MODE_TG:this._ViewingModeManager.currentViewingMode,this._durationOffset=parseFloat(this.props.durationCompletionOffset),this._titleHoldTime=1e3*parseInt(this.props.titleHoldTime,10),this._showTitle="true"===this.props.showTitle}determineAutoplayConfiguration(){return this.props.autoplay===e.MediaPlayer.AUTOPLAY_TRUE}setMediaSource(){let t,e,i;this.props.media_src.match(/^flv:/gim)?(t=/\/(\w+)$/gim.exec(this.props.media_src)[1],i=/:(.*\/)/gim,e=this.props.httpFallbackPath+i.exec(this.props.media_src)[1]):t=this.props.media_src.match(/\.flv$/gim)?(e=this.props.media_src.match(/.*\//gim)[0],(i=/\/(\w*)\.flv/gim).exec(this.props.media_src)):(e=this.props.media_src.match(/.*\//gim)[0],this.props.media_src.match(/\w+$/gim)[0]),t+=this.getVideoSuffix()+"."+n.getSupportedVideoExtension(),e=n.updatePathToCurrentProtocol(e),this._source=this.replaceLanguageInPath(e+t)}getVideoSuffix(){var t=this._inFallbackState?this.props.vidhi_fallback_suffix:this.props.vidhi_suffix;return this._viewingMode===s.VIEWING_MODE_VIDHI?t:this.props.vidlo_suffix}replaceLanguageInPath(t){return"none"===this.props.forcedLanguage||this.props.forcedLanguage===this._LanguageManager.currentLangId?t:e.MediaUtil.forcePathToUseLanguage(t,this._LanguageManager.currentLangId,this.props.forcedLanguage)}buildComponentHTML(){var t=$("<div id='video'/>");return t.html(this.buildPlayer()),this.buildControls(t),t[0].outerHTML}buildPlayer(){return _.template(this.api.getTemplate(this.props.templateID).content)({autoplay:this._autoplay})}buildControls(t){var e=this.api.populate(null,this.props.vidcontrols,this.content);return t.find("#media-controls").html($(e.content).html()),t}program(t){this.programZone(t),this._bodySelector=this.getBodySelector(),this._$container=$(this._bodySelector),this._$vid=this._$container.find(".vid"),this.initMediaControls(),this.configureVideo(),this.configureCaptions(),this.initializeMediaPlayer()}programZone(t){super.program(t)}getBodySelector(){return this._isZone?`#${this._zoneData.zoneId} #video-container`:"#video-container"}initMediaControls(){this._$captionsContent=this._$container.find("#video-captions"),this._MediaControls.init({plugin:this,mediaScrub:this.getMediaScrub(),zoneId:this._isZone?this._zoneData.zoneId:null}),this._$replay=this._$container.find(".overlay-play-button"),this._$replay.click(()=>{this._showTitle="true"===this.props.showTitle,this._MediaControls.togglePlayback()})}getMediaScrub(){let t=this.props.mediaScrub;return t=t===i.PROGRESS_SCRUB_LIMIT&&this.api.getThisPageComplete()?i.PROGRESS_SCRUB_FULL:t}shouldRemoveCCButton(){var t=_.isEmpty(this._captions),e="true"===this.props.hideCCButton;return t||e}configureVideo(){this.configureDOM(),this.addListeners(),this.configureVideoElement(),this.configureVolume(),this._$window.resize(t=>this.onWindowResize(t)),this.setImagePoster(),this.setOverlayText(),this.configureDevice()}configureDOM(){this._$document=$(document),this._$window=$(window),this._$mediaControls=this._$container.find("#media-controls"),this._$video=this._$container.find("#video-player"),this._video=this._$video.get(0),this._$videoTitle=this._$container.find("#video-title"),this._$video.hide()}configureDevice(){var t,e=this.api.getDeviceType();e===o.DEVICE_IOS?(t=window.navigator.userAgent.match(/iphone/gim),this.setContainerClass("ios"),t?this._$video.on("loadedmetadata",this.prepareVTT):(this._video.autoplay=!0,this._iosAutoplayTriggered=!0)):e===o.DEVICE_ANDROID&&this.setContainerClass("android")}addListeners(){window.addEventListener("orientationchange",this.onWindowOrientationChange),this._video.addEventListener("loadeddata",this.onWindowOrientationChange),this._video.addEventListener("pause",this.pauseHandler,!1),this._video.addEventListener("playing",this.playHandler,!1),this._video.addEventListener("timeupdate",this.onTimeChange,!1),this._video.addEventListener("progress",this.progressHandler,!1),this._video.addEventListener("ended",this.onVideoComplete,!1),this._video.addEventListener("error",this.checkForFallback,!1),this._$document.bind("fullscreenchange webkitfullscreenchange",this.fullscreenChangeHandler)}removeListeners(){window.removeEventListener("orientationchange",this.onWindowOrientationChange),this._video&&(this._video.removeEventListener("loadeddata",this.onWindowOrientationChange),this._video.removeEventListener("pause",this.pauseHandler,!1),this._video.removeEventListener("playing",this.playHandler,!1),this._video.removeEventListener("timeupdate",this.onTimeChange,!1),this._video.removeEventListener("progress",this.progressHandler,!1),this._video.removeEventListener("ended",this.onVideoComplete,!1),this._video.removeEventListener("error",this.checkForFallback,!1),this._$document.unbind("fullscreenchange webkitfullscreenchange",this.fullscreenChangeHandler))}configureVideoElement(){this._video.preload="auto",this._video.load(),this._$video.bind("click",this.startPlayback),this._$video.bind("touchend",this.startPlayback),this._$video.attr("src",this._source)}configureVolume(){this._MediaControls.setVolume(this.api.model.appVolume),this.api.model.isMuted?this._video.volume=0:this._video.volume=this.api.model.appVolume}setImagePoster(){this._$container.find("img.poster-image").attr("src",this.content.getChildByAttribute("id","overlay_still").attributes.src)}setOverlayText(){this._showTitle&&this._$videoTitle.html(this.content.getChildByAttribute("id","overlay_title").text)}configureCaptions(){var e=this.content.getAllDescendantsOfType("line"),i=e.length;this._captions=[];for(let t=0;t<i;t++){var s=e[t];this._captions.push({text:s.text,image:s.attributes.image,cuePoint:parseFloat(s.attributes.cuePoint)})}this._captions.sort((t,e)=>t.cuePoint-e.cuePoint),this.shouldRemoveCCButton()&&this._MediaControls.removeCaptions()}initializeMediaPlayer(){this._$video.show(),this.setContainerClass("show-controls"),!0===this._autoplay&&(this.setContainerClass("autoplay","preparing"),this._MediaControls.togglePlayback()),this.api.addEvent("apiEvent",this.apiEventHandler)}pauseActions(){this._state&&(this._$vid.removeClass("hidePoster"),this._state="paused",this.setContainerClass("paused","playing"))}playActions(){this._$video.unbind("click",this.startPlayback),this._$video.unbind("touchend",this.startPlayback),"preparing"!==this._state&&this._$vid.addClass("hidePoster"),this._state="playing",this.setContainerClass("playing","paused preparing"),this._iosAutoplayTriggered&&!this._iosAutoplayProcessed&&this._isZone&&1<this.zonePosition?(this._iosAutoplayProcessed=!0,this.pauseMedia()):this.api.sendEvent({destination:"MediaPlayer",type:"media_playing",source:this})}timeHandler(){this._MediaControls.setProgress(this._video.currentTime,this._video.duration),this.updateCaptions()}updateCaptions(){if(this._MediaControls.captionsOn){for(let t=this._captions.length-1;0<=t;t--){var e=this._captions[t];if(this._video.currentTime>e.cuePoint){if(e===this._currentCaption)return;this._$captionsContent.html(e.text),this._currentCaption=e;break}}this.adjustZoneMargin()}}completeHandler(){this._MediaControls.completeActions(),this.setContainerClass("replay","playing"),this._$vid.removeClass("hidePoster"),this._state=null}adjustZoneMargin(){if(this._isZone){var e="none"===this._$captionsContent.css("display");let t;t=!0==e?"":Math.max(48,this._$captionsContent.outerHeight()+16),this._$container.css("margin-bottom",t)}}onWindowResize(t,e=!1){!(e="orientationchange"===(null==t?void 0:t.type)?!0:e)&&this._inFullScreenMode||t&&"loadeddata"===t.type&&this.setContainerClass("loaded")}adjustTitleSize(t){t=Math.round(.0015*t*10)/10;this._$videoTitle.css("font-size",t+"rem")}getVideoGutters(){return this.api.getMediaSize()===o.DEVICE_MEDIA_SIZE_XS||this.api.getMediaSize()===o.DEVICE_MEDIA_SIZE_SM?0:parseInt(this.props.videoGutters,10)}setContainerClass(t,e=""){this._$container.removeClass(e).addClass(t)}startAutoplaying(){this._video.play().then(()=>{this.doAutoplayActions()}).catch(()=>{this._$container.removeClass("preparing")})}doAutoplayActions(){this._timerRemaining=0,this._$vid.addClass("hidePoster"),setTimeout(()=>{this.setContainerClass("playing","preparing replay")},200),this._state="playing"}mediaFullscreen(){this._inFullScreenMode=!this._inFullScreenMode,this._inFullScreenMode?this.renderFullscreenVideo():this.exitFullscreenVideo()}renderFullscreenVideo(){var t,e=this._$container.get(0);this._video.requestFullscreen?(t=e.requestFullscreen())&&t.catch(()=>{this.fullscreenChangeHandler()}):this._video.msRequestFullscreen?e.msRequestFullscreen():this._video.webkitRequestFullscreen&&e.webkitRequestFullscreen()}exitFullscreenVideo(){var t,e=this._$document.get(0);e.exitFullscreen?(t=e.exitFullscreen())&&t.catch(()=>{this.onExitFullscreen()}):e.msExitFullscreen?e.msExitFullscreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}onExitFullscreen(){this._inFullScreenMode=!1,r(()=>this.onWindowResize(),100)}initMedia(){window.navigator.userAgent.match(/iphone/gim)&&this._$video.attr("playsinline","playsinline");var t=this._video.play();if(void 0===t)return this.onMediaInit();t.then(()=>{this.onMediaInit()}).catch(()=>{this._inFallbackState?this.onMediaInit():this.pauseActions()})}onMediaInit(){this._state="preparing",this._$videoTitle.addClass("showTitle"),this.setContainerClass("preparing","replay"),this._autoplayTimeout=window.setTimeout(this.hideOverlay,this._titleHoldTime),this._timerStarted=new Date,"off"===this._LaunchDataManager.launchInfo.preferences.audio&&(this._video.volume=0),this.delayPause()}delayPause(){setTimeout(()=>{this._video.pause()},0)}playMedia(){this.startPlayback(),this._$videoTitle.removeClass("showTitle"),clearTimeout(this._autoplayTimeout)}pauseMedia(){this._video.pause(),this.pauseActions()}muteMedia(){this._video.volume=0,this.api.model.isMuted=!0}unMuteMedia(){this._video.volume=this.api.model.appVolume,this.api.model.isMuted=!1}mediaSlideReleased(t){var e=this._video.duration;this._video.currentTime=t*e/100}mediaCCOn(){this._$captionsContent.show(),this.adjustZoneMargin()}mediaCCOff(){this._$captionsContent.hide(),this.adjustZoneMargin()}mediaVolumeAdjusted(t){this._video.volume=this.api.model.appVolume=t,this.api.model.isMuted=0===t}togglePlayback(){"playing"===this._state?this.pauseMedia():"paused"===this._state||"preparing"===this._state?this.playMedia():this._state||this.initMedia()}modalClosedHandler(){var t=this.api.getPreferences(),e=this.api.getDeviceType()===o.DEVICE_IOS&&this._isZone;"preparing"!==this._state&&"paused"!==this._state||(this._autoplayTimeout=window.setTimeout(this.hideOverlay,this._timerRemaining)),t.viewingMode&&t.viewingMode!==this._viewingMode?this.api.reloadCurrentPage():e||"paused"!==this._state||this._videoWasPaused||this.startPlayback()}destroy(){this.api.removeEvent("apiEvent",this.apiEventHandler),clearTimeout(this._autoplayTimeout),this._video&&(this._video.src=""),this.removeListeners(),super.destroy(),this._state=null,this._inFallbackState=!1,this._MediaControls.destroy(),this._MediaControls=null,$(window).off("resize")}}t.AUTOPLAY_TRUE="true",e.AbstractVideo=t}(GLEPlugins=GLEPlugins||{}),function(l){var t=GLECore.ViewingModeManager,d=GLECore.Platform,e=GLECore.ModalManager;class i extends l.AbstractVideo{constructor(t){super(t),this._tg=null,this._setTrackingComplete=!1,this._iosAutoplayProcessed=!1,this._delayTakeNote=!1,this._delayTakeNoteDuration=0,this._isInteractiveVideo=!1,this.apiEventHandler=t=>{t.data.type!==e.MODAL_CLOSED||this._tgOnly?t.data.type===e.MODAL_OPENED?this.modalOpenedHandler():"preferencesUpdate"===t.data.type?this.preferencesUpdateHandler(t):"media_playing"===t.data.type&&"playing"===this._state&&t.data.source!==this&&this.pauseMedia():this.modalClosedHandler()},this._TrackingManager=t.TrackingManager}configureSettings(){super.configureSettings(),this._tg=null,this._delayTakeNote="true"===this.props.delayTakeNote,this._delayTakeNoteDuration=1e3*parseInt(this.props.delayTakeNoteDuration,10),this._autoAdvance="true"===this.props.autoAdvance,this._autoAdvanceDelay=1e3*parseInt(this.props.autoAdvanceDelay,10)}buildComponentHTML(){return this._viewingMode===t.VIEWING_MODE_TG?(this._tg=new l.Slideshow(this._dependencies),this._tg.build(this.content,this.api)):(_.isNull(this._tg)||(this._tg=null),super.buildComponentHTML())}program(t){this.programZone(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} #video-container`:"#video-container",this._$container=$(this._bodySelector),this._$vid=this._$container.find(".vid"),this._tgOnly&&this._delayTakeNote&&this.unpauseTakeNote(),this._tg?(this._$container.addClass("tg"),this._tg.program(t)):(this.initMediaControls(),this.configureVideo(),this.configureCaptions(),this.initializeMediaPlayer())}buildPlayer(){return this._isZone&&1<this.zonePosition&&(this._autoplay=!1),super.buildPlayer()}configureVideo(){this.configureDOM(),this.addListeners(),this.configureVideoElement(),this.configureVolume(),this.props.maxWidth&&this._$dynamicStyles.text("video  {max-width: "+this.props.maxWidth+";}"),this._$window.resize(t=>this.onWindowResize(t)),this.setImagePoster(),this.setOverlayText(),this.configureDevice()}configureDOM(){super.configureDOM(),this._$dynamicStyles=this._$container.find("#dynamic-video-styles")}initializeMediaPlayer(){super.initializeMediaPlayer(),"true"===this.props.completeOnDuration&&this._viewingMode!==t.VIEWING_MODE_TG&&(this._setTrackingComplete=!0),this._isZone||this.trackInit(),this._isZone&&!this._setTrackingComplete&&setTimeout(()=>this.setZoneComplete(),0)}timeHandler(){super.timeHandler(),this._video.currentTime>=this._video.duration-this._durationOffset&&this.trackCompletion()}completeHandler(){super.completeHandler(),this.unpauseTakeNote(),this.trackCompletion(),this._autoAdvance&&this.autoAdvanceMedia()}unpauseTakeNote(){this._delayTakeNote&&this.api.sendEvent({destination:"Annobar",type:"render",delay:this._delayTakeNoteDuration,source:this})}autoAdvanceMedia(){setTimeout(()=>{this._isZone?this.advanceZone():this.api.callNextPage()},this._autoAdvanceDelay)}adjustZoneMargin(){if(this._isZone){var e="none"===this._$captionsContent.css("display");let t;t=!0==e?"":Math.max(48,this._$captionsContent.outerHeight()+16),this._$container.css("margin-bottom",t)}}delayPause(){const t=window.navigator.userAgent.match(/iphone/gim);setTimeout(()=>{this._video.pause(),t&&!this._isInteractiveVideo&&this._$video.attr("playsinline",null)},0)}modalClosedHandler(){var t=this.api.getPreferences(),e=this.api.getDeviceType()===d.DEVICE_IOS&&this._isZone;"preparing"!==this._state&&"paused"!==this._state||(this._autoplayTimeout=window.setTimeout(this.hideOverlay,this._timerRemaining)),t.viewingMode&&t.viewingMode!==this._viewingMode?(this._TrackingManager.setActivityStatus({status:"clearAll",activity:{id:"media",complete:!1}}),this.api.reloadCurrentPage()):e||"paused"!==this._state||this._videoWasPaused||this.startPlayback()}trackInit(){this._setTrackingComplete&&!this._isZone&&this._TrackingManager.setActivityStatus({status:"register",activity:{id:"media",complete:!1,alert:"altPageJump"}})}trackCompletion(){this._setTrackingComplete&&!this._isZone?(this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"media",complete:!0}}),this._setTrackingComplete=!1):(this._setTrackingComplete||this._isZone)&&this.setZoneComplete()}onWindowResize(t,e=!1){super.onWindowResize(t,e),this.updateContainerDimensions()}updateContainerDimensions(){var t=this._$container.find(".vid"),e=this._isZone?$("#MultiZone1-body"):this._$container.parent(),i=this._$video.width(),s=this.api.getMediaSize()===d.DEVICE_MEDIA_SIZE_XS,t=parseInt(t.css("margin-top"),10),a=this._isZone?parseInt($("#"+this._zoneData.zoneId).css("padding-top"),10):0,n=this._video.videoWidth/this._video.videoHeight,a=this._isZone?t+a:t,t=this._inFullScreenMode?window.innerHeight-this._$mediaControls.height():e.height()-2*a-this._$mediaControls.height();let r=this._inFullScreenMode?window.innerWidth:window.innerWidth-this.getVideoGutters(),o=r/n;o>t&&(r=t*n,o=r/n),s?(this._$vid.css("width",""),this._$vid.css("height","")):(this._$vid.css("width",r),this._$vid.css("height",o)),this.adjustTitleSize(i),l.MediaUtil.calculateCaptionPosition(this._$captionsContent,this._inFullScreenMode),this.adjustZoneMargin()}}i.AUTOPLAY_TRUE="true",l.MediaPlayer=i}(GLEPlugins=GLEPlugins||{}),function(h){var e=GLECore.ZoneData,i=GLECore.ViewingModeManager,s=GLECore.QAModeManager,a=GLECore.AlertData,c=GLECore.delay,n=GLECore.isInViewport;class r extends h.IPluggable{constructor(t){super(t),this._zones=[],this._source=[],this._activeZones=[],this._orderedZones=[],this._online=!0,this._alertAdded=!1,this._dynamicFlowComplete=!1,this._dynamicFlowActive=!1,this._pageStore={viewed:[]},this._useStandardBookmarks=!0,this._transitionSpeed=0,this._hideProgressNav=!1,this._requireViewAll=!0,this.onTrackingAlert=t=>{var e=this.api.model.getCurrentPage().complete,i=this.activitiesAreComplete();return!e&&i?"altMultiZoneScroll":t},this.register=(t,e)=>{e=_.find(this._source,{zoneId:e});e.registered=!0,t.zoneData=e,this._zones.push(t)},this.onZoneComplete=t=>{t.zoneData.complete=!0,this.evaluateZoneCompletion(),this.resetNavigationButtons()},this.hideContinueButton=()=>{this._$continueBtn.addClass("hidden")},this.apiEventHandler=t=>{var e;"preferencesUpdate"===t.data.type?(e=t.data.value.viewingMode,r.setViewingMode(e)):"trackingAlertShown"===t.data.type?((e=this._ModalManager.getModalDataById("tracking_alert"))&&(e.preventClickOutsideDismiss=!0),this.handleIncompleteZones()):"trackingAlertDismissed"===t.data.type?this.scrollToFirstIncompleteZone():"pageComplete"===t.data.type&&this.isActiveProfiling()?(this.destroy(),this.api.callNextPage()):"precourseSettingsClosed"===t.data.type&&this.scrollToLastVisibleZone()},this.initializeZone=(t,e,i=!1)=>{const s=$("#"+t.zoneId);var a=$(`#${t.zoneId} .zone-content`).get(0),n=t.templateId,e=this.convertContentContainer(t.content,e+1),r=this._source.indexOf(t)===this._source.length-1;this.api.populate(a,n,e),s.addClass("rendered present"),t.rendered=!0,i&&s.addClass("grouped"),this.isBranchingMode()?this.resetNavigationButtons():(r?s.find(".zone-button.text"):s.find(".zone-button.arrow")).removeClass("hidden"),this.resetRequiredLinkListeners(),this.api.sendEvent({destination:"Style",type:"updateAllPSS"}),c(()=>s.addClass("fadein"),this._scrollSpeed)},this.onRequiredLinkClick=()=>{this.evaluateZoneCompletion(!1)},this.onNavigateZone=t=>{var e=$(t.currentTarget);if(!e.hasClass("inactive")){var i=$(t.currentTarget).closest(".zone"),i=_.find(this._source,{zoneId:i.attr("id")});if(this.isBranchingMode()&&_.last(this._orderedZones)===i)return this.onAdvancePage(t);i=this.getNextZone(e);this.evaluateZoneCompletion(),this.scrollToZone(i)}},this.onPageScroll=()=>{(this._mode===h.ZoneMode.Default?this._source:this._activeZones).forEach(t=>this.trackZoneViewState(t,this._pageStore))},this.trackZoneViewState=(t,e)=>{this.updateViewState(t)&&(t.hasBeenViewed=!0,e.viewed.push(t.zoneId),this.trackZoneView(t),this.checkPageCompletion())},this.onAdvancePage=t=>{var e=$(t.currentTarget).closest(".zone"),e=_.find(this._source,{zoneId:e.attr("id")}),i=this.handleIncompleteZones(),e=!_.isEmpty(this._orderedZones)&&_.last(this._orderedZones)!==e;if(this.isBranchingMode()&&e)return this.onNavigateZone(t);i?this.renderTrackingAlert():this.api.callNextPage()},this.scrollToFirstIncompleteZone=(t,e)=>{e&&this._AlertManager.closeAlert(e);e=$(".zone.incomplete");const i=e.eq(0);e.addClass("render"),i.length&&(this.scrollToZone(i),c(()=>{i.find(".zone-alert").focus()},this._scrollSpeed))},this.setActivityComplete=()=>{this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"multizone",complete:!0}}),this._AlertManager.removeStateChangeAlert("modal_"+r.ALERT_EXIT),this._$continueBtn.removeClass("inactive")},this.scrollToLastVisibleZone=t=>{var e=$(".zone.rendered");const i=t||e.last();1!==e.length&&c(()=>this.scrollToZone(i),500)},this._ViewingModeManager=t.ViewingModeManager,this._AlertManager=t.AlertManager,this._ModalManager=t.ModalManager,this._RouteManager=t.RouteManager,this._TrackingManager=t.TrackingManager}get zones(){return this._activeZones}get mode(){return this._mode}build(t,e){super.build(t,e),this._data=t.getFirstChildOfType("Data"),this._mode=this._data.attributes.mode,this._scrollSpeed=1e3*parseFloat(this._data.attributes.scrollSpeed),this._launchedPage=this.api.model.currentPage.id,this._requireViewAll="true"===this._data.attributes.requireViewAll,this._zoneViewPercentage=parseInt(this._data.attributes.zoneViewPercent),this._transitionSpeed=parseFloat(this._data.attributes.transitionSpeed),this._hideProgressNav="true"===this._data.attributes.hideProgressNav,this._online=!this.api.detectOffline(),(r.activeZone=this).initializeZoneData(),this.processConditionalBranches(),this.setHelper(),this.updateActiveZones();e=this.api.getTemplate(this._data.attributes.templateID);return _.template(e.content)({qa:s.QA_MODE_ENABLED,mode:this._mode,zones:this._source,device:this.api.getDeviceType()})}setHelper(){this._helper=new h.ZoneProfileHelper(this._RouteManager),this._dynamicFlowActive=this._helper.active,this._dynamicFlowComplete=this._helper.evaluate(this._source)}program(){this.trackingInit(),this.wireNavigation(),this.initializeZones(),this.checkPageCompletion(),r.setViewingMode(this._ViewingModeManager.currentViewingMode),this.api.addEvent("apiEvent",this.apiEventHandler),this.restoreFromTracking(),this.onPageScroll(),this._hideProgressNav&&this.api.sendEvent({destination:"ProgressBar",type:"SetProgressDisplayMode",value:h.ProgressDisplayType.HideNavigation})}destroy(){this.api.sendEvent({destination:"ProgressBar",type:"SetProgressDisplayMode"}),_.each(this._zones,t=>{try{t.destroy&&t.destroy()}catch(t){}}),this._source=[],this._zones=[],this._activeZones=[],this._orderedZones=[],this._dynamicFlowActive=!1,r.activeZone=null,this._AlertManager.removeStateChangeAlert("modal_"+r.ALERT_EXIT),this.api.removeEvent("apiEvent",this.apiEventHandler)}addNavigationAlert(t){var e;this.api.model.getCurrentPage().complete||this._alertAdded||(e=r.ALERT_EXIT,this._AlertManager.addStateChangeAlert(new a({id:"modal_"+e,content:t,renderAsModalAlert:!0,hasExit:!1,exitCallback:()=>{this._helper.cleanup(!0,this._source,this._orderedZones)}})),this._alertAdded=!0)}advanceZone(t){$(`#${t.zoneId} .zone-button:not(.hidden)`).trigger("click")}updateBranches(t,i=!1){if(this._mode===h.ZoneMode.Branching){var s=this._source.filter(t=>t.conditional);const d=(null==(a=t.selectedBranches)?void 0:a.map(t=>_.find(this._source,{zoneId:t})))||[];let e=[];_.each(s,t=>t.hidden=!0),_.each(this._source,t=>{!t.conditional&&_.isEmpty(d)||t.conditional&&-1===e.indexOf(t.zoneId)||t.selectedBranches&&(e=_.uniq(e.concat(t.selectedBranches)))}),_.each(e,t=>{_.find(this._source,{zoneId:t}).hidden=!1}),this._orderedZones=this.orderZones();var a=$("#"+t.zoneId).index(),n=$(".zone").length;for(let t=a+1;t<n;t++){var r=$(".zone").eq(t),o=_.find(this._source,{zoneId:r.attr("id")}),l=_.find(this._zones,{zoneData:o});if(l)try{l.destroy()}catch(t){}r.removeClass("rendered fadein").find(".zone-content").html(""),o.rendered=!1}this._helper.cleanup(!1,this._source,this._orderedZones),this.updateActiveZones(),!0===i&&c(()=>this.advanceZone(t),100)}}orderZones(){let e=this._source.filter(t=>!t.conditional);for(let t=0;t<e.length;t++){var i=e[t].selectedBranches.map(t=>_.find(this._source,{zoneId:t}));e.splice(t+1,0,...i)}return e=_.uniq(e),_.each(e,(t,e)=>{t=$("#"+t.zoneId);0!==e&&(e=$(".zone").eq(e-1),t.insertAfter(e))}),e}resetNavigationButtons(){if(this._mode===h.ZoneMode.Branching){var t=this._orderedZones;const a=_.last(t),n=this.getLastVisibleZone();_.each(this._source,t=>$(`#${t.zoneId} .zone-button`).addClass("hidden").removeClass("inactive")),_.each(t,t=>{var e=_.eq(t,n),i=_.eq(t,a),s=t.complete||!t.registered;i&&!s?$(`#${t.zoneId} .zone-button.text`).removeClass("hidden").addClass("inactive"):i&&s?$(`#${t.zoneId} .zone-button.text`).removeClass("hidden"):e&&!s?$(`#${t.zoneId} .zone-button.arrow`).removeClass("hidden").addClass("inactive"):$(`#${t.zoneId} .zone-button.arrow`).removeClass("hidden")})}}getLastVisibleZone(){return _.last(this._activeZones)}isActiveProfiling(){var t=this._TrackingManager.active&&!s.QA_TRACKING_MODE_DISABLED;return this._RouteManager.profilingActive&&this._launchedPage===this.api.model.currentPage.id&&t}static setViewingMode(t){var e=$(".zone");t===i.VIEWING_MODE_TG?e.addClass("tg"):e.removeClass("tg")}initializeZoneData(){var t=this.getPageZones();_.each(t,t=>{this._source.push(new e(t))}),_.first(this._source).rendered=!0}processConditionalBranches(){let e=[];_.each(this._source,t=>e=_.uniq(e.concat(t.branches))),_.each(e,t=>{t=_.find(this._source,{zoneId:t});t.hidden=!0,t.conditional=!0}),e.length&&this._mode===h.ZoneMode.Sequential&&(this._mode=h.ZoneMode.Branching)}updateActiveZones(){this._mode===h.ZoneMode.Default?(this._activeZones=this._source.concat(),this._activeZones.forEach(t=>t.rendered=!0)):(this._activeZones=this._source.filter(t=>t.rendered),_.isEmpty(this._orderedZones)&&(this._orderedZones=this._activeZones),this.resetNavigationButtons())}getPageZones(){const i=this.content.getChildrenOfType("Zone"),s=i.filter(t=>t.attributes.offlineZone).map(t=>t.attributes.offlineZone);if(this._online)return i.filter(t=>-1===s.indexOf(t.attributes.zoneID));const a=[];return _.each(i,e=>{var t=_.find(i,t=>t.attributes.zoneID===e.attributes.offlineZone);e.attributes.offlineZone||-1!==s.indexOf(e.attributes.zoneID)?e.attributes.offlineZone&&t&&a.push(t):a.push(e)}),a}initializeZones(t){t=t||this._activeZones;_.each(t,(t,e)=>this.initializeZone(t,e)),this._online&&this.handleOfflineZones(),this._dynamicFlowComplete&&this.handleUnrenderedZones()}handleUnrenderedZones(){$(".zone:not(.rendered)").remove()}resetRequiredLinkListeners(){$("*[data-required-id]").off("click",this.onRequiredLinkClick).on("click",this.onRequiredLinkClick)}handleOfflineZones(){var t=this.content.getChildrenOfType("Zone");const e=t.filter(t=>t.attributes.offlineZone).map(t=>t.attributes.offlineZone);t=t.filter(t=>-1!==e.indexOf(t.attributes.zoneID));const a=[];_.each(t,t=>{var e=/data-required-id="(.*?)"/gim,i=t.sourceXML.textContent;let s=e.exec(i);for(;s;)a.push(parseInt(s[1])),s=e.exec(i)}),a.length&&setTimeout(()=>{this.api.sendEvent({destination:"RequiredLinks",type:"RequiredLinkIgnore",ids:a})})}convertContentContainer(t,e){var i=t.getFirstChildOfType("Background");return _.isEmpty(i)||(i=i.getChildrenOfType("Image"),_.each(i,t=>{"background"===t.attributes.target&&(t.attributes.target="zone-$"+e)})),t}wireNavigation(){this._$continueBtn=$(".zone-button.text"),this._$continueBtn.click(this.onAdvancePage),$(".zone-button.arrow").click(this.onNavigateZone),$(".page-body").on("scroll",this.onPageScroll)}updateViewState(t){var e=$("#"+t.zoneId).get(0);return n(e,this._zoneViewPercentage)&&!t.hasBeenViewed}trackZoneView(t){this._TrackingManager.saveStandardZoneBookmark(this._launchedPage,t.zoneId)}getNextZone(t){var t=t.closest(".zone"),e=t.next();return $(".zone.rendered").last().attr("id")===t.attr("id")?this._mode==h.ZoneMode.Sequential?this.buildNextZonesInSequence(t):this.isBranchingMode()&&this.allowBranchBuilding()?this.buildNextBranchedZones(t):e:e}allowBranchBuilding(){return!this._dynamicFlowComplete}buildNextZonesInSequence(t){var e=t.next(),t=t.attr("id"),i=e.attr("id"),t=_.find(this._source,{zoneId:t}),i=_.find(this._source,{zoneId:i}),i=_.isEmpty(t.triggers)?[i]:t.triggers.map(t=>_.find(this._source,{zoneId:t}));return _.each(i,t=>{var e=this._source.indexOf(t);this.initializeZone(t,e)}),this.updateActiveZones(),e}buildNextBranchedZones(e){var t=this._orderedZones.find(t=>t.zoneId===e.attr("id")),i=this.getNextZoneData(e);const s=null==i?void 0:i.zoneId;var t=(null!=(t=t.selectedGroups)?t:[]).find(t=>-1!==t.split(":").indexOf(s)),t=(null!=(t=null==t?void 0:t.split(":").filter(t=>t!==s))?t:[]).map(e=>this._orderedZones.find(t=>t.zoneId===e));return _.isEmpty(i)?e:(this.initializeZone(i,this._orderedZones.indexOf(i),!!t.length),t.forEach(t=>this.initializeZone(t,this._orderedZones.indexOf(t),!0)),this.updateActiveZones(),this.api.sendEvent({destination:"RequiredLinks",type:"RequiredLinkUpdate",$container:$("#"+s),currentPage:this.api.getCurrentPage()}),this.api.sendEvent({destination:"All",type:"NewZonesRendered",$container:$("#"+s),currentPage:this.api.getCurrentPage()}),$("#"+s).find("input:checked").length&&$("#"+s).find("input").attr("disabled",null),$("#"+s))}getNextZoneData(t){t=_.find(this._orderedZones,{zoneId:t.attr("id")}),t=this._orderedZones.indexOf(t);return this._orderedZones[t+1]}scrollToZone(t){t.get(0).scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}handleIncompleteZones(i=!0){let s=!1;var t;return!this.api.model.currentPage.complete&&(t=this.isBranchingMode()?this._zones.filter(t=>_.find(this._orderedZones,{zoneId:t.zoneData.zoneId})):this._zones,_.each(t,t=>{var e=t.hasIncompleteRequiredLinks(),i=t.zoneData.registered&&!t.zoneData.complete,t=t.$element;t.removeClass("incomplete render"),(e||i)&&(s=!0,t.addClass("incomplete"))}),t=this._mode===h.ZoneMode.Default?this._activeZones.filter(t=>!t.registered):this._orderedZones.filter(t=>!t.registered),_.each(t,t=>{var e=$("#"+t.zoneId),t=$(`#${t.zoneId} [data-required-id]:not(.visited)`);e.removeClass("incomplete render"),t.length&&(s=!0,e.addClass(i?"incomplete":""))}),s)}renderTrackingAlert(){var t={id:r.ALERT_ID,content:"{tk_MultiZoneAlert}",preventClickOutsideDismiss:!0,autoRemove:!1,exitCallback:this.scrollToFirstIncompleteZone};this._AlertManager.showAlert(new a(t))}checkPageCompletion(){var t=this.api.model.currentPage.complete,e=_.filter(this._activeZones,t=>t.registered),i=_.every(this._source,t=>t.rendered),s=this.viewRequirementsAreSatisfied(),t=t||this.activitiesAreComplete()||0===e.length;s&&t&&this._$continueBtn.removeClass("inactive"),s&&t&&i&&this.trackingComplete()}viewRequirementsAreSatisfied(){let t=!0;return t=this._mode===h.ZoneMode.Default&&this._requireViewAll?_.every(this._source,t=>t.hasBeenViewed):t}evaluateZoneCompletion(t=!0){t=this.handleIncompleteZones(t);this.viewRequirementsAreSatisfied()&&this.activitiesAreComplete()&&!t&&this.trackingComplete()}activitiesAreComplete(){var t=_.filter(this._activeZones,t=>t.registered),t=_.every(t,{complete:!0}),e=_.filter(this._source,t=>!t.hidden),e=_.every(e,t=>t.rendered);return!1!==t&&!1!==e}trackingInit(){var t=this._mode===h.ZoneMode.Default&&this._requireViewAll?this._data.attributes.scrollAlertId:this._data.attributes.activityAlertId;this._TrackingManager.setActivityStatus({status:"register",activity:{id:"multizone",complete:!1,alert:t}})}trackingComplete(){this._mode===h.ZoneMode.Branching?this.api.sendEvent({destination:"RequiredLinks",type:"ForceRequiredLinkCompletion"}).then(this.setActivityComplete):this.setActivityComplete()}restoreFromTracking(){var t,e;this._useStandardBookmarks&&(t=(e=this._TrackingManager.getStandardZoneBookmarkForPage(this.api.model.currentPage.id)).map(t=>"#"+t).join(","),this._mode===h.ZoneMode.Sequential&&e.forEach(e=>{var t=this._source.find(t=>t.zoneId===e),i=this._source.indexOf(t);this.initializeZone(t,i)}),_.isEmpty(t)||(e=$(t).addClass("rendered").last(),this.scrollToLastVisibleZone(e)))}isBranchingMode(){return this._mode===h.ZoneMode.Branching||this._mode===h.ZoneMode.Presentation}}r.ALERT_ID="multizone_alert",r.ALERT_EXIT="altMultiZoneExit",r.activeZone=null,h.MultiZone=r}(GLEPlugins=GLEPlugins||{}),function(t){var s=GLECore.MagicButtonManager;class c extends t.AbstractZone{constructor(t){super(t),this._complete=!1,this._requiredToComplete=!0,this._allowMultipleOpen=!1,this.buildAccordionGroupTemplateData=(t,e,i)=>{var s=t.getFirstChildOfType("ColumnHeader");return{columnHeader:s?s.text:null,items:_.map(t.getChildrenOfType("Item"),this.buildAccordionItemTemplateData),size:1<i.length?"":"size-"+this._singleColumnWidth}},this.buildAccordionItemTemplateData=t=>{var e=t.getFirstChildOfType("ItemHeader"),i=t.getFirstChildOfType("ItemContent"),s=e.getFirstChildOfType("Text").text,e=e.getFirstChildOfType("Image"),a=!this.api.detectSVGOverride()&&!_.isEmpty(e)&&/\.svg/i.test(e.attributes.src),n=_.isEmpty(e)?null:e.getFirstChildOfType("Description"),r=i.getFirstChildOfType("Image"),o=_.isEmpty(r)?null:r.getFirstChildOfType("Description"),i=i.getFirstChildOfType("Text"),l=_.isEmpty(r)?null:c.validateImageType(t.attributes.imageType),d=this.content.getChildByAttribute("id","expandicon"),h=this.content.getChildByAttribute("id","collapseicon");return{header:s,headerImage:_.isEmpty(e)?null:e.attributes.src,headerImageAlt:_.isEmpty(n)?"":n.text,headerImageIsSVG:a,image:_.isEmpty(r)?null:r.attributes.src,imageType:l,imageAlign:c.validateImageAlign(t.attributes.imageAlign,l),imageAlt:_.isEmpty(o)?"":o.text,expandIcon:_.isEmpty(d)?null:d.attributes.src,collapseIcon:_.isEmpty(h)?null:h.attributes.src,expandIconIsImg:this.api.detectSVGOverride()&&!_.isEmpty(d),collapseIconIsImg:this.api.detectSVGOverride()&&!_.isEmpty(h),text:i.text}},this.onItemActivate=t=>{var t=$(t.currentTarget),e=t.closest(".accordion-item").data("index"),i=$(this._bodySelector).find(".accordion-item:not(.accordion-item-"+e+")"),s=t.find(".accessible-text");t.hasClass("complete")||this.api.sendEvent({destination:"Style",type:"applyPageClasses"}),e?(this._allowMultipleOpen||(this._$controls.attr("aria-describedby",null),i.accordion({active:!1,animate:250})),t.attr("aria-describedby",t.attr("aria-controls")),t.addClass("complete"),s.attr("aria-hidden","false").html(this.api.parseTokens("{tk_AccordionItemIsComplete}")),this._requiredToComplete&&!this._complete&&this.checkAllComplete()):this._$controls.attr("aria-describedby",null)},this._MagicButtonManager=t.MagicButtonManager,this._TrackingManager=t.TrackingManager}build(t,e){super.build(t,e),this._data=t.getChildrenOfType("Data")[0],this._requiredToComplete="true"===this._data.attributes.requiredToComplete,this._allowMultipleOpen="true"===this._data.attributes.allowMultipleOpen,this._singleColumnWidth=parseInt(this._data.attributes.singleColumnWidth,10),this._groups=_.map(t.getChildrenOfType("AccordionGroup"),this.buildAccordionGroupTemplateData);e=this.api.getTemplate(this._data.attributes.templateID);let i=_.template(e.content)(this.buildTemplateContent());return i=s.isMagicButtonInText(i)?this._MagicButtonManager.replaceMagicButtonsInTextWithHtml(i):i}program(t){super.program(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} #Accordion-body`:"#Accordion-body",this._$container=$(this._bodySelector).find(".accordion-container"),this._$wrapper=$(this._bodySelector).find(".accordion-page-wrapper"),this.wireAccordionButtons(),this._$wrapper.addClass("columns-"+this._groups.length),!0!==this._requiredToComplete||this._isZone||this.trackAccInit(),!1===this._requiredToComplete&&this._isZone&&(this.zoneData.complete=!0)}buildTemplateContent(){return{expandIconPosition:this._data.attributes.expandIconPosition,groups:this._groups}}static validateImageAlign(t,e){return _.isEmpty(t)||t.toLowerCase()!==c.IMAGE_ALIGN_RIGHT?e===c.IMAGE_TYPE_INLINE?c.IMAGE_ALIGN_LEFT:_.isEmpty(t)||t.toLowerCase()!==c.IMAGE_ALIGN_BOTTOM?c.IMAGE_ALIGN_TOP:c.IMAGE_ALIGN_BOTTOM:c.IMAGE_ALIGN_RIGHT}static validateImageType(t){return _.isEmpty(t)||t.toLowerCase()!==c.IMAGE_TYPE_BLOCK?c.IMAGE_TYPE_INLINE:c.IMAGE_TYPE_BLOCK}wireAccordionButtons(){this._$controls=$(this._bodySelector).find(".accordion-item-header"),$(this._bodySelector).find(".accordion-item").accordion({header:".accordion-item-header",active:!1,collapsible:!0,heightStyle:"content",beforeActivate:this.onItemActivate,activate:(t,e)=>{e.oldHeader.attr("aria-expanded","false")},animate:250})}checkAllComplete(){this._$container.find(".accordion-item-header.complete").length===this._$controls.length&&(this._complete=!0,this.trackACCCompletion())}trackAccInit(){this._TrackingManager.setActivityStatus({status:"register",activity:{id:"accordion",complete:!1,alert:this._data.attributes.activityAlertId}})}trackACCCompletion(){this._isZone?this.setZoneComplete():this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"accordion",complete:!0}})}destroy(){this._data=null,this._complete=!1,this._requiredToComplete=!0,this._allowMultipleOpen=!1}}c.IMAGE_TYPE_BLOCK="block",c.IMAGE_TYPE_INLINE="inline",c.IMAGE_ALIGN_LEFT="left",c.IMAGE_ALIGN_RIGHT="right",c.IMAGE_ALIGN_TOP="top",c.IMAGE_ALIGN_BOTTOM="bottom",t.Accordion=c}(GLEPlugins=GLEPlugins||{}),function(t){var n=GLECore.Trace,o=GLECore.AssessmentFlow,l=GLECore.FeedbackType,r=GLECore.AssessmentPhase,d=GLECore.AssessmentHelper;class e extends t.AbstractZone{constructor(t){super(t),this._bodySelector=null,this.onItemActivate=t=>{var t=$(t.currentTarget).closest(".accordion-item").data("index"),e=$(this._bodySelector).find(`.accordion-item:not(.accordion-item-${t})`);t&&e.accordion({active:!1,animate:250})},this._TrackingManager=t.TrackingManager}build(t,e){return super.build(t,e),this.buildTemplateData()}program(t){super.program(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} #analytics1-body`:"#analytics1-body",this.wireAccordion()}buildTemplateData(){var t=this.api.getTemplate("p_analytics_review"),t=_.template(t.content),e=this.getSummary(r.PreTest),i=this.getSummary(r.PostTest),s=this.getTokens();let a=!1;return _.isEmpty(e)&&(n.error('There is no assessment with a "pre" phase attribute in this course'),a=!0),_.isEmpty(i)&&(n.error('There is no assessment with a "post" phase attribute in this course'),a=!0),a?"":t({tokens:s,summaries:[e,i]})}getSummary(t){var e,i,s=$(this.api.model.contentXml),a=s.find(`Data[templateID="p_assessment"][phase="${t}"]`).closest("Page").attr("pageID"),s=s.find("TerminalOutcome").attr("id"),n=this.api.getPageById(a);return _.isEmpty(n)?null:(n=n.xmlContainer.getChildByAttribute("id","courseassessment"),i=this._TrackingManager.trackingObject,e=d.deserializeAssessmentData(i.getAssessmentData(t)),i=d.deserializeAssessmentData(i.suspendData.analytics),{type:t,confidence:s=this.getConfidence(s,t,i),confidenceLabel:this.api.parseTokens(`{tk_ConfidenceRating${s}}`),score:e.score+"%",questions:this.reconstructQuestions(a,n,i)})}reconstructQuestions(r,t,o){var e=t.getAllDescendantsOfType("Question");const l=t.getFirstChildOfType("Data").attributes.flow;return e.map((t,e)=>{var i,s,a,n,e=_.padStart((e+1).toString(),3,"0"),e=null==(e=o[r+"_"+e])?void 0:e.split(",").map(t=>parseInt(t));return _.isEmpty(e)?null:(i=e[0],e=e[1],s=this.api.parseTokens(`{tk_ConfidenceRating${e}}`),n=(a=this.reconstructChoices(t.getChildrenOfType("Response"),i))[i],{text:t.getFirstChildOfType("QuestionText").text,confidence:e,confidenceLabel:s,response:n,choices:a,feedback:this.getFeedback(t,n,i,l)})}).filter(t=>!_.isEmpty(t))}reconstructChoices(t,i){return t.map((t,e)=>{return{correct:"true"===t.attributes.correct,selected:e===i,text:t.text}})}getConfidence(t,e,i){e=$(this.api.model.contentXml).find(`Data[phase=${e}][outcome=${t}]`).closest("Page"),t=i[e.attr("pageID")],i=parseInt(t.replace(/^.*-/gim,""))-1,t=e.find("Choice").eq(i);return parseInt(t.attr("confidence"))}getFeedback(t,e,i,s){var a=t.getChildrenOfType("Feedback"),n=t.getFirstChildOfType("Review"),i=t.getChildByAttribute("choiceNum",(i+1).toString()),r=t.getChildByAttribute("type",l.Correct),t=t.getChildByAttribute("type",l.Incorrect),a=_.first(a.filter(t=>_.isEmpty(t.attributes.type)&&_.isEmpty(t.attributes.choiceNum)));return _.isEmpty(n)||s!==o.Continuous?_.isEmpty(i)?!_.isEmpty(r)&&e.correct?r.text:_.isEmpty(t)||e.correct?_.isEmpty(a)?null:a.text:t.text:i.text:n.getFirstChildOfType("Text").text}getTokens(){return{header:this.getToken("header","tk_AnalyticsHeader"),preTestConfidenceHeader:this.getToken("preTestConfidence","tk_PreTestConfidence"),postTestConfidenceHeader:this.getToken("postTestConfidence","tk_PostTestConfidence"),preTestScore:this.getToken("preTestScore","tk_preTestScore"),postTestScore:this.getToken("postTestScore","tk_postTestScore"),preTestQuestionsHeader:this.getToken("preTestQuestions","tk_PreTestQuestions"),postTestQuestionsHeader:this.getToken("postTestQuestions","tk_PostTestQuestions"),questionConfidenceHeader:this.getToken("questionConfidence","tk_QuestionConfidence")}}getToken(t,e){return(null==(t=this.content.getChildByAttribute("id",t))?void 0:t.text)||this.api.parseTokens(`{${e}}`)}wireAccordion(){$(this._bodySelector).find(".accordion-item").accordion({header:".accordion-item-header",active:!1,collapsible:!0,heightStyle:"content",beforeActivate:this.onItemActivate,activate:(t,e)=>{e.oldHeader.attr("aria-expanded","false")},animate:250})}}t.AnalyticsReview=e}(GLEPlugins=GLEPlugins||{}),function(t){var i=GLECore.ModalManager,e=GLECore.ModalData,s=GLECore.ViewingModeManager;class a extends t.IPluggable{constructor(t){super(t),this._annos=[],this._opened=!1,this._autoPlayDelay=0,this._autoPlay=!1,this._memory=!1,this._timeout=0,this.updateHandler=t=>{clearTimeout(this._timeout),this._ModalManager.removeModalObjectById(a.ANNOBAR_MODAL_ID),this._currentPage=t.data,this._currentAnnobar=this.getAnnoByID(this._currentPage.id),this.buildAnnobar(),this.processContent(),this.displayAnnobarButton(),this.handleAutoPlay()},this.autoPlayHandler=()=>{this.showAnnobar({autoPlay:!0})},this.closeHandler=()=>{this._ModalManager.closeModal(a.ANNOBAR_MODAL_ID),this.hideAnnobar()},this.apiEventHandler=t=>{var e;t.data&&("showAnnobar"===t.data.type?(this._$launcherButton=t.data.$launcher_button,this.buildAnnobar(),this.processContent(),this.showAnnobar({autoPlay:!1})):t.data.type===i.MODAL_CLOSED?t.data.modalId===a.ANNOBAR_MODAL_ID&&this.hideAnnobar():"Annobar"===t.data.destination&&null!=(e=this._currentAnnobar)&&e.autoOpen&&"render"===t.data.type&&(this._timeout=window.setTimeout(this.autoPlayHandler,t.data.delay)))},this._ModalManager=t.ModalManager,this._ViewingModeManager=t.ViewingModeManager}build(t,e){if(super.build(t,e),t.parent&&"Page"===t.parent.type)return null;this._data=this.content.getChildrenOfType("Data")[0],this.initEvents(),this.initConfig(),this.buildAnnoCollection()}initEvents(){this.api.addEvent("pageUpdate",this.updateHandler),this.api.addEvent("apiEvent",this.apiEventHandler)}initConfig(){this._autoPlayDelay=1e3*parseFloat(this._data.attributes.autoplayDelay),this._memory="false"!==this._data.attributes.memory.toString().toLowerCase(),this._autoPlay="false"!==this._data.attributes.autoplay.toString().toLowerCase()}buildAnnoCollection(){var t,e=this.api.model.content.getAllDescendantsOfType("AnnoBar");for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t={id:(t=e[i]).parent.attributes.pageID,header:t.getChildrenOfType("HeaderText")[0].text,content:t.getChildrenOfType("ContentText")[0].text,open:!1,registeredLinks:!1,autoPlayDelay:t.attributes.autoplayDelay?1e3*parseFloat(t.attributes.autoplayDelay):this._autoPlayDelay,autoOpen:this.shouldAnnoAutoOpen(t)},this._annos.push(t))}buildAnnobar(){_.isUndefined(this._currentAnnobar)||(this._modalParams={$modalEl:void 0,autoRemove:!1,exitCallback:null,isAlert:!1,preventClickOutsideDismiss:!1,scheduledForDeletion:!1,zoneId:"",id:a.ANNOBAR_MODAL_ID,header:this.api.parseTokens("{tk_TakeNote}"),content:this.getAnnoContent(),sourceElement:"root",buttons:[{id:"annobar_close",label:this.api.parseTokens("{tk_CloseUpperCase}"),callback:this.closeHandler}],hasExit:!0,isFullScreen:!1,$launcher:$()},this._$modal=this._ModalManager.preBuildModal(new e(this._modalParams.id,this._modalParams.header,this._modalParams.content,this._modalParams.sourceElement,this._modalParams.buttons,this._modalParams.hasExit,this._modalParams.$launcher,null,this._modalParams.isFullScreen),!0))}processContent(){this.registerRequiredLinks()}registerRequiredLinks(){var t;_.isUndefined(this._currentAnnobar)||(t=!0===this._currentAnnobar.registeredLinks?"RequiredLinkUpdate":"RequiredLink",this._currentAnnobar.registeredLinks=!0,this.api.sendEvent({destination:"RequiredLinks",type:t,$container:this._$modal,currentPage:this._currentPage}))}displayAnnobarButton(){var t=!_.isUndefined(this._currentAnnobar)&&this._currentPage.id===this._currentAnnobar.id;this.api.sendEvent({type:"showAnnobarButton",show:t})}handleAutoPlay(){var t,e;_.isUndefined(this._currentAnnobar)||(t=!!$(this._currentPage.xmlContainer.sourceXML).find("Data[delayTakeNote=true]").get(0),e=this._ViewingModeManager.currentViewingMode===s.VIEWING_MODE_TG,t&&!e)||this._currentAnnobar.autoOpen&&(0<this._currentAnnobar.autoPlayDelay?this._timeout=window.setTimeout(this.autoPlayHandler,this._currentAnnobar.autoPlayDelay):0===this._currentAnnobar.autoPlayDelay&&this.showAnnobar({autoPlay:!0}))}showAnnobar(t){clearTimeout(this._timeout),this._currentAnnobar&&!this._currentAnnobar.open&&(this._memory&&(this._currentAnnobar.autoOpen=!1,this._currentAnnobar.open=!0),this.openAnnobarModal(t.autoPlay))}openAnnobarModal(t){this._modalParams.$launcher=t?$():this._$launcherButton,this._modalParams.$modalEl=this._$modal,this._ModalManager.openModal(this._modalParams,!0)}getAnnoContent(){var t={header:this._currentAnnobar.header,content:this._currentAnnobar.content};return _.template(this.api.getTemplate("AnnobarContent").content)(t)}hideAnnobar(){this._currentAnnobar&&this._memory&&(this._currentAnnobar.open=!1),this._opened=!1}program(t){super.program(t)}shouldAnnoAutoOpen(t){return _.isEmpty(t.attributes.autoOpen)||"true"!==t.attributes.autoOpen&&"false"!==t.attributes.autoOpen?this._autoPlay:"false"!==t.attributes.autoOpen}getAnnoByID(t){for(const e in this._annos)if(Object.prototype.hasOwnProperty.call(this._annos,e)&&this._annos[e].id===t)return this._annos[e]}destroy(){super.destroy(),clearTimeout(this._timeout)}}a.ANNOBAR_MODAL_ID="annobar_modal",t.Annobar=a}(GLEPlugins=GLEPlugins||{}),function(i){var s=GLECore.Trace,a=GLECore.ViewingModeManager,e=GLECore.SettingsManager,n=GLECore.MediaControls,r=GLECore.DataUtil,o=GLECore.MagicButtonManager,l=GLECore.ModalManager;class t extends i.AbstractZone{constructor(t){super(t),this._config={},this._audioWasPaused=!1,this._isMatchAudio=!1,this._setTrackingComplete=!1,this._showCCTextForTG=!1,this._showTextContentForTG=!1,this._tgTexts=[],this._renderTG=!1,this._autoPlay=!0,this._delayTakeNote=!1,this._delayTakeNoteDuration=0,this.onExitZone=()=>{"playing"===this._state&&this.pauseMedia()},this.initMedia=()=>{this._state="preparing",this.setContainerClass("playing","replay"),this._$imageOverlay.removeClass("render").addClass("hidden"),this._isMatchAudio&&this._MatchAudioHelper.reset(),this.startPlayback(),this.sendAudioState(),this.api.sendEvent({destination:"MediaPlayer",type:"media_playing",source:this})},this.apiEventHandler=t=>{if(!_.isUndefined(_.get(t,"data.type")))switch(t.data.type){case l.MODAL_CLOSED:this.modalClosedHandler();break;case l.MODAL_OPENED:this.modalOpenedHandler();break;case"preferencesUpdate":this.preferencesUpdateHandler(t);break;case"audioPlayRequest":t.data.zoneId?this.zonePlayRequestHandler(t.data.zoneId):this.playRequestHandler();break;case"audioDestroyRequest":t.data.zoneId&&this.zoneDestroyRequestHandler(t.data.zoneId);break;case"audioPauseRequest":t.data.zoneId?this.zonePauseRequestHandler(t.data.zoneId):this.pauseRequestHandler();break;case"setAudioAutoAdvance":this._$container.closest(t.data.context).length&&(this._autoAdvance=!0===t.data.value);break;case"media_playing":"playing"===this._state&&t.data.source!==this&&this.pauseMedia()}},this.modalClosedHandler=()=>{"paused"!==this._state||this._audioWasPaused||this._renderTG||this.startPlayback()},this.modalOpenedHandler=()=>{"playing"===this._state?(this._audio.pause(),this.pauseActions(),this._audioWasPaused=!1):"playing"!==this._state&&(this._audioWasPaused=!0)},this.preferencesUpdateHandler=t=>{_.isUndefined(_.get(t,"data.value"))||(this._renderTG=!!this._config.tgOnly||this.api.getPreferences().viewingMode===a.VIEWING_MODE_TG,this.configureTGPresentation(),this.showCC(),this.configureVolume(),this.completeOnTgMode()&&this.trackCompletion(),this.setPlayerPresentation())},this.playRequestHandler=()=>{"playing"!==this._state&&this._MediaControls.togglePlayback()},this.pauseRequestHandler=()=>{"playing"===this._state&&(this.pauseMedia(),this._MediaControls.togglePlayback())},this.completeHandler=()=>{this._MediaControls.completeActions(),this._MatchAudioHelper&&this._MatchAudioHelper.completeActions(),this.setContainerClass("replay","playing"),this._state=null,this._autoAdvance&&this.autoAdvanceMedia()},this.timeHandler=()=>{this._MediaControls.setProgress(this._audio.currentTime,this._audio.duration),this._isMatchAudio&&this._MatchAudioHelper.timeUpdateHandler(this._audio.currentTime),this._audio.currentTime>=this._audio.duration-parseFloat(this._config.durationCompletionOffset)&&this.trackCompletion()},this.progressHandler=()=>{try{let t=Math.floor(this._audio.buffered.end(0))/Math.abs(this._audio.duration);.95<t&&(t=1),this._MediaControls.setBuffering(t)}catch(t){}},this.pauseHandler=()=>{this.pauseActions()},this.playHandler=()=>{this.playActions()},this._ViewingModeManager=t.ViewingModeManager,this._MagicButtonManager=t.MagicButtonManager,this._SettingsManager=t.SettingsManager,this._LanguageManager=t.LanguageManager,this._LaunchDataManager=t.LaunchDataManager,this._TrackingManager=t.TrackingManager}build(t,e){return super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0],this._MediaControls=new n(e),this.setUpConfig(),this._isMatchAudio=0<$(this.content.sourceXML).find("Bullet").length,this._isMatchAudio&&(this._MatchAudioHelper=new i.MatchAudioHelper(t,e,this._MagicButtonManager,this.dependencies,this._isZone,this.zoneId)),this._renderTG="true"===this._config.tgOnly||this._ViewingModeManager.currentViewingMode===a.VIEWING_MODE_TG,this.setPathAndFileName(),this.buildAudioPlayerMarkup()}setUpConfig(){_.each(this._data.attributes,(t,e)=>{this._config[e]=t.replace(/\s*/gi,"")}),this._delayTakeNote="true"===this._config.delayTakeNote,this._delayTakeNoteDuration=1e3*parseInt(this._config.delayTakeNoteDuration,10),this._autoAdvance="true"===this.props.autoAdvance,this._autoAdvanceDelay=1e3*parseInt(this.props.autoAdvanceDelay,10)}setPathAndFileName(){let t,e,i;this._config.src.match(/^mp3:/gim)?(t=/\/(\w+)$/gim.exec(this._config.src)[1],i=/:(.*\/)/gim,e=this._config.httpFallbackPath+i.exec(this._config.src)[1]):this._config.src.match(/\.mp3$/gim)?(e=this._config.src.match(/.*\//gim)[0],i=/(\w*)\.mp3/gim,t=i.exec(this._config.src)[1]):s.error("Unrecognized media source format: "+this._config.src),t+="."+r.getSupportedAudioExtension(),e=r.updatePathToCurrentProtocol(e),this._source=this.replaceLanguageInPath(e+t)}replaceLanguageInPath(t){return"none"===this.props.forcedLanguage||this.props.forcedLanguage===this._LanguageManager.currentLangId?t:i.MediaUtil.forcePathToUseLanguage(t,this._LanguageManager.currentLangId,this.props.forcedLanguage)}buildAudioPlayerMarkup(){var t=this.api.populate(null,this._data.attributes.templateID,this.content),e={preloadType:this._renderTG?"none":"auto",source:this._source},e=_.template(this.api.getTemplate("audioPlayerSource").content)(e),i=$(t.content);return i.html(e+t.content),i.html()}zoneConfigurationOverride(t){i.MultiZone.activeZone&&t.parent&&!t.parent.attributes.templateID.match("Audio")&&(this.unsetZone(),this._isNestedInZone=!0)}program(t){super.program(t);t=this._isZone||this._isNestedInZone;this._bodySelector=t?`#${this.zoneId} .audio-body`:".audio-body",this._$audio=t?$(this._bodySelector).find("audio:not(#background-audio)"):$("audio:not(#background-audio)"),this._$container=this._$audio.parent(),this._$pageContainer=$(this._bodySelector),this._$tgFallback=t?$(this._bodySelector).find(this._$container.data("tg-fallback")):$(this._$container.data("tg-fallback")),this._$imageOverlay=$(this._$container.data("image-overlay")),this._$captionsContent=t?$(this._bodySelector).find(".captions-content"):$(".captions-content"),this.api.addEvent("apiEvent",this.apiEventHandler),"true"===this._config.tgOnly&&this._delayTakeNote&&this.unpauseTakeNote(),this.checkForImage(),this.initMediaControls(),this.configureAudio(),this.configureMatchAudio(),this.configureAutoPlay(),this.configureTGPresentation(),this.trackInit(),this.showCC(),this.setPlayerPresentation(),this.doAutoplay(),this._isZone&&!this._setTrackingComplete&&setTimeout(()=>this.setZoneComplete(),0)}checkForImage(){var t=this._$container.data("checkforimage"),e=this._isZone||this._isNestedInZone;_.isEmpty(t)||(t=e?this._bodySelector+" "+t:t,!0!=!!$(t).find("img").length&&$(this._bodySelector).addClass("noimage-audioplayer"))}initMediaControls(){this._MediaControls.init({plugin:this,mediaScrub:this.getMediaScrub(),zoneId:this._zoneId}),this._$imageOverlay.click(()=>{this._MediaControls.togglePlayback()})}getMediaScrub(){let t=this._config.mediaScrub;return t=t===n.PROGRESS_SCRUB_LIMIT&&this.api.getThisPageComplete()?n.PROGRESS_SCRUB_FULL:t}configureAudio(){var t=this._isZone||this._isNestedInZone;this._audio=this._$audio[0],this._$captions=t?$(this._bodySelector).find("#audio-captions"):$("#audio-captions"),this.setCaptionsText(),this.configureVolume(),this._audio.addEventListener("pause",this.pauseHandler,!1),this._audio.addEventListener("playing",this.playHandler,!1),this._audio.addEventListener("timeupdate",this.timeHandler,!1),this._audio.addEventListener("progress",this.progressHandler,!1),this._audio.addEventListener("ended",this.completeHandler,!1)}setCaptionsText(){var t=$(this.content.sourceXML).find("#txtCC").text();this._$captionsContent.html(t)}configureVolume(){this._MediaControls.setVolume(this.api.model.appVolume),this._audio.volume=this.api.model.appVolume,this.api.model.isMuted||this._LaunchDataManager.launchInfo.preferences.audio===e.SETTING_VAL_OFF?this._audio.volume=0:this._audio.volume=this.api.model.appVolume}configureMatchAudio(){this._isMatchAudio&&this._MatchAudioHelper.init({matchTextTarget:this._config.matchTextTarget,matchAudioMode:this._config.matchAudioMode,matchSlideshowTGTemplate:this._config.matchSlideshowTGTemplate,matchHeaderTarget:this._config.matchHeaderTarget,matchImageTarget:this._config.matchImageTarget,matchSlideshowTGImageTarget:this._config.matchSlideshowTGImageTarget,matchSlideshowTGTextTarget:this._config.matchSlideshowTGTextTarget,bpTGCarousel:"true"===this._config.bpTGCarousel,$bulletScrollTargetLandscape:this._$pageContainer.find(".audio-content"),$bulletScrollTargetPortrait:this._$pageContainer,$pageContainer:this._$pageContainer,renderTG:this._renderTG,bodySelector:this._bodySelector})}configureAutoPlay(){var t;this._renderTG||(t=this._isZone||this._isNestedInZone,this._autoPlay="true"===this._config.autoplay,t&&1<this.zonePosition&&(this._autoPlay=!1),!1===this._autoPlay&&this._$imageOverlay.addClass("render").removeClass("hidden"))}configureTGPresentation(){var t=this._isMatchAudio?this._MatchAudioHelper.$matchAudioTGContent:this._$tgFallback.find(".text-content"),e={ccContent:this._$captionsContent.html()};this._isMatchAudio||this._renderTG?this._renderTG&&this._isMatchAudio&&this._MatchAudioHelper.usingCarousel?t.show():(this._$tgFallback.find(".tg-content").removeClass("hidden"),this._tgTexts=this._config.tgTexts.split(","),this._showCCTextForTG=-1!==this._tgTexts.indexOf("cc"),this._showTextContentForTG=-1!==this._tgTexts.indexOf("content"),this._showCCTextForTG||this._showTextContentForTG||(this._showCCTextForTG=!0),this._showCCTextForTG&&!this._showTextContentForTG&&(this.prepareCaptionContent(e),t.hide())):(t.show(),this._$tgFallback.find(".tg-content").addClass("hidden"))}prepareCaptionContent(t){var e;_.isEmpty(this._$tgFallback.find(".tg-content"))&&(e=_.template(this.api.getTemplate("textForTGMode").content),this._MagicButtonManager&&o.isMagicButtonInText(t.ccContent)&&(t.ccContent=this._MagicButtonManager.replaceMagicButtonsInTextWithHtml(t.ccContent)),this._$tgFallback.append(e(t)),this._MagicButtonManager.updateAllMagicButtonHtml(this._$tgFallback))}trackInit(){"true"!==this._config.completeOnDuration||this._renderTG||(this._setTrackingComplete=!0),this._setTrackingComplete&&!this._isZone&&this._TrackingManager.setActivityStatus({status:"register",activity:{id:"audioplayer",complete:!1,alert:"altPageJump"}})}trackCompletion(){this.unpauseTakeNote(),this._setTrackingComplete&&!this._isZone?(this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"audioplayer",complete:!0,alert:"altPageJump"}}),this._setTrackingComplete=!1):this._isZone&&this.setZoneComplete()}showCC(){let t=this.api.getPreferences().subtitles===e.SETTING_VAL_ON;this._renderTG?this._showTextContentForTG&&this._showCCTextForTG||(t=!1):this.shouldRemoveCCButton()&&this._MediaControls.removeCaptions(),this.shouldRemoveCCButton()&&this._MediaControls.$progressBar.addClass("hide-cc"),(t=this.isCCTextEmpty()?!1:t)?this._MediaControls.setCaptionsOn():this._MediaControls.setCaptionsOff()}shouldRemoveCCButton(){var t="true"===this._config.hideCCButton;return this.isCCTextEmpty()||t}isCCTextEmpty(){var t=$(this.content.sourceXML).find("#txtCC");return!!_.isEmpty(t)||_.isEmpty(t.text())}destroy(){this.api.removeEvent("apiEvent",this.apiEventHandler),this._MatchAudioHelper&&this._MatchAudioHelper.destroy(),clearTimeout(this._autoplayTimeout),super.destroy(),this._state=null,this._isMatchAudio=!1,this._MatchAudioHelper=null,this._autoPlay=!0;try{this._audio.pause()}catch(t){s.warn("AudioPlayer: Unable to pause on destroy.")}try{this._audio.removeEventListener("pause",this.pauseHandler),this._audio.removeEventListener("playing",this.playHandler),this._audio.removeEventListener("timeupdate",this.timeHandler),this._audio.removeEventListener("progress",this.progressHandler),this._audio.removeEventListener("ended",this.completeHandler)}catch(t){s.warn("AudioPlayer: Unable to remove listeners on destroy.")}this._audio=null,this._MediaControls.destroy(),this._MediaControls=null}setPlayerPresentation(){this._renderTG?(this._$pageContainer.addClass("tgmode"),this._$container.hide()):(this._$pageContainer.removeClass("tgmode"),this._$container.show()),!this._isZone&&this._renderTG&&this._isMatchAudio&&this._MatchAudioHelper.usingCarousel&&(this._TrackingManager.setActivityStatus({status:"clearAll",activity:{id:"audioplayer",complete:!1,alert:"altPageJump"}}),this._MatchAudioHelper.slideshow.enableTracking()),this.api.sendEvent({destination:"Style",type:"applyPageClasses"})}doAutoplay(){this._renderTG||this._autoPlay&&(this._autoplayTimeout=window.setTimeout(this.playRequestHandler,1e3*parseFloat(this._config.autoplayDelay)))}playMedia(){var t=this._audio.play();if(void 0===t)return this.onPlayMedia();t.then(()=>{this.onPlayMedia()}).catch(()=>{_.isEmpty(this.api)||this.pauseActions()})}onPlayMedia(){this.playActions(),this.api.sendEvent({destination:"MediaPlayer",type:"media_playing",source:this})}pauseMedia(){this._audio.pause(),this.pauseActions()}muteMedia(){this._audio.volume=0,this.api.model.isMuted=!0}unMuteMedia(){this._audio.volume=this.api.model.appVolume,this.api.model.isMuted=!1}mediaSlideReleased(t){var e=this._audio.duration;_.isNaN(t)||(e=t*e/100,this._MatchAudioHelper&&this._MatchAudioHelper.mediaSlideReleased(t,e),this._audio.currentTime=e)}mediaVolumeAdjusted(t){this._audio.volume=t,this.api.model.appVolume=t,this.api.model.isMuted=0===t}mediaCCOn(){this._$pageContainer.addClass("show-captions"),this._$captions&&this._$captions.slideDown(),this._isMatchAudio&&this._isZone&&this._MatchAudioHelper.calculateZoneMargin()}mediaCCOff(){this._$pageContainer.removeClass("show-captions"),this._$captions&&this._$captions.slideUp(),this._isMatchAudio&&this._isZone&&this._MatchAudioHelper.calculateZoneMargin()}togglePlayback(){"playing"===this._state?this.pauseMedia():"paused"===this._state||"preparing"===this._state?this.playMedia():this._state||this.initMedia()}completeOnTgMode(){return!(!this._renderTG||this._isMatchAudio&&this._MatchAudioHelper.usingCarousel)}zoneDestroyRequestHandler(t){this._$audio.closest(".zone").attr("id")===t&&this.destroy()}zonePlayRequestHandler(t){this._$audio.closest(".zone").attr("id")===t&&this.playRequestHandler()}zonePauseRequestHandler(t){this._$audio.closest(".zone").attr("id")===t&&this.pauseRequestHandler()}autoAdvanceMedia(){setTimeout(()=>{this._isZone?this.advanceZone():this.api.callNextPage()},this._autoAdvanceDelay)}startPlayback(){var t=this._audio.play();if(void 0===t)return this.playActions();t.then(()=>{this.playActions()}).catch(()=>{_.isEmpty(this.api)||this.pauseActions()})}pauseActions(){this._state="paused",this.sendAudioState(),this.setContainerClass("paused","playing")}playActions(){this._state="playing",this.sendAudioState(),this.setContainerClass("playing","paused"),this._$imageOverlay.removeClass("render").addClass("hidden")}sendAudioState(){this.api.sendEvent({destination:"All",type:"sendAudioState",state:this._state})}setContainerClass(t,e=""){this._$container.removeClass(e).addClass(t)}unpauseTakeNote(){this._delayTakeNote&&this.api.sendEvent({destination:"Annobar",type:"render",delay:this._delayTakeNoteDuration,source:this})}}i.AudioPlayer=t}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.IPluggable{constructor(t){super(t),this._StyleManager=t.StyleManager}build(s,t){super.build(s,t),this._data=this.content.getChildrenOfType("Data")[0];t=this.content.getChildrenOfType("Image");return _.each(t,t=>{var e=t.attributes.target,i=_.isEmpty(e)?"background":e,e=_.isEmpty(e)||"background"===e?this._data.attributes.defaultClass:null;this._StyleManager.addCourseStyle({pageID:this.api.getCurrentPage().id,zoneID:"Zone"!==s.parent.type||i.match("zone")?null:s.parent.attributes.zoneID,item:i,bp:t.attributes.breakpoint,classes:e,styles:"background-image: url('"+t.attributes.src+"')",altText:null==(i=t.getFirstChildOfType("Description"))?void 0:i.text})}),""}}t.BackgroundImage=e}(GLEPlugins=GLEPlugins||{}),function(a){var e=GLECore.StateChangeAlert,i=GLECore.AlertData,s=GLECore.isInViewport,n=GLECore.TransitionType,d=GLECore.delay,r=GLECore.transition;class o extends a.MultiZone{constructor(t){super(t),this._useStandardBookmarks=!1,this._initialized=!1,this.onPageScroll=()=>{this._initialized&&this._orderedZones.forEach(t=>this.trackZoneViewState(t,this._pageStore))},this.confirmReset=()=>{var t="modal_"+o.ALERT_RESET,e=this.getResetPromptMessage(),t={id:t,buttons:this._AlertManager.generateYesNoAlertButtons(t,this.onReset),content:e};this._AlertManager.showAlert(new i(t))},this.onReset=()=>{var t=this.api.model.currentPage.id;delete this.api.trackingData.bz["p"+t],this._TrackingManager.saveAdvancedZoneBranching(),this.api.callPage(t)}}program(){super.program(),this._pageStore=this.generateTrackingStore(),this._orderedZones=this.orderZones(),this.programAlert(),this.configureButtons(),this.scrollToLastVisibleZone(),this.addRequiredLinkListeners(),this.restoreGroups(),this.fadePageIn(),this._initialized=!0,this.onPageScroll(),this._mode!==a.ZoneMode.Presentation||$(".zone.present").last().hasClass("endpoint")||this.api.sendEvent({destination:"ProgressBar",type:"SetProgressDisplayMode",value:a.ProgressDisplayType.Hidden})}destroy(){this.api.sendEvent({destination:"ProgressBar",type:"SetProgressDisplayMode"}),super.destroy()}updateQuestionResponses(t,e){e=e.map(t=>t.id);this._pageStore[t.zoneId]=e,this._TrackingManager.saveAdvancedZoneBranching()}updateBranches(t,e=!1){if(this.isBranchingMode()){null==(i=t.selectedGroups)||i.filter(t=>t.match(/:/));var i=$("#"+t.zoneId).hasClass("grouped"),s=$(".zone.present.grouped").last().attr("id")===t.zoneId;if(i&&!s)this.resetNavigationButtons();else{i=this._source.filter(t=>t.conditional);const l=(null==(s=t.selectedBranches)?void 0:s.map(t=>_.find(this._source,{zoneId:t})))||[];let e=[];_.each(i,t=>t.hidden=!0),_.each(this._source,t=>{!t.conditional&&_.isEmpty(l)||t.conditional&&-1===e.indexOf(t.zoneId)||t.selectedBranches&&(e=_.uniq(e.concat(t.selectedBranches)))}),_.each(e,t=>{const e=t.split(":");this._source.filter(t=>-1!==e.indexOf(t.zoneId)).forEach(t=>t.hidden=!1)}),this._orderedZones=this.orderZones();var s=$("#"+t.zoneId).index(),a=$(".zone").length;for(let t=s+1;t<a;t++){var n=$(".zone").eq(t),r=_.find(this._source,{zoneId:n.attr("id")}),o=_.find(this._zones,{zoneData:r});if(o)try{o.destroy()}catch(t){}n.removeClass("rendered fadein present").find(".zone-content").html(""),r.rendered=!1}this._helper.cleanup(!1,this._source,this._orderedZones),this.updateActiveZones()}!0===e&&d(()=>this.advanceZone(t),100)}}addNavigationAlert(t){this.api.model.getCurrentPage().complete||this._alertAdded||(t={id:"modal_"+a.MultiZone.ALERT_EXIT,context:e.LanguageChange,content:t,renderAsModalAlert:!0,hasExit:!1,exitCallback:()=>{this._helper.cleanup(!0,this._source,this._orderedZones)},stateChangeType:e.LanguageChange},this._AlertManager.addStateChangeAlert(new i(t)),this._alertAdded=!0)}scrollToZone(t){var e=t.hasClass("grouped")&&!$(".zone.present.grouped").first().is(t);if(this._mode!==a.ZoneMode.Presentation||e)return super.scrollToZone(t);this.crossFadeZones(t)}convertContentContainer(t,e){return t}handleUnrenderedZones(){var t=$(".zone:not(.rendered)");let i=$(".zone.rendered").last();t.each((t,e)=>{e=$(e);e.insertAfter(i),i=e})}allowBranchBuilding(){return!0}setHelper(){var t=this._mode===a.ZoneMode.Presentation?a.ZonePresentationHelper:a.ZoneBranchingHelper;this._helper=new t(this.isBranchingMode(),this.api,this._TrackingManager),this._dynamicFlowActive=this._helper.active,this._dynamicFlowComplete=this._helper.evaluate(this._source)}updateActiveZones(){this._activeZones=this._source.filter(t=>t.rendered),this._orderedZones=this.orderZones(),this.resetNavigationButtons()}updateViewState(t){var e=$("#"+t.zoneId).get(0);return s(e,this._zoneViewPercentage)&&t.rendered&&!t.hasBeenViewed}trackZoneView(t){this._TrackingManager.saveAdvancedZoneBranching()}getLastVisibleZone(){var t=$(".zone.rendered").last().attr("id");return _.find(this._source,{zoneId:t})}resetNavigationButtons(){var t=$(".zone.present");if(this._mode!==a.ZoneMode.Presentation)return super.resetNavigationButtons();if(t.length){const n=_.last(this._orderedZones),r=this.getLastVisibleZone();t.each((t,e)=>{const i=$(e);e=this._orderedZones.find(t=>t.zoneId===i.attr("id"));if(e){var s=$(`#${e.zoneId} .zone-button.text`),a=(_.eq(e,r),_.eq(e,n),i.hasClass("grouped")&&!$(".zone.grouped").last().is(i));let t=e.complete||!e.registered;!e.complete&&$(`#${e.zoneId} [data-required-id]:not(.visited)`).length&&(t=!1),a?($(`#${e.zoneId} .zone-button.text`).addClass("hidden"),$(`#${e.zoneId} .zone-button.arrow`).removeClass("hidden")):($(`#${e.zoneId} .zone-button.text`).removeClass("hidden"),$(`#${e.zoneId} .zone-button.arrow`).addClass("hidden")),$(`#${e.zoneId} .zone-button`).removeClass("inactive"),t||s.addClass("inactive")}})}}checkPageCompletion(){var t=this._mode===a.ZoneMode.Presentation?this._orderedZones:this._source,e=this.api.model.currentPage.complete,i=_.filter(this._activeZones,t=>t.registered),t=_.every(t,t=>t.rendered),s=this.viewRequirementsAreSatisfied(),e=e||this.activitiesAreComplete()||0===i.length;s&&e&&this._$continueBtn.removeClass("inactive"),s&&e&&t&&this.trackingComplete(),$(".zone.present").last().hasClass("endpoint")&&this.api.sendEvent({destination:"ProgressBar",type:"SetProgressDisplayMode"})}viewRequirementsAreSatisfied(){const e=$(".zone.present");var t=this._activeZones.find(t=>t.zoneId===e.attr("id"));let i=!0;return this._mode===a.ZoneMode.Default&&this._requireViewAll&&(i=_.every(this._source,t=>t.hasBeenViewed)),i=this._mode===a.ZoneMode.Presentation&&!t.complete&&$(`#${t.zoneId} [data-required-id]:not(.visited)`).length?!1:i}trackingComplete(){this._AlertManager.removeStateChangeAlert("modal_"+a.MultiZone.ALERT_EXIT),this._$continueBtn.removeClass("inactive"),this.api.sendEvent({destination:"RequiredLinks",type:"ForceRequiredLinkCompletion"}).then(this.setActivityComplete)}programAlert(){a.MultiZone.activeZone.addNavigationAlert(this.api.parseTokens("{tk_MultiZoneLanguageChangeAlert}"))}generateTrackingStore(){var t="p"+this.api.model.currentPage.id,e=_.isEmpty(this.api.trackingData.bz)?{}:this.api.trackingData.bz,i=null!=(i=e[t])?i:{viewed:[]};return e[t]=i,this.api.trackingData.bz=e,i}restoreGroups(){const e=$(".zone.present").last(),i=this._orderedZones.find(t=>t.zoneId===e.attr("id"));var t=this._orderedZones.concat();let s=t.shift();for(;s;){var a=s.selectedGroups.filter(t=>t.match(/:/)).map(t=>t.split(":")).find(t=>-1!==t.indexOf(i.zoneId));s=a?(a.forEach(t=>$("#"+t).addClass("present grouped")),null):t.shift()}}fadePageIn(){return __awaiter(this,void 0,void 0,function*(){yield r($(".mz-container"),{class:"ready",duration:this._transitionSpeed,delay:this._transitionSpeed,type:n.AddClass})})}crossFadeZones(e){return __awaiter(this,void 0,void 0,function*(){e.hasClass("grouped")||$(".zone.grouped").removeClass("grouped");const t=$(".zone.present:not(.grouped)");yield r(t,{class:"fadedown",type:n.AddClass,duration:this._transitionSpeed,callback:()=>{$(".zone.present:not(.grouped)").removeClass("present"),this.sendZoneFadedDownEvent(t.attr("id"))}}),e.addClass("present fadedown"),yield r(e,{class:"fadedown",type:n.RemoveClass,duration:this._transitionSpeed,callback:()=>{$("#MultiZone1-body").get(0).scrollTop=0}}),this.resetNavigationButtons(),this.addRequiredLinkListeners(),this.onPageScroll()})}configureButtons(){this._mode===a.ZoneMode.Presentation&&($(".zone-button.text").removeClass("hidden"),$(".zone-button.reset").click(this.confirmReset))}getResetPromptMessage(){var t=this.content.getFirstChildOfType("StartOverMessage");return this.api.getPromptText(t,"{tk_altMultiZoneStartOverPrompt}")}addRequiredLinkListeners(){this._mode===a.ZoneMode.Presentation&&$(".zone.present [data-required-id]:not(.visited)").click(()=>{this.resetNavigationButtons()})}sendZoneFadedDownEvent(t){this.api.sendEvent({destination:"All",type:"ZoneFadedDown",id:t,currentPage:this.api.getCurrentPage()})}}o.ALERT_RESET="altMultiZoneStartOverPrompt",a.BranchingZones=o}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.IPluggable{constructor(t){super(t)}build(t,e){super.build(t,e);t=this.api.getTemplate("p_callout");return _.template(t.content)(this.buildTemplateContent())}buildTemplateContent(){var t=this.content.getFirstChildOfType("Header"),e=this.content.getFirstChildOfType("Text");return{id:this.content.attributes.id,header:_.isEmpty(t)?null:t.text,content:e.text}}}t.Callout=e}(GLEPlugins=GLEPlugins||{}),function(i){class t extends i.AbstractZone{constructor(t,e){super(t),this._isFQ=!1,this._isAnalyticsQuestion=!1,this._hasAutoAdvanced=!1,this.onSubmit=(t,e)=>{null!=t&&t.preventDefault(),null!=t&&t.stopImmediatePropagation();var i,t=this.api.model.getCurrentPage().complete;this.setFeedbackVariables(),_.isEmpty(e)&&(e=this._quiz.submitHandler(),this._isAnalyticsQuestion=this._AnalyticsManager.submitQuestionResponse(this.content,e.map(t=>t.id))),_.isEmpty(e)||(i=this._quiz.buildFeedbackContainer(e),this.configuration.iTestable&&"continuous"===this.configuration.flow)||(_.isEmpty(i)?this.configuration.iTestable&&"incremental"===this.configuration.flow?this.configuration.onQuestionSubmit(this._quiz.lastSelections):!this._isAnalyticsQuestion||!t&&this.api.model.trackingEnabled||(this._hasAutoAdvanced=!0,this._quiz.autoAdvancePage()):($(this._zoneSelector+" .question-feedback-content").html(i.content),this._quiz.$retryButton=$(this._zoneSelector+" .retry-button"),this._quiz.$continueButton=$(this._zoneSelector+" .continue-button"),this._quiz.configureFeedbackComponents(),this._quiz.renderFeedbackContainer(e),this._quiz.renderIndicators(e),i.showCorrections&&this._quiz.renderCorrections(e)))},this.trackZoneCompletion=()=>{this.setZoneComplete()},this.trackInit=()=>{this.configuration.iTestable||this._TrackingManager.setActivityStatus({status:"register",activity:{id:"checkpoint",complete:!1,alert:this.data.attributes.activityAlertId}})},this.trackFQInit=()=>{this.configuration.iTestable||this._TrackingManager.setActivityStatus({status:"register",activity:{id:"test",complete:!1,alert:this.data.attributes.activityAlertFQId}})},this.trackCompletion=(t=!1)=>{var e;!this._quiz.setTrackingComplete||this.configuration.iTestable||!1!==(e=this.api.model.getCurrentPage().complete)&&!_.isUndefined(e)||(this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"checkpoint",complete:!0}}),!0!==t)||(this._hasAutoAdvanced=!0,this._quiz.autoAdvancePage())},this.trackFQCompletion=()=>{this._quiz.setTrackingComplete&&!this.configuration.iTestable&&this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"test",complete:!0}})},this.apiHandler=t=>{this._isAnalyticsQuestion&&"pageComplete"===(null==(t=t.data)?void 0:t.type)&&!this._hasAutoAdvanced&&(this._hasAutoAdvanced=!0,this._quiz.autoAdvancePage())},this._dependencies=t,this.configuration=e||{},this._AnalyticsManager=t.AnalyticsManager,this._TrackingManager=t.TrackingManager}get modalDelay(){return this._modalDelay}get modalTimeout(){return this._modalTimeout}set modalTimeout(t){this._modalTimeout=t}build(t,e){return super.build(t,e),this._isFQ=/FQCheckpoint/gim.test(this.content.attributes.src),this.data=this.content.getChildrenOfType("Data")[0],this.configuration.flow=this.data.attributes.flow,this._quiz=new i.QuizUtil(this,this._dependencies,!0),this._quiz.defineConfiguration({attitudinal:"true"===this.data.attributes.attitudinal,assessment:this.configuration,api:e,content:t,isZone:this._isZone,zoneId:this._zoneId,submitHandler:this.onSubmit}),this._quiz.build(),this._quiz.buildHeader(),this._quiz.buildQuestionText(),this._quiz.buildPromptText(),this._quiz.buildFeedback(),this._quiz.buildChoices(),this._quiz.buildQuestionImage(),this.addColumnClass(),this._quiz.$container.html()}addColumnClass(){var t=this._quiz.$container.find(".question-option").length,t=Math.max(Math.min(10,t),1);this._quiz.$container.find(".question-options").addClass("col-"+t)}buildReviewScreen(t,e,i,s,a){var n=_.template(this.api.getTemplate("CheckpointReview").content),r=this.buildReviewOptionData(i,t,a);return n({questionText:t.text,responseText:"",options:r,isAttitudinal:t.attitudinal,reviewText:_.isEmpty(t.review)?null:t.review[0].text,outcome:a,secondaryOutcome:i.secondaryOutcome})}buildReviewOptionData(i,t,s){const a="true"===t.display.data.attributes.showCorrections;return i.options.map(t=>{var e=t.itestableID===i.selection.attr("data-itestableid");return{id:t.itestableID,selectionClass:e?"selected":"unselected",isChecked:e,responseText:t.targetText,outcomeIndicator:a&&e?i.correct:"",correction:a&&t.correct&&"correct"!==s?"correction":""}})}program(t){super.program(t),this._quiz.zoneData=this._zoneData,this.configureTracking(),this._quiz.program(),this.beforeAnalyticsRestore(t),this.restoreAnalyticsResponses(),this.api.addEvent("apiEvent",this.apiHandler)}beforeAnalyticsRestore(t){}restoreAnalyticsResponses(){var t=this._AnalyticsManager.fetchQuestionResponse(this.content),e=null==t?void 0:t.map(t=>$("#"+t));t&&this._quiz.deactivateActivity(e,!0)}setFeedbackVariables(){this._quiz.$questionPanel=$(this._zoneSelector+" .question-panel:not(.confidence)"),this._quiz.$feedbackPanel=$(this._zoneSelector+" .question-feedback-panel"),this._quiz.$optionSelected=$(this._zoneSelector+" .question-option.selected"),this._quiz.$feedbackHeader=$(this._zoneSelector+" .feedback-header"),this._quiz.$feedbackSummary=$(this._zoneSelector+" .feedback-summary")}configureTracking(){this._isZone?(this._quiz.trackInit=()=>{},this._quiz.trackCompletion=this.trackZoneCompletion):this._isFQ?(this._quiz.trackInit=this.trackFQInit,this._quiz.trackCompletion=this.trackFQCompletion):(this._quiz.trackInit=this.trackInit,this._quiz.trackCompletion=this.trackCompletion)}setTrackingComplete(){this._quiz.setTrackingComplete=!0,this._quiz.trackCompletion()}doExploreMore(){this._quiz.hideFeedback()}doContinue(){this._quiz.quizComplete()}destroy(){var t;null!=(t=this.api)&&t.removeEvent("apiEvent",this.apiHandler),super.destroy(),this._quiz.destroy()}}i.Checkpoint=t}(GLEPlugins=GLEPlugins||{}),function(i){class t extends i.AbstractZone{constructor(t,e){super(t),this.customFeedback={correct:null,partial:null,incorrect:null},this._isFQ=!1,this._isCertification=!1,this.onSubmit=t=>{t.preventDefault(),t.stopImmediatePropagation(),this.setFeedbackVariables();var e,t=this._quiz.submitHandler();_.isEmpty(t)||(e=this._quiz.buildFeedbackContainer(t),this.configuration.iTestable&&"continuous"===this.configuration.flow)||_.isEmpty(e)||($(this._zoneSelector+" .question-feedback-content").html(e.content),this._quiz.$retryButton=$(this._zoneSelector+" .retry-button"),this._quiz.$continueButton=$(this._zoneSelector+" .continue-button"),this._quiz.configureFeedbackComponents(),this._quiz.renderFeedbackContainer(t),this._quiz.renderIndicators(t),e.showCorrections&&this._quiz.renderCorrections(t))},this.trackZoneCompletion=()=>{this.setZoneComplete()},this.trackInit=()=>{this.configuration.iTestable||this._TrackingManager.setActivityStatus({status:"register",activity:{id:"chexercise",complete:!1,alert:this.data.attributes.activityAlertId}})},this.trackFQInit=()=>{var t;this.configuration.iTestable||(t=!0===this._isCertification?"altCert":this.data.attributes.activityAlertFQId,this._TrackingManager.setActivityStatus({status:"register",activity:{id:"test",complete:!1,alert:t}}))},this.trackCompletion=(t=0)=>{var e;!this._quiz.setTrackingComplete||this.configuration.iTestable||!1!==(e=this.api.model.getCurrentPage().complete)&&!_.isUndefined(e)||this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"chexercise",complete:!0}})},this.trackFQCompletion=()=>{this._quiz.setTrackingComplete&&!this.configuration.iTestable&&this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"test",complete:!0}})},this._dependencies=t,this._TrackingManager=t.TrackingManager,this.configuration=e||{}}get modalDelay(){return this._modalDelay}get modalTimeout(){return this._modalTimeout}set modalTimeout(t){this._modalTimeout=t}build(t,e){return super.build(t,e),this._isFQ=/FQChexercise/gim.test(this.content.attributes.src),this.data=this.content.getChildrenOfType("Data")[0],this._modalDelay=1e3*parseFloat(this.data.attributes.modalDelay),this.configuration.flow=this.data.attributes.flow,this._quiz=new i.QuizUtil(this,this._dependencies,!1),this._quiz.defineConfiguration({attitudinal:"true"===this.data.attributes.attitudinal,assessment:this.configuration,api:e,content:t,testable:this.configuration.iTestable,isZone:this._isZone,zoneId:this._zoneId}),this._quiz.build(),this._quiz.buildHeader(),this._quiz.buildQuestionText(),this._quiz.buildPromptText(),this._quiz.buildFeedback(),this._quiz.buildChoices(),this._quiz.buildQuestionImage(),this.handleCertification(),this._quiz.$container.html()}buildReviewScreen(t,e,i,s,a){let n="<form class='modal-review-content chexercise'>";var r=i.selection;n=n+("<p class='question-text'>"+t.text)+"</p><ul class='options'>";for(let t=0,e=i.options.length;t<e;t++){var o=i.options[t],l=o.itestableID,d=function(t,e){let i=!1;return e.each(function(){$(this).attr("data-itestableid")===t&&(i=!0)}),i}(l,r)?"selected":"unselected";n+="<li class='selection "+d+" checkbox'> <input id='"+l+"' type='checkbox' disabled "+("selected"==d?"checked":"")+"><label for='"+l+"'>"+o.targetText+"</label></li>"}return n=(n=n+"</ul>"+("<h3 class='subheader'>"+a+"</h3>"))+("<p class='review'>"+t.review[0].text+"</p>")+"</form>"}handleCertification(){var t;this._isCertification="true"===this.data.attributes.certification,this._isCertification&&(t=this.api.getPromptText(this.content.getFirstChildOfType("Prompt"),this.api.model.tokens.tk_CertDirections),this._quiz.$container.find(".question-prompt").html(t))}program(t){super.program(t),this._quiz.zoneData=this._zoneData,this.configureTracking(),this._quiz.program(),this._quiz.$questionForm.submit(this.onSubmit)}setFeedbackVariables(){this._quiz.$questionPanel=$(this._zoneSelector+" .question-panel"),this._quiz.$feedbackPanel=$(this._zoneSelector+" .question-feedback-panel"),this._quiz.$optionSelected=$(this._zoneSelector+" .question-option.selected"),this._quiz.$feedbackHeader=$(this._zoneSelector+" .feedback-header"),this._quiz.$feedbackSummary=$(this._zoneSelector+" .feedback-summary")}configureTracking(){this._isZone?(this._quiz.trackInit=()=>{},this._quiz.trackCompletion=this.trackZoneCompletion):this._isFQ?(this._quiz.trackInit=this.trackFQInit,this._quiz.trackCompletion=this.trackFQCompletion):(this._quiz.trackInit=this.trackInit,this._quiz.trackCompletion=this.trackCompletion)}getFeedbackForOption(){return this.defaultFeedback}setTrackingComplete(){this._quiz.setTrackingComplete=!0,this._quiz.trackCompletion()}doExploreMore(){this._quiz.hideFeedback()}doContinue(){this._quiz.quizComplete()}destroy(){super.destroy(),this._quiz.destroy()}}i.Chexercise=t}(GLEPlugins=GLEPlugins||{}),function(s){var a=GLECore.ViewingModeManager,n=GLECore.SettingsManager,e=GLECore.MediaControls,i=GLECore.AlertData,r=GLECore.Platform;class o extends s.AbstractZone{constructor(t){super(t),this._autoplay=!0,this._audioAutoAdvance=!0,this.toggleCaptions=()=>{var t=this._$audioContainer.hasClass("show-captions"),e=this._$audioContainer.find(".captions-content");e.length&&(t?e.slideDown({progress:this.evaluateZoneHeight}):e.slideUp({progress:this.evaluateZoneHeight}))},this.evaluateZoneHeight=()=>{var t,e;this._isZone&&(t=this._$audioContainer.find("#media-cc").hasClass("selected"),e=this._$body.get(0).scrollHeight,t?this._$body.css("min-height",e+"px"):this._$body.css("min-height","initial"))},this.onItemClick=t=>{var t=$(t.currentTarget),e=t.data("index"),e=this._$revealItems.eq(e);!0===this._audioEnabled&&!1===this.isAudioRequirementSatisfied()?this.generateAudioIncompleteAlert():((this._$launcher=t).find(".completion-indicator").attr("aria-hidden","false"),this._$items.removeClass("clicked"),this._$items.attr("aria-selected","false"),this._$revealItems.removeClass("render").attr("aria-hidden","true").attr("tabindex","-1"),this._$defaultImage.removeClass("render"),e.addClass("render").attr("aria-hidden","false").attr("tabindex","0").focus(),t.find(".state").attr("aria-hidden","false"),t.addClass("clicked complete"),t.attr("aria-selected","true"),this._$revealContainer.addClass("render"),this._isZone&&($(".mz-body").addClass("faudal"),this.$element.addClass("showing-reveal"),this.evaluateZoneRevealState()),setTimeout(()=>{this._isZone&&s.MultiZone.activeZone.scrollToZone(this.$element),this._$revealContainer.get(0).scrollTo(0,0)}),this._audioEnabled&&!this._tg&&this.pauseAudio(),this.disableAudio(),this.checkStatus())},this.onItemKeyDown=t=>{var e=$(t.currentTarget);"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.click())},this.onImageOverlayClicked=()=>{var t=this._isZone?this.zoneData.zoneId:null;this.api.sendEvent({destination:"All",type:"audioPlayRequest",zoneId:t})},this.onCloseItem=t=>{t.stopImmediatePropagation(),this.enableAudio(),this._$items.removeClass("clicked"),this._$revealContainer.removeClass("render"),this._$revealItems.removeClass("render").attr("aria-hidden","true").attr("tabindex","-1"),this._$defaultImage.addClass("render"),this._$items.attr("aria-selected","false"),this._isZone&&(this.$element.removeClass("showing-reveal"),$(".mz-body").removeClass("faudal"),this.evaluateZoneRevealState()),this._$launcher.focus()},this.setTopBoundary=()=>{var t=$(".toolbar-menu"),e=$("#gle-progressbar"),t=t.outerHeight(),e=e.outerHeight();this._$css.text("@media only screen and (min-width: 62rem) {.cr-reveal-view, #click-reveal-container {top: "+t+"px; bottom: "+e+"px; }}")},this.apiEventHandler=t=>{_.isUndefined(_.get(t,"data.type"))||("sendAudioState"===t.data.type?this.handleAudioStateChange(t):"preferencesUpdate"===t.data.type?this.handlePreferencesUpdate(t):t.data.type===e.MEDIA_END_EVENT&&(!this._isZone||this._isZone&&this.zoneId===t.data.zoneId)&&(this._audioComplete=!0))},this.onWindowResize=()=>{var t=this.matchMedia();if(t===this._currentState)return!1;this._currentState=t,this.setTopBoundary()},this._ViewingModeManager=t.ViewingModeManager,this._AlertManager=t.AlertManager,this._SettingsManager=t.SettingsManager,this._TrackingManager=t.TrackingManager}build(t,e){super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0],this._tg=this._ViewingModeManager.currentViewingMode===a.VIEWING_MODE_TG,this._requireAudioCompletion="true"===this._data.attributes.requireAudioCompletion,this._audioEnabled=this.isAudioEnabled();var t=_.template(this.api.getTemplate(this._data.attributes.templateID).content),e=s.MediaUtil.imageData(this.content.getChildByAttribute("id","default_image")),i=this.content.getFirstChildOfType("Header");return t({header:_.isEmpty(i)?"":i.text,intro:this.content.getChildByAttribute("id","question").text,audioEnabled:this._audioEnabled,defaultToPausedState:this._audioEnabled&&!this._tg,showCaptions:this._audioEnabled&&this._tg,prompt:this.content.getChildByAttribute("id","prompt").text,image:e,items:this.buildItemList()})}isAudioEnabled(){return!_.isEmpty(this.content.parent.getChildByAttribute("src","@MediaPlugins.AudioPlayer"))}isAudioRequirementSatisfied(){return this._isZone&&this.zoneData.complete||!0===this._audioComplete||!0===this.api.getThisPageComplete()||!0===this._tg||!1===this._requireAudioCompletion}buildItemList(){var t=this.content.getChildrenOfType("Option");const s=[];return _.each(t,(t,e)=>{var i=t.getChildrenOfType("DefaultContent")[0],t=t.getChildrenOfType("RevealContent")[0],e={id:e,title:i.text,image:i.attributes.src,revealText:t.text,revealImage:t.attributes.src,revealImageAlt:t.attributes.description};s.push(e)}),s}program(t){super.program(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} .cr-body`:".cr-body",this._$body=$(""+this._bodySelector),this._$audio=$(this._bodySelector+" + .media-container audio"),this._$pageContainer=$(this._bodySelector+" .audio-body"),this._$items=$(this._bodySelector+" .cr-item"),this._$revealContainer=$(this._bodySelector+" .cr-reveal-view"),this._$revealItems=$(this._bodySelector+" .cr-reveal-item"),this._$defaultImage=$(this._bodySelector+" .cr-default-view"),this._$imageOverlay=$(this._bodySelector+" .cr-image-overlay"),this._$css=$(this._bodySelector+" #cr-dynamic-styles"),this._$container=this._$audio.parent(),this._currentState=this.matchMedia(),this._audioComplete=this.isAudioRequirementSatisfied(),this._audioAutoAdvance="true"===this._data.attributes.audioAutoAdvance,this._$items.click(this.onItemClick).on("keydown",this.onItemKeyDown),this._$imageOverlay.click(this.onImageOverlayClicked),$(this._bodySelector+" .close-button").click(this.onCloseItem),this.configureAudio(),this.configureAutoPlay(),this.setTopBoundary(),this._isZone||this._TrackingManager.setActivityStatus({status:"register",activity:{id:"clickandreveal",complete:!1,alert:this._data.attributes.activityAlertId}}),this.doAutoplay(),$(window).on("resize",this.onWindowResize)}doAutoplay(){var t;this._autoplay&&(t=this._isZone?this.zoneData.zoneId:null,this._$imageOverlay.hide(),this.api.sendEvent({destination:"All",type:"audioPlayRequest",zoneId:t}))}configureAudio(){this.api.sendEvent({destination:"All",type:"setAudioAutoAdvance",context:this._bodySelector,value:this._audioAutoAdvance});var t=$(this._bodySelector+" + .media-container");this._audioEnabled?($(this._bodySelector+" .cr-default-image-container").after(t),this._$audioContainer=$(this._bodySelector+" .audio-body"),this._$audioContainer.find("#media-cc").click(()=>setTimeout(this.toggleCaptions)),this.api.addEvent("apiEvent",this.apiEventHandler),this.evaluateZoneHeight()):t.remove()}configureAutoPlay(){var t=this.content.parent.getChildByAttribute("src","@MediaPlugins.AudioPlayer");t&&"true"===t.getChildrenOfType("Data")[0].attributes.tgOnly?(this._autoplay=!1,this._$imageOverlay.addClass("tgmode"),this._$container.hide(),this._audioComplete=!0):this.api.getDeviceType()!==r.DEVICE_DESKTOP||this._tg||this._isZone&&1<this.zonePosition?this._autoplay=!1:this._autoplay="true"===this._data.attributes.autoplay}enableAudio(){this._audioEnabled&&(this._$audioContainer.attr("aria-hidden","false"),this._$audioContainer.find("button").attr("tabindex",null))}disableAudio(){this._audioEnabled&&(this._$audioContainer.attr("aria-hidden","true"),this._$audioContainer.find("button").attr("tabindex","-1"))}generateAudioIncompleteAlert(){var t={id:o.CR_MODAL_ERROR_ID,content:"{tk_altClickRevealAudio}"};this._AlertManager.showAlert(new i(t))}pauseAudio(){var t;this._audioEnabled&&!this._tg&&(t=this._isZone?this.zoneData.zoneId:null,this.api.sendEvent({destination:"All",type:"audioPauseRequest",zoneId:t}))}handleAudioStateChange(t){"playing"===t.data.state?this._$audioContainer.removeClass("paused init").addClass("playing"):this._$audioContainer.removeClass("playing").addClass("paused")}handlePreferencesUpdate(t){var e,i;_.isUndefined(_.get(t,"data.value"))||(this._tg=this.api.getPreferences().viewingMode===a.VIEWING_MODE_TG,!0===this._tg&&this._audioEnabled?this._$defaultImage.removeClass("paused"):this._audioEnabled&&this._$defaultImage.addClass("paused"),t=this.api.getPreferences().subtitles===n.SETTING_VAL_ON,e=this._$audioContainer.hasClass("show-captions"),i=this._$audioContainer.find(".captions-content"),!t||e||this._tg?(!t&&e||this._tg)&&(this._$audioContainer.removeClass("show-captions"),i.slideUp({progress:this.evaluateZoneHeight})):(this._$audioContainer.addClass("show-captions"),i.slideDown({progress:this.evaluateZoneHeight})))}checkStatus(){!0!=0<$(this._bodySelector+" .cr-item:not(.complete)").length&&(this._isZone?this.setZoneComplete():this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"clickandreveal",complete:!0}}))}matchMedia(){return this.api.getMediaSize()}evaluateZoneRevealState(){!1==0<$(".showing-reveal").length?$(".mz-wrapper").attr("data-showing-reveal",null):$(".mz-wrapper").attr("data-showing-reveal","true")}destroy(){var t;this._isZone&&this._audioEnabled&&(t=this.zoneData.zoneId,this.api.sendEvent({destination:"All",type:"audioDestroyRequest",zoneId:t})),this.api.removeEvent("apiEvent",this.apiEventHandler),this._data=null,this._audioEnabled=null,this._tg=null,this._$items=null,this._$defaultImage=null,this._$revealContainer=null,this._$revealItems=null,this._$audioContainer=null,this._$imageOverlay=null,this._autoplay=!0,$(window).off("resize",this.onWindowResize),super.destroy()}}o.CR_MODAL_ERROR_ID="cr-modal-error",s.ClickReveal=o}(GLEPlugins=GLEPlugins||{}),function(i){var n=GLECore.ModalData,r=GLECore.delay;class o extends i.Checkpoint{constructor(t,e){super(t,e),this.onChoiceSelected=t=>{t=$(t.currentTarget),t=this._quiz.choices[t.val()];this._widget.onChoiceSelected(t)},this.onConfidenceSelected=t=>{var e=this._AnalyticsManager.getInteractionId(this.content,this._isAssessment),e=(this._confidenceLevel=t.value,this._TrackingManager.updateInteractionWithAnalytics({confidence:t.value,interactionId:e}),this.storeAnalyticsData(t));this.onSubmit(null,e)},this.onFeedbackRender=(t,e)=>{(this.configuration.iTestable?this._quiz.$container.parent():this._quiz.$container).get(0).scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"});let i=t.find(".fdbk-indicator-area").html();var s=t.find(".feedback-summary").html().replace(/^\s+/gim,""),t=!!t.find(".retry-button").length,t=this.buildButtonArray(t),s=(_.isEmpty(i)||(i=i.replace(/<(\/)?h2/gim,"<$1div")),{id:o.MODAL_ID,header:i,content:s,srcElement:"root",buttons:t,hasExit:this._quiz.isAttitudinal,isFullScreen:!1,$launcher:this._quiz.$submitButton,exitCallback:this.onModalClose,isAlert:!1,preventClickOutsideDismiss:!0});const a=new n(s.id,s.header,s.content,s.srcElement,s.buttons,s.hasExit,s.$launcher,null,s.isFullScreen,s.isAlert,s.preventClickOutsideDismiss,s.exitCallback);this._quiz.isAttitudinal?this.launchModal(a,e):this._modalTimeout=r(()=>{this.launchModal(a,e)},this._modalDelay)},this.onModalClose=()=>{this.configuration.iTestable?this.onContinue():(this.reset(),this._ModalManager.closeModal(o.MODAL_ID))},this.onContinue=()=>{this._ModalManager.closeModal(o.MODAL_ID),this._isZone&&this._quiz.isAttitudinal?this._quiz.hideFeedback():this._quiz.quizComplete()},this._widget=new i.ConfidenceWidget(t),this._ModalManager=t.ModalManager}build(t,e){var i=t.getFirstChildOfType("Confidence"),i=this._widget.build(i,e),t=$(`<div>${super.build(t,e)} <div class="widget-wrapper">${i}</div></div>`);return this._data=this.content.getFirstChildOfType("Data"),this._modalDelay=1e3*parseFloat(this._data.attributes.modalDelay),this._scrollSpeed=1e3*parseFloat(this._data.attributes.scrollSpeed),this._scrollEase=this._data.attributes.scrollEase,this._scrollDelay=1e3*parseFloat(this._data.attributes.scrollDelay),this._isAssessment=this.configuration.iTestable,t.html()}beforeAnalyticsRestore(t){this._widget.scrollProps={speed:this._scrollSpeed,ease:this._scrollEase,delay:this._scrollDelay},this._widget.containerSelector=this._quiz.containerSelector,this._widget.$parent=this.configuration.iTestable?this._quiz.$container.parent():this._quiz.$container,this._widget.program(t),this._widget.selectConfidence().then(this.onConfidenceSelected),this._quiz.overrideFeedbackPanelRender=this.onFeedbackRender,this.wireChoiceSelection()}destroy(){super.destroy()}wireChoiceSelection(){$(""+this._quiz.containerSelector).find(".question-option:not(.confidence) input").on("change",this.onChoiceSelected)}restoreAnalyticsResponses(){var t,e,i=this._AnalyticsManager.fetchQuestionResponse(this.content);i&&!this._isAssessment&&(t=(i=[this.getOptionIdByInteractionId(i[0]),"confidence-choice-"+i[1]]).map(t=>$("#"+t)),e=_.first(i.filter(t=>!t.match(/^confidence-/))),e=this._quiz.choices[e],this._quiz.deactivateActivity(t,!0),this._widget.deactivate(i,e))}getOptionIdByInteractionId(t){t=$(`.question-option[data-itestableid=${t}]`);return _.isEmpty(t)?null:t.attr("id")}storeAnalyticsData(t){var e=this._quiz.submitHandler(),i=e.map(t=>{var e;return null!=(e=/\d+$/.exec(t.itestableID)[0])?e:t.itestableID}).concat([null!=(i=/\d+$/.exec(t.id)[0])?i:t.id]);return this._AnalyticsManager.submitQuestionResponse(this.content,i),e}launchModal(t,e){t=this._ModalManager.openModal(t,!0);!0!==this._quiz.isAttitudinal&&t.find("header > h2").addClass(e)}buildButtonArray(t){var e=[],i=new ModalButton("confidence-continue",this._isZone?this.api.parseTokens("{tk_CloseUpperCase}"):this.api.parseTokens("{tk_ContinueButton}"),this.onContinue.bind(this));return!0===this._quiz.isAttitudinal?e.push(i):e.push(!0===t?new ModalButton("confidence-retry",this.api.parseTokens("{tk_TryAgain}"),this.onModalClose.bind(this)):i),e}reset(){this._quiz.hideFeedback(),this._widget.reactivate(),this._widget.selectConfidence().then(this.onConfidenceSelected)}buildReviewScreen(t,e,i,s,a){return i.secondaryOutcome=`${this.api.parseTokens("{tk_YourConfidence}")} <b>${this.api.parseTokens("{tk_ConfidenceRating"+this._confidenceLevel+"}")}</b>`,super.buildReviewScreen(t,e,i,s,a)}}o.MODAL_ID="confidence-feedback-modal",i.ConfidenceQuestion=o}(GLEPlugins=GLEPlugins||{}),function(a){class n extends a.AbstractZone{constructor(t){super(t),this.processCharacter=(t,e)=>{var i=t.getFirstChildOfType("Name"),s=a.MediaUtil.imageData(t.getFirstChildOfType("Image"));return{id:t.attributes.id,index:e+1,image:s,name:i}},this.processMessage=(t,e)=>{var i=n.POSITION_GROUPS[this._characters.length-1];const s=t.attributes.characterId;var a=_.find(this._characters,t=>t.id===s);return{id:e+1,index:e+1,position:i[this._characters.indexOf(a)],rendering:!1,rendered:!1,text:t.text,character:a,$element:null,element:null,complete:0}},this.renderMessages=()=>{var t=_.filter(this._messages,t=>!1===t.rendered&&n.viewport(t.element,.1)),e=_.filter(this._messages,t=>!0===t.rendering),e=_.last(e);const i=(new Date).getTime(),s=_.isEmpty(e)?i:e.complete;_.each(t,(t,e)=>{e=(e+1)*this._transitionDelay*1e3,t.complete=s+e,t.rendered=!0,t.rendering=!0,e=(t.complete-i)/1e3;t.$element.addClass("render").css("transitionDelay",e+"s"),setTimeout(()=>{t.rendering=!1,this.checkComplete()},1e3*e)})},this.onContinue=()=>{this.api.callNextPage()},this._TrackingManager=t.TrackingManager}build(t,e){super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0],this._characters=this.content.getChildrenOfType("Character").map(this.processCharacter),this._messages=this.content.getChildrenOfType("Message").map(this.processMessage),this._transitionDelay=parseFloat(this._data.attributes.transitionDelay);var t=_.template(this.api.getTemplate("p_conversation").content),e=this.content.getFirstChildOfType("Header"),i=this.content.getFirstChildOfType("Intro"),s=this.content.getFirstChildOfType("Prompt");return t({header:_.isEmpty(e)?"":e.text,characters:this._characters,messages:this._messages,intro:_.isEmpty(i)?"":i.text,prompt:_.isEmpty(s)||_.isEmpty(s.text)?null:this.api.getPromptText(s,"{tk_ConversationPrompt}")})}program(t){super.program(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} .cnv-body`:".cnv-body",this._$scrollContainer=this._isZone?$(".mz-body"):$(".page-body"),this.trackActivityInit(),this.wireConversation(),this.renderMessages()}destroy(){this._$scrollContainer.off("scroll",this.renderMessages),super.destroy()}wireConversation(){this._$scrollContainer.on("scroll",this.renderMessages),this._$btnComplete=$(this._bodySelector).find(".btn-complete"),this._isZone||this._$btnComplete.click(this.onContinue),_.each(this._messages,t=>{t.$element=$(this._bodySelector).find("#message-"+t.id),t.element=t.$element.get(0)})}checkComplete(){var t=_.last(this._messages);!1!=(!0===t.rendered&&!1===t.rendering)&&(this._$btnComplete.attr("disabled",null),this.trackActivityCompletion())}trackActivityInit(){this._isZone||this._TrackingManager.setActivityStatus({status:"register",activity:{id:"conversation",complete:!1,alert:this._data.attributes.activityAlertId}})}trackActivityCompletion(){this._isZone?this.setZoneComplete():this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"conversation",complete:!0}})}static viewport(t,e=1){t=n.clone(t.getBoundingClientRect()),e=(t.bottom-t.top)*e;return t.bottom=t.top+e,0<=t.top&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)}static clone(t){return{top:t.top,bottom:t.bottom}}}n.POSITION_GROUPS=[["left"],["left","right"],["left","center","right"]],a.Conversation=n}(GLEPlugins=GLEPlugins||{}),function(n){var e=GLECore.ModalData,s=GLECore.AlertData,i=GLECore.RouteManager,a=GLECore.QAModeManager,r=GLECore.DataUtil,l=GLEProfiling.ProfileQuery;class d extends n.IPluggable{static initInteractionData(t,e){const i=[];t=t.getAllDescendantsOfType("Question");let s=0;return t.forEach(t=>{t=n.AssessmentQuestionBuilder.QUESTION_TYPES[t.attributes.type].initInteractionData(t,e+s,s);i.push(...t),s+=t.length}),i}constructor(t){super(t),this._questionLookup={},this._currentQuestionIndex=0,this._metadata={},this._defaults={},this._categories=[],this._assessment=[],this._reviewables=[],this._categoryScores={},this._hasPassed=!1,this._profiling=!1,this._firstTimeTestOut=!1,this._partialPass=!1,this._pageIsComplete=!1,this._alertAdded=!1,this._hideQuestionFeedback=!1,this.filterCategoriesForProfiling=t=>{t=t.profileQuery;return!1==(!_.isEmpty(t)&&!_.isEmpty(this._RouteManager.profilingResponses))||t.evaluate(this._RouteManager.profilingResponses)},this.filterQuestionsForAvailableCategories=t=>{if(a.QA_ALL_ASMT_ENABLED)return!0;var i=t.attributes.category;for(let t=0,e=this._categories.length;t<e;t++)if(i===this._categories[t].id)return!0;return!1},this.apiHandler=t=>{"pageComplete"!==t.data.type||this._metadata.testOut||this._pageIsComplete?"profiling"===t.data.type&&this._firstTimeTestOut&&(this._TrackingManager.testout({nextPageOnPass:this._metadata.nextPageOnPass,result:t.data.responses[0].profileValue,categoryScores:this._categoryScores,modular:this._metadata.modular}),this.onPageComplete()):this.onPageComplete()},this.retakeAssessment=()=>{var t=this.fetchIncorrectQuestions(),e=this._assessment.concat();switch(this._metadata.retake){case"incorrect":this.retakeIncorrect(t);break;case"incorrect-alternate":this.retakeIncorrectAlternate(t);break;case"all":this.retakeAll(e);break;case"all-alternate":this.retakeAllAlternate(e)}this._currentQuestionIndex=0,this.renderQuestion(),this._$reviewContainer.remove(),this._$questionContainer.fadeIn()},this.launchReviewModal=t=>{const a=$(t.currentTarget);t=_.template(this.api.getTemplate("p_assessment_modal").content);const n=[];let r=null,o=null;_.each(this._reviewables,(t,e)=>{var i=t.id,i=a.data("question").toString()===i?"render":"",s=this.fetchOutcomeLabel(t.submission),t=t.display.buildReviewScreen(t,this._defaults,t.submission,t.templateID,s);n.push({render:i,content:t}),"render"==i&&0===e?(r="disabled",o=1===this._reviewables.length?"disabled":null):"render"==i&&e===this._reviewables.length-1&&(o="disabled")});t={id:"assessment_review_modal",header:"",content:t({questions:n}),srcElement:"root",hasExit:!0,isFullScreen:!1,isAlert:!1,preventClickOutsideDismiss:!0,$launcher:a};this._$modal=this._ModalManager.openModal(new e(t.id,t.header,t.content,t.srcElement,[],t.hasExit,t.$launcher,null,t.isFullScreen,t.isAlert,t.preventClickOutsideDismiss)),this._$reviewModalNext=$(".assessment-review-next-button"),this._$reviewModalPrevious=$(".assessment-review-previous-button"),this._$reviewModalClose=$(".assessment-review-close-button"),this._$reviewModalNext.click(this.onModalNavigate).attr("disabled",o),this._$reviewModalPrevious.click(this.onModalNavigate).attr("disabled",r),this._$reviewModalClose.click(this.onModalClose),1===this._reviewables.length&&this._$reviewModalPrevious.hide()},this.onModalNavigate=t=>{var t=$(t.currentTarget),e=$(".assessment-review-modal.render"),i=$(".assessment-review-modal"),t=t.hasClass("assessment-review-next-button");let s=e.index()-1;var a=i.length;t&&s<a-1?(s++,e.removeClass("render"),i.eq(s).addClass("render")):!t&&0<s&&(s--,e.removeClass("render"),i.eq(s).addClass("render")),this._$reviewModalPrevious.attr("disabled",0===s?"disabled":null),this._$reviewModalNext.attr("disabled",s<a-1?null:"disabled")},this.onModalClose=()=>{this._ModalManager.closeModal("assessment_review_modal")},this.onQuestionSubmit=t=>{const i=this._assessment[this._currentQuestionIndex];i.submission=t,i.submission.selection.each(t=>{var t=i.submission.selection.eq(t),e=t.closest(".question-option").attr("data-itestableid");t.attr("data-itestableid",e)}),this._currentQuestionIndex++,this._pageIsComplete||this._alertAdded||(t=d.ALERT_EXIT,this._AlertManager.addStateChangeAlert(new s({id:"modal_"+t,content:"{tk_"+t+"}",renderAsModalAlert:!1})),this._alertAdded=!0),this.renderQuestion()},this._RouteManager=t.RouteManager,this._ModalManager=t.ModalManager,this._SettingsManager=t.SettingsManager,this._AlertManager=t.AlertManager,this._AnalyticsManager=t.AnalyticsManager,this._TrackingManager=t.TrackingManager}build(t,e){return super.build(t,e),this._pageIsComplete=!0===this.api.model.currentPage.complete,this.buildContainer(),this._$container[0].outerHTML}buildContainer(){this._data=this.content.getChildrenOfType("Data")[0],this._metadata={},this._hideQuestionFeedback="true"===this._data.attributes.hideQuestionFeedback;var t=this.shouldPreventRetake()?"p_assessment_complete":this._data.attributes.templateID,t=this.api.populate(null,t,this.content);this._$container=$(t.content)}program(){this._currentPageId=this.api.getCurrentPage().id,this._$reviewContainer=$("#assessment-review-container"),this._$questionContainer=$("#assessment-question-container"),this._$questionWrapper=$("#assessment-question-wrapper"),this._$assessmentContainer=$("#CourseAssessment1-body"),this._$reviewModal=$("#assessment-review-modal"),this._$reviewModalPrevious=$("#assessment-review-previous-button"),this._$reviewModalNext=$("#assessment-review-next-button"),this._$reviewModalClose=$("#assessment-review-close-button"),$("#page-top").attr("aria-hidden","true"),this.shouldPreventRetake()?this.wireContinueButton():(this._AnalyticsManager.clearStorageOfType(this._currentPageId),this.processMetadata(),this.processCategories(),this.processQuestions(),this.buildAssessment(),this.renderQuestion(),this._firstTimeTestOut=this.isFreshTestOut(),this._firstTimeTestOut&&this.api.sendEvent({destination:"RouteManager",type:"reinitialize-profiling"}),this.api.model.addEventListener("apiEvent",this.apiHandler),this._TrackingManager.setActivityStatus({status:"register",activity:{id:"assessment",complete:!1,alert:this._data.attributes.activityAlertId}}))}processMetadata(){this.storeDefaults(),this.storeMetadata(),this.applyMetadata()}storeDefaults(){const i=/^(.*?)Defaults$/,s=$(this.content.sourceXML).children().filter(function(){return this.tagName.match(i)});s.each(t=>{var t=s[t].tagName,e=t.replace(i,"$1").toLowerCase();this._defaults[e]=this.content.getChildrenOfType(t)[0]})}wireContinueButton(){this._$continueButton=this._$assessmentContainer.find(".assessment-continue-button"),this._$continueButton.click(()=>{this.advancePage()})}storeMetadata(){this._metadata.testOut=this._data.attributes.testout&&"true"===this._data.attributes.testout.toLowerCase(),this._metadata.modular=this._data.attributes.modular&&"true"===this._data.attributes.modular.toLowerCase(),this._metadata.nextPageOnPass=this._data.attributes.nextPageOnPass,this._metadata.numQuestions=parseInt(this._data.attributes.numQuestions,10),this._metadata.sequence=this._data.attributes.sequence,this._metadata.flow=this._data.attributes.flow,this._metadata.retake=this._data.attributes.retake,this._metadata.phase=this._data.attributes.phase,this._metadata.randomizeAnswers="true"===this._data.attributes.randomizeAnswersDefault,this._metadata.questionMandatory="true"===this._data.attributes.questionMandatoryDefault,this._metadata.review=this._data.attributes.review,this._metadata.pass=this._data.attributes.pass,this._metadata.passingScore=parseFloat(this._data.attributes.passingScore),this._metadata.preAssessPassingScore=parseFloat(this._data.attributes.preAssessPassingScore),this._metadata.saveBestScore="true"===this._data.attributes.saveBestScore,this._passingScore=this.isPreTest()?this._metadata.preAssessPassingScore:this._metadata.passingScore,!0===a.QA_ALL_ASMT_ENABLED&&(this._metadata.sequence="default",this._metadata.randomizeAnswers=!1)}applyMetadata(){var i=this.parseConfigGlobalSettings();for(let t=0,e=i.length;t<e;t++){var s=i[t],a=this._SettingsManager.getConfigGlobalXml().find('plugin[id="'+s.template+'"]');const n=s.defaults.attributes;a.find("datum").each((t,e)=>{var i=$(e).attr("name"),e=$(e).attr("value");n[i]||(n[i]=e)})}}parseConfigGlobalSettings(){var t,e,i=/^(\w+)_(\w+)$/gim,s=[];for(const a in this._data.attributes)Object.prototype.hasOwnProperty.call(this._data.attributes,a)&&(t=i.exec(a))&&(e=t[1],t=t[2],e=this._defaults[e])&&("componentTemplate"===t&&s.push({template:this._data.attributes[a],defaults:e}),e.attributes[t]||(e.attributes[t]=this._data.attributes[a],i.lastIndex=0));return s}processCategories(){var i=this.content.getChildrenOfType("Category");for(let e=0,t=i.length;e<t;e++){var s=i[e],a=s.getChildrenOfType("Profile"),n=s.getFirstChildOfType("ProfileQuery"),r=s.getChildrenOfType("Name"),o=parseInt(s.attributes.passingScore,10)||100;let t;_.isEmpty(n)?_.isEmpty(a)||(t=l.convertStandardProfiles(a)):t=new l(n.attributes.value),_.isEmpty(t)||(this._profiling=!0);a={id:s.attributes.id,name:_.isEmpty(r)?"":r[0].text,increment:0,profileQuery:t,frequency:parseInt(s.attributes.numQuestions,10),shuffleQuestions:"true"===s.attributes.shuffleQuestions,questions:[],availableQuestions:[],sectionId:s.attributes.sectionId,passingScore:o};this._categories.push(a),this._categoryScores[a.id]={total:0,correct:0,score:null,passed:!1,sectionId:a.sectionId}}this._profiling&&(this._categories=this._categories.filter(this.filterCategoriesForProfiling))}processQuestions(){var i=this.content.getChildrenOfType("Question").filter(this.filterQuestionsForAvailableCategories);this._questions=[];for(let t=0,e=i.length;t<e;t++){var s=i[t],a={},n=s.getChildrenOfType("Response"),r=s.getChildrenOfType("Feedback"),o=s.getChildrenOfType("Review");a.attitudinal="true"===s.attributes.attitudinal,a.category=_.find(this._categories,{id:s.attributes.category}),a.id=s.attributes.id,a.index=t,a.complete=!1,a.templateID=s.attributes.templateID,a.randomIndex=Math.round(1e5*Math.random()),a.type=s.attributes.type,a.text=s.getChildrenOfType("QuestionText")[0].text,a.defaultText=s.getChildrenOfType("QuestionText")[0].text,a.responses=d.processResponses(n),a.feedback=d.processFeedbacks(r),a.review=d.processReviews(o),a.constructor=s,a.category.questions.push(a),a.category.availableQuestions.push(a),this._questionLookup[a.id.toString()]=a,this._questions.push(a)}this._profiling&&(this._metadata.numQuestions=this._questions.length)}static processResponses(i){var s=[];for(let t=0,e=i.length;t<e;t++){var a=i[t];s.push({correct:"true"===a.attributes.correct,value:a.attributes.value?a.attributes.value.toString():null,src:a.attributes.src||null,constructor:a,text:a.text})}return s}static processFeedbacks(i){var s=[];for(let t=0,e=i.length;t<e;t++){var a=i[t];s.push({text:a.text,attributes:a.attributes})}return s}static processReviews(i){var s=[];for(let t=0,e=i.length;t<e;t++){var a=i[t].getChildrenOfType("Text")[0].text;s.push({text:a,num:0,qid:"",result:""})}return s}buildAssessment(){var t=this._metadata.sequence,e=this._metadata.numQuestions;"default"===t?this.buildDefaultSequence(e):"random"===t?this.buildRandomSequence():this.buildDefinedSequence(t);for(let t=0;t<this._assessment.length;t++){var i,s=this.replaceQuestionNumberFormatting(t+1);(i=this._assessment[t]).text=s+i.defaultText,i.currentNumber=t+1,i.currentAssessmentLength=this._assessment.length}}buildDefaultSequence(e){var i;let s;for(let t=0;t<e;t++)i=this._questions[t],(s=i.category.availableQuestions).length||(i.category.availableQuestions=i.category.questions.concat(),s=i.category.availableQuestions),s.splice(s.indexOf(i),1),this._assessment.push(i)}buildRandomSequence(){var i;for(let t=0,e=this._categories.length;t<e;t++)(i=this._categories[t]).availableQuestions.sort(d.randomize),this.buildRandomCategoryQuestions(i);this._assessment.sort(d.randomize)}buildRandomCategoryQuestions(e){var i,s=e.frequency;for(let t=0;t<s;t++)e.availableQuestions.length||(e.availableQuestions=e.questions.concat(),e.availableQuestions.sort(d.randomize)),i=e.availableQuestions.shift(),this._assessment.push(i)}buildDefinedSequence(t){let e;var i=t.split(",");for(let t=0;t<i.length;t++){var s=i[t],s=_.find(this._questions,{id:s});(e=s.category.availableQuestions).length||(s.category.availableQuestions=s.category.questions.concat(),e=s.category.availableQuestions),e.splice(e.indexOf(s),1),this._assessment.push(s)}}onPageComplete(){this._pageIsComplete=!0,this._AlertManager.removeStateChangeAlert("modal_"+d.ALERT_EXIT),this.canAutoAdvance()&&this.advancePage()}retakeIncorrect(i){var s;this.clear(!0);for(let t=0,e=i.length;t<e;t++)s=i[t],this._assessment.push(s)}retakeIncorrectAlternate(i){let s;var a,e;this.clear(!0);for(let t=0,e=i.length;t<e;t++)s=i[t],(a=this.fetchAlternate(s,!0)).submission=null,s.submission=null,this._assessment.push(a);this._assessment.sort(d.randomize);for(let t=0;t<this._assessment.length;t++)e=this.replaceQuestionNumberFormatting(t+1),(s=this._assessment[t]).text=e+s.defaultText,s.currentNumber=t+1,s.currentAssessmentLength=this._assessment.length}retakeAll(i){var s;this.clear(!1);for(let t=0,e=i.length;t<e;t++)(s=i[t]).submission=null,this._assessment.push(s)}retakeAllAlternate(i){let s;var a,e;this.clear(!1);for(let t=0,e=i.length;t<e;t++)s=i[t],(a=this.fetchAlternate(s,!0)).randomIndex=Math.round(1e5*Math.random()),a.submission=s.submission=null,this._assessment.push(a);this._assessment.sort(d.randomize);for(let t=0;t<this._assessment.length;t++)e=this.replaceQuestionNumberFormatting(t+1),(s=this._assessment[t]).text=e+s.defaultText,s.currentNumber=t+1,s.currentAssessmentLength=this._assessment.length}fetchAlternate(t,e){var i=t.category;if(i.availableQuestions.length||(i.availableQuestions=i.questions.concat()),e)for(let t=0;t<i.availableQuestions.length;t++){var s=i.availableQuestions[t];if((!s.submission||"correct"!==s.submission.correct)&&-1===this._assessment.indexOf(s))return i.availableQuestions.splice(t,1),s}return i.availableQuestions.shift()}fetchIncorrectQuestions(){return this._assessment.filter(t=>{var e;return"correct"!==(null==(e=t.submission)?void 0:e.correct)&&!t.attitudinal})}clear(i){for(let t=0,e=this._questions.length;t<e;t++){var s=this._questions[t];(!i||s.submission&&"correct"!==s.submission.correct)&&(s.submission=null)}this._assessment=[],this._reviewables=[],this._currentQuestionIndex=0,this._partialPass=!1}replaceQuestionNumberFormatting(t){let e=this.api.parseTokens("{tk_Assessment_Question_Number_Format}");return e=(e=e.replace(/<Number\/>/gim,t.toString())).replace(/<nbsp\/>/gim,"&nbsp;")}renderQuestion(){var t,e;this.isLastQuestion()||(this.clearOldClasses(),t=this._assessment[this._currentQuestionIndex],e=n.AssessmentQuestionBuilder.buildQuestion(t.type,t,this._defaults[t.type],this._metadata,this.onQuestionSubmit,this.dependencies),this.addQuestionClasses(e),this.buildQuestion(t,e),this.buildHeader(),this.api.sendEvent({destination:"Style",type:"applyPageClasses"}),this.api.sendEvent({type:d.ASSESSMENT_QUESTION_CHANGE,value:t}),setTimeout(()=>{this._$questionContainer.find(".introduction-text, .question-text").eq(0).attr("tabindex","-1").focus()},500))}isLastQuestion(){return this._currentQuestionIndex>=this._assessment.length&&(this.api.sendEvent({type:d.ASSESSMENT_QUESTION_CHANGE,value:null}),this.renderReview(),!0)}clearOldClasses(){var t=[n.AssessmentQuestionBuilder.CHECKPOINT,n.AssessmentQuestionBuilder.CHEXERCISE,n.AssessmentQuestionBuilder.SORTABLE,n.AssessmentQuestionBuilder.RATINGSCALE,"drag-and-drop",n.AssessmentQuestionBuilder.MATRIX];_.each(t,t=>{this._$questionContainer.removeClass(t+"-body"),this._$questionContainer.removeClass("question-body"),this._$questionWrapper.removeClass(t+"-wrapper")}),this._$questionContainer.removeClass("answered feedback"),this._$questionContainer.removeClass("page-body")}addQuestionClasses(t){this._$questionContainer.addClass(t.getContainerClasses()),this._$questionWrapper.addClass(t.getWrapperClasses())}buildQuestion(t,e){var i=e.buildConstructor(),e=e.buildInstance(),s=e.build(i,this.api),i=i.getChildrenOfType("Data")[0];this._$questionWrapper.html(s),this.buildQuestionImage(i.attributes.featureImage,i.attributes.featureAlt),e.program(this._$questionContainer[0]),t.display=e}buildQuestionImage(t,e){t&&(this._$questionWrapper.find(".question-image").html(`<img src="${t}" alt="${e}" class="assessment-featured-image"/>`),this._$questionWrapper.find(".noimage").removeClass("noimage"))}buildHeader(){var t;this._headerTemplate&&(t=this._headerTemplate.replace(/<Count\/>/gim,(this._currentQuestionIndex+1).toString()).replace(/<Total\/>/gim,this._assessment.length.toString()),this.api.sendEvent({type:"headerUpdate",headerText:t}))}renderReview(){var t=_.template(this.api.getTemplate("p_assessment_fdbk").content),e={score:null,explanation:null,categoryScores:null,showRetake:!1,showContinue:!1,reviewPrompt:null,reviewItems:[]};this._score=this.calculateTotalScore(),this._metadata.modular&&this.isPreTest()?(this.processCategoryScores(),this._hasPassed=this.passedAllCategories(),this._partialPass=!this.failedAllCategories(),e.categoryScores=this.buildCategoryScoreDisplay()):(this._hasPassed=this._score>=this._passingScore,e.score=this._score+"%"),e.reviewItems=this.generateReviewList(),e.showRetake=!this._hasPassed&&!this._metadata.testOut&&"none"!==this._metadata.retake,e.showContinue=this._hasPassed||this._metadata.testOut||"none"===this._metadata.retake,e.reviewPrompt=this.fetchReviewPrompt(),e.explanation=this.fetchExplanationText(),this._$assessmentContainer.addClass("all"===this._metadata.review?"all":"incorrect"),this.setAssessmentData(this._score),this.shouldShowReview()?(this._$assessmentContainer.append(t(e)),this.api.sendEvent({destination:"Style",type:"applyPageClasses"}),this._$reviewContainer.remove(),this._$reviewContainer=this._$assessmentContainer.find("#assessment-review-container"),this.hideQuestionFeedback()&&this._$reviewContainer.addClass("hide-feedback"),this.shouldSetCompletion()&&this.doCompletionTrackingActions(),this._$retakeButton=this._$reviewContainer.find(".assessment-retake-button"),this.wireContinueButton(),this._$retakeButton.click(this.retakeAssessment),this._$reviewContainer.find(".assessment-review-description").click(this.launchReviewModal),this._$questionContainer.hide(),this._$reviewContainer.show().attr("tabindex","-1").focus()):this.doCompletionTrackingActions()}hideQuestionFeedback(){return!!this._hideQuestionFeedback||100===this._score&&"review100"===this._metadata.pass&&"incorrect"===this._metadata.review}shouldShowReview(){var t={failed:!this._hasPassed,imperfectScore:"review"===this._metadata.pass&&this._score<100,forceReview:"review100"===this._metadata.pass};return r.objectValues(t).some(t=>t)}shouldSetCompletion(){return this._hasPassed||this._metadata.testOut||"none"===this._metadata.retake}calculateTotalScore(){let i=0,s=0;var a=this._questions.filter(t=>!1===t.attitudinal);for(let t=0,e=a.length;t<e;t++){var n=a[t];n.submission&&("correct"===n.submission.correct&&s++,i++)}return Math.round(s/i*100)}processCategoryScores(){this.calculateCategoryScores(),this.setCategoryScores()}buildCategoryScoreDisplay(){var t=_.template(this.api.getTemplate("assessment-review-category-template").content);const e=[];return _.each(this._categoryScores,t=>{e.push({score:t.score,sectionName:this.api.getSectionTitleById(t.sectionId)})}),t({categories:e})}calculateCategoryScores(){for(let t=0;t<this._questions.length;t++){var e,i=this._questions[t];i.submission&&(e=i.category.id,this._categoryScores[e].total++,"correct"===i.submission.correct)&&this._categoryScores[e].correct++}}setCategoryScores(){_.each(this._categoryScores,(t,e)=>{var e=this.fetchCategoryInfo(e),i=Math.round(t.correct/t.total*100);_.isEmpty(e)||(t.score=i,t.passed=i>=e.passingScore)})}fetchCategoryInfo(i){for(let t=0,e=this._categories.length;t<e;t++){var s=this._categories[t];if(s.id===i)return s}return null}generateReviewList(){var i=[];for(let t=0,e=this._assessment.length;t<e;t++){var s=this._assessment[t],a="correct"===s.submission.correct?"correct":"incorrect";"incorrect"===this._metadata.review&&("correct"==a||s.attitudinal)||(this._reviewables.push(s),i.push({num:t,result:s.attitudinal?n.QuizUtil.FEEDBACK_NEUTRAL:a,qid:s.id,text:s.text}))}return i}fetchExplanationText(){var t="Assessment_Explanation_",e=this.isPreTest()?"Pre":"",i=this._metadata.modular?"_Modular":"",s=d.fetchOutcomeString(this.isPreTest(),this._metadata.modular,this._hasPassed,this._partialPass),e=`{tk_${e}${t}${s}${i}}`;return _.isEmpty(this.content.getChildrenOfType(t+s))?this.api.parseTokens(e):this.content.getChildrenOfType(t+s)[0].text}static fetchOutcomeString(t,e,i,s){return t&&e&&i&&!s?"PassAll":t&&e&&s?"PassSome":t&&!e&&i||!t&&i?"Pass":"Fail"}setAssessmentData(t){!this._firstTimeTestOut&&this._metadata.testOut||this._TrackingManager.setAssessmentData({score:t,passingScore:this._passingScore,isTestOut:this._metadata.testOut,suppressScore:this.shouldSuppressScore(),pre:this.isPreTest(),persist:!0,categoryScores:this._metadata.modular?this._categoryScores:{},saveBestScore:this._metadata.saveBestScore})}shouldSuppressScore(){return this.testOutAttempted()&&!this.isPreTest()||this.isPreTest()&&!this._metadata.testOut}fetchReviewPrompt(){let t;return t=this.isPreTest()?"all"===this._metadata.review?this.getReviewAllPrompt():"{tk_PreAssessment_Prompt_Incorrect}":"all"===this._metadata.review?this.getReviewAllPrompt():"{tk_Assessment_Prompt_Incorrect}",this.api.parseTokens(t)}getReviewAllPrompt(){return"review100"===this._metadata.pass&&this._hasPassed?"{tk_Assessment_Prompt_All_Passed}":this.isPreTest()?"{tk_PreAssessment_Prompt_All}":"{tk_Assessment_Prompt_All}"}isFreshTestOut(){return this._metadata.testOut&&_.isEmpty(this._RouteManager.profilingResponses[i.TESTOUT_PROFILE_ID])}testOutAttempted(){return!!this._RouteManager.profilingResponses[i.TESTOUT_PROFILE_ID]}doCompletionTrackingActions(){this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"assessment",complete:!0}}),this._AlertManager.removeStateChangeAlert("modal_"+d.ALERT_EXIT),this._metadata.testOut?this.routeTestOutUsers():this._pageIsComplete&&this.canAutoAdvance()&&this.advancePage()}routeTestOutUsers(){let t;t=this._firstTimeTestOut?(this.api.model.testedOut=this.hasTestedOut(),this.api.model.testedOut?i.TESTOUT_PASSED:i.TESTOUT_FAILED):this._RouteManager.profilingResponses[i.TESTOUT_PROFILE_ID][0],this.api.sendEvent({destination:"all",type:"profiling",profileId:i.TESTOUT_PROFILE_ID,responses:[{profileValue:t}],pageID:this.api.model.currentPage.id})}advancePage(){this._metadata.testOut&&this.api.model.testedOut?_.isUndefined(this._metadata.nextPageOnPass)||_.isEmpty(this._metadata.nextPageOnPass)||setTimeout(()=>{this.api.callPage(this._metadata.nextPageOnPass)},10):setTimeout(()=>{this.api.callNextPage()},10)}fetchOutcomeLabel(t){switch(t.correct){case n.QuizUtil.FEEDBACK_CORRECT:return this.api.parseTokens("{tk_ThatIsCorrect}");case n.QuizUtil.FEEDBACK_PARTIAL:return this.api.parseTokens("{tk_PartiallyCorrect}");case n.QuizUtil.FEEDBACK_INCORRECT:return this.api.parseTokens("{tk_ThatIsIncorrect}");default:return null}}canAutoAdvance(){var t={passed:this._hasPassed,perfectScore:100===this._score,optionalReview:"review100"!==this._metadata.pass};return r.objectValues(t).every(t=>t)||"advance"===this._metadata.pass}hasTestedOut(){return this._metadata.modular?this.passedAllCategories():this._hasPassed}passedAllCategories(){let e=!0;return _.each(this._categoryScores,t=>{t.passed||(e=!1)}),e}failedAllCategories(){let e=!0;return _.each(this._categoryScores,t=>{t.passed&&(e=!1)}),e}static randomize(t,e){return t.randomIndex-e.randomIndex}destroy(){this._$reviewContainer=null,this._$questionContainer=null,this._$questionWrapper=null,this._$assessmentContainer=null,this._$reviewModalNext=null,this._$reviewModalPrevious=null,this._$container=null,this._questions=[],this._questionLookup={},this._currentQuestionIndex=0,this._metadata={},this._defaults={},this._categories=[],this._assessment=[],this._reviewables=[],this._headerTemplate=null,this._$reviewModal=null,this._score=void 0,this._profiling=!1,this._pageIsComplete=!1,this._AlertManager.removeStateChangeAlert("modal_"+d.ALERT_EXIT),this.api.model.removeEventListener("apiEvent",this.apiHandler),$("#page-top").attr("aria-hidden","false")}isPreTest(){return this._metadata.testOut||this._metadata.phase===d.PHASE_PRE}shouldPreventRetake(){return this._pageIsComplete&&"none"===this._data.attributes.retake&&!1===a.QA_TRACKING_MODE_DISABLED}}d.ASSESSMENT_QUESTION_CHANGE="assessmentQuestionChange",d.ALERT_EXIT="altAssessmentExit",d.PHASE_PRE="pre",n.CourseAssessment=d}(GLEPlugins=GLEPlugins||{}),function(t){var e=GLECore.TooltipData,a=GLECore.DateUtil;class i extends t.IPluggable{constructor(t){super(t),this.print=()=>{var t=window.document.title,e=this.api.parseTokens(this._data.attributes.printTitle).replace(/[ ./\\:*?"<>]/g,"_");let i="";try{i=window.top.document.title,window.top.document.title=e}catch(t){}finally{window.document.title=e}window.print();try{window.top.document.title=i}catch(t){}finally{window.document.title=t}},this.renderTooltip=t=>{t=$(t.currentTarget),t=new e(t.attr("id"),null,t.attr("aria-label"),"simple_tooltip",e.TOOLTIP_EFFECT_FADE,e.TOOLTIP_POSITION_BOTTOM_CENTER,e.TOOLTIP_DISMISS_MOUSEOUT,!0,"diplomaprint",t,null,null,null,!1);this.api.sendEvent({destination:"TooltipManager",type:"showTooltip",tooltip:t})},this._LanguageManager=t.LanguageManager,this._LaunchDataManager=t.LaunchDataManager}build(t,e){super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0],this._diplomaType=this._data.attributes.diplomaType,this._showControlID="true"===this._data.attributes.showControlID;t=this.api.populate(null,this._data.attributes.templateID,this.content);return this._template=t.template,this._$container=$(t.content),t.content}program(t){super.program(t),this.setDiplomaTitle(),this.parseVerbage(),this.buildControlID(),this._$printButton=$("#diploma-print"),this._$printButton.on("click",this.print),this._$printButton.on("mouseenter focus",this.renderTooltip)}setDiplomaTitle(){var t=$(".diploma-title");"Certificate"===this._diplomaType?t.html(this.api.parseTokens("{tk_Certificate}")):"CertComplete"===this._diplomaType&&(t.html(this.api.parseTokens("{tk_CertComplete}")),t.addClass("cert-complete-title"))}parseVerbage(){var t=$(".diploma-text"),e=this.api.trackingData?this.api.trackingData.userName:"Guest",i=a.getDate(this.api.trackingData.completionDate||new Date);let s=t.html();s=(s=s.replace(/<username\s*\/?>(?:<\/username>)?/gim,e)).replace(/<date\s*\/?>(?:<\/date>)?/gim,i),t.html(s)}buildControlID(){var t;this._showControlID&&(t=this.generateControlHash(),$(".diploma-control").html(this.api.parseTokens("{tk_DiplomaControl}")+t))}generateControlHash(){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZ",s="GALAHUNO",t=null!=(t=null==(t=this.api.trackingData)?void 0:t.userName)?t:"Guest",e=null!=(e=null==(e=this.api.trackingData)?void 0:e.userId)?e:"guest_id",a=this._LaunchDataManager.courseInputData.courseCode,n=this._LaunchDataManager.courseInputData.clientCode,r=null!=(r=null==(r=this.api.trackingData)?void 0:r.completionDate)?r:new Date,o=r.getDate()<10?"0"+r.getDate().toString():r.getDate().toString(),l=[{def:"USER",data:t},{def:"ABCD",data:e},{def:"BPCO",data:a},{def:"SAIG",data:n},{def:"0101",data:(r.getMonth()+1<10?"0"+(r.getMonth()+1):(r.getMonth()+1).toString())+o}];let d="";for(let t=0,e=l.length;t<e;t++){var h=l[t];d+=0<h.data.length?(h.data+"ZZZZ").substring(0,4).toUpperCase():h.def}let c=0,u="";for(let e=0,t=d.length;e<t;e++){let t=i.indexOf(d.charAt(e));var p=(t=t<0?parseInt(d.charAt(e),10):t)+i.indexOf(s.charAt(c));u+=i.charAt(p%26),c=c===s.length-1?0:c+1}return u}}t.Diploma=i}(GLEPlugins=GLEPlugins||{}),function(l){var s=GLECore.TimeUtil,n=GLECore.DataUtil,a=GLECore.ModalData,d=GLECore.TrackingManager,t=GLECore.Platform;class r extends l.AbstractZone{get data(){return this._data}constructor(t,e){super(t),this._currentScrollIndex=0,this._skipReview=!1,this._requireReview=!1,this._maxCarouselItems=5,this._carouselOffset=80,this._scrollIncrement=140,this._interactionTime=0,this.onExampleItemClick=()=>{this._$instructions.addClass("renderBucketModal"),this.buildInstructionsBucketModal()},this.onAccordionClick=()=>{var t=$(this._bodySelector+" .dd-getting-started-accordion"),e=$(this._bodySelector+" .dd-getting-started-accordion-header");t.toggleClass("expanded"),e.attr("aria-expanded",t.is(".expanded")?"true":"false")},this.onExampleItemDrop=(t,e)=>{var t=$(t.target),e=e.draggable,i=e.parent(),s=t.position(),i=i.position();t.addClass("dropped"),e.css("left",s.left-i.left).css("top",0),this.exitExampleScreen()},this.onExampleComplete=()=>{this.exitExampleScreen()},this.exitExampleScreen=()=>{this._ModalManager.closeModal(r.DD_MODAL_INSTRUCTIONS_BUCKET_ID),this._$instructions.addClass("hide"),setTimeout(this.renderActivity,500),r.DD_INSTRUCTIONS_VIEWED=!0,$(this._bodySelector+" #drag-and-drop-container").scrollTop(0).find(".dd-carousel-prompt")},this.renderActivity=()=>{this._$instructions.hide(),this._$container.removeClass("instructions-view").addClass("activity-view"),this._$activity.addClass("render"),this.api.sendEvent({destination:"Style",type:"applyPageClasses"}),setTimeout(()=>{$(this._bodySelector+" #drag-and-drop-container").find(".dd-carousel-prompt").attr("tabindex","-1").focus()},500)},this.onLaunchKeyHandler=t=>{var e=$(t.currentTarget);"Tab"===t.key?this.resetKeyEventListeners():-1!==["Enter"," "].indexOf(t.key)&&this.handleAccessMenuSelection(t,e)},this.onContainerKeyHandler=t=>{var e=$(this._bodySelector+" .dd-access-menu"),i=0<e.length,s=$(this._bodySelector+" .dd-getting-started-draggable"),s=_.isEmpty(s)?$(this._bodySelector+" .dd-carousel-item.selected"):s;"Escape"===t.key&&!0==i&&(e.detach(),s.focus(),s.on("keydown",this.onLaunchKeyHandler))},this.onExampleAccessMenuItemSelect=t=>{var e=$(t.currentTarget),e=$(this._bodySelector+" .dd-getting-started-example-target[data-target-id='"+e.data("bucket-id")+"']"),i=$(this._bodySelector+" .dd-getting-started-draggable");"click"!==t.type&&-1===[13,32].indexOf(t.keyCode)||($(this._bodySelector+" .dd-access-menu").detach(),i.detach().appendTo(e),this.exitExampleScreen())},this.onAccessMenuItemSelect=t=>{var e=$(t.currentTarget),i=e.closest(".dd-carousel-item"),e=e.data("bucket"),e=$(this._bodySelector+" #dd-bucket-"+e.id);"click"!==t.type&&-1===["Enter"," "].indexOf(t.key)||(t.preventDefault(),t.stopImmediatePropagation(),(t=jQuery.Event("drop")).target=e[0],this.onItemDrop(t,{draggable:i}),i.on("keydown",this.onLaunchKeyHandler),$(this._bodySelector+" .dd-access-menu").detach(),this._$activity.hasClass("complete")&&this._$submitButton.focus())},this.onItemMobileClick=t=>{t=$(t.currentTarget);this._$activity.addClass("renderBucketModal"),this.buildBucketModal(t)},this.buildBucketModal=i=>{const s=i.data("item");var t=_.template(this.api.getTemplate("p_dd_modal_bucket").content),e={item:s},t={id:r.DD_MODAL_BUCKET_ID,content:t(e),srcElement:"root",buttons:this._buckets.map((t,e)=>({id:"dd-target-"+(e+1),label:t.header,data:{item:s,bucket:t,$item:i},callback:this.onMobileSelection})),hasExit:!0,isFullScreen:!1,$launcher:i},e=new a(t.id,null,t.content,t.srcElement,t.buttons,t.hasExit,t.$launcher,null,t.isFullScreen);this._ModalManager.closeModal(r.DD_MODAL_BUCKET_ID),this._ModalManager.openModal(e)},this.onMobileSelection=t=>{var t=t.data.buttonData,e=t.$item,i=e.next(),t=t.bucket,t=$(this._bodySelector+" #dd-bucket-"+t.id);e.detach().appendTo(t).removeClass("ghost selected"),this._$carousel.removeClass("clearFocus"),this.clearFeatureText(),this._ModalManager.closeModal(r.DD_MODAL_BUCKET_ID),e.hasClass("dropped")||this.completeItemDrop(e,i)},this.onWindowResize=()=>{var t=this.matchMedia();t!==this._currentState&&(this._currentState=t,this.resetCarouselScroll(),this.updateCarouselScrollValues())},this.onItemMouseOver=t=>{t=$(t.currentTarget);this._$carousel.addClass("hovering"),this._$carousel.removeClass("clearFocus"),this.setFeatureText(t)},this.onItemMouseOut=()=>{$(this._bodySelector+" .dd-bucket > .selected").removeClass("selected"),this._$carousel.removeClass("hovering clearFocus"),this.setFeatureText()},this.onItemClick=t=>{var e=$(t.currentTarget),i=0<e.closest(".dd-bucket").length,t=t.type;!0==i&&"click"===t?$(this._bodySelector+" .dd-bucket > .dd-carousel-item").addClass("clicked"):"click"!==t&&$(this._bodySelector+" .dd-bucket > .dd-carousel-item").removeClass("clicked"),!0==i?($(this._bodySelector+" .dd-bucket > .selected").removeClass("selected"),this._$carousel.addClass("clearFocus"),e.addClass("selected"),this.setFeatureText(e)):(this._$carousel.removeClass("clearFocus"),$(this._bodySelector+" .selected").removeClass("selected"),e.addClass("selected"),this.enableDragging(),this.setFeatureText())},this.onItemDragStart=t=>{$(t.target).addClass("ghost")},this.onItemDragStop=t=>{$(t.target).removeClass("ghost")},this.onItemDrop=(t,e)=>{t=$(t.target),e=e.draggable;let i=e.next();_.isEmpty(i)&&(i=e.prev()),e.detach().appendTo(t).removeClass("ghost selected"),this.clearFeatureText(),this._ModalManager.closeModal(r.DD_MODAL_BUCKET_ID);t=e.closest(".dd-bucket").data("bucket");this.applyBucketHeaderAltText(e,t),e.hasClass("dropped")||(this.completeItemDrop(e,i),this._$carousel.parent().removeClass("accessEnabled"))},this.onRewindCarousel=()=>{var t=this._$carousel.find(".dd-carousel-item").eq(this._currentScrollIndex+(this._maxCarouselItems-1));t.hasClass("selected")&&(t.removeClass("selected"),t.prev().addClass("selected")),this._currentScrollIndex--,this.scrollCarousel(),this.enableDragging()},this.onAdvanceCarousel=()=>{var t=this._$carousel.find(".dd-carousel-item").eq(this._currentScrollIndex);t.hasClass("selected")&&(t.removeClass("selected"),t.next().addClass("selected")),this._currentScrollIndex++,this.scrollCarousel(),this.enableDragging()},this.evaluate=()=>{let s=!0;var t;this._attempts++,this._$submitButton.attr("disabled","disabled"),this._$activity.addClass("submitted"),this._$items.each(t=>{var t=this._$items.eq(t),e=t.closest(".dd-bucket").data("bucket"),i=t.data("item");i.selectedBucket=this.getBucketById(e.id),i.target===e.id?(i.correct=!0,i.statusHeader=this.api.parseTokens("{tk_dd_CorrectStatus}"),this._iTestable||t.addClass("correct")):(i.correct=!1,i.statusHeader=this.api.parseTokens("{tk_dd_IncorrectStatus}"),this._iTestable||t.addClass("incorrect"),s=!1)}),this._lastAnswer={correct:!0===s?"correct":"incorrect",selection:this._$items},this._configuration.iTestable&&this._iTestableContinuous?(this._configuration.onQuestionSubmit(this._lastAnswer),this.trackInteractionCompletion([this.encodeInteractionResponses()],!0===s?"correct":"wrong")):(!0===s&&!1===this._requireReview&&(this._skipReview=!0,this.trackDDCompletion()),this.trackInteractionCompletion([this.encodeInteractionResponses()],!0===s?"correct":"wrong"),t=this._iTestable?0:this._reviewTimeout,this._timeoutRef=window.setTimeout(this.advanceScreen,1e3*t))},this.advanceScreen=()=>{!0===this._skipReview&&!0!==this._configuration.iTestable?this._isZone?this.advanceZone():this.api.callNextPage():this.fadeOutActivityScreen()},this.fadeInReviewScreen=()=>{$(this._bodySelector+" #drag-and-drop-container").scrollTop(0),this._$container.removeClass("activity-out"),this._$container.removeClass("activity-view").addClass("feedback-view");var t=this.buildReviewScreen();$(this._bodySelector+" .drag-and-drop-wrapper").html(t),this.trackDDCompletion(),this.api.sendEvent({destination:"Style",type:"applyPageClasses"}),this._$reviewContainer=this._$container.find(".dd-review"),this._$reviewContainer.find(".dd-review-header").attr("tabindex","-1").focus(),this._configuration.iTestable&&(t=this.needsMoreAttempts()?this._lastAnswer.correct:"complete",this._$container.find(".dd-review-buttons").addClass(t),this._$container.find(".dd-review-continue-button").on("click",this.onQuestionSubmit),this._$container.find(".dd-review-retry-button").on("click",this.onRetry))},this.onQuestionSubmit=()=>{this._configuration.onQuestionSubmit(this._lastAnswer)},this.onRetry=()=>{this._$container.removeClass("feedback-view").addClass("activity-view"),this.resetActivity(null,this._$reviewContainer)},this.resetActivity=(t,e)=>{var i=(e=_.isEmpty(e)?this._$activity:e).parent(),s=(this._currentScrollIndex=0,this._items=n.shuffleArray(this._items),this.buildActivityContainer());e.detach(),i.append($(s)),this.api.sendEvent({destination:"Style",type:"applyPageClasses"}),i.find(".dd-activity").addClass("render"),$(this._bodySelector+" .reset-alert").attr("role","alert").html(this.api.parseTokens("{tk_dd_ResetSuccess}")),this.configureActivity(),this.configureAccessibility()},this.showGettingStartedModal=()=>{var t={id:r.DD_MODAL_ID,header:this.api.parseTokens("{tk_GettingStarted}"),content:this.api.parseTokens("{tk_dd_Prompt_All}"),srcElement:"root",buttons:[{id:"dd-resume",label:this.api.parseTokens("{tk_dd_ResumeActivity}"),callback:this.onModalClose}],hasExit:!0,isFullScreen:!1,$launcher:this._$gettingStartedButton},t=new a(t.id,t.header,t.content,t.srcElement,t.buttons,t.hasExit,t.$launcher,null,t.isFullScreen);this._ModalManager.openModal(t)},this.onModalClose=()=>{this._ModalManager.closeModal(r.DD_MODAL_ID)},this._configuration=e||{},this._ModalManager=t.ModalManager,this._TrackingManager=t.TrackingManager}static initInteractionData(t,e,r,o){const l={n:e};var e=$(t.sourceXML),i=r?"_"+(o+1):"",i=(l.id=n.standardizeId(t.getFirstAncestorElementByName("Page").attributes.pageID+i),l.type="matching",l.correct_responses=[{pattern:"{order_matters=false}"}],l.long_correct_responses=[{pattern:"{order_matters=false}"}],l.long_response_lookup={},r?"QuestionText":"#txtRollover"),e=e.find(i).text(),i=(l.description=e.replace(/<[^>]+>/gim,"").substr(0,255),l.long_response_lookup.items={},l.long_response_lookup.buckets={},r?"Response":"Item");return t.getAllDescendantsOfType(i).forEach((t,e)=>{var i=0===e?"":"[,]",s="target_"+t.attributes.target,a=r?"tile_i"+(e+1):"tile_"+t.attributes.id,n=(r?t:t.getFirstChildOfType("RolloverText")).text,e=d.generateShortIdentifier(o+1,e,n,r?"CA":"");l.correct_responses[0].pattern+=i+a+"[.]target_"+s,l.long_correct_responses[0].pattern+=i+e+"[.]Bucket_"+t.attributes.target.replace(/t/gim,""),l.long_response_lookup.items[a]=e,l.long_response_lookup.buckets[s]="Bucket_"+t.attributes.target.replace(/t/gim,"")}),d.addInteractionIdToSource(t,l.id),[l]}build(t,e){super.build(t,e),this.extractDataValues();t=this.buildInstructionsContainer();return t+=this.buildActivityContainer()}extractDataValues(){var t=this.content.getChildrenOfType("Activity")[0];this._data=this.content.getChildrenOfType("Data")[0],this._skipReview="true"===this._data.attributes.skipReview,this._reviewType=this._data.attributes.reviewType,this._reviewTimeout=parseFloat(this._data.attributes.autoAdvanceDelay),this._requireReview="true"===this._data.attributes.requireReview,this._transitionSpeed=parseFloat(this._data.attributes.autoAdvanceTransitionSpeed),this._iTestable="true"===this._data.attributes.itestable,this._iTestableContinuous="continuous"===this._data.attributes.flow,this._iTestableID=this._data.attributes.itestableID,this._items=r.generateItemList(t),this._buckets=this.generateBucketList(this._items,t)}buildInstructionsContainer(){return _.template(this.api.getTemplate("p_dd_instructions").content)()}buildActivityContainer(){var t=this.content.getChildrenOfType("Activity")[0];return _.template(this.api.getTemplate("p_dd_activity").content)({instructions:t.getChildByAttribute("id","txtRollover").text,defaultText:this._items[0].hoverText,items:this._items,buckets:this._buckets})}static generateItemList(t){let i=[];var s=t.getChildrenOfType("Item");for(let t=0,e=s.length;t<e;t++){var a=new l.DragAndDropItemModel(s[t],t);a.imageType===l.DragAndDropImageType.Vector&&(a.src=sai.ApplicationController.model.svgManifest[a.src].content),i.push(a)}return i=n.shuffleArray(i)}generateBucketList(i,s){var a=[];for(let t=0,e=s.getChildrenLike("id",/^txt\d{1}Label$/).length;t<e;t++){var n=t+1,r="t"+n,o=i.filter(this.getItemsInBucket,r),n=s.getChildByAttribute("id","txt"+n+"Label").text,r=new l.DragAndDropBucketModel(r,t,n,o);a.push(r)}return a}getItemsInBucket(t){return t.target===this.toString()}getBucketById(t){return _.find(this._buckets,{id:t})}program(t){super.program(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} .drag-and-drop-body`:".drag-and-drop-body",this._$container=$(""+this._bodySelector),this._interactionTimer=window.setInterval(()=>{this._interactionTime++},1e3),this.configureInstructions(),this.configureActivity(),this.configureAccessibility(),this.trackDDInit(),this._$container.addClass("instructions-view");let e=!0===r.DD_INSTRUCTIONS_VIEWED;(e=!(!this._isZone||this.isFirstDragAndDropZone())||e)?this.renderActivity():this._attempts=0}configureInstructions(){var t=$(this._bodySelector+" .dd-getting-started-draggable"),e=$(this._bodySelector+" .dd-getting-started-example-target"),i=$(this._bodySelector+" .dd-getting-started-accordion-header");this._$instructions=$(this._bodySelector+" .dd-getting-started"),t.on("mousedown",this.onExampleItemClick),i.on("click",this.onAccordionClick),t.draggable({revert:"invalid",appendTo:this._$container,containment:this._$container,revertDuration:500}),e.droppable({accept:".dd-getting-started-draggable",hoverClass:"ui-state-active",drop:this.onExampleItemDrop})}buildInstructionsBucketModal(){var t=_.template(this.api.getTemplate("p_dd_modal_example_bucket").content),t={id:r.DD_MODAL_INSTRUCTIONS_BUCKET_ID,content:t(),srcElement:"root",buttons:[{id:"dd-target-1",label:this.api.parseTokens("{tk_dd_target_1}"),callback:this.onExampleComplete},{id:"dd-target-2",label:this.api.parseTokens("{tk_dd_target_2}"),callback:this.onExampleComplete}],hasExit:!0,isFullScreen:!1,$launcher:$(this._bodySelector+" .dd-getting-started-draggable")},t=new a(t.id,null,t.content,t.srcElement,t.buttons,t.hasExit,t.$launcher,null,t.isFullScreen);this._ModalManager.closeModal(r.DD_MODAL_INSTRUCTIONS_BUCKET_ID),this._ModalManager.openModal(t)}configureActivity(){this._currentState=this.matchMedia(),this._$activity=$(this._bodySelector+" .dd-activity"),this._$carousel=$(this._bodySelector+" .dd-carousel"),this._$itemDescription=$(this._bodySelector+" .dd-activity-instruction-box span"),this._$items=this._$carousel.find(".dd-carousel-item"),this._$items.hover(this.onItemMouseOver,this.onItemMouseOut),this._$items.click(this.onItemClick),this._$targets=$(this._bodySelector+" .dd-bucket"),this.connectModelsToDisplay(),this.wireButtons(),this.enableDragging(),this.enableDropping(),this.updateCarouselScrollValues(),$(window).on("resize",this.onWindowResize)}configureAccessibility(){$(this._bodySelector+" .dd-access-launch").on("keydown",this.onLaunchKeyHandler),this._$container.on("keydown",this.onContainerKeyHandler)}resetKeyEventListeners(){var t=$(this._bodySelector+" .dd-access-launch");t.off("keydown",this.onLaunchKeyHandler),t.on("keydown",this.onLaunchKeyHandler),$(this._bodySelector+" .dd-access-menu").detach()}handleAccessMenuSelection(t,e){var i=e.data("item");$(this._bodySelector+" .dd-access-menu").detach(),_.isEmpty(i)?(this.renderExampleAccessMenu(e),e.off("keydown",this.onLaunchKeyHandler)):e.hasClass("selected")?(this.renderAccessMenu(e),e.off("keydown",this.onLaunchKeyHandler)):this.onItemClick(t)}renderExampleAccessMenu(t){var e=_.template(this.api.getTemplate("p_dd_access_menu").content)({buckets:[{id:"1",header:this.api.parseTokens("{tk_dd_target_1}")},{id:"2",header:this.api.parseTokens("{tk_dd_target_2}")}]}),t=(t.append(e),$(this._bodySelector+" .dd-access-menu")),e=t.find("button");e.on("keydown",this.onExampleAccessMenuItemSelect),e.eq(0).focus(),t.on("keydown",r.handleAccessMenuNavigation)}renderAccessMenu(t){var e=_.template(this.api.getTemplate("p_dd_access_menu").content)({buckets:this._buckets}),t=(t.append(e),$(this._bodySelector+" .dd-access-menu")),e=t.find("button");e.on("keydown",this.onAccessMenuItemSelect),_.each(this._buckets,t=>{$(this._bodySelector+" .dd-access-button[data-bucket-id='"+t.id+"']").data("bucket",t)}),this._$carousel.parent().addClass("accessEnabled"),e.eq(0).focus(),t.on("keydown",r.handleAccessMenuNavigation)}static handleAccessMenuNavigation(t){var e,i,s;-1!==["ArrowUp","ArrowDown"].indexOf(t.key)&&(t="ArrowUp"===t.key,i=(e=$(".dd-access-button:focus")).parent().prev().find(".dd-access-button"),s=e.parent().next().find(".dd-access-button"),(!0==t&&_.isEmpty(i)?e.closest(".dd-access-menu").children().last().find(".dd-access-button"):!0==t?i:_.isEmpty(s)?e.closest(".dd-access-menu").children().first().find(".dd-access-button"):s).focus())}connectModelsToDisplay(){_.each(this._items,(t,e)=>{this._$items.eq(e).attr("data-id",t.id).data("item",t)}),_.each(this._buckets,(t,e)=>{$(this._bodySelector+" .dd-bucket[data-bucket-id='"+e+"']").attr("data-id",t.id).data("bucket",t)})}wireButtons(){this._$previousButton=$(this._bodySelector+" .dd-carousel-back-button"),this._$nextButton=$(this._bodySelector+" .dd-carousel-next-button"),this._$submitButton=$(this._bodySelector+" .dd-carousel-submit-button"),this._$resetButton=$(this._bodySelector+" .dd-reset-button"),this._$gettingStartedButton=$(this._bodySelector+" .dd-getting-started-button"),this._$previousButton.on("click",this.onRewindCarousel),this._$nextButton.on("click",this.onAdvanceCarousel),this._$submitButton.on("click",this.evaluate),this._$resetButton.on("click",this.resetActivity),this._$gettingStartedButton.on("click",this.showGettingStartedModal),this.updateCarouselButtons()}updateCarouselButtons(){var t=this._$carousel.find(".dd-carousel-item").length;$(this._bodySelector+" .dd-carousel-scroll-container").toggleClass("overMaxItems",this._items.length>this._maxCarouselItems),0<this._currentScrollIndex?this._$previousButton.attr("disabled",null):this._$previousButton.attr("disabled","disabled"),this._currentScrollIndex+this._maxCarouselItems<t?this._$nextButton.attr("disabled",null):this._$nextButton.attr("disabled","disabled")}enableDragging(){var t=this._$carousel.find(".dd-carousel-item.ui-draggable"),e=this._$carousel.find(".selected");_.isEmpty(t)||(t.draggable("destroy"),t.off("mousedown",this.onItemMobileClick)),e.on("mousedown",this.onItemMobileClick),e.draggable({revert:"invalid",helper:"clone",appendTo:this._$activity,containment:this._$activity,revertDuration:500,start:this.onItemDragStart,stop:this.onItemDragStop})}enableDropping(){this._$targets.droppable({accept:".dd-carousel-item",hoverClass:"ui-state-active",drop:this.onItemDrop})}matchMedia(){return this.api.getMediaSize()}resetCarouselScroll(){5<this._items.length||this._currentState!==t.DEVICE_MEDIA_SIZE_LG||(this._currentScrollIndex=0)}updateCarouselScrollValues(){this._maxCarouselItems=parseInt(this._data.attributes[this._currentState+"MaxItems"],10),this._scrollIncrement=parseInt(this._data.attributes[this._currentState+"ScrollIncrement"],10),this._carouselOffset=parseInt(this._data.attributes[this._currentState+"CarouselOffset"],10),this.scrollCarousel()}applyBucketHeaderAltText(i,t){const s=i.find("img");this._buckets.forEach(t=>{var t=new RegExp("^"+t.header+": "),e=i.attr("aria-label")||s.attr("alt");_.isEmpty(e)||(s.attr("alt",e.replace(t,"")),i.attr("aria-label",e.replace(t,"")))}),_.isEmpty(t)||(i.attr("aria-label",t.header+": "+i.attr("aria-label")),s.attr("alt",t.header+": "+s.attr("alt")))}completeItemDrop(t,e){this.updateCarouselScroll(),this.updateCarouselButtons(),this.updateScrollClasses(),this.checkCompletion(e),t.addClass("dropped")}setFeatureText(t){let e;_.isEmpty(t)?(e=$(this._bodySelector+" .dd-carousel-item.selected").data("item"),this._$itemDescription.html(e?e.hoverText:"")):(e=t.data("item"),this._$itemDescription.html(e.hoverText))}clearFeatureText(){this._$itemDescription.html("")}scrollCarousel(){let t;t=!0===this.api.model.rtl?{right:this._carouselOffset+-1*this._currentScrollIndex*this._scrollIncrement}:{left:this._carouselOffset+-1*this._currentScrollIndex*this._scrollIncrement},this._$carousel.stop().animate(t),this.updateCarouselButtons(),this.updateScrollClasses()}updateScrollClasses(){const i=this._$carousel.find(".dd-carousel-item"),s=this._currentScrollIndex,a=s+this._maxCarouselItems-1;i.each(t=>{var e=i.eq(t);e.removeClass("onscreen offscreen"),t<s||t>a?(e.addClass("offscreen"),e.attr("tabindex","-1")):(e.addClass("onscreen"),e.attr("tabindex","0"))}),this._$carousel.attr("data-scroll-index",this._currentScrollIndex)}updateCarouselScroll(){this._$carousel.find(".dd-carousel-item").length===this._currentScrollIndex&&(this._currentScrollIndex--,this.scrollCarousel())}checkCompletion(t){0===this._$carousel.find(".dd-carousel-item").length?(this._$activity.addClass("complete"),setTimeout(()=>$(this._bodySelector+" #drag-and-drop-container").scrollTop(0),0)):this.setCarouselSelection(t)}setCarouselSelection(t){_.isEmpty(t)?this.clearFeatureText():(t.addClass("selected"),this.enableDragging(),this.setFeatureText(),t.focus())}fadeOutActivityScreen(){this._$container.addClass("activity-out"),setTimeout(this.fadeInReviewScreen,500)}needsMoreAttempts(){var t=parseInt(this._data.attributes.numAttempts,10);return this._attempts<t||-1===t}buildReviewScreen(t){if(!this._iTestable||this._iTestable&&!this._iTestableContinuous)return this.standaloneReview();var e=_.template(this.api.getTemplate("p_dd_review_assess").content);let i="";return _.isEmpty(t.review)||(i=t.review[0].text),e({items:this._items,reviewText:i})}standaloneReview(){return _.template(this.api.getTemplate("p_dd_review").content)({items:this._items,testable:this._iTestable})}trackInteractionCompletion(t,e){var i=this.content.attributes.interactionID;this._TrackingManager.setScormInteraction({latency:s.formatLatencyTime(this._interactionTime),interactionID:i,responses:t,result:e}),clearInterval(this._interactionTimer)}encodeInteractionResponses(){let s="";return this._$items.each(t=>{var e=this._$items.eq(t),i=e.closest(".dd-bucket"),t=0===t?"":"[,]";s+=t+"tile_"+e.data("id")+"[.]target_"+i.data("id")}),s}trackDDInit(){this._configuration.iTestable||this._isZone||this._TrackingManager.setActivityStatus({status:"register",activity:{id:"draganddrop",complete:!1,alert:this._data.attributes.activityAlertId}})}trackDDCompletion(){this._configuration.iTestable||this._isZone?this._isZone&&this.setZoneComplete():this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"draganddrop",complete:!0}})}destroy(){this._data=null,this._$instructions=null,this._$activity=null,this._$reviewContainer=null,this._reviewTimeout=0,this._$submitButton=null,clearTimeout(this._timeoutRef),$(window).off("resize",this.onWindowResize)}isFirstDragAndDropZone(){return 0===l.MultiZone.activeZone.zones.filter(t=>t.templateId.match(/DragDrop/i)).indexOf(this._zoneData)||!1===r.DD_INSTRUCTIONS_VIEWED}}r.DD_INSTRUCTIONS_VIEWED=!1,r.DD_MODAL_ID="dd",r.DD_MODAL_INSTRUCTIONS_BUCKET_ID="dd-example-bucket",r.DD_MODAL_BUCKET_ID="dd-bucket",l.DragAndDrop=r}(GLEPlugins=GLEPlugins||{}),function(i){class t extends i.AbstractZone{constructor(t){super(t),this.onFlip=t=>{const e=$(t.currentTarget).closest(".flipcard");t=this._flipcards.find(t=>t.id===e.data("id"));e.toggleClass("flipped").addClass("complete"),t.complete=!0,this.checkCompletion()},this.trackInit=()=>{"false"===this._data.attributes.requiredToComplete||this._isZone||this._TrackingManager.setActivityStatus({status:"register",activity:{id:"flipcard",complete:!1,alert:this._data.attributes.activityAlertId}})},this.trackCompletion=()=>{this._isZone?this.setZoneComplete():"false"!==this._data.attributes.requiredToComplete&&this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"flipcard",complete:!0}})},this._TrackingManager=t.TrackingManager}build(t,e){super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0],this._flipcards=this.buildTemplateContent();var t=this.api.getTemplate(this._data.attributes.templateID),e=_.template(t.content),t=Math.min(parseInt(this._data.attributes.maxColumns),this._flipcards.length),i=this.hasBackgroundImages();return e({flipcards:this._flipcards,columns:t,hasBackgroundImages:i})}buildTemplateContent(){return this.content.getChildrenOfType("Flipcard").map((t,e)=>{return{id:e+1,front:this.getFlipState(i.FlipStateType.Front,t),back:this.getFlipState(i.FlipStateType.Back,t),complete:!1}})}getFlipState(t,e){e=e.getFirstChildOfType(t);return{type:t,header:null==(t=e.getFirstChildOfType("Header"))?void 0:t.text,image:this.getImageData(e.getChildByAttribute("id","gfx")),background:this.getImageData(e.getChildByAttribute("id","background")),text:null==(t=e.getFirstChildOfType("Text"))?void 0:t.text}}getImageData(t){return t?{src:t.attributes.src,alt:null!=(t=null==(t=t.getFirstChildOfType("Description"))?void 0:t.text)?t:""}:null}hasBackgroundImages(){return this._flipcards.some(t=>t.front.background||t.back.background)}program(t){super.program(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} #Flipcard-body`:"#Flipcard-body",this.trackInit(),this.wireFlipcards()}wireFlipcards(){$(""+this._bodySelector).find(".flipcard-button").click(this.onFlip)}checkCompletion(){this._flipcards.some(t=>!t.complete)||this.trackCompletion()}}i.Flipcard=t}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.IPluggable{constructor(t){super(t)}build(t,e){return super.build(t,e),t.attributes.value}program(t){super.program(t)}destroy(){super.destroy()}}t.GLEDatum=e}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.IPluggable{constructor(t){super(t)}build(t,e){super.build(t,e);var e=t.attributes.type,i=t.getChildrenOfType("Description")[0],s="dynamic"===e?this.api.getTemplate("DynamicImage"):this.api.getTemplate("StaticImage"),e={id:t.attributes.id,src:t.attributes.src,type:e,alt:_.isEmpty(i)?"":i.text,position:t.attributes.position||"left"};return _.template(s.content)(e)}}t.GLEImage=e}(GLEPlugins=GLEPlugins||{}),function(t){var s=GLECore.MagicButtonManager;class e extends t.IPluggable{constructor(t){super(t),this._MagicButtonManager=t.MagicButtonManager}build(t,e){super.build(t,e);let i=this.content.text;return i=this._MagicButtonManager&&s.isMagicButtonInText(i)?this._MagicButtonManager.replaceMagicButtonsInTextWithHtml(i):i}}t.GLEText=e}(GLEPlugins=GLEPlugins||{}),function(t){var e=GLECore.ViewingModeManager;class i extends t.AbstractVideo{constructor(t){super(t),this.preventDynamicResizing=!0}program(t){this._viewingMode!==e.VIEWING_MODE_TG&&super.program(t)}buildComponentHTML(){var t;return this._viewingMode===e.VIEWING_MODE_TG?_.template(this.api.getTemplate("p_gle_video_tg").content)({image:this.getImageData(this.content.getChildByAttribute("id","overlay_still")),lines:this.getConcatenatedCCText()}):((t=$('<div id="video-container" class="gle-video-container media-container"/>')).html(this.buildPlayer()),this.buildControls(t),t[0].outerHTML)}getConcatenatedCCText(){return this.content.getChildrenOfType("line").map(t=>t.text)}getImageData(t){return t?{src:t.attributes.src,alt:null!=(t=null==(t=t.getFirstChildOfType("Description"))?void 0:t.text)?t:""}:null}onMediaInit(){this._state="preparing",this.setContainerClass("preparing","replay"),this._timerStarted=new Date,"off"===this._LaunchDataManager.launchInfo.preferences.audio&&(this._video.volume=0),this._autoplay?this.startAutoplaying():this.delayPause()}}t.GLEVideo=i}(GLEPlugins=GLEPlugins||{}),function(s){var a=GLECore.ModalData;class m extends s.AbstractZone{constructor(t){super(t),this._referenceImageWidth=960,this._referenceImageHeight=540,this.onHotspotClick=t=>{var t=$(t.currentTarget),e=t.data("object"),i=e.complete;t.addClass("complete"),e.complete=!0,i||(this.api.sendEvent({destination:"Style",type:"applyPageClasses"}),this._sequencingEnabled&&(this._sequencingIndex++,this.enableNextHotspot())),e.linkText?this.openContentWindow(e):(this.openContentModal(e,t),this.registerRequiredLinks()),this.checkCompletion()},this.trackInit=()=>{"false"===this._data.attributes.requiredToComplete||this._isZone||this._TrackingManager.setActivityStatus({status:"register",activity:{id:"hotspot",complete:!1,alert:this._data.attributes.activityAlertId}})},this.trackCompletion=()=>{this._isZone?this.setZoneComplete():"false"!==this._data.attributes.requiredToComplete&&this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"hotspot",complete:!0}})},this._ModalManager=t.ModalManager,this._TrackingManager=t.TrackingManager,this._PluginManager=t.PluginManager}build(t,e){super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0],this._referenceImageWidth=parseInt(this._data.attributes.imageWidth),this._referenceImageHeight=parseInt(this._data.attributes.imageHeight),this._sequencingEnabled=this._data.attributes.sequencing!==m.SEQUENCING_NONE;t=this.api.getTemplate(this._data.attributes.templateID);return _.template(t.content)(this.buildTemplateContent())}buildTemplateContent(){var t=this.content.getChildrenOfType("Hotspot");return this._image=this.content.getChildByAttribute("id","gfx"),this._hotspots=[],_.each(t,(t,e)=>{var i=t.getChildByAttribute("id","txtButtonLabel"),s=t.getChildByAttribute("id","gfxButtonIcon"),a=t.getChildByAttribute("id","txtDetailsHeader"),n=t.getChildByAttribute("id","gfxDetailsImage"),r=t.getChildByAttribute("id","txtDetailsContent"),o=t.getFirstChildOfType("Video"),l=t.attributes.type;let d=!1,h,c=null,u=!0,p,g;h=l!==m.ICON_TYPE_NONE?(p=m.getIconSrc(l,s),g=this.api.model.svgManifest[p],{alt:m.getIconAlt(l,s),content:g.content}):(d=!0,p=m.getIconSrc(this._data.attributes.defaultMobileIcon),g=this.api.model.svgManifest[p],{alt:m.getIconAlt(this._data.attributes.defaultMobileIcon),content:g.content}),_.isEmpty(n)||(c={src:n.attributes.src,alt:n.getFirstChildOfType("Description").text}),_.isEmpty(h)&&(u=!1),this._hotspots.push({index:e+1,top:parseInt(t.attributes.top,10),left:parseInt(t.attributes.left,10),text:_.isEmpty(i)?null:i.text,icon:h,modalHeader:_.isEmpty(a)?null:a.text,modalContent:_.isEmpty(r)?null:r.text,modalImage:c,modalVideo:o,iconIsMobileOnly:d,iconProvided:u,linkText:_.isEmpty(t.attributes.href)?null:t.attributes.href,complete:!1,enabled:this._sequencingEnabled})}),{collapseOnMobile:"true"===this._data.attributes.collapseTextButtonsOnMobile,image:{src:this._image.attributes.src,alt:this._image.getFirstChildOfType("Description").text},items:this._hotspots,checkIcon:this.api.model.svgManifest["#icon-hs-check"]}}static getIconSrc(t,e){return t===m.ICON_TYPE_CUSTOM?""+e.attributes.src:"#icon-hs-"+t}static getIconAlt(t,e){var i=_.capitalize(t);return t===m.ICON_TYPE_CUSTOM?e.getFirstChildOfType("Description").text:`<Token id="tk_HotspotIcon${i}Alt"/>`}program(t){super.program(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} #Hotspot-body`:"#Hotspot-body",this.trackInit(),this.wireHotspots(),this.initSequencing()}wireHotspots(){_.each(this._hotspots,t=>{var e=100*t.top/this._referenceImageHeight,i=100*t.left/this._referenceImageWidth;t.$button=$(this._bodySelector+" #hs-"+t.index),t.$button.click(this.onHotspotClick),t.$button.css("top",e+"%"),t.$button.css("left",i+"%"),t.$button.data("object",t),t.$button[0].disabled=t.enabled})}initSequencing(){this._sequencingEnabled&&(this._sequencingIndex=0,this._data.attributes.sequencing===m.SEQUENCING_ORDERED?this._sequencingPattern=this._hotspots.map(t=>t.index):this._sequencingPattern=this._data.attributes.sequencing.split(",").map(t=>parseInt(t,10)),this.enableNextHotspot())}enableNextHotspot(){var t=this._hotspots.find(t=>t.index===this._sequencingPattern[this._sequencingIndex]);t&&(t.enabled=!0,t.$button[0].disabled=!1)}openContentWindow(t){this.api.callWebAddress(t.linkText)}openContentModal(t,e){var i=this.api.getTemplate("p_hotspot_modal"),i=_.template(i.content)(t);const s=m.MODAL_ID+"-"+t.index;i={id:s,header:t.modalHeader||"",content:i,srcElement:"root",buttons:[{id:"hotspot_close",label:this.api.parseTokens("{tk_CloseUpperCase}"),callback:()=>this._ModalManager.closeModal(s)}],hasExit:!0,isFullScreen:!1,$launcher:e,exitCallback:()=>this._ModalManager.closeModal(s),isAlert:!1,preventClickOutsideDismiss:!1,zoneId:this.zoneId},e=new a(i.id,i.header,i.content,i.srcElement,i.buttons,i.hasExit,i.$launcher,null,i.isFullScreen,i.isAlert,i.preventClickOutsideDismiss,i.exitCallback,!0,i.zoneId);this._$modal=this._ModalManager.openModal(e,!0),this._$modal.addClass(m.MODAL_ID),t.modalVideo&&this.renderModalVideo(t.modalVideo)}renderModalVideo(t){var e=this._$modal.find(".modal-video-container").get(0),i=new s.GLEVideo(this._PluginManager.lookupManifestDefinition("Video","dependencies")),t=i.build(t,this.api);e.innerHTML+=t,i.program(e),this._$modal.addClass("has-video")}registerRequiredLinks(){this.api.sendEvent({destination:"RequiredLinks",type:"RequiredLinkUpdate",$container:this._$modal,currentPage:this.api.getCurrentPage()})}checkCompletion(){this._hotspots.filter(t=>!0!==t.complete).length||this.trackCompletion()}}m.ICON_TYPE_CUSTOM="custom",m.ICON_TYPE_NONE="none",m.MODAL_ID="hotspot-modal",m.SEQUENCING_NONE="none",m.SEQUENCING_ORDERED="ordered",s.Hotspot=m}(GLEPlugins=GLEPlugins||{}),function(t){var e=GLECore.ViewingModeManager,i=GLECore.ModalManager;class s extends t.AbstractZone{constructor(t){super(t),this._viewingMode=null,this.apiEventHandler=t=>{t.data.type===i.MODAL_CLOSED?this.modalClosedHandler():t.data.type===i.MODAL_OPENED&&this.modalOpenedHandler()},this.modalClosedHandler=()=>{this._viewingMode!==this._ViewingModeManager.currentViewingMode?this.onViewingModeChange():this._isZone||this._viewingMode===e.VIEWING_MODE_TG||this._$iframe.get(0).contentWindow.postMessage(JSON.stringify({event:"command",func:"playVideo"}),"*")},this.modalOpenedHandler=()=>{this._viewingMode!==e.VIEWING_MODE_TG&&this._$iframe.get(0).contentWindow.postMessage(JSON.stringify({event:"command",func:"pauseVideo"}),"*")},this._ViewingModeManager=t.ViewingModeManager}build(t,e){return super.build(t,e),this._data=t.getChildrenOfType("Data")[0],this._viewingMode=this._ViewingModeManager.currentViewingMode,this.renderTgMode()?this.buildTGHtml():this.buildIFrameHtml()}renderTgMode(){return!!this.tgContentExists()&&this._viewingMode===e.VIEWING_MODE_TG}tgContentExists(){var t=this.content.getChildByAttribute("id","txtCC");return t&&!_.isEmpty(t.text)}buildIFrameHtml(){var t=this.api.getTemplate(this._data.attributes.templateID);return _.template(t.content)({src:this.content.getChildrenOfType("IFrame")[0].attributes.src})}buildTGHtml(){var t=this.api.getTemplate("p_iframeplayer-tg"),t=_.template(t.content),e=this.content.getChildByAttribute("id","gfx"),i=this.content.getChildByAttribute("id","txtCC").text;return t({imgSrc:_.isEmpty(e)?null:e.attributes.src,imgAlt:_.isEmpty(e)?null:e.getFirstChildOfType("Description").text,textContent:i})}program(t){super.program(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} #iFrame-body`:"#iFrame-body",this._$iframe=$(this._bodySelector+" .iframe"),this._$content=$(this._bodySelector),this.api.addEvent("apiEvent",this.apiEventHandler),this.renderTgMode()&&this._$content.addClass("tg"),this._isZone&&setTimeout(()=>this.setZoneComplete(),1e3)}onViewingModeChange(){let t;this._viewingMode=this._ViewingModeManager.currentViewingMode,this.renderTgMode()?(t=this.buildTGHtml(),this._$content.addClass("tg")):(t=this.buildIFrameHtml(),this._$content.removeClass("tg")),$(this._bodySelector+" .iframe-wrapper").html(t),this._$iframe=$(this._bodySelector+" .iframe"),this.api.sendEvent({destination:"Style",type:"applyPageClasses"})}destroy(){this.api.removeEvent("apiEvent",this.apiEventHandler),super.destroy()}}t.IframePlayer=s}(GLEPlugins=GLEPlugins||{}),function(e){var i=GLECore.ViewingModeManager,h=GLECore.TrackingManager,a=GLECore.ModalData,s=GLECore.FeedbackType,c=GLECore.DataUtil,n=GLECore.TimeUtil,r=GLECore.delay;class o extends e.MediaPlayer{static initInteractionData(o,l){const d=[];return o.getAllDescendantsOfType("VideoQuestion").forEach((t,e)=>{const n={n:l+e},r=o.getChildrenOfType("VideoQuestion").indexOf(t)+1;var e=$(t.sourceXML),i=e.closest("Page").attr("pageID"),e=e.find("QuestionText").text();let s="_"+r;var a=t.getFirstAncestorElementByName("Zone");_.isEmpty(a)||(s="_"+a.attributes.zoneID+s),n.id=c.standardizeId(i+s),n.type="choice",n.correct_responses=[],n.long_correct_responses=[{pattern:"{order_matters=false}"}],n.long_response_lookup={},n.description=e.replace(/<[^>]+>/gim,"").substr(0,255),t.attributes.interactionID=n.id,t.getAllDescendantsOfType("Response").forEach((t,e)=>{var i=t.getFirstChildOfType("Text").text,s=r,a=n.long_correct_responses[0].pattern.match(/{order_matters=false}$/gim)?"":"[,]",s=h.generateShortIdentifier(s,e,i,"");n.long_response_lookup[e]=s,"true"===t.attributes.correct&&(n.correct_responses.push({pattern:e.toString()}),n.long_correct_responses[0].pattern+=a+s),t.attributes.interactionID=e.toString(),$(t.sourceXML).attr("interactionID",e)}),h.addInteractionIdToSource(t,n.id),d.push(n)}),d}constructor(t){super(t),this._isInteractiveVideo=!0,this._complete=!1,this.completeHandler=()=>{this._viewingMode!==i.VIEWING_MODE_TG&&this._MediaControls.completeActions(),this.setContainerClass("prompt hidePoster","playing"),this._state=null,_.isEmpty(this._currentNode.question.response)?(this.renderQuestion(),this.wireQuestion()):this._requireCorrect&&!this._currentNode.question.response.correct?(this._currentNode.question.response=null,this.transitionVideo(this._currentNode.xml)):this.loadNextQuestion()},this.onOptionSelect=t=>{t=$(t.currentTarget);const e=t.hasClass("option-container")?t.siblings("input"):t;t=_.find(this._currentNode.question.options,t=>t.id===parseInt(e.val()));this._currentNode.question.response=t,this._$submitButton.attr("disabled",null)},this.onSubmit=t=>{null!=t&&t.preventDefault(),null!=t&&t.stopImmediatePropagation(),this.transitionVideo(this._currentNode.question.response.xml)},this.onContinue=()=>{this._ModalManager.closeModal(o.MODAL_ID),this.api.callNextPage()},this.onModalClose=()=>{this._ModalManager.closeModal(o.MODAL_ID),this.reset()},this._XMLManager=t.XMLManager,this._ModalManager=t.ModalManager,this._TrackingManager=t.TrackingManager}build(t,e){var i=t.getFirstChildOfType("Data");return this.content=t,this.api=e,this._constructor=t,this._transitionSpeed=1e3*parseFloat(i.attributes.transitionSpeed),this._attitudinal="true"===i.attributes.attitudinal,this._requireCorrect="true"===i.attributes.requireCorrect&&!this._attitudinal,this.initializeNodes(t),super.build(_.first(this._nodes).xml,e)}initializeNodes(t){t=t.getChildrenOfType("VideoQuestion");this._nodes=t.map((t,e)=>({id:t.attributes.id,xml:this.buildMediaPlayerXml(t),question:this.buildQuestion(t,e),interactionID:t.attributes.interactionID,complete:!1,latency:0}))}buildMediaPlayerXml(t){var e=this.api.getTemplate("MediaPlayerConstructor"),e=_.template(e.content)({src:t.attributes.media_src,data:this.content.getFirstChildOfType("Data").attributes,overlay_text:null==(e=t.getFirstChildOfType("OverlayText"))?void 0:e.text,overlay_src:null==(e=t.getFirstChildOfType("Image"))?void 0:e.attributes.src,overlay_alt:null==(e=t.getFirstChildOfType("Image"))?void 0:e.text,captions:t.getChildrenOfType("line")});return this._XMLManager.deserializeXML($.parseXML(e))}buildQuestion(t,e){return{id:e,text:t.getFirstChildOfType("QuestionText").text,response:null,options:this.buildOptions(t)}}buildOptions(t){t=t.getChildrenOfType("Response");return this._options=t.map((t,e)=>({id:e,xml:this.buildMediaPlayerXml(t),text:t.getFirstChildOfType("Text").text,correct:"true"===t.attributes.correct,selected:!1,interactionID:t.attributes.interactionID})),this._options}setLatencyTimer(){clearInterval(this._latencyTimer),this._latencyTimer=window.setInterval(()=>{this._currentNode.latency++},1e3)}buildComponentHTML(){if(this._viewingMode===i.VIEWING_MODE_TG)return this._tg=new e.Slideshow(this._dependencies),(this._tg.videoContainer=this)._tg.build(this.content,this.api);_.isNull(this._tg)||(this._tg=null);var t=$("<div id='video'/>");return t.html(this.buildPlayer()),this.buildControls(t),t[0].outerHTML}program(t){super.program(t),this._currentNode=_.first(this._nodes),this.trackInit(),this.setLatencyTimer()}onSlideshowComplete(){this.completeHandler()}onSlideshowRewind(){this.setContainerClass("","prompt"),this._$container.find("#carousel-image-container .question-wrapper").remove()}renderQuestion(){var t=this.api.getTemplate("p_interactive_video_question"),t=_.template(t.content)({id:this._currentNode.question.id,question:this._currentNode.question.text,options:this._currentNode.question.options});this.appendToViewport($(t)),this.api.sendEvent({destination:"Style",type:"applyPageClasses"}),r(()=>$(this._bodySelector).find(".question").attr("tabindex","-1").focus(),1e3)}wireQuestion(){var t=this._$container.find(".option-wrapper");t.find(".option-container").click(this.onOptionSelect),this._options.forEach(t=>$("#option-"+(t.id+1)).bind("change",this.onOptionSelect)),t.submit(this.onSubmit),this._$submitButton=$(this._isZone?`#${this._zoneData.zoneId} .submit-button`:".submit-button")}loadNextQuestion(){var t=this._nodes.indexOf(this._currentNode),e=_.last(this._nodes);if(this._currentNode===e)return this._complete=!0,this._tg||this.exitFullscreenVideo(),this.trackCompletion(),this.trackInteractionCompletion(),e=this.getFeedbackContent(this.calculateFeedbackType()),_.isEmpty(e)?this.renderNoFeedback():this.renderFeedback(e);this._currentNode=this._nodes[t+1],this.transitionVideo(this._currentNode.xml)}transitionVideo(t){this._$container.addClass("fadedown"),r(()=>{this.renderVideo(this.api,t),r(()=>this._$container.removeClass("fadedown"),this._transitionSpeed)},this._transitionSpeed)}renderVideo(t,e){this.setContainerClass("","prompt"),super.destroy();e=super.build(e,t);this._captions=[],this._$container.find("#video, #carousel").remove(),this._$container.append($(e)),this.api.sendEvent({destination:"Style",type:"applyPageClasses"}),super.program(this.parent)}renderNoFeedback(){var t=this.api.getTemplate("interactive-video-no-feedback"),t=_.template(t.content)({});this.appendToViewport($(t)),$(".continue-button").click(()=>this.api.callNextPage())}renderFeedback(t){var e=this.calculateFeedbackType(),i=this.getFeedbackHeader(e),s=this.api.getTemplate("interactive-video-feedback-header"),s=_.template(s.content)({result:e,text:i}),i=this.buildButtonArray(),s=a.create({id:o.MODAL_ID,header:s,content:t,buttons:i,$launcher:$("#progress-bar-nextBtn"),preventClickOutsideDismiss:!0,exitCallback:this.onModalClose}),t=this._ModalManager.openModal(s,!0);this._attitudinal||t.find("header > h2").addClass(e)}appendToViewport(t){(this._viewingMode===i.VIEWING_MODE_TG?this._$container.find("#carousel-image-container"):this._$container.find(".vid")).append(t)}buildButtonArray(){return[new ModalButton("interactive-video-continue",this._isZone?this.api.parseTokens("{tk_CloseUpperCase}"):this.api.parseTokens("{tk_ContinueButton}"),this.onContinue)]}reset(){this._currentNode=_.first(this._nodes),this._nodes.forEach(t=>t.question.response=null),this.transitionVideo(this._currentNode.xml)}trackInit(){this._isZone||this._TrackingManager.setActivityStatus({status:"register",activity:{id:"interactive-video",complete:!1,alert:"altPageJump"}})}trackCompletion(){this._complete&&(this._isZone?this._isZone&&this.setZoneComplete():(this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"interactive-video",complete:!0}}),this._setTrackingComplete=!1))}trackInteractionCompletion(){var t=this._nodes.map(t=>{var e=this._nodes.length,e=n.formatLatencyTime(Math.round(t.latency/e)),i=t.question.response.correct;return{interactionID:t.interactionID,responses:[t.question.response.interactionID],result:this._attitudinal?"neutral":i?"correct":"wrong",latency:e}});this._TrackingManager.batchSetInteractions({interactionCollection:t})}calculateFeedbackType(){var t=_.every(this._nodes,t=>t.question.response.correct),e=_.every(this._nodes,t=>!t.question.response.correct);return this._attitudinal?s.Neutral:t?s.Correct:e?s.Incorrect:s.Partial}getFeedbackHeader(t){switch(t){case s.Correct:return this.api.parseTokens("{tk_InteractiveVideoCorrect}");case s.Incorrect:return this.api.parseTokens("{tk_InteractiveVideoIncorrect}");case s.Partial:return this.api.parseTokens("{tk_InteractiveVideoPartiallyCorrect}");default:return this.api.parseTokens("{tk_InteractiveVideoNeutral}")}}getFeedbackContent(t){var e;switch(t){case s.Correct:return null==(e=this._constructor.getChildByAttribute("type",s.Correct))?void 0:e.text;case s.Incorrect:return null==(e=this._constructor.getChildByAttribute("type",s.Incorrect))?void 0:e.text;case s.Partial:return null==(e=this._constructor.getChildByAttribute("type",s.Partial))?void 0:e.text;default:return null==(e=this._constructor.getFirstChildOfType("Feedback"))?void 0:e.text}}}o.MODAL_ID="interactive-video-feedback-modal",e.InteractiveVideo=o}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.IPluggable{constructor(t){super(t),this._MagicButtonManager=t.MagicButtonManager}build(t,e){super.build(t,e);e=t.attributes.id;return this._magicBtnData=this._MagicButtonManager.getMagicButtonDataById(e),this._magicBtnData.buildMagicButtonDisplay(),""}}t.MagicButtonElement=e}(GLEPlugins=GLEPlugins||{}),function(t){var s=GLECore.TimeUtil,a=GLECore.ModalData,n=GLECore.StyleManager;class r extends t.IPluggable{constructor(t){super(t),this._maxColumns=5,this.sectionKeyHandler=t=>{" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),t.stopImmediatePropagation(),this.launchSectionMenu(t))},this.launchSectionMenu=t=>{var t=$(t.currentTarget),e=t.data("section-index"),e=this._sections[e],i=_.template(this.api.getTemplate(this.props.templateID+"_pages").content)(e),e={id:"main_menu_modal",header:e.title,content:i,srcElement:"root",hasExit:!0,isFullScreen:!1,isAlert:!1,preventClickOutsideDismiss:!0,$launcher:t};this._ModalManager.openModal(new a(e.id,e.header,e.content,e.srcElement,[],e.hasExit,e.$launcher,null,e.isFullScreen,e.isAlert,e.preventClickOutsideDismiss)),this.programPageMenu()},this.requestPage=t=>{t=$(t.currentTarget).data("page-id").toString();this.api.callPage(t)},this.keyHandler=t=>{-1!==["Enter"," "].indexOf(t.key)&&this.requestPage(t)},this._ModalManager=t.ModalManager,this._RouteManager=t.RouteManager,this._StyleManager=t.StyleManager}build(t,e){super.build(t,e),this._sections=this.api.getSectionTemplateData();var t=s.replaceTotalCourseTime(this.content.getChildByAttribute("id","time").text,this.api.model.getTotalCourseTime()),e=_.template(this.api.getTemplate(this.props.templateID).content),t={title:this.content.getChildByAttribute("id","title").text,intro_header:this.content.getChildByAttribute("id","header").text,intro_content:this.content.getChildByAttribute("id","body").text,time:t,hideTime:"true"===this.props.hideTime,sections:this._sections,maxColumns:0},i=(this.addSectionStyles(),Number(this.props.maxColumns)||this._sections.length);return t.maxColumns=Math.min(this._maxColumns,i),e(t)}addSectionStyles(){this._sections.forEach((t,e)=>{_.isEmpty(t.styles)||this.addStylesToPage(t.styles[0].getChildrenOfType("st"),e)})}addStylesToPage(t,e){if(!_.isEmpty(t)){const i=this.api.model.getCurrentPageId();t.forEach(t=>{t=Object.assign({},t.attributes);t.pageID=i,t.item=r.STYLE_ITEM_MAP[t.item].replace(/\$n/,"$"+(e+2)),this._StyleManager.addCourseStyle(n.createStyleData(t))})}}program(t){super.program(t),this.programSectionMenus()}programSectionMenus(){this._$sectionButtons=$(".mainMenuList .sectionButton"),this._$sectionButtons.on("click",this.launchSectionMenu),this._$sectionButtons.on("keydown",this.sectionKeyHandler)}programPageMenu(){$(".modal-saig[data-id='main_menu_modal']").find(".link").on("click",this.requestPage)}}r.STYLE_ITEM_MAP={container:"tile-$n-container",image:"tile-$n-image",title:"tile-$n-label"},t.MainMenu=r}(GLEPlugins=GLEPlugins||{}),function(t){var p=GLECore.TrackingManager,i=GLECore.ModalData,s=GLECore.TimeUtil,g=GLECore.DataUtil;class l extends t.AbstractZone{get data(){return this._data}static initInteractionData(l,d,h,c){const u=[];return l.getAllDescendantsOfType("QuestionRow").forEach((n,t)=>{const r={n:d+t},o=l.getChildrenOfType("QuestionRow").indexOf(n)+1;var t=$(n.sourceXML),e=t.closest("Page").attr("pageID"),i=h?"Response":"Choice",t=t.find(h?"Text":"Question").text();let s="_"+(h?c+1:o);var a=n.getFirstAncestorElementByName("Zone");_.isEmpty(a)||(s="_"+a.attributes.zoneID+s),r.id=g.standardizeId(e+s),r.type="choice",r.correct_responses=[],r.long_correct_responses=[{pattern:"{order_matters=false}"}],r.long_response_lookup={},r.description=t.replace(/<[^>]+>/gim,"").substr(0,255),n.attributes.interactionID=r.id,l.getAllDescendantsOfType(i).forEach((t,e)=>{var i=t.text,s=h?c+1:o,a=r.long_correct_responses[0].pattern.match(/{order_matters=false}$/gim)?"":"[,]",s=p.generateShortIdentifier(s,e,i,h?"CA":"");r.long_response_lookup[e]=s,parseInt(n.attributes.correctChoiceNum,10)===e+1&&(r.correct_responses.push({pattern:e.toString()}),r.long_correct_responses[0].pattern+=a+s),t.attributes.interactionID=e.toString(),$(t.sourceXML).attr("interactionID",e)}),p.addInteractionIdToSource(n,r.id),u.push(r),c++}),u}constructor(t,e){super(t),this._configuration=null,this._attitudinal=!1,this._modalDelay=1,this._latencyTime=0,this._pageIsComplete=!1,this._bodySelector=null,this.onInputChange=t=>{var t=$(t.currentTarget),e=t.closest(".question-row"),e=parseInt(e.attr("data-question"),10),e=this._questions[e],{complete:e,status:t}=(e.selection=parseInt(t.val(),10),e.selectedInteractionID=t.attr("data-interaction"),e.$selection=t,this.validateResponses());e&&(this._status=t,this._$submitButton.attr("disabled",null))},this.attitudinalApiHandler=t=>{"pageComplete"===t.data.type&&(this.api.model.removeEventListener("apiEvent",this.attitudinalApiHandler),this.advanceScreen())},this.onFormSubmit=t=>{const e=this._attitudinal?this.determineAttitudinalFeedbackType():this.determineFeedbackType();t.preventDefault(),t.stopImmediatePropagation(),this._numAttempts++,!this._pageIsComplete&&e===l.FEEDBACK_TYPE_SKIP&&this._attitudinal?(this.api.model.addEventListener("apiEvent",this.attitudinalApiHandler),this.trackActivityCompletion(),this.trackInteractionCompletion(),this._isZone&&!this.isLastZone&&this.advanceZone()):(this._iTestable||this._status!==l.STATUS_CORRECT&&!this._attitudinal&&this._numAttempts!==this._maxAttempts?this._iTestable&&(this._status===l.STATUS_CORRECT||this._iTestableContinuous)&&this.trackInteractionCompletion():(this.trackActivityCompletion(),this.trackInteractionCompletion()),e===l.FEEDBACK_TYPE_SKIP&&this._attitudinal?this.advanceScreen(!0):e===l.FEEDBACK_TYPE_SKIP?(this.renderCorrectMarks(!0),this.advanceScreen(!0),this._$submitButton.attr("disabled","disabled")):this._attitudinal?setTimeout(()=>{this.showFeedback(e)},0):this._iTestableContinuous?this.advanceScreen():(this.renderCorrectMarks(),setTimeout(()=>{this.showFeedback(e)},this._modalDelay)))},this.advanceScreen=(t=!1)=>{if(t&&!this._iTestable&&!this._attitudinal)return this.advanceScreenOnDelay();this._isZone||(!0===this._iTestable?this._configuration.onQuestionSubmit({correct:this._status===l.STATUS_CORRECT?l.STATUS_CORRECT:l.STATUS_INCORRECT,selection:$(this._bodySelector).find(".question-row").find("input:checked")}):this.api.callNextPage())},this.onModalClose=()=>{this._ModalManager.closeModal(l.MODAL_ID),$(this._bodySelector).find(".response.correct, .response.incorrect").removeClass("correct incorrect")},this.onContinue=()=>{this._ModalManager.closeModal(l.MODAL_ID),this.advanceScreen()},this._ModalManager=t.ModalManager,this._TrackingManager=t.TrackingManager,this._configuration=e||{}}build(t,e){var i=t.getAllDescendantsOfType("Feedback");return super.build(t,e),this._data=this.content.getFirstChildOfType("Data"),this._modalDelay=1e3*parseFloat(this._data.attributes.modalDelay),this._attitudinal="true"===this._data.attributes.attitudinal,this._maxAttempts=parseInt(this._data.attributes.numAttempts,10),this._numAttempts=0,this._animationAdvanceDelay=1e3*parseFloat(this._data.attributes.animationAdvanceDelay),this._checkmarkAnimationSpeed=1e3*parseFloat(this._data.attributes.checkmarkAnimationSpeed),0!==this._maxAttempts&&0!==i.length||(this._maxAttempts=1),this._iTestable="true"===this._data.attributes.itestable,this._iTestableContinuous="continuous"===this._data.attributes.flow,this._iTestableID=this._data.attributes.itestableID,this.generateHTML()}advanceScreenOnDelay(){var t=this._animationAdvanceDelay+(this._questions.length+1)*this._checkmarkAnimationSpeed;this._questions.forEach(t=>{const e=t.correct?"correct":"incorrect",i=t.$selection.closest(".response");setTimeout(()=>i.find(".icon-wrapper."+e).addClass("render"),0)}),this._isZone?this.advanceZone(!0,t):this._advanceTimeout=window.setTimeout(this.advanceScreen,t)}generateHTML(){var t=this.content.getFirstChildOfType("Header"),e=this.content.getChildByAttribute("id","introduction"),i=this.content.getChildByAttribute("id","prompt"),s=this.content.getFirstChildOfType("QuestionHeader");const a=this.content.getChildrenOfType("Choice").map((t,e)=>({label:t.text,interactionID:t.attributes.interactionID,value:e+1}));return this._questions=this.content.getChildrenOfType("QuestionRow").map(t=>{var e=t.getFirstChildOfType("Feedback");return{text:t.getFirstChildOfType("Question").text,options:a,interactionID:t.attributes.interactionID,feedback:e?e.text:null,correctChoice:t.attributes.correctChoiceNum?a[parseInt(t.attributes.correctChoiceNum,10)-1]:null,selection:0,selectedInteractionID:"",$selection:null,correct:!1}}),_.template(this.api.getTemplate(this._data.attributes.templateID).content)({header:t?t.text:null,introduction:e.text,prompt:i?i.text:this.api.parseTokens("{tk_MatrixPrompt}"),questionHeader:s?s.text:"",options:a,collapse:2<a.length?"collapse":"standard",zoneId:this.zoneId?"-"+this.zoneId:"",questions:this._questions})}program(t){super.program(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} .matrix-body`:".matrix-body",this.wireForm(),this.trackActivityInit(),this.setLatencyTimer()}destroy(){super.destroy(),clearInterval(this._latencyTimer),clearTimeout(this._advanceTimeout)}setZoneComplete(){this._attitudinal||($(this._bodySelector).find(".question-form").find("input[type='radio']").attr("disabled","disabled"),this._$submitButton.attr("disabled","disabled")),super.setZoneComplete()}wireForm(){var t=$(this._bodySelector).find(".question-form"),e=t.find("input[type='radio']");t.submit(this.onFormSubmit),e.on("change",this.onInputChange),this._$submitButton=t.find("input[type='submit']")}validateResponses(){var t=this._questions.filter(t=>!!t.selection);const e=t.filter(t=>null===t.correctChoice||t.correctChoice.value===t.selection);return t.length!==this._questions.length?{complete:!1,status:l.STATUS_INCOMPLETE}:(t.forEach(t=>t.correct=-1!==e.indexOf(t)),this._attitudinal?this.determineAttitudinalStatus(e.length):e.length===this._questions.length?{complete:!0,status:l.STATUS_CORRECT}:0<e.length?{complete:!0,status:l.STATUS_PARTIAL}:{complete:!0,status:l.STATUS_INCORRECT})}determineAttitudinalStatus(t){return t===this._questions.length?this._attitudinalStatus=l.STATUS_CORRECT:this._attitudinalStatus=0<t?l.STATUS_PARTIAL:l.STATUS_INCORRECT,{complete:!0,status:l.STATUS_NEUTRAL}}determineFeedbackType(){var t=this.content.getChildByAttribute("type","default"),e=this.content.getChildByAttribute("type","correct"),i=this.content.getChildByAttribute("type","partial"),s=this.content.getChildByAttribute("type","incorrect"),a=this._questions.filter(t=>t.feedback).length;return t?l.FEEDBACK_TYPE_GENERAL_DEFAULT:this._status===l.STATUS_CORRECT&&e?l.FEEDBACK_TYPE_GENERAL_CORRECT:this._status===l.STATUS_PARTIAL&&i?l.FEEDBACK_TYPE_GENERAL_PARTIAL:this._status===l.STATUS_INCORRECT&&s?l.FEEDBACK_TYPE_GENERAL_INCORRECT:this._status!==l.STATUS_CORRECT&&a||this._status===l.STATUS_CORRECT&&!0===this._iTestable&&a?l.FEEDBACK_TYPE_QUESTION_SPECIFIC:l.FEEDBACK_TYPE_SKIP}determineAttitudinalFeedbackType(){var t=this.content.getChildByAttribute("type","default"),e=this.content.getChildByAttribute("type","correct"),i=this.content.getChildByAttribute("type","partial"),s=this.content.getChildByAttribute("type","incorrect"),a=this._questions.filter(t=>t.feedback).length;return t?l.FEEDBACK_TYPE_GENERAL_DEFAULT:this._attitudinalStatus===l.STATUS_CORRECT&&e&&a?l.FEEDBACK_TYPE_GENERAL_CORRECT_QUESTION_SPECIFIC:this._attitudinalStatus===l.STATUS_CORRECT&&e?l.FEEDBACK_TYPE_GENERAL_CORRECT:this._attitudinalStatus===l.STATUS_CORRECT&&a?l.FEEDBACK_TYPE_QUESTION_SPECIFIC:this._attitudinalStatus===l.STATUS_INCORRECT&&s&&a?l.FEEDBACK_TYPE_GENERAL_INCORRECT_QUESTION_SPECIFIC:this._attitudinalStatus===l.STATUS_INCORRECT&&s?l.FEEDBACK_TYPE_GENERAL_INCORRECT:this._attitudinalStatus===l.STATUS_INCORRECT&&a?l.FEEDBACK_TYPE_QUESTION_SPECIFIC:this._attitudinalStatus===l.STATUS_PARTIAL&&i&&a?l.FEEDBACK_TYPE_GENERAL_PARTIAL_QUESTION_SPECIFIC:this._attitudinalStatus===l.STATUS_PARTIAL&&i?l.FEEDBACK_TYPE_GENERAL_PARTIAL:this._attitudinalStatus===l.STATUS_PARTIAL&&a?l.FEEDBACK_TYPE_QUESTION_SPECIFIC:l.FEEDBACK_TYPE_SKIP}renderCorrectMarks(e=!1){this._questions.forEach(t=>{t.$selection.closest(".response").addClass(t.correct?"correct":"incorrect").addClass(e?"animate":"")})}buildReviewScreen(t,e,i,s,a){a={questions:this._questions.filter(t=>!t.correct),outcome:a,review:t.review[0].text};return _.template(this.api.getTemplate("MatrixAssessmentReview").content)(a)}showFeedback(t){var e=this.renderHeader(),t=this.renderFeedback(t),e={id:l.MODAL_ID,header:e,content:t,srcElement:"root",buttons:this.buildButtonArray(),hasExit:!1,isFullScreen:!1,$launcher:this._$submitButton,exitCallback:this.onModalClose,isAlert:!1,preventClickOutsideDismiss:!0},t=new i(e.id,e.header,e.content,e.srcElement,e.buttons,e.hasExit,e.$launcher,null,e.isFullScreen,e.isAlert,e.preventClickOutsideDismiss,e.exitCallback);this._ModalManager.openModal(t,!0).addClass(this._status)}renderHeader(){return _.template(this.api.getTemplate("matrix-modal-header").content)({text:this.api.parseTokens(this.getHeaderToken()),result:this._status})}renderFeedback(t){var{text:e,image:i,questions:s}=this._attitudinal?this.getAttitudinalFeedbackContent(t):this.getFeedbackContent(t),a=_.isEmpty(i)?null:i.attributes.src,i=_.isEmpty(i)?null:i.getFirstChildOfType("Description").text;return _.template(this.api.getTemplate("matrix-modal-content").content)({text:e,questions:s,image:a,imageAltText:i,feedbackType:t})}getHeaderToken(){return this._status===l.STATUS_NEUTRAL?"{tk_Feedback}":this._status===l.STATUS_INCORRECT?"{tk_ThatIsIncorrect}":this._status===l.STATUS_PARTIAL?"{tk_PartiallyCorrect}":"{tk_ThatIsCorrect}"}getFeedbackContent(t){let e,i=[],s=this._questions.filter(t=>!0!==t.correct);const a=this._numAttempts===this._maxAttempts;t===l.FEEDBACK_TYPE_GENERAL_DEFAULT?e=this.content.getChildByAttribute("type","default").text:t===l.FEEDBACK_TYPE_GENERAL_CORRECT?e=this.content.getChildByAttribute("type","correct").text:t===l.FEEDBACK_TYPE_GENERAL_INCORRECT?e=this.content.getChildByAttribute("type","incorrect").text:t===l.FEEDBACK_TYPE_GENERAL_PARTIAL&&(e=this.content.getChildByAttribute("type","partial").text),(s=t===l.FEEDBACK_TYPE_QUESTION_SPECIFIC&&!0===this._iTestable?this._questions.concat():s).length&&(a||t===l.FEEDBACK_TYPE_QUESTION_SPECIFIC)&&(i=s.map(e=>({question:e.text,feedback:t===l.FEEDBACK_TYPE_QUESTION_SPECIFIC?e.feedback:null,correct:e.correct,correctChoice:a?e.correctChoice.label:null,userChoice:e.options.filter(t=>t.value===e.selection)[0].label})));var n=this.getFeedbackImage(t);return{text:e,image:n,questions:i}}getAttitudinalFeedbackContent(t){let e,i=[];const s=!!t.match(/question-specific/gim);t===l.FEEDBACK_TYPE_GENERAL_DEFAULT?e=this.content.getChildByAttribute("type","default").text:t===l.FEEDBACK_TYPE_GENERAL_CORRECT||t===l.FEEDBACK_TYPE_GENERAL_CORRECT_QUESTION_SPECIFIC?e=this.content.getChildByAttribute("type","correct").text:t===l.FEEDBACK_TYPE_GENERAL_INCORRECT||t===l.FEEDBACK_TYPE_GENERAL_INCORRECT_QUESTION_SPECIFIC?e=this.content.getChildByAttribute("type","incorrect").text:t!==l.FEEDBACK_TYPE_GENERAL_PARTIAL&&t!==l.FEEDBACK_TYPE_GENERAL_PARTIAL_QUESTION_SPECIFIC||(e=this.content.getChildByAttribute("type","partial").text),s&&(i=this._questions.map(e=>({question:e.text,feedback:s?e.feedback:null,correct:e.correct,correctChoice:null,userChoice:e.options.filter(t=>t.value===e.selection)[0].label})));t=this.getFeedbackImage(t);return{text:e,image:t,questions:i}}getFeedbackImage(t){var e=[l.FEEDBACK_TYPE_GENERAL_CORRECT,l.FEEDBACK_TYPE_GENERAL_CORRECT_QUESTION_SPECIFIC],i=[l.FEEDBACK_TYPE_GENERAL_PARTIAL,l.FEEDBACK_TYPE_GENERAL_PARTIAL_QUESTION_SPECIFIC],s=[l.FEEDBACK_TYPE_GENERAL_INCORRECT,l.FEEDBACK_TYPE_GENERAL_INCORRECT_QUESTION_SPECIFIC],a=this.content.getChildByAttribute("id","feedback-image"),n=this.content.getChildByAttribute("id","feedback-image-correct"),r=this.content.getChildByAttribute("id","feedback-image-partial"),o=this.content.getChildByAttribute("id","feedback-image-incorrect"),e=this._status===l.STATUS_CORRECT||-1!==e.indexOf(t),i=this._status===l.STATUS_PARTIAL||-1!==i.indexOf(t),s=this._status===l.STATUS_INCORRECT||-1!==s.indexOf(t);return e&&n?n:s&&o?o:i&&r?r:a}buildButtonArray(){var t="true"===this._data.attributes.showExploreOther,e=new ModalButton("matrix-edit",this.api.parseTokens(this._attitudinal?"{tk_Attitudinal_Explore}":"{tk_TryAgain}"),this.onModalClose.bind(this)),i=new ModalButton("matrix-continue",this._isZone?this.api.parseTokens("{tk_MatrixModalClose}"):this.api.parseTokens("{tk_ContinueButton}"),this.onContinue.bind(this));return this._status===l.STATUS_NEUTRAL?t?[e,i]:[i]:this._status!==l.STATUS_CORRECT&&(this._numAttempts<this._maxAttempts||-1===this._maxAttempts)?[e]:[i]}trackActivityInit(){this._pageIsComplete=!0===this.api.model.currentPage.complete,this._configuration.iTestable||this._isZone||this._TrackingManager.setActivityStatus({status:"register",activity:{id:"matrix",complete:!1,alert:this._data.attributes.activityAlertId}})}trackActivityCompletion(){this._isZone&&this.setZoneComplete(),this._configuration.iTestable||this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"matrix",complete:!0}})}setLatencyTimer(){clearInterval(this._latencyTimer),this._latencyTimer=window.setInterval(()=>{this._latencyTime++},1e3)}trackInteractionCompletion(){var t=this._questions.map(t=>{var e=this._questions.length,e=s.formatLatencyTime(Math.round(this._latencyTime/e)),i=null===t.correctChoice||t.correctChoice.value===t.selection;return{interactionID:t.interactionID,responses:[t.selectedInteractionID],result:this._attitudinal?"neutral":i?"correct":"wrong",latency:e}});this._TrackingManager.batchSetInteractions({interactionCollection:t})}}l.MODAL_ID="matrix-feedback-modal",l.STATUS_INCOMPLETE="incomplete",l.STATUS_CORRECT="correct",l.STATUS_PARTIAL="partial",l.STATUS_INCORRECT="incorrect",l.STATUS_NEUTRAL="neutral",l.FEEDBACK_TYPE_GENERAL_DEFAULT="general-default",l.FEEDBACK_TYPE_GENERAL_CORRECT="general-correct",l.FEEDBACK_TYPE_GENERAL_PARTIAL="general-partial",l.FEEDBACK_TYPE_GENERAL_INCORRECT="general-incorrect",l.FEEDBACK_TYPE_QUESTION_SPECIFIC="question-specific",l.FEEDBACK_TYPE_GENERAL_CORRECT_QUESTION_SPECIFIC="general-correct-question-specific",l.FEEDBACK_TYPE_GENERAL_INCORRECT_QUESTION_SPECIFIC="general-incorrect-question-specific",l.FEEDBACK_TYPE_GENERAL_PARTIAL_QUESTION_SPECIFIC="general-partial-question-specific",l.FEEDBACK_TYPE_SKIP="skip",t.Matrix=l}(GLEPlugins=GLEPlugins||{}),function(t){var a=GLECore.StateChangeAlert,i=GLECore.SettingsManager,e=GLECore.ModalData;class s extends t.IPluggable{constructor(t){super(t),this._modalId="menu_modal",this.NAVIGATION_KEYS=["End","Home","ArrowLeft","ArrowUp","ArrowRight","ArrowDown"],this.SELECTION_KEYS=["Enter"," "],this.showMenuHandler=t=>{t.data&&"showModalMenu"===t.data.type&&(this._$launcherButton=t.data.$launcher_button,this.buildMenuContent(),this.openMenuModal(),this.wireMenu())},this.onMenuClose=(t,e)=>{var i=$(".modal-menu-accordion .tab");this.unwire(i),this._ModalManager.closeModal(e)},this.keyHandler=t=>{var e=t.key,i=-1!==this.NAVIGATION_KEYS.indexOf(e),s=-1!==this.SELECTION_KEYS.indexOf(e),a=t.ctrlKey;i&&!a?this.tabNavigationHandler(e):s&&!a?this.triggerTabSelection():a&&this.panelNavigationHandler(e,t)},this.toggleTab=t=>{var t=$(t.currentTarget),e=this._$menu.find("#"+t.attr("aria-controls")),i="true"!==t.attr("aria-expanded");this._$menu.find(".tab[aria-selected='true']").attr("aria-selected","false"),t.attr("aria-expanded",i?"true":"false"),t.attr("aria-selected","true"),e.attr("aria-hidden",i?"false":"true")},this.focusHandler=t=>{t=$(t.currentTarget).closest(".panel"),t=this._$menu.find("#"+t.attr("aria-labelledby"));this._$menu.find(".tab[aria-selected='true']").attr("aria-selected","false"),t.attr("aria-selected","true")},this.menuLinkHandler=t=>{var e=$(t.currentTarget).data("page").toString(),i=this._AlertManager.getStateChangeAlert(a.Navigation),s=$(".modal-menu-accordion .tab");_.isEmpty(i)?(this._ModalManager.reenableTabIndexes(),this.api.callPage(e)&&this.unwire(s),this.api.sendEvent({type:"dismissMobileMenu"})):this._AlertManager.renderStateChangeAlert(i,()=>{this.menuLinkHandler(t)})},this._RouteManager=t.RouteManager,this._ModalManager=t.ModalManager,this._AlertManager=t.AlertManager,this._SettingsManager=t.SettingsManager}build(t,e){return super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0],this.api.addEvent("apiEvent",this.showMenuHandler),"true"===this._SettingsManager.getSettingValueGeneral(i.SETTING_NAME_HIDE_SECTION_TIME)&&$("body").addClass("hide-section-time"),""}buildMenuContent(){var t=this.api.getSectionTemplateData(),e=_.template(this.api.getTemplate(this._data.attributes.templateID).content);this._menuContent=e({sections:t})}openMenuModal(){var t={id:this._modalId,header:this.api.parseTokens("{tk_MenuModalHeading}"),content:this._menuContent,srcElement:"root",hasExit:!0,isFullScreen:!0,$launcher:this._$launcherButton,exitCallback:this.onMenuClose};this._$modal=this._ModalManager.openModal(new e(t.id,t.header,t.content,t.srcElement,[],t.hasExit,t.$launcher,null,t.isFullScreen,!1,!1,t.exitCallback))}unwire(t){t.off("click",this.toggleTab),$(document).off("keydown",this.keyHandler),this._$menu.find(".page-link").off("focus",this.focusHandler).off("click",this.menuLinkHandler)}wireMenu(){var t=$(".modal-menu-accordion .tab");this._$menu=$(".modal-menu-accordion"),this.unwire(t),this._$document=$(document).on("keydown",this.keyHandler),t.on("click",this.toggleTab),this._$menu.find(".page-link").on("focus",this.focusHandler).on("click",this.menuLinkHandler)}tabNavigationHandler(e){var i=this._$menu.find(".tab:focus");if(i.length&&-1!==this.NAVIGATION_KEYS.indexOf(e)){var s=this._$menu.find(".tab");let t=i.data("index");0<t&&("ArrowLeft"===e||"ArrowUp"===e)?t--:t<s.length-1&&("ArrowRight"===e||"ArrowDown"===e)?t++:"Home"===e?t=0:"End"===e&&(t=s.length-1),s.attr("aria-selected","false"),s.eq(t).attr("aria-selected","true").focus()}}triggerTabSelection(){this._$menu.find(".tab:focus").click()}panelNavigationHandler(t,e){var i=this._$menu.find(".tab[aria-selected='true']"),s=i.data("index"),a=this._$menu.find(".tab");let n,r;e.preventDefault(),"ArrowLeft"===t||"ArrowUp"===t?i.focus():"PageUp"===t?(this._$menu.find(".tab[aria-selected='true']").attr("aria-selected","false"),r=0<s?s-1:a.length-1,(n=a.eq(r)).attr("aria-selected","true"),n.focus(),"false"===n.attr("aria-expanded")&&n.click()):"PageDown"===t&&(this._$menu.find(".tab[aria-selected='true']").attr("aria-selected","false"),r=s<a.length-1?s+1:0,(n=a.eq(r)).attr("aria-selected","true"),n.focus(),"false"===n.attr("aria-expanded"))&&n.click()}}t.ModalMenu=s}(GLEPlugins=GLEPlugins||{}),function(t){var s=GLECore.MagicButtonManager;class e extends t.IPluggable{constructor(t){super(t),this._maxColumns=6,this._MagicButtonManager=t.MagicButtonManager}build(t,e){super.build(t,e);e=this.api.getTemplate(this.props.templateID);let i=_.template(e.content)(this.buildTemplateContent(t));return i=s.isMagicButtonInText(i)?this._MagicButtonManager.replaceMagicButtonsInTextWithHtml(i):i}buildTemplateContent(t){const a={useNumbers:"true"===this.props.useNumbers,numberPosition:this.props.numberPosition,imageType:this.props.imageType,columns:[],maxColumns:0};_.forEach(t.getChildrenOfType("Column"),t=>{var e=t.getChildrenOfType("Image"),i=this.getImageSrc(e[0]),e=e[0]?e[0].getChildrenOfType("Description")[0]:null,s=t.getChildByAttribute("id","header"),t=t.getChildByAttribute("id","content");a.columns.push({imageSrc:i,description:e,text:t,header:s})});t=Number(this.props.maxColumns)||a.columns.length;return a.maxColumns=Math.min(this._maxColumns,t),a}getImageSrc(t){if(!t)return null;let e=t.attributes.src;return e="icon"===this.props.imageType?this.api.model.svgManifest[t.attributes.src].content:e}}t.MultiColumnStaticList=e}(GLEPlugins=GLEPlugins||{}),function(t){var a=GLECore.ModalData,i=GLECore.TimeUtil,o=GLECore.DataUtil,l=GLECore.TrackingManager;class n extends t.AbstractZone{static initInteractionData(t,e,i){var e={n:e},s=$(t.sourceXML),a=t.getFirstAncestorElementByName("Page"),n=t.getFirstAncestorElementByName("Zone");let r=a.attributes.pageID;n&&(r=r+"_"+n.attributes.zoneID);a=t.getFirstChildOfType("Question"),e.id=o.standardizeId(r),e.type="fill-in",e.correct_responses=[],e.long_correct_responses=[{pattern:"{order_matters=false}"}],e.long_response_lookup={},n=s.find("Question").text();return e.description=n.replace(/<[^>]+>/gim,"").substr(0,255),e.long_response_lookup[0]=l.generateShortIdentifier(i+1,0,n),a.attributes.interactionID="0",s.find("Question").attr("interactionID",0),l.addInteractionIdToSource(t,e.id),[e]}constructor(t,e){super(t),this._latencyTime=0,this.onKeyDown=t=>{var e=this._$textarea.val().length+1,i=t.ctrlKey||t.metaKey;-1!==["Backspace","Delete"].indexOf(t.key)||i&&"a"===t.key||e<=this._characterLimit||t.preventDefault()},this.onKeyUp=()=>{var t=this._$textarea.val();this._$textarea.val(t.substring(0,this._characterLimit)),this.updateCounter(this._$textarea.val().length)},this.onFormSubmit=t=>{t.preventDefault(),n.sessionStorage[this._storageId]=this._$textarea.val(),this.showFeedback(),this.trackActivityCompletion(),this.trackInteractionCompletion(this._$textarea.val())},this.onModalClose=()=>{this._ModalManager.closeModal(n.MODAL_ID)},this.onContinue=()=>{this._ModalManager.closeModal(n.MODAL_ID),this._isZone?this.advanceZone():this.api.callNextPage()},this._configuration=e||{},this._ModalManager=t.ModalManager,this._TrackingManager=t.TrackingManager,_.isEmpty(n.sessionStorage)&&(n.sessionStorage={})}build(t,e){super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0],this._characterLimit=parseInt(this._data.attributes.multilineCharacterLimit,10);var t=_.template(this.api.getTemplate(this._data.attributes.templateID).content),e=this.content.getChildByAttribute("id","gfx"),i=_.isEmpty(e)?null:e.attributes.src,e=_.isEmpty(e)||_.isEmpty(e.getFirstChildOfType("Description"))?"":e.getFirstChildOfType("Description").text,s=_.isEmpty(this._data.attributes.numLines)?n.DEFAULT_NUM_LINES:this._data.attributes.numLines,a="true"===this._data.attributes.allowInputResize?"resize":"noresize";return t({header:this.content.getFirstChildOfType("Header").text,question:this.content.getFirstChildOfType("Question").text,image:i,imageAltText:e,numLines:s,resize:a,prompt:this.api.getPromptText(this.content.getFirstChildOfType("Prompt"),"{tk_OpenResponsePrompt}"),counterText:this._characterLimit})}program(t){super.program(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} .openresponse-body`:".openresponse-body",this._storageId=this._isZone?this.api.model.currentPage.id+"-"+this._zoneData.zoneId:this.api.model.currentPage.id,this.wireOpenResponse(),this.restoreContent(),this._isZone||this.trackActivityInit()}destroy(){clearInterval(this._latencyTimer),super.destroy()}wireOpenResponse(){this._$counter=$(this._bodySelector+" .counter.typed"),this._$submit=$(this._bodySelector+" .or-submit-button"),this._$form=$(this._bodySelector+" .or-form"),this._$textarea=$(this._bodySelector+" .or-textarea"),this._$textarea.keydown(this.onKeyDown).keyup(this.onKeyUp),this._$form.on("submit",this.onFormSubmit),this._latencyTimer=window.setInterval(()=>{this._latencyTime++},1e3)}restoreContent(){var t=n.sessionStorage[this._storageId];this._$textarea.val(t),this.updateCounter(t?t.length:0)}updateCounter(t){this._$counter.html(t.toString()),0<t&&0<this._$textarea.val().replace(/\s+/gim,"").length?this._$submit.attr("disabled",null):this._$submit.attr("disabled","disabled")}showFeedback(){var t=this.api.parseTokens("{tk_Feedback}"),e=this.content.getFirstChildOfType("Feedback").text,i=this.content.getChildByAttribute("id","gfx-feedback"),s=_.isEmpty(i)?null:i.attributes.src,i=_.isEmpty(i)||_.isEmpty(i.getFirstChildOfType("Description"))?"":i.getFirstChildOfType("Description").text,e=_.template(this.api.getTemplate("or-modal-content").content)({content:e,image:s,imageAltText:i}),s={id:n.MODAL_ID,header:t,content:e,srcElement:"root",buttons:this.buildButtonArray(),hasExit:!0,isFullScreen:!1,$launcher:this._$textarea,exitCallback:this.onModalClose,isAlert:!1,preventClickOutsideDismiss:!0},i=new a(s.id,s.header,s.content,s.srcElement,s.buttons,s.hasExit,s.$launcher,null,s.isFullScreen,s.isAlert,s.preventClickOutsideDismiss,s.exitCallback);this._ModalManager.openModal(i,!0)}buildButtonArray(){return[new ModalButton("openresponse-edit",this.api.parseTokens("{tk_OpenResponseEdit}"),this.onModalClose.bind(this)),new ModalButton("openresponse-continue",this.api.parseTokens("{tk_ContinueButton}"),this.onContinue.bind(this))]}trackActivityInit(){this._TrackingManager.setActivityStatus({status:"register",activity:{id:"openresponse",complete:!1,alert:this._data.attributes.activityAlertId}})}trackActivityCompletion(){this._isZone?this.setZoneComplete():this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"openresponse",complete:!0}})}trackInteractionCompletion(t){var e=$(this.content.sourceXML).attr("interactionID");this._TrackingManager.setScormInteraction({latency:i.formatLatencyTime(this._latencyTime),interactionID:e,responseText:t,result:"neutral"}),clearInterval(this._latencyTimer)}}n.DEFAULT_NUM_LINES=3,n.MODAL_ID="openresponse-modal",t.OpenResponse=n}(GLEPlugins=GLEPlugins||{}),function(s){var i=GLECore.Trace,a=GLECore.ModalData;class g extends s.AbstractZone{constructor(t,e){super(t),this._maxColumns=6,this.onButtonSelected=t=>{var t=$(t.currentTarget),e=t.data("index"),e=this._buttonData[e];e.complete=!0,t.addClass("complete"),_.isEmpty(e.contentText)&&_.isEmpty(e.contentImage)&&_.isEmpty(e.contentVideo)?i.error("PopupButtons: You must have content for a button."):(e.isLink?this.openContentWindow(e):(this.openContentModal(e,t),this.registerRequiredLinks()),t.find(".item-state").attr("aria-hidden","false").html(this.api.parseTokens("{tk_PopupItemIsComplete}")),this.api.sendEvent({destination:"Style",type:"applyPageClasses"}),this.trackActivityCompletion())},this.onKeyUp=t=>{var e=$(t.currentTarget),i="true"===e.attr("data-focused");-1!==["Enter"," "].indexOf(t.key)?this.toggleItemSelection(e,!i):this._$buttons.find(".srt-item").attr("data-focused","false")},this._configuration=e||{},this._ModalManager=t.ModalManager,this._TrackingManager=t.TrackingManager,this._PluginManager=t.PluginManager}build(t,e){super.build(t,e);e=this.api.getTemplate(this.props.templateID);return _.template(e.content)(this.buildTemplateContent(t))}buildTemplateContent(t){var e={imageType:this.props.imageType,columns:[],maxColumns:0},t=(this._buttonData=[],_.forEach(t.getChildrenOfType("PopupButton"),(t,e)=>{var i=t.getChildByAttribute("id","gfx-default"),s=t.getChildByAttribute("id","gfx-hover"),a=t.getChildByAttribute("id","gfx-selected"),n=i?i.getFirstChildOfType("Description"):null,r=s?s.getFirstChildOfType("Description"):null,o=a?a.getFirstChildOfType("Description"):null,l=t.getChildrenOfType("Label")[0],t=t.getChildrenOfType("Content")[0],d=t.getFirstChildOfType("Header"),h=t.getFirstChildOfType("Text"),c=t.getFirstChildOfType("Image"),t=t.getFirstChildOfType("Video"),u=c?c.getFirstChildOfType("Description"):null,p=!_.isEmpty(h)&&g.LINK_REGEX.test(h.text);this._buttonData.push({imageDefault:i,imageHover:s||i,imageSelected:a||i,descriptionDefault:n,descriptionHover:r||n,descriptionSelected:o||n,label:l?l.text:"",contentHeader:d,contentText:h,contentImage:c,contentImageDesc:u,contentVideo:t,isLink:p,complete:!1,modalId:g.MODAL_ID+"-"+(e+1),svgSrc:"icon"===this.props.imageType?this.api.model.svgManifest[i.attributes.src].content:null})}),e.columns=this._buttonData,Number(this.props.maxColumns)||e.columns.length);return e.maxColumns=Math.min(this._maxColumns,t),e}program(t){super.program(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} .pub-body`:".pub-body";var t=$(this._bodySelector),e=t.find("#gfx");_.isEmpty(e)||t.addClass("hasImage"),this.wireEvents(),this.wireAccessibility(),this._isZone||this.trackActivityInit()}wireEvents(){this._$buttons=$(this._bodySelector).find(".pub-button"),this._$buttons.on("click",this.onButtonSelected)}openContentWindow(t){this.api.callWebAddress(t.contentText.text)}openContentModal(t,e){var i=this.api.getTemplate("p_popup_content"),i=_.template(i.content)({contentImage:t.contentImage,contentImageDesc:t.contentImageDesc,contentText:t.contentText,contentVideo:t.contentVideo}),i={id:t.modalId,header:this.getHeaderText(t),content:i,srcElement:"root",buttons:[{id:"popup_close",label:this.api.parseTokens("{tk_CloseUpperCase}"),callback:()=>this._ModalManager.closeModal(t.modalId)}],hasExit:!0,isFullScreen:!1,$launcher:e,exitCallback:()=>this._ModalManager.closeModal(t.modalId),isAlert:!1,preventClickOutsideDismiss:!1,zoneId:this.zoneId},e=new a(i.id,i.header,i.content,i.srcElement,i.buttons,i.hasExit,i.$launcher,null,i.isFullScreen,i.isAlert,i.preventClickOutsideDismiss,i.exitCallback,!0,i.zoneId);this._$modal=this._ModalManager.openModal(e,!0),this._$modal.addClass(g.MODAL_ID),t.contentVideo&&this.renderVideo(t.contentVideo)}renderVideo(t){var e=this._$modal.find(".modal-video-container").get(0),i=new s.GLEVideo(this._PluginManager.lookupManifestDefinition("Video","dependencies")),t=i.build(t,this.api);e.innerHTML+=t,i.program(e),this._$modal.addClass("has-video")}getHeaderText(t){return null!=(t=null==(t=t.contentHeader)?void 0:t.text)?t:""}registerRequiredLinks(){this.api.sendEvent({destination:"RequiredLinks",type:"RequiredLinkUpdate",$container:this._$modal,currentPage:this.api.getCurrentPage()})}wireAccessibility(){this._$buttons.attr("data-focused","false"),this._$buttons.on("keyup",this.onKeyUp)}toggleItemSelection(t,e){this._$buttons.attr("data-focused","false"),t.attr("data-focused",e?"true":"false")}trackActivityInit(){this._configuration.iTestable||this._TrackingManager.setActivityStatus({status:"register",activity:{id:g.ACTIVITY_ID,complete:!1,alert:this.props.activityAlertId}})}trackActivityCompletion(){var t=_.every(this._buttonData,"complete");!0!==t||this._isZone?!0===t&&this.setZoneComplete():this._TrackingManager.setActivityStatus({status:"complete",activity:{id:g.ACTIVITY_ID,complete:!0}})}}g.MODAL_ID="popupbuttons-modal",g.ACTIVITY_ID="popupbuttons",g.LINK_REGEX=/^(https?:\/\/[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/,s.PopupButtons=g}(GLEPlugins=GLEPlugins||{}),function(i){var e=GLECore.SettingsManager,s=GLECore.BackgroundMediaManager,a=GLECore.Platform;class n extends i.IPluggable{constructor(t){super(t),this._preloadList=[],this._complete=[],this._data=null,this._ready=!1,this._resetting=!1,this._preCourseSettings=!1,this._disableBreakpointSpecificLoading=!1,this._imageSrcs=null,this._imageTypes=null,this.reprogram=()=>{$("#preloader").addClass("resetting"),this.setPercentPreloaded(0),this.startPreload()},this.apiHandler=t=>{var e;"internalReset"===t.data.type?(e=$("#preloader-panel"),this._resetting&&e.html(this._$container[0].outerHTML),this._resetting=!0,this.setPercentPreloaded(0),e.find(".preloader-percent").hide(),e.addClass("resetting"),e.show()):"precourseSettingsClosed"===t.data.type&&this._preCourseSettings&&!t.data.langChange&&this.startPreload()},this.onComplete=t=>{this._complete.push(t.original),this.updatePreloaderPercentage()},this.updatePreloaderPercentage=()=>{var t=this.getPreloadedPercentage();this.setPercentPreloaded(t)},this.onFinishImages=()=>{this._svgHelper.svgs.length?this._svgHelper.init(this.onReady):this.onReady()},this.onReady=()=>{const t=$("#preloader-panel");var e="tg"===this._LaunchDataManager.launchInfo.preferences.viewingMode;(this._ready=!0)!==s.BGMEDIA_EXISTS||e?t.fadeOut("fast",this.hidePreloader):(t.addClass("show-continue-button"),t.find(".continue-container > button").click(()=>{t.fadeOut("fast"),this.hidePreloader()}))},this.hidePreloader=()=>{this._TrackingManager.startCourse()},this._SettingsManager=t.SettingsManager,this._LaunchDataManager=t.LaunchDataManager,this._TrackingManager=t.TrackingManager}build(t,e){return this._svgHelper=new i.SVGPreloaderHelper(e,this.updatePreloaderPercentage),this.buildSteps(t,e)}buildSteps(t,e){return super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0],this._imageSrcs=this._data.attributes.imageSrcs.split(","),this._imageTypes=this._data.attributes.imageTypes.split(","),this._disableBreakpointSpecificLoading="true"===this._data.attributes.disableBreakpointSpecificLoading,this.reset(),this.generateQueue(),this.buildContainer(),this.api.addEvent("apiEvent",this.apiHandler),this._$container[0].outerHTML}reset(){this._preloadList=[],this._complete=[],this._ready=!1,this._svgHelper.reset(this.api)}generateQueue(){var t=this.api.getMediaSize(),e=this.api.getDeviceType()===a.DEVICE_DESKTOP;const i=n.PRELOAD_BPS[e?"desktop":"device-"+t];var e=this._imageSrcs.map(t=>`[${t}]`).join(","),t=$(this.api.model.contentXml).find(e).filter((t,e)=>this.satisfiesPreloadRequirements($(e),i)),e=(this._preloadList=_.uniq($.map(t,t=>this.getImageSrc($(t)))),parseInt(this.content.getChildrenOfType("Data")[0].attributes.percentToPreload,10)/100),s=Math.floor(e*this._preloadList.length);for(let t=this._preloadList.length-1;t>s;t--)this._preloadList.splice(t,1)}satisfiesPreloadRequirements(t,e){var i=this.getImageSrc(t),s=this._imageTypes.map(t=>`(.${t})`).join("|"),s=new RegExp(`(?:${s})$`,"i").test(i),i=t.attr("breakpoint");return!(!s||!_.isEmpty(i)&&"all"!==i&&!this._disableBreakpointSpecificLoading&&-1===e.indexOf(i))}getImageSrc(i){for(let t=0,e=this._imageSrcs.length;t<e;t++){var s=this._imageSrcs[t];if(i.attr(s))return i.attr(s).toString()}return null}buildContainer(){var t=this.api.populate(null,this._data.attributes.templateID,this.content);this._$container=$(t.content)}rebuild(t,e){return this.api.removeEvent("apiEvent",this.apiHandler),this.buildSteps(t,e)}program(t){super.program(t),"true"!==this._SettingsManager.getSettingValueGeneral(e.SETTING_NAME_SHOW_PRECOURSE_SETTINGS)||this._SettingsManager.firstPreferencesDisplay?this.startPreload():this._preCourseSettings=!0}startPreload(){const t=$(".preloader-body");setTimeout(()=>{t.find("h2").attr("tabindex","-1").focus()},250),/iPad|iPhone|iPod/.test(navigator.userAgent)&&t.attr("role","alert"),$.preload(this._preloadList.concat(),{onComplete:this.onComplete,onFinish:this.onFinishImages})}getPreloadedPercentage(){var t=this._preloadList.length+this._svgHelper.svgs.length,e=this._complete.length+this._svgHelper.complete;return Math.round(100*e/t)}setPercentPreloaded(t){t=this.content.getChildrenOfType("Text")[0].text.replace(/<Percent[^>]*>/gim,t.toString());$(".preloader-percent").html(t)}}n.PRELOAD_BPS={"device-xs":["xs","sm"],"device-sm":["xs","sm"],"device-md":["md","lg"],"device-lg":["md","lg","xl"],"device-xl":["lg","xl"],desktop:["lg","xl"]},i.Preloader=n}(GLEPlugins=GLEPlugins||{}),function(i){class t extends i.AbstractZone{constructor(t){super(t),this.onSubmission=()=>{this.trackCompletion(),this.api.sendEvent({destination:"all",type:"profiling",profileId:this._profileId,responses:[!0],pageID:this.api.model.currentPage.id}),this._$submit.attr("disabled","disabled"),this._$continue.attr("disabled",null)},this.onReviewQuestion=t=>{var t=$(t.currentTarget),e=t.data("page").toString(),t=t.data("zone").toString();this._isZone?(t=$("#z"+t),i.MultiZone.activeZone.scrollToZone(t)):(this._RouteManager.reviewPageReference=this.api.model.currentPage.id,this.api.callPage(e))},this.trackInit=()=>{this.api.addEvent("apiEvent",this.apiEventHandler),this._isZone||this._TrackingManager.setActivityStatus({status:"register",activity:{id:"profile_review",complete:!1,alert:this._data.attributes.activityAlertId}})},this.apiEventHandler=t=>{"routeAndTrackingUpdate"===(null==(t=t.data)?void 0:t.type)&&this.advancePage()},this.advancePage=()=>{this._RouteManager.reviewPageReference=null,this.api.callNextPage()},this.trackCompletion=()=>{this._isZone?this.setZoneComplete():!1===this.api.model.getCurrentPage().complete&&this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"profile_review",complete:!0}})},this._RouteManager=t.RouteManager,this._TrackingManager=t.TrackingManager}build(t,e){super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0],this._profileId=this._data.attributes.profileId;t=this.api.getTemplate(this._data.attributes.templateID);return _.template(t.content)(this.buildTemplateContent())}buildTemplateContent(){return{header:this.content.getChildByAttribute("id","header").text,prompt:this.content.getChildByAttribute("id","prompt").text,message:this.content.getChildByAttribute("id","message").text,reviewItems:this.buildReviewItems()}}buildReviewItems(){var t=this._RouteManager.profilingPages;const l=this._RouteManager.profilingResponses,d=[];return t.each((t,o)=>{$(o).find('Data[profiling="true"]').parent().each((t,e)=>{var e=$(e),i=e.find("Data").attr("profileId");const s=l[i];var a=$(o).attr("pageID"),e=e.closest("Zone").attr("zoneID"),n=this.api.getPageById(a),r=n.xmlContainer.find({zoneID:e},!0),r=e?r:n.xmlContainer;_.isEmpty(s)||i===this._profileId||(i=_.last(r.getAllDescendantsOfType("Question")),r=n.xmlContainer.getAllDescendantsOfType("Choice").filter(t=>-1!==s.indexOf(t.attributes.id)).map(t=>t.text),d.push({pageId:a,zoneID:e,text:i.text,responses:r}))})}),d}program(t){super.program(t),this.wireButtons(),this.wireReviewItems(),this.trackInit()}destroy(){this.api.removeEvent("apiEvent",this.apiEventHandler)}wireButtons(){var t=this.api.model.getCurrentPage().complete;this._$submit=$(".pr-submission-button"),this._$continue=$(".pr-continue-button"),t?this._$submit.attr("disabled","disabled"):(this._$continue.attr("disabled","disabled"),this._$submit.click(this.onSubmission)),this._$continue.click(this.advancePage)}wireReviewItems(){$(".pr-review-question").click(this.onReviewQuestion)}}i.ProfileReview=t}(GLEPlugins=GLEPlugins||{}),function(i){var s=GLECore.TooltipData,e=GLECore.StateChangeAlert,a=GLECore.TimeUtil,n=GLECore.DisplayUtil;class t extends i.IPluggable{constructor(t){super(t),this._currentPageNum=1,this._totalPages=0,this._useBeginButton=!0,this._useInactiveState=!1,this._useProgressTimer=!1,this._beginHasShown=!1,this._displayMode=i.ProgressDisplayType.All,this.updateHandler=()=>{this._totalPages=this.api.model.pages.length,this._currentPageNum=this.api.model.pages.indexOf(this.api.model.currentPage)+1,isNaN(this._startingHighWatermarkPageNum)&&(this._startingHighWatermarkPageNum=this.api.model.getPageIndexByPageId(this.api.model.courseLoadHighWatermarkPageId),this._startingHighWatermarkPageNum++),isNaN(this._highWatermarkPageNum)&&(this._highWatermarkPageNum=this._startingHighWatermarkPageNum),1<this._highWatermarkPageNum&&(this._beginHasShown=!0),this.updateHighwaterMarkPageNum(),this.fillProgressIndicator(),this.handleNavControls(),this.setNextButtonState()},this.previousBtnClickHandler=()=>{var t=this._AlertManager.getStateChangeAlert(e.Navigation);_.isEmpty(t)?this.api.callPreviousPage():this._AlertManager.renderStateChangeAlert(t,()=>{this.previousBtnClickHandler()})},this.nextBtnClickHandler=()=>{this.api.callNextPage()},this.focusBtnClickHandler=()=>{$("#page-top").focus()},this.renderTooltip=t=>{var t=$(t.currentTarget),e=new s(t.attr("id"),null,t.attr("aria-label"),"simple_tooltip",s.TOOLTIP_EFFECT_FADE,s.TOOLTIP_POSITION_BOTTOM_CENTER,s.TOOLTIP_DISMISS_MOUSEOUT,!0,"navigation",t,null,null,null,!1);t.hasClass("locked")||this.api.sendEvent({destination:"TooltipManager",type:"showTooltip",tooltip:e})},this.apiEventHandler=t=>{"alert"===_.get(t,"data.type.value.modalType")?this.handleNavControls():"routeUpdate"===_.get(t,"data.type")?this.onRouteUpdated():"pageComplete"===_.get(t,"data.type")?this.setNextButtonState(!0):"SetProgressDisplayMode"===_.get(t,"data.type")&&this.setDisplayMode(null!=(t=t.data.value)?t:this._displayMode)},this.onTimerTick=t=>{var e=$("#gle-progressbar .progress-ring-circle"),t=_.isEmpty(t)?this.api.model.currentBookmark:t.data.bookmark,i=t.time,t=t.value,s=Math.round(100*(i+1)/t),t=a.formatLatencyTime(t-i,!0,!0);100<s?(this.api.model.removeEventListener("tick",this.onTimerTick),this._$nextButton.removeClass("timer"),n.drawCircle(e)):(n.drawCircle(e,s),this._$nextButton.find(".icon-timer .label").html(t))},this._RouteManager=t.RouteManager,this._AlertManager=t.AlertManager}build(t,e){return super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0],this._displayMode=null!=(t=this._data.attributes.displayMode)?t:i.ProgressDisplayType.All,this._useBeginButton="true"===this._data.attributes.useBeginButton,this._useInactiveState="true"===this._data.attributes.useInactiveState,this._useProgressTimer="true"===this._data.attributes.useProgressTimer,this.buildContainer(),this.api.addEvent("apiEvent",this.apiEventHandler),this._markup}buildContainer(){var t=this.api.populate(null,this._data.attributes.templateID,this.content);this._template=t.template,this._markup=t.content,this._$container=$("#gle-progressbar"),this._$container.html(this._markup)}setPageCount(){var t=_.template(this.api.getTemplate("p_progressbar_page_numbering").content);this._$pageNumbers.html(t({currentPage:this._currentPageNum,totalPages:this._totalPages}))}program(t){super.program(t),this.initNavControls(),this.api.addEvent("pageUpdate",this.updateHandler),this._totalPages=this.api.model.pages.length,this._currentPageNum=this.api.model.pages.indexOf(this.api.model.currentPage)+1,this.initProfiling()}initNavControls(){this._$previousButton=$("#progress-bar-prevBtn"),this._$nextButton=$("#progress-bar-nextBtn"),this._$beginButton=$("#progress-bar-beginBtn"),this._$focusButton=$("#progress-bar-focusBtn"),this._$pageNumbers=$("#progress_pageNums"),this._$previousButton.on("click",this.previousBtnClickHandler),this._$nextButton.on("click",this.nextBtnClickHandler),this._$beginButton.on("click",this.nextBtnClickHandler),this._$focusButton.on("touchstart click",this.focusBtnClickHandler),this._$previousButton.on("mouseenter focus",this.renderTooltip),this._$nextButton.on("mouseenter focus",this.renderTooltip),this.setDisplayMode(this._displayMode),this.configureAccessibleNavigation()}initProfiling(){this._RouteManager&&this._RouteManager.profilingActive&&this._$container.addClass("profiling")}updateHighwaterMarkPageNum(){this._currentPageNum>this._highWatermarkPageNum&&(this._highWatermarkPageNum=this._currentPageNum)}fillProgressIndicator(){var t=100/this._totalPages;$(".progressBarHighWaterMark").css("width",t*this._highWatermarkPageNum+"%"),$(".progressBarIndicatorFill").css("width",t*this._currentPageNum+"%")}configureAccessibleNavigation(){$("button#page-top").remove(),$("#page-container").before($("<button id='page-top' class='accessible-offscreen'>"+this.api.model.tokens.tk_AccessPageTop+"</button>")),$("#page-top").click(()=>{(this._$beginButton.hasClass("show")?this._$beginButton:this._$nextButton).focus()})}handleNavControls(){this._$previousButton.removeClass("hidden"),this.isFirstPage()?this._$previousButton.hide():this._$previousButton.show(),this.setPageCount(),this.isLastPage()?this._$nextButton.hide():this._$nextButton.show(),this._useBeginButton&&1===this._currentPageNum&&1!==this._totalPages&&!this._beginHasShown?(this._$beginButton.addClass("show"),this._$container.addClass("first-page")):(this._$beginButton.removeClass("show"),this._$container.removeClass("first-page"))}isFirstPage(){return 1===this._currentPageNum}isLastPage(){return this._currentPageNum===this._totalPages}setDisplayMode(t){this.clearDisplayMode(),$("#gle-progressbar").addClass(t)}clearDisplayMode(){$("#gle-progressbar").removeClass(`${i.ProgressDisplayType.All} ${i.ProgressDisplayType.Hidden} ${i.ProgressDisplayType.HideProgress} `+i.ProgressDisplayType.HideNavigation)}onRouteUpdated(){this._totalPages=this.api.model.pages.length,this._currentPageNum=this.api.model.pages.indexOf(this.api.model.currentPage)+1,this._$container.removeClass("profiling"),this.setPageCount()}setNextButtonState(t=null){t=t||this.api.model.currentPage.complete;!0===this._useInactiveState&&this._$nextButton.removeClass("active locked").addClass(t?"active":"locked"),!0===this._useProgressTimer&&this.configurePageTimer(t)}configurePageTimer(t){this.api.model.removeEventListener("tick",this.onTimerTick),clearTimeout(this._timeout),t?(n.drawCircle($("#gle-progressbar .progress-ring-circle")),this._$nextButton.removeClass("timer")):(this._$nextButton.addClass("timer"),this._timeout=window.setTimeout(this.onTimerTick,0),this.api.model.addEventListener("tick",this.onTimerTick))}}i.ProgressBar=t}(GLEPlugins=GLEPlugins||{}),function(i){var n=GLECore.ModalData;class r extends i.Checkpoint{constructor(t,e){super(t,e),this.onFeedbackRender=(t,e)=>{let i=t.find(".fdbk-indicator-area").html();var s=t.find(".feedback-summary").html().replace(/^\s+/gim,""),t=!!t.find(".retry-button").length,t=this.buildButtonArray(t),s=(_.isEmpty(i)&&!0===this._quiz.isAttitudinal?i=this.api.parseTokens("{tk_Attitudinal_RatingScale_Header}"):_.isEmpty(i)||(i=i.replace(/<(\/)?h2/gim,"<$1div")),{id:r.MODAL_ID,header:i,content:s,srcElement:"root",buttons:t,hasExit:this._quiz.isAttitudinal,isFullScreen:!1,$launcher:this._quiz.$submitButton,exitCallback:this.onModalClose,isAlert:!1,preventClickOutsideDismiss:!0});const a=new n(s.id,s.header,s.content,s.srcElement,s.buttons,s.hasExit,s.$launcher,null,s.isFullScreen,s.isAlert,s.preventClickOutsideDismiss,s.exitCallback);this._quiz.isAttitudinal?this.launchModal(a,e):this._modalTimeout=window.setTimeout(()=>{this.launchModal(a,e)},this._modalDelay)},this.onModalClose=()=>{this._quiz.hideFeedback(),this._ModalManager.closeModal(r.MODAL_ID)},this.onContinue=()=>{var t=this._isZone&&i.MultiZone.activeZone.mode!==i.ZoneMode.Default&&this._quiz.isAttitudinal;this._ModalManager.closeModal(r.MODAL_ID),t?(this._quiz.hideFeedback(),i.MultiZone.activeZone.advanceZone(this._zoneData)):this._isZone&&this._quiz.isAttitudinal?this._quiz.hideFeedback():this._quiz.quizComplete()},this._ModalManager=t.ModalManager}build(t,e){t=$(`<div>${super.build(t,e)}</div>`);return this._data=this.content.getFirstChildOfType("Data"),this._modalDelay=1e3*parseFloat(this._data.attributes.modalDelay),this._showExploreOther="true"===this._data.attributes.showExploreOther,t.html()}program(t){super.program(t),this._quiz.overrideFeedbackPanelRender=this.onFeedbackRender}destroy(){super.destroy(),clearTimeout(this._modalTimeout)}launchModal(t,e){t=this._ModalManager.openModal(t,!0);!0!==this._quiz.isAttitudinal&&t.find("header > h2").addClass(e)}buildButtonArray(t){var e=[],i=new ModalButton("ratingscale-continue",this._isZone?this.api.parseTokens("{tk_CloseUpperCase}"):this.api.parseTokens("{tk_ContinueButton}"),this.onContinue.bind(this));return!0===this._quiz.isAttitudinal?(this._showExploreOther&&e.push(new ModalButton("ratingscale-explore",this.api.parseTokens("{tk_Attitudinal_Explore}"),this.onModalClose.bind(this))),e.push(i)):e.push(!0===t?new ModalButton("ratingscale-retry",this.api.parseTokens("{tk_TryAgain}"),this.onModalClose.bind(this)):i),e}}r.MODAL_ID="ratingscale-feedback-modal",i.RatingScale=r}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.IPluggable{constructor(t){super(t),this.checkRequirements=e=>{for(let t=this._currentLinks.length-1;0<=t;t--){var i=this._currentLinks[t];i===$(e.currentTarget).data("requiredId")&&(this._currentLinks.splice(t,1),this._completedLinks.push(i))}this.evaluateCompletion()},this.apiEventHandler=t=>{var e;"RequiredLink"===t.data.type?this.registerRequiredLinks(t.data.$container,t.data.currentPage):"pageViewUpdate"===t.data.type?(this._currentLinks=[],e=t.data,this.registerRequiredLinks(e.$pageContainer,e.currentPage)):"RequiredLinkUpdate"===t.data.type?this.programRequiredLinks(t.data.$container):"RequiredLinkIgnore"===t.data.type?this.ignoreRequiredLinks(t.data.ids):"ForceRequiredLinkCompletion"===t.data.type&&(this._currentLinks=[],this.evaluateCompletion())},this.wireRequiredLink=t=>{var e=t.data("requiredId");-1===this._currentLinks.indexOf(e)&&-1===this._completedLinks.indexOf(e)&&this._currentLinks.push(e),t.on("click",this.checkRequirements)},this._ContentManager=t.ContentManager,this._TrackingManager=t.TrackingManager}build(t,e){return super.build(t,e),this._completedLinks=[],this.api.addEvent("apiEvent",this.apiEventHandler),""}program(t){super.program(t)}evaluateCompletion(){this._currentLinks.length||this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"required_links",complete:!0}})}registerRequiredLinks(t,e){_.isEmpty(e)||_.isEmpty(t)||(e=e.id,this._requiredLinkIDs=this._ContentManager.requiredLinkLookup[e],_.isEmpty(this._requiredLinkIDs)||this._TrackingManager.setActivityStatus({status:"register",activity:{id:"required_links",complete:!1,alert:"altRequiredLink"}}),this.programRequiredLinks(t))}programRequiredLinks(e){_.each(this._requiredLinkIDs,t=>{t=e.find("[data-required-id='"+t+"']");_.isEmpty(t)||this.wireRequiredLink(t)})}ignoreRequiredLinks(t){_.each(t,t=>{t=this._currentLinks.indexOf(t);-1!==t&&this._currentLinks.splice(t,1)}),this.evaluateCompletion()}}t.RequiredLinks=e}(GLEPlugins=GLEPlugins||{}),function(t){var e=GLECore.ModalData,a=GLEProfiling.ProfileQuery;class i extends t.IPluggable{constructor(t){super(t),this._resourcesData=[],this._modalId="resources_modal",this.apiEventHandler=t=>{"showResourceMenu"===_.get(t,"data.type")?(this._$launcherButton=t.data.$launcher_button,this.openResourcesModal(),this.wireResources()):"routeUpdate"!==_.get(t,"data.type")||0<this._resourcesData.length||this.buildResourceContent()},this.closeHandler=()=>{this._ModalManager.closeModal(this._modalId)},this.resourceLinkHandler=t=>{var e;t.preventDefault(),_.isEmpty(t.data)||((e=t.data.params.slice()).unshift(t.data.id),this.api[t.data.functionName](e))},this.filterProfiledResources=t=>{var e=t.getChildrenOfType("Profile"),t=t.getFirstChildOfType("ProfileQuery"),i=this._RouteManager.profilingResponses;let s;return _.isEmpty(t)?!e.length||(s=a.convertStandardProfiles(e)).evaluate(i):(s=new a(t.attributes.value)).evaluate(i)},this._RouteManager=t.RouteManager,this._ModalManager=t.ModalManager}build(t,e){return super.build(t,e),this._RouteManager.profiling||this.buildResourceContent(),this._data=this.content.getChildrenOfType("Data")[0],this.api.addEvent("apiEvent",this.apiEventHandler),""}buildResourceContent(){this.content.getChildrenOfType("Resource").filter(this.filterProfiledResources).forEach((t,e)=>{this.generateResourceData(t,e)});var t=_.template(this.api.getTemplate("ResourcesContent").content);this._resourcesContent=t({resources:this._resourcesData})}generateResourceData(t,e,i=!0){var s=t.getChildrenOfType("Name"),a=t.attributes.parameters.split(","),i={defaultText:i?"default":"",functionName:t.attributes.function,params:a,href:a[0],title:(s.length?s[0]:t).text,id:e};this._resourcesData.push(i)}openResourcesModal(){var t={id:this._modalId,header:this.api.parseTokens("{tk_Resources}"),content:this._resourcesContent,srcElement:"root",buttons:[{id:"annobar_close",label:this.api.parseTokens("{tk_CloseUpperCase}"),callback:this.closeHandler}],hasExit:!0,isFullScreen:!0,$launcher:this._$launcherButton};this._$modal=this._ModalManager.openModal(new e(t.id,t.header,t.content,t.srcElement,t.buttons,t.hasExit,t.$launcher,null,t.isFullScreen))}wireResources(){var t=this._$modal.find(".resource-link");_.each(t,t=>{var t=$(t),e=_.find(this._resourcesData,{id:t.data("id")});e&&t.on("click",e,this.resourceLinkHandler)})}}t.Resources=i}(GLEPlugins=GLEPlugins||{}),function(t){var e=GLECore.Trace,s=GLECore.TooltipData,n=GLECore.SettingsManager,u=GLECore.StateChangeAlert,i=GLECore.ViewingModeManager,a=GLECore.ModalData;class r extends t.IPluggable{constructor(t){super(t),this._data=null,this._settings=null,this._currentViewingModes=[],this._$settingsWindow=null,this._preCourse=!1,this._template=null,this.submitHandler=t=>{var e,i,s,a,n,r,o,l,d,h,c;t.key&&"Enter"!==t.key&&" "!==t.key||(e=$("#settings-viewing-mode").find("select").val(),i=$("#settings-language").find("select").val(),s=$("#settings-form-row-audio").find("input:checked").val(),a=$("#settings-form-row-subtitles").find("input:checked").val(),n=this._ViewingModeManager.getAudioHiddenSetting(e),r=this._ViewingModeManager.getAudioDisabledSetting(e),o=this._ViewingModeManager.getSubtitleHiddenSetting(e),l=this._ViewingModeManager.getSubtitleDisabledSetting(e),d=this._settings.lang!==i,h=this._settings.viewingMode!==e,c=this._AlertManager.getStateChangeAlert(u.LanguageChange),!0!=d||_.isEmpty(c)?(this._ViewingModeManager.setCurrentViewingMode(e),this._currentViewingModes=this._ViewingModeManager.getDisplayViewingModes(i),this._settings={lang:i,viewingMode:e,audio:s,subtitles:a,audioOptionHidden:n,audioOptionDisabled:r,subtitleOptionHidden:o,subtitleOptionDisabled:l},this.api.setPreferences(this._settings),this.hideSettingsPanel(),this._preCourse?(this._preCourse=!1,this.api.sendEvent({type:"precourseSettingsClosed",langChange:d,destination:"all"})):!0==d?this.api.sendEvent({type:"langChange",lang:i,destination:"all"}):!0==h&&this.api.sendEvent({type:"viewingModeChange",viewingMode:e,destination:"all"})):this._AlertManager.renderStateChangeAlert(c,()=>{this.submitHandler(t)}))},this.cancelHandler=t=>{t.key&&"Enter"!==t.key&&" "!==t.key||(this.api.sendEvent({type:"modalClosed",value:this._settings}),this.hideSettingsPanel())},this.languageSelectHandler=()=>{var t=$(".modal-saig #settings-language").find("select").val(),e=$(".modal-saig #settings-viewing-mode").find("select").val(),i=this._ViewingModeManager.getDisplayViewingModes(t),i=!_.isEqual(this._currentViewingModes,i);!1===this.updateConfigurationOnLanguageSelection(t,e)&&i&&this.populateSettingsPanel(t,e)},this.viewingModeSelectHandler=()=>{var t=$("#settings-viewing-mode").find("select").val(),t=this._ViewingModeManager.getViewingModeObj(t);t.valid||e.error("Invalid viewing mode data in Preferences panel!"),t.viewingMode.viewingModeValue===i.VIEWING_MODE_TG?this.setTGMode():this.setMediaMode()},this.toggleAudioOn=()=>{this._$subtitleOptionOff.attr("disabled",null),this.api.model.isMuted=!1},this.toggleAudioOff=()=>{this._$subtitleOptionOn.attr("disabled",null).get(0).checked=!0,this._$subtitleOptionOff.attr("disabled","disabled").get(0).checked=!1,this.api.model.isMuted=!0},this.renderTooltip=t=>{t.preventDefault();var t=$(t.currentTarget),e=t.attr("id").replace(/settings-(.*?)-help/gim,"$1"),i=this.fetchTooltipHeader(e),e=this.fetchTooltipBody(e),i=new s(t.attr("id"),i,e,"info_tooltip",s.TOOLTIP_EFFECT_FADE,s.TOOLTIP_POSITION_LEFT_CENTER,s.TOOLTIP_DISMISS_CLICK,!1,"settings",t,this.onTooltipRendered,this.onTooltipDismissed,$("body"),!0,!0);this.api.sendEvent({destination:"TooltipManager",type:"showTooltip",tooltip:i})},this.onTooltipRendered=()=>{$(".modal-saig[data-id*='settings_modal']").addClass("tooltip-rendered")},this.onTooltipDismissed=()=>{$(".modal-saig[data-id*='settings_modal']").removeClass("tooltip-rendered")},this._ViewingModeManager=t.ViewingModeManager,this._LanguageManager=t.LanguageManager,this._ModalManager=t.ModalManager,this._SettingsManager=t.SettingsManager,this._AlertManager=t.AlertManager,this._LaunchDataManager=t.LaunchDataManager}build(t,e){super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0];t=this.api.populate($("#settings-panel-container").get()[0],this._data.attributes.templateID,this.content);return this._template=t.template,t.content}program(t){super.program(t),this.programButtons(),this.api.addEvent("apiEvent",this.showSettingsHandler.bind(this)),this._$settingsWindow=$("#settings"),this._preCourse="true"===this._SettingsManager.getSettingValueGeneral(n.SETTING_NAME_SHOW_PRECOURSE_SETTINGS)&&!this._SettingsManager.firstPreferencesDisplay}programButtons(){$("#settings-submit-button").on("click keyup",this.submitHandler),$("#settings-cancel-button").on("click keyup",this.cancelHandler),$("#settings").find(".close-button").on("click keyup",this.cancelHandler)}hideSettingsPanel(){this._ModalManager.closeModal("settings_modal"+(this._preCourse?"_precourse":"")),this.api.model.touchMoveExceptions=[],this._$settingsWindow.hasClass("precourse")&&this.api.sendEvent({type:"precourseSettingsClosed"})}showSettingsHandler(t){var e;("showPreferencesMenu"===(null==(e=t.data)?void 0:e.type)||"langReady"===(null==(e=t.data)?void 0:e.type)&&this._preCourse)&&(this._$containerSource||(this._$containerSource=$("#settings-container").detach()),t={id:"settings_modal"+(this._preCourse?"_precourse":""),header:this.api.parseTokens("{tk_SettingsButtonText}"),content:this._$containerSource.html(),srcElement:"root",buttons:[{id:"pref_cancel",label:this.api.parseTokens("{tk_Cancel}"),callback:this.cancelHandler},{id:"pref_save",label:this.api.parseTokens("{tk_Submit}"),callback:this.submitHandler}],hasExit:!0,isFullScreen:!0,isAlert:!1,preventClickOutsideDismiss:!0,$launcher:$("#preferences-button-lg")},this._ModalManager.openModal(new a(t.id,t.header,t.content,t.srcElement,t.buttons,t.hasExit,t.$launcher,null,t.isFullScreen,t.isAlert,t.preventClickOutsideDismiss)),this._settings||(this._settings={},this._settings.lang=this._LanguageManager.currentLangId,this._settings.viewingMode=this._LaunchDataManager.launchInfo.preferences.viewingMode,this._settings.audio=this._LaunchDataManager.launchInfo.preferences.audio,this._settings.subtitles=this._LaunchDataManager.launchInfo.preferences.subtitles,this._settings.audioOptionHidden=this._ViewingModeManager.getAudioHiddenSetting(this._settings.viewingMode),this._settings.subtitleOptionHidden=this._ViewingModeManager.getSubtitleHiddenSetting(this._settings.viewingMode),this._settings.audioOptionDisabled=this._ViewingModeManager.getAudioDisabledSetting(this._settings.viewingMode),this._settings.subtitleOptionDisabled=this._ViewingModeManager.getSubtitleDisabledSetting(this._settings.viewingMode)),this.populateSettingsPanel(this._settings.lang,this._settings.viewingMode,!0),this.updateConfigurationOnLanguageSelection(this._settings.lang,this._settings.viewingMode),this._settings.viewingMode===i.VIEWING_MODE_TG?this.setTGMode():this.setMediaMode(this._settings),this._SettingsManager.firstPreferencesDisplay=!0)}populateSettingsPanel(t,e,i=!1){this._$audioRow=$("#settings-form-row-audio"),this._$subtitlesRow=$("#settings-form-row-subtitles"),this._$audioOptionOn=this._$audioRow.find('input[value="'+n.SETTING_VAL_ON+'"]'),this._$audioOptionOff=this._$audioRow.find('input[value="'+n.SETTING_VAL_OFF+'"]'),this._$subtitleOptionOn=this._$subtitlesRow.find('input[value="'+n.SETTING_VAL_ON+'"]'),this._$subtitleOptionOff=this._$subtitlesRow.find('input[value="'+n.SETTING_VAL_OFF+'"]'),i&&(this._currentViewingModes=this._ViewingModeManager.getDisplayViewingModes(t),this._$audioOptionOff.on("change",this.toggleAudioOff),this._$audioOptionOn.on("change",this.toggleAudioOn)),this.buildLanguageOptions(t),r.buildViewingModeOptions(this._currentViewingModes,e),this.setRowDisplays(),$("#settings-viewing-mode").find("select").change(this.viewingModeSelectHandler),$("#settings-language").find("select").change(this.languageSelectHandler),$(".modal-saig .settings-help-button").click(this.renderTooltip)}buildLanguageOptions(i){const s=this._LanguageManager.getDisplayLanguages().sort((t,e)=>t.transliteration.localeCompare(e.transliteration)),a=$("#languageSelector");_.isEmpty(a.children())||a.children().remove(),0===s.length?a.append(new Option(s[0].label,s[0].value,!0,!0)):$.each(s,t=>{var t=s[t],e=this.prepareLanguageOptionLabel(t.label,t.value);t.value===i?a.append(new Option(e,t.value,!0,!0)):a.append(new Option(e,t.value,!1,!1))})}setRowDisplays(){var t=$("#settings-language"),e=$("#settings-viewing-mode");this.setRowDisplay(n.SETTING_NAME_HIDE_LANGUAGE_SELECTOR,t),this.setRowDisplay(n.SETTING_NAME_HIDE_VIEWING_MODE_SELECTOR,e)}setRowDisplay(t,e){"true"===this._SettingsManager.getSettingValueGeneral(t)?e.addClass("hidden"):e.removeClass("hidden")}prepareLanguageOptionLabel(t,e){let i=t;return i=this.api.model.rtl&&"rtl"!==this._LanguageManager.langDefinitionsData[e].direction?r.decodeEntities(i.replace(/\)/g,")&#x200E;")):i}static decodeEntities(t){var e=document.createElement("textarea");return e.innerHTML=t,e.value}static buildViewingModeOptions(i,s){var a=$("#viewingModeSelector");let n=!1;0<a.children().length&&a.empty();for(let t=0,e=i.length;t<e;t++){var r=i[t];if(""===s)break;r.value===s?(a.append(new Option(r.label,r.value,!0,!0)),n=!0):a.append(new Option(r.label,r.value,!1,!1))}!1===n&&(a.append(new Option(i[0].label,i[0].value,!0,!0)),a.parent().find('a[data-value="'+i[0].value+'"]').click())}setTGMode(){var t=$("#settings-viewing-mode").find("select").val(),t=this._ViewingModeManager.getViewingModeObj(t).viewingMode;this._$audioOptionOn.attr("disabled","disabled").get(0).checked=!1,this._$audioOptionOff.attr("disabled",null).get(0).checked=!0,this._$subtitleOptionOn.attr("disabled",null).get(0).checked=!0,this._$subtitleOptionOff.attr("disabled","disabled").get(0).checked=!1,this.setRadioRowViewState(t),this.api.model.isMuted=!0}setMediaMode(t){var e=$("#settings-viewing-mode").find("select").val(),t=t||this._ViewingModeManager.getViewingModeObj(e).viewingMode,e=t.audio===n.SETTING_VAL_ON,i=t.audioOptionDisabled===n.SETTING_VAL_ON?"disabled":null,s=t.subtitles===n.SETTING_VAL_ON,a=t.subtitleOptionDisabled===n.SETTING_VAL_ON?"disabled":null;this._$audioOptionOn.attr("disabled",i).get(0).checked=e,this._$audioOptionOff.attr("disabled",i).get(0).checked=!e,this._$subtitleOptionOn.attr("disabled",a).get(0).checked=s,this._$subtitleOptionOff.attr("disabled",a||!e?"disabled":null).get(0).checked=!s,this.setRadioRowViewState(t),this.api.model.isMuted=!e}setRadioRowViewState(t){t.audioOptionHidden===n.SETTING_VAL_ON?this._$audioRow.hide():this._$audioRow.show(),t.subtitleOptionHidden===n.SETTING_VAL_ON?this._$subtitlesRow.hide():this._$subtitlesRow.show()}updateConfigurationOnLanguageSelection(t,e){var i,s=this._ViewingModeManager.explicitViewingModeSettings;return!(!s||!s[t]||(this._ViewingModeManager.createViewingModesForLang(t),s[t][e]?this.applyLanguageSpecificConfiguration(s[t][e]):(i=this._ViewingModeManager.getDisplayViewingModes(t),s[t][i[0].value]?this.applyLanguageSpecificConfiguration(s[t][i[0].value]):r.buildViewingModeOptions(this._ViewingModeManager.getDisplayViewingModes(t),e)),0))}applyLanguageSpecificConfiguration(t){r.buildViewingModeOptions(this._ViewingModeManager.getDisplayViewingModes(t.lang),t.viewingMode),t.viewingMode===i.VIEWING_MODE_TG?this.setTGMode():this.setMediaMode(t),this.setRadioRowViewState(t)}static generateTooltipText(...i){let s="";for(let t=0,e=i.length;t<e;t++){var a=i[t];s+="<div class='tooltip-body-content-block'>"+a+"</div>"}return s}fetchTooltipHeader(t){switch(t){case"language":return this.api.parseTokens("{tk_LangTTHeader}");case"viewing":return this._ViewingModeManager.getTooltipTextHeader();case"audio":return this.api.parseTokens("{tk_AudioTTHeader}");case"subtitles":return this.api.parseTokens("{tk_SubtitleTTHeader}")}return""}fetchTooltipBody(t){var e=$("#languageSelector").val();const i=this._ViewingModeManager.getDisplayViewingModes(e);switch(t){case"language":return r.generateTooltipText(this.api.parseTokens("{tk_LangTT}"));case"viewing":{const s=[this._ViewingModeManager.getTooltipTextIntro()];return $(i).each(t=>{t=$(i).eq(t).attr("value");s.push(this._ViewingModeManager.getViewingModeTooltipText(t))}),r.generateTooltipText.apply(this,s)}case"audio":return r.generateTooltipText(this.api.parseTokens("{tk_AudioTT}"));case"subtitles":return r.generateTooltipText(this.api.parseTokens("{tk_SubtitleTT}"))}return""}}t.SettingsPanel=r}(GLEPlugins=GLEPlugins||{}),function(t){var i=GLECore.ModalManager,s=GLECore.ViewingModeManager;class a extends t.AbstractZone{constructor(t,e=!0){super(t),this._trackingEnabled=e,this._totalSlides=0,this._highwater=0,this._captions=[],this._mediaMode=!0,this._templateID="",this.setPlayerDimension=()=>{let t=this._referenceImage.width,e="";var i,s=this._$carousel.find("#carousel-image-width");t<a.IMAGE_MIN?(t=a.IMAGE_MIN,e=`min-width: ${a.IMAGE_MIN}px;`):t>a.IMAGE_MAX&&(t=a.IMAGE_MAX,e=`max-width: ${a.IMAGE_MAX}px;`),this._allowScale?(i=`@media only screen and (min-width: 62rem) { ${this._bodySelector} #carousel-feature-area { ${e} }} `,i=(i=(i+=`@media only screen and (min-width: 62rem) { ${this._bodySelector} #carousel-progress-meter { ${e} }} `)+`@media only screen and (min-width: 62rem) { ${this._bodySelector} #carousel-subtitle-area { ${e} }} `)+`@media only screen and (min-width: 62rem) { ${this._bodySelector} .carousel-header { ${e} }} `,s.text(i)):(i=`@media only screen and (min-width: 62rem) { ${this._bodySelector} #carousel-feature-area {width: `+t+"px;}} ",i=(i=(i+=`@media only screen and (min-width: 62rem) { ${this._bodySelector} #carousel-progress-meter {width: `+t+"px;}} ")+`@media only screen and (min-width: 62rem) { ${this._bodySelector} #carousel-subtitle-area {width: `+t+"px;}} ")+`@media only screen and (min-width: 62rem) { ${this._bodySelector} .carousel-header {width: `+t+"px;}} ",s.text(i))},this.updateSlidePositions=()=>{this._currentIndex===this._totalSlides&&this._videoContainer?this._videoContainer.onSlideshowComplete():this._$images.each(t=>{var e=this._$images.eq(t);t===this._currentIndex?e.removeClass("left right").addClass("center"):t<this._currentIndex?e.removeClass("center").addClass("left"):e.removeClass("center").addClass("right")})},this.apiEventHandler=t=>{t.data.type===i.MODAL_CLOSED&&this.api.getPreferences().viewingMode!==s.VIEWING_MODE_TG&&this._trackingEnabled&&(this._TrackingManager.setActivityStatus({status:"clearAll",activity:{id:"carousel",complete:!1,alert:this._data.attributes.activityAlertId}}),this.api.removeEvent("apiEvent",this.apiEventHandler),this.api.reloadCurrentPage())},this.advanceSlide=()=>{var t=this._videoContainer?this._totalSlides:this._totalSlides-1,t=(this._currentIndex<t&&(this._currentIndex++,this._highwater=Math.max(this._currentIndex,this._highwater),this.updateView()),this._currentIndex===this._totalSlides-1),t=t&&this._trackingEnabled&&!this._videoContainer;t&&this._isZone?this.setZoneComplete():t&&this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"carousel",complete:!0}})},this.rewindSlide=()=>{this._currentIndex===this._totalSlides&&this._videoContainer&&this._videoContainer.onSlideshowRewind(),0<this._currentIndex&&(this._currentIndex--,this.updateView())},this._TrackingManager=t.TrackingManager}set videoContainer(t){this._videoContainer=t}build(t,e){return super.build(t,e),this._captions=[],this._data=this.content.getChildrenOfType("Data")[0],this._tgOnly="true"===this._data.attributes.tgOnly,this._allowScale="true"===this._data.attributes.allowImageScale,this.configureMode(),this.buildContainer(),this.getHeader(),this._$container[0].outerHTML}enableTracking(){this._trackingEnabled=!0,1<this._totalSlides&&!this._isZone&&!this._videoContainer&&this._TrackingManager.setActivityStatus({status:"register",activity:{id:"carousel",complete:!1,alert:this._data.attributes.activityAlertId}})}getHeader(){var t=this.content.getFirstChildOfType("Header"),e=this._$container.find(".carousel-header");_.isEmpty(t)?e.addClass("hidden"):e.html(t.text)}configureMode(){this.content.attributes.src.match(/CarouselViewer/gim)?(this._mediaMode=!1,this._templateID=this._data.attributes.templateID):(this._mediaMode=!0,this._templateID=this._data.attributes.tgcontrols)}buildContainer(){var t=this.api.populate(null,this._templateID,this.content),i=this.content.getChildrenLike("type",/((line)|(bullet))/gim,!1),s=this.content.getChildByAttribute("id","txtCC");let a=null;s&&(a=s.text.split("<bbr/>").filter(t=>0<t.length));var n=i.filter(t=>t.attributes.src||t.attributes.image).map(t=>t.attributes.src||t.attributes.image)[0],t=(this._template=t.template,this._$container=$(t.content),this._totalSlides=i.length,this._currentIndex=0,_.template(this.api.getTemplate("CarouselImage").content)),r={slides:[]};for(let t=0,e=this._totalSlides;t<e;t++){var o=i[t],l="Bullet"===o.type,o={url:this.api.parseTokens(o.attributes.image||o.attributes.src),alt:_.isEmpty(o.attributes.description)?null:this.api.parseTokens(o.attributes.description),text:o.text,overlay:l?o.text:null,reference:l?n:null};l&&(o.text=_.isEmpty(s)?null:a[t]),r.slides.push(o),this._captions.push(o)}this._$container.find("#carousel-image-container").append(t(r)),this._allowScale&&this._$container.addClass("scale")}program(t){super.program(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} #carousel`:"#carousel",this._$carousel=$(this._bodySelector),this._$images=this._$carousel.find(".carousel-image"),this._$carousel.append("<style id='carousel-width' />"),this._referenceImage=new Image,this._referenceImage.onload=this.setPlayerDimension,this._referenceImage.src=this._$carousel.find("#carousel-image-container .img").eq(0).attr("src"),this.programButtons(),this.updateView(),!this._tgOnly&&this._mediaMode&&this.api.addEvent("apiEvent",this.apiEventHandler),1<this._totalSlides&&!0===this._trackingEnabled&&!this._isZone&&!this._videoContainer&&this._TrackingManager.setActivityStatus({status:"register",activity:{id:"carousel",complete:!1,alert:this._data.attributes.activityAlertId}})}programButtons(){this._$leftButton=this._$carousel.find("#carousel-left-button"),this._$rightButton=this._$carousel.find("#carousel-right-button"),this._$rightButton.click(this.advanceSlide),this._$leftButton.click(this.rewindSlide)}updateView(){this.updateMeter(),this.updateCaption(),this.updateSlidePositions(),this.updateButtonState()}updateMeter(){var t,e;this._currentIndex!==this._totalSlides&&(t=this._$carousel.find("#carousel-width"),e=Math.min(this._highwater,this._totalSlides-1),t.text(this._bodySelector+" #carousel-feature-area #carousel-progress-meter:before {width: "+Math.round(100*(e+1)/this._totalSlides)+"%}"))}updateCaption(){var t;this._currentIndex===this._totalSlides?this._$carousel.find("#carousel-subtitle-area").html(""):(t=_.template(this.api.getTemplate("CarouselCaption").content)(this._captions[this._currentIndex]),this._$carousel.find("#carousel-subtitle-area").html(t))}updateButtonState(){var t=this._$rightButton,e=this._$leftButton;t.attr("disabled",null),e.attr("disabled",null),(!this._videoContainer&&this._currentIndex===this._totalSlides-1||this._videoContainer&&this._currentIndex===this._totalSlides)&&t.attr("disabled","disabled"),0===this._currentIndex&&e.attr("disabled","disabled")}destroy(){this.api.removeEvent("apiEvent",this.apiEventHandler),super.destroy()}}a.IMAGE_MIN=464,a.IMAGE_MAX=880,t.Slideshow=a}(GLEPlugins=GLEPlugins||{}),function(t){var o=GLECore.TrackingManager,a=GLECore.ModalData,i=GLECore.TimeUtil,l=GLECore.DataUtil;class r extends t.AbstractZone{get data(){return this._data}static initInteractionData(t,e,a,n){const r={n:e};e=$(t.sourceXML);let i=a?"_"+(n+1):"";var s=t.getFirstAncestorElementByName("Zone"),s=(_.isEmpty(s)||(i="_"+s.attributes.zoneID+i),r.id=l.standardizeId(t.getFirstAncestorElementByName("Page").attributes.pageID+i),r.type="sequencing",r.correct_responses=[{pattern:""}],r.long_correct_responses=[{pattern:""}],r.long_response_lookup={},a?"Response":"SortableItem"),s=(t.getAllDescendantsOfType(s).forEach((t,e)=>{var i=0===e?"":"[,]",s=e,e=o.generateShortIdentifier(n+1,e,t.text,a?"CA":"");r.correct_responses[0].pattern+=i+s,r.long_correct_responses[0].pattern+=i+e,r.long_response_lookup[s]=e}),a?"QuestionText":"Question"),s=e.find(s).text();return r.description=s.replace(/<[^>]+>/gim,"").substr(0,255),a||(t.getFirstChildOfType("Question").attributes.interactionID="0"),e.find("Question").attr("interactionID",0),o.addInteractionIdToSource(t,r.id),[r]}constructor(t,e){super(t),this._latencyTime=0,this._attitudinal=!1,this.processChild=(t,e)=>({id:e,text:t.text,order:parseInt(t.attributes.correctPosition,10)}),this.onPageScroll=()=>{this._$list.sortable("refreshPositions")},this.onSortStart=(t,e)=>{var i=e.placeholder,e=e.item;e.show().addClass("srt-item-source"),this._$list.sortable("refreshPositions"),i.height(e.outerHeight())},this.onSortStop=()=>{this._$list.find(".srt-item-source").removeClass("srt-item-source")},this.onKeyUp=t=>{var e=$(t.currentTarget),i="true"===e.attr("data-focused");-1!==["Enter"," ","]"].indexOf(t.key)?this.toggleItemSelection(e,!i):i&&-1!==["ArrowUp","ArrowDown"].indexOf(t.key)?this.moveItem(e,t.key):this._$list.find(".srt-item").attr("data-focused","false").attr("aria-selected","false")},this.onFormSubmit=t=>{t.preventDefault();t=this.evaluateResponse();-1!==this._maxAttempts&&this._numAttempts++,this._iTestable&&this._iTestableContinuous?($(this._scrollTarget).off("scroll",this.onPageScroll),this.trackInteractionCompletion(t),this._configuration.onQuestionSubmit(this._lastAnswer)):(this.showFeedback(t),this.trackActivityCompletion(t),this.trackInteractionCompletion(t))},this.onModalClose=()=>{this._ModalManager.closeModal(r.MODAL_ID)},this.onContinue=()=>{this._ModalManager.closeModal(r.MODAL_ID),!0===this._iTestable?($(this._scrollTarget).off("scroll",this.onPageScroll),this._configuration.onQuestionSubmit(this._lastAnswer)):this._isZone||this.api.callNextPage()},this._dependencies=t,this._configuration=e||{},this._ModalManager=t.ModalManager,this._TrackingManager=t.TrackingManager}build(t,e){super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0],this._items=this.content.getChildrenOfType("SortableItem").map(this.processChild),this._key=[...this._items],this._key.sort((t,e)=>t.order>e.order?1:-1),this._attitudinal="true"===this._data.attributes.attitudinal,this._maxAttempts=parseInt(this._data.attributes.numAttempts,10),this._numAttempts=0,this._iTestable="true"===this._data.attributes.itestable,this._iTestableContinuous="continuous"===this._data.attributes.flow,this._iTestableID=this._data.attributes.itestableID;var t=_.template(this.api.getTemplate(this._data.attributes.templateID).content),e=this.content.getFirstChildOfType("Header"),i=this.content.getChildByAttribute("id","gfx"),s=_.isEmpty(i)?null:i.attributes.src,a=_.isEmpty(i)||_.isEmpty(i.getFirstChildOfType("Description"))?"":i.getFirstChildOfType("Description").text,i=(this._hasImage=!_.isEmpty(i),{header:_.isEmpty(e)?"":e.text,question:this.content.getFirstChildOfType("Question").text,image:s,imageAltText:a,items:this._items,prompt:this.api.getPromptText(this.content.getFirstChildOfType("Prompt"),"{tk_SortablePrompt}")});return t(i)}program(t){super.program(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} .sortable-body`:".sortable-body",this._scrollTarget=this._isZone?".mz-body":".sortable-body",this.wireSortable(),this.wireAccessibility(),this.trackActivityInit(),this.setLatencyTimer(),$(this._bodySelector).find(".sortable-wrapper").addClass(this._hasImage?"hasimage":"noimage")}destroy(){clearInterval(this._latencyTimer),$(this._scrollTarget).off("scroll",this.onPageScroll),super.destroy()}setLatencyTimer(){clearInterval(this._latencyTimer),this._latencyTimer=window.setInterval(()=>{this._latencyTime++},1e3)}wireSortable(){this._$list=(this._iTestable?$(this.parent):$(this._bodySelector)).find(".srt-list"),this._$list.sortable({placeholder:"ui-placeholder",helper:"clone",tolerance:"pointer",start:this.onSortStart,stop:this.onSortStop}),this._$list.disableSelection(),$(this._scrollTarget).on("scroll",this.onPageScroll),$(this._bodySelector).find(".srt-form").submit(this.onFormSubmit)}wireAccessibility(){var t=this._$list.find(".srt-item");t.attr("data-focused","false"),t.attr("aria-selected","false"),t.on("keyup",this.onKeyUp)}toggleItemSelection(t,e){var i=this._$list.find(".srt-item");i.attr("data-focused","false"),i.attr("aria-selected","false"),t.attr("data-focused",e?"true":"false"),t.attr("aria-selected",e?"true":"false")}moveItem(t,e){var i=t.index(),s=this._$list.find(".srt-item").length-1;let a=this._$list.find(".srt-item"),n;e===r.RESPONSE_SORT_UP&&0<i?(n=a.eq(i-1),t.insertBefore(n)):e===r.RESPONSE_SORT_DOWN&&i<s&&(n=a.eq(i+1),t.insertAfter(n)),(a=this._$list.find(".srt-item")).each((t,e)=>{$(e).find(".accessible").html(this.api.parseTokens("{tk_SortablePosition}")+(t+1))}),t.focus()}evaluateResponse(){let i=!0;var t=this._$list.find(".srt-item");const s=[];let e;return t.each((t,e)=>{e=$(e).data("item-id");s.push(e),e!==this._key[t].id&&(i=!1)}),e=this._attitudinal?r.RESPONSE_NEUTRAL:i?r.RESPONSE_CORRECT:r.RESPONSE_INCORRECT,this._lastAnswer={correct:e,selection:t},e}buildReviewScreen(t,e,i,s,a){i=$(i.selection);const n=[];var r=_.template(this.api.getTemplate("SortableAssessmentReview").content),i=(i.each((t,e)=>{n.push({text:$(e).find(".srt-item-text").html()})}),{question:t.text,options:n,outcome:a,review:t.review[0].text});return r(i)}showFeedback(t){var e=!_.isEmpty(this.content.getChildByAttribute("id","fdbk-default")),i=this.renderHeader(t,e),s=this.renderFeedback(t,e),i={id:r.MODAL_ID,header:i,content:s,srcElement:"root",buttons:this.buildButtonArray(t),hasExit:!1,isFullScreen:!1,$launcher:this._$submit,exitCallback:this.onModalClose,isAlert:!1,preventClickOutsideDismiss:!0},s=new a(i.id,i.header,i.content,i.srcElement,i.buttons,i.hasExit,i.$launcher,null,i.isFullScreen,i.isAlert,i.preventClickOutsideDismiss,i.exitCallback);this._ModalManager.openModal(s,!0).addClass(e?r.RESPONSE_NEUTRAL:t)}renderHeader(t,e){return _.template(this.api.getTemplate("srt-modal-header").content)({text:this.api.parseTokens(r.getHeaderToken(t,e)),result:e?r.RESPONSE_NEUTRAL:t})}renderFeedback(t,e){var i=this.getFeedbackElement(t,e),s=i.getFirstChildOfType("FeedbackText").text,i=i.getFirstChildOfType("Image"),a=_.isEmpty(i)?null:i.attributes.src,i=_.isEmpty(i)?null:i.getFirstChildOfType("Description").text;return _.template(this.api.getTemplate("srt-modal-content").content)({content:s,image:a,imageAltText:i,showAnswers:this.showAnswers(t,e),items:this._key})}showAnswers(t,e){return!1===e&&t===r.RESPONSE_CORRECT||!1===e&&t===r.RESPONSE_INCORRECT&&this._numAttempts>=this._maxAttempts&&-1!==this._maxAttempts}static getHeaderToken(t,e){return!0===e||t===r.RESPONSE_NEUTRAL?"{tk_Feedback}":t===r.RESPONSE_CORRECT?"{tk_Correct}":"{tk_Incorrect}"}getFeedbackElement(t,e){return!0===e||t===r.RESPONSE_NEUTRAL?this.content.getChildByAttribute("id","fdbk-default"):t===r.RESPONSE_CORRECT?this.content.getChildByAttribute("id","fdbk-correct"):this.content.getChildByAttribute("id","fdbk-incorrect")}buildButtonArray(t){var e,i,s=new ModalButton("sortable-continue",this.api.parseTokens(this._isZone?"{tk_SortableModalClose}":"{tk_ContinueButton}"),this.onContinue.bind(this));return t===r.RESPONSE_NEUTRAL?(e="true"===this._data.attributes.showExploreOther,i=new ModalButton("sortable-edit",this.api.parseTokens("{tk_SortableExplore}"),this.onModalClose.bind(this)),e?[i,s]:[s]):t===r.RESPONSE_INCORRECT&&(this._numAttempts<this._maxAttempts||-1===this._maxAttempts)?[new ModalButton("sortable-try-again",this.api.parseTokens("{tk_TryAgain}"),this.onModalClose.bind(this))]:[s]}trackActivityInit(){this._configuration.iTestable||this._isZone||this._TrackingManager.setActivityStatus({status:"register",activity:{id:"sortable",complete:!1,alert:this._data.attributes.activityAlertId}})}trackActivityCompletion(t){if(!(t===r.RESPONSE_INCORRECT&&(this._numAttempts<this._maxAttempts||-1===this._maxAttempts)||this._configuration.iTestable))return this._isZone?this.setZoneComplete():void this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"sortable",complete:!0}})}trackInteractionCompletion(t){var e=$(this.content.sourceXML).attr("interactionID");this._TrackingManager.setScormInteraction({latency:i.formatLatencyTime(this._latencyTime),interactionID:e,responses:this.generateInteractionResponse(),result:t===r.RESPONSE_INCORRECT?"wrong":t}),clearInterval(this._latencyTimer)}generateInteractionResponse(){const i=[];return this._$list.find(".srt-item").each((t,e)=>{i.push($(e).data("item-id"))}),i}}r.RESPONSE_CORRECT="correct",r.RESPONSE_INCORRECT="incorrect",r.MODAL_ID="sortable-modal",r.RESPONSE_NEUTRAL="neutral",r.RESPONSE_SORT_UP="ArrowUp",r.RESPONSE_SORT_DOWN="ArrowDown",t.Sortable=r}(GLEPlugins=GLEPlugins||{}),function(t){var a=GLECore.StyleManager,i=GLECore.Trace,s=GLECore.DataUtil,r=GLECore.Platform;class o extends t.IPluggable{constructor(t){super(t),this._hasPageStyles=!1,this._selectorList=[],this.onApiEvent=t=>{!0===this._hasPageStyles&&"applyPageClasses"===t.data.type?this.applyPageClasses(this._lastClassSize):!0===this._hasPageStyles&&"writePageStyles"===t.data.type?this.updateCurrentPageStyles():!0===this._hasPageStyles&&"updateAllPSS"===t.data.type?(this.updateCurrentPageStyles(),this.applyPageClasses(this._lastClassSize)):"internalReset"===t.data.type&&(this.removeResizeListener(),this._hasPageStyles=!1,this._pageStyles=null)},this.onPageUpdate=()=>{var t=this.api.model.currentPage;this.removeResizeListener(),this.clearAllPageClasses(),this.clearStyleText(),this._templateStyleItems=this._StyleManager.getTemplateStyle(t.templateId),_.isEmpty(this._templateStyleItems)||(this._pageStyles=this._StyleManager.getStyleForPage(t.id),_.isEmpty(this._pageStyles)?this._hasPageStyles=!1:(this.addResizeListener(),this._hasPageStyles=!0,this._lastClassSize=this._currentMediaSize,this.writePageStyles(),this.applyPageClasses(this._lastClassSize)))},this.onWindowResize=()=>{var t=this.api.getMediaSize();t!==this._currentMediaSize&&(this.updateBreakpoint(),this.applyPageClasses(t))},this._StyleManager=t.StyleManager}build(t,e){return super.build(t,e),this._data=this.content.getFirstChildOfType("Data"),this._template=this.api.getTemplate(this._data.attributes.templateID),_.template(this._template.content)()}program(t){super.program(t),this._$styleContainer=$("style#PSSStyleContainer"),this.api.addEvent("pageUpdate",this.onPageUpdate),this.api.addEvent("apiEvent",this.onApiEvent)}destroy(){super.destroy(),this._selectorList=[]}updateCurrentPageStyles(){var t=this.api.model.currentPage;this._pageStyles=this._StyleManager.getStyleForPage(t.id),this.writePageStyles()}removeResizeListener(){$(window).off("resize",this.onWindowResize)}addResizeListener(){$(window).on("resize",this.onWindowResize),this.updateBreakpoint()}updateBreakpoint(){this._currentMediaSize=this.api.getMediaSize()}writePageStyles(){this.clearStyleText();let s="";_.each(this._pageStyles,t=>{if(!_.isEmpty(t.styles)&&!_.isEmpty(t.item)){const i=this.getTemplateStyle(t);i&&_.each(t.styles,(t,e)=>{s+=a.writeStrictMediaQuery(t,e,i.selector)})}}),this._$styleContainer.text(s)}clearStyleText(){this._$styleContainer.text("")}applyPageClasses(e){_.each(this._pageStyles,t=>{this.applyAccessibleImages(t),this.setPageClass(t,e)}),$("[data-style-applied]").attr("data-style-applied",null),this._lastClassSize=e}applyAccessibleImages(t){var e,i=this.getTemplateStyle(t);i&&(i=$(i.selector),_.isEmpty(i)||(i.find(".background-image-alt").remove(),t=t.itemReference.altText,_.isEmpty(t))||(e=this.api.getTemplate("AccessibleBackgroundImage"),e=_.template(e.content)({altText:t}),i.prepend(e)))}setPageClass(e,i){if(!_.isEmpty(e.classes)){var s=this.getTemplateStyle(e);if(s){this.clearPageClasses(s.selector);const a=o.trimPseudoClasses(s.selector);s=e.classes[r.DEVICE_MEDIA_SIZE_ALL]||[];let t=e.classes[i]||[];t=t.concat(s);const n=$(a);_.each(t,t=>{-1===this._selectorList.indexOf(a)&&this._selectorList.push(a),this.removeLikeClassName(n,t),$(a).addClass("pss-"+t).attr("data-style-applied","true")})}}}removeLikeClassName(t,e){if(e.match(/-hover/))return this.removeLikeHoverClassName(t,e);e.match(/-sel/)||(e=this._StyleManager.selectorMap["pss-"+e]||[],t.removeClass(e.join(" ")))}removeLikeHoverClassName(t,e){e=e.replace(/-hover/,""),e=(this._StyleManager.selectorMap["pss-"+e]||[]).map(t=>t+"-hover");t.removeClass(e.join(" "))}getTemplateStyle(t){var e;return t.zoneID?this.getTemplateZoneStyle(t):(e=this._StyleManager.getTemplateStyleByItem(this._templateStyleItems,t.item),_.isEmpty(e)?void i.warn("Style Plugin: Unsupported template style item "+t.item+" for page "+this.api.getCurrentPage().id):e)}getTemplateZoneStyle(t){var e=$(this.api.model.currentPage.xmlContainer.sourceXML).find(`Zone[zoneID="${t.zoneID}"]`).attr("templateID"),e=this._StyleManager.getTemplateStyle(e),e=this._StyleManager.getTemplateStyleByItem(e,t.item);if(!_.isEmpty(e))return"background"===(e=s.clone(e)).id&&(e.selector=""),e.selector=e.selector.match("modal")?".z"+t.zoneID+e.selector:`#z${t.zoneID} `+e.selector,e;i.warn("Style Plugin: Unsupported template style item "+t.item+" for page "+this.api.getCurrentPage().id+" and zone "+t.zoneID)}clearPageClasses(e){var t=$(e+':not([data-style-applied="true"])');this._selectorList=this._selectorList.filter(t=>t!==e),e.match(/:hover/i)?t.removeClass((t,e)=>(e.match(/(^|\s)pss-\S+-hover/g)||[]).join(" ")):t.removeClass((t,e)=>(e.match(/(^|\s)pss-\S+/g)||[]).join(" "))}static trimPseudoClasses(t){return t.replace(/:(?!(nth|not))\w+/g,"")}clearAllPageClasses(){this._selectorList.forEach(t=>this.clearPageClasses(t))}}t.Style=o}(GLEPlugins=GLEPlugins||{}),function(e){var s=GLECore.QAModeManager,a=GLECore.AlertData,n=GLECore.TimeUtil,l=GLECore.TrackingManager,i=GLECore.ModalData,d=GLECore.DataUtil;class r extends e.IPluggable{constructor(t){super(t),this._itemViewClassNames={},this._itemViewsForPage=[],this._templates={},this._surveyIsComplete=!1,this._keyIsDepressed=!1,this._currentPageIndex=0,this._interactionCollection=[],this.confirmItemInView=t=>{var e,i,s,a;!1===this._keyIsDepressed||(t=$(t.currentTarget).parent(),e=this._$surveyPageContents.closest(".modal-content-saig"),a=t.offset(),t=t.height(),i=e.offset(),s=e.height(),(a=e.scrollTop()+a.top+t-(i.top+s))<0)||e.scrollTop(a)},this.onRequiredLinkClick=t=>{var t=$(t.currentTarget).data("required-id"),e=this._conditionalLinks.indexOf(t),t=this._requiredLinks.indexOf(t);-1!==e&&this._conditionalLinks.splice(e,1),-1!==t&&this._requiredLinks.splice(t,1),!this._requiredLinks.length&&this._answerStorage.surveyCompleted&&this.trackCompletion()},this.filterActiveRequiredLinks=t=>-1!==this._conditionalLinks.indexOf(t),this.convertSurveyPage=t=>new e.SurveyPageModel($(t.sourceXML),this._data,this._answerStorage),this.setCurrentPageFlow=()=>{var t,e=this._pageFlow.map(t=>t.id);this._triggeredPages=[];for(const i in this._answerStorage.answers)Object.prototype.hasOwnProperty.call(this._answerStorage.answers,i)&&0<=(t=e.indexOf(i))&&t<=this._currentPageIndex&&this._answerStorage.answers[i].forEach(this.concatenateTriggeredPages);this._pageFlow=this._surveyPages.filter(this.filterCurrentPages),this._currentPageIndex=this._pageFlow.indexOf(this._currentSurveyPage),this._pageFlow[this._pageFlow.length-1].surveyCompleted=!0,this._answerStorage.pageFlow=this._pageFlow},this.concatenateTriggeredPages=t=>{this._triggeredPages=this._triggeredPages.concat(this.getPagesTriggeredBySelections(t.availableOptions,t.selectedOptionIds))},this.renderCurrentPage=()=>{if(this._currentSurveyPage=this._currentPageIndex>=this._pageFlow.length?null:this._pageFlow[this._currentPageIndex],!this._currentSurveyPage)return $(".survey-state-view").addClass("complete"),this._ModalManager.closeModal(r.SURVEY_MODAL_ID);this.displaySurveyPage(),this.setLatencyTimer()},this.defineInteraction=t=>{var e=this.getResponseType(t);return{latency:n.formatLatencyTime(t.latency),interactionID:t.interactionId,responses:t.selectedOptionIds,responseText:t.answerText,result:e}},this.generateGUIDs=t=>{const e=this.api.model.currentPage.id+"_"+t.id+"_",i=t.items;i.forEach(t=>{t.id=t.data.general.itemId=e+(i.indexOf(t)+1),t.data.options.forEach(t=>{t.optionId=t.interactionId})})},this.filterCurrentPages=t=>!(!(t.surveyCompleted=!1)!==s.QA_PROFILING_DISABLED&&-1!==this._triggers.indexOf(t.id)&&-1===this._triggeredPages.indexOf(t.id)),this.launchSurveyModal=()=>{var t=this.api.getTemplate("p_survey_modal"),t=_.template(t.content),e=this.content.parent.getChildByAttribute("id","prompt"),t={id:r.SURVEY_MODAL_ID,header:this.getHeaderText(),content:t({prompt:e?e.text:""}),srcElement:"root",buttons:[{id:"survey-previous",label:this.api.parseTokens("{tk_SurveyPreviousButton}"),callback:this.onBackButtonSelected.bind(this)},{id:"survey-continue",label:this.api.parseTokens("{tk_SurveyNextButton}"),callback:this.onSubmitButtonSelected.bind(this)},{id:"survey-submit",label:this.api.parseTokens("{tk_Submit}"),callback:this.onSubmitButtonSelected.bind(this)}],hasExit:!0,isFullScreen:!1,$launcher:this._$launcherButton,exitCallback:this.onExitSurvey,isAlert:!1,preventClickOutsideDismiss:!0},e=new i(t.id,t.header,t.content,t.srcElement,t.buttons,t.hasExit,t.$launcher,null,t.isFullScreen,t.isAlert,t.preventClickOutsideDismiss,t.exitCallback);this._$modal=this._ModalManager.preBuildModal(e,!0),this._ModalManager.openModal(e,!0),this.wireSurvey()},this.overrideFormSubmission=t=>{t.preventDefault()},this.onSetCurrentSurveyPage=t=>{var e={id:r.SURVEY_MODAL_NAV_CONFIRMATION_ID,buttons:this._AlertManager.generateYesNoAlertButtons(r.SURVEY_MODAL_NAV_CONFIRMATION_ID,()=>this.onModalNavConfirm(t)),content:this.api.parseTokens("{tk_SurveyNavigationPrompt}")};this._AlertManager.showAlert(new a(e))},this.onModalNavConfirm=t=>{this._currentSurveyPage=t,this._currentPageIndex=this._pageFlow.indexOf(t),this._AlertManager.closeAlert(r.SURVEY_MODAL_NAV_CONFIRMATION_ID),this.changeSurveyPage(r.SERVICE_CALL_TYPE_CURRENT)},this.onBackButtonSelected=()=>{this.changeSurveyPage(r.SERVICE_CALL_TYPE_BACK)},this.onSubmitButtonSelected=()=>{this.changeSurveyPage(r.SERVICE_CALL_TYPE_SUBMIT)},this.onExitSurvey=(t,e)=>{var i=this.preventSurveyExit();_.isEmpty(i)?this._ModalManager.closeModal(e):(e={id:r.SURVEY_MODAL_CONFIRMATION_ID,buttons:this._AlertManager.generateYesNoAlertButtons(e,this.onModalExitConfirm),content:i},this._AlertManager.showAlert(new a(e)))},this.onModalExitConfirm=()=>{this._ModalManager.closeModal(r.SURVEY_MODAL_CONFIRMATION_ID),this._ModalManager.closeModal(r.SURVEY_MODAL_ID)},this._LanguageManager=t.LanguageManager,this._ModalManager=t.ModalManager,this._AlertManager=t.AlertManager,this._ContentManager=t.ContentManager,this._TrackingManager=t.TrackingManager}static initInteractionData(t,i){const s=[];return s.push(r.initMetaInteractionData(t,i)),t.getAllDescendantsOfType("item").filter(t=>"Message"!==t.attributes.type&&"Summary"!==t.attributes.type).forEach((t,e)=>{s.push(r.initQuestionInteractionData(t,i+1+e))}),s}static initMetaInteractionData(t,e){var e={n:e},i=$(t.sourceXML),s=i.closest("Page").attr("pageID");return e.description=i.find("Data").attr("surveyName"),e.id=d.standardizeId(s),e.type="numeric",e.correct_responses=[{pattern:"0[:]100"}],l.addInteractionIdToSource(t,e.id),e}static initQuestionInteractionData(t,e){const a={n:e};e=$(t.sourceXML);const n=this.getFilteredSurveyItemPosition(t)+1;var i=e.closest("Page").attr("pageID"),s=e.find("texts").text(),e=e.find("appearanceData").attr("DisplayNumber");const r=_.isEmpty(e)?"":"_"+e,o=(a.description=s.replace(/<[^>]+>/gim,"").substr(0,255),t.parent.attributes.id);return a.id=d.standardizeId(i+"_"+o+"_"+n)+r,a.type=this.getSurveyInteractionType(t.attributes.type),a.correct_responses=[],a.long_correct_responses=[{pattern:"{order_matters=false}"}],a.long_response_lookup={},t.getAllDescendantsOfType("listOption").forEach((t,e)=>{var i="S"+d.standardizeNumber(o)+"_",s=d.standardizeNumber(n)+r;a.long_response_lookup[e]=l.generateShortIdentifier(s,e,t.getFirstChildOfType("text").text,i),t.attributes.interactionID=e.toString(),$(t.sourceXML).attr("interactionID",e)}),l.addInteractionIdToSource(t,a.id),a}static getSurveyInteractionType(t){return t.match(/text/gim)?"fill-in":t.match(/scale/gim)?"likert":"choice"}static getFilteredSurveyItemPosition(t){return t.parent.children.filter(this.filterReportableSurveyItems).indexOf(t)}static filterReportableSurveyItems(t){return!("Message"===t.attributes.type||"Summary"===t.attributes.type)}static buildClassRef(t,e,...i){return new(Object.create(e[t].prototype).constructor)(...i)}static createNewStorageData(){return{surveyCompleted:!1,pageFlow:[],answers:{}}}build(t,e){super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0],this._template=this.api.getTemplate(this._data.attributes.templateID),this.addItemClassNames(),this.buildTemplates();e=_.template(this._template.content)();return this._answerStorage=r.ANSWER_STORAGE[this.api.model.currentPage.id],this._answerStorage&&!0!==s.QA_TRACKING_MODE_DISABLED||(this._answerStorage=r.ANSWER_STORAGE[this.api.model.currentPage.id]=r.createNewStorageData()),this._surveyPages=t.getChildrenOfType("surveypage").map(this.convertSurveyPage),this._surveyPages.forEach(this.generateGUIDs),this._triggers=this.fetchTriggers(),this._pageFlow=this._surveyPages,this._currentSurveyPage=this._pageFlow[0],this._currentPageId=this.api.getCurrentPage().id,this._conditionalLinks=this._ContentManager.conditionalLinkLookup[this._currentPageId]||[],this._allowSurveyRetake="true"===this._data.attributes.allowSurveyRetake||!0===s.QA_TRACKING_MODE_DISABLED,e}addItemClassNames(){this._itemViewClassNames[r.OBJECT_TYPE_MESSAGE]=r.CLASSNAME_MESSAGE,this._itemViewClassNames[r.OBJECT_TYPE_SCALE]=r.CLASSNAME_SCALE,this._itemViewClassNames[r.OBJECT_TYPE_RADIO]=r.CLASSNAME_RADIO,this._itemViewClassNames[r.OBJECT_TYPE_CHECKBOX]=r.CLASSNAME_CHECKBOX,this._itemViewClassNames[r.OBJECT_TYPE_DROPDOWN]=r.CLASSNAME_DROPDOWN,this._itemViewClassNames[r.OBJECT_TYPE_MULTI_LINE]=r.CLASSNAME_MULTI_LINE,this._itemViewClassNames[r.OBJECT_TYPE_SINGLE_LINE]=r.CLASSNAME_SINGLE_LINE,this._itemViewClassNames[r.OBJECT_TYPE_SUMMARY]=r.CLASSNAME_SUMMARY,this._itemViewClassNames[r.OBJECT_TYPE_CERTIFICATION]=r.CLASSNAME_CERTIFICATION}buildTemplates(){for(const e in this._itemViewClassNames){var t;Object.prototype.hasOwnProperty.call(this._itemViewClassNames,e)&&(t=this._itemViewClassNames[e],t=this.api.getTemplate(t),this._templates[e]=t.content)}}program(t){super.program(t),this.initTracking(),this.preventRetake()?this.restoreCompletionState():(this.setLaunchPrompt(),this.wireLaunchPage()),$(".survey-page-preloader").addClass("hidden")}initTracking(){"true"===this._data.attributes.requiredToComplete.toLowerCase()&&this._TrackingManager.setActivityStatus({status:"register",activity:{id:"survey",complete:!1,alert:this._data.attributes.activityAlertId}})}trackCompletion(){"true"===this._data.attributes.requiredToComplete.toLowerCase()&&this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"survey",complete:!0}})}preventRetake(){return!this._allowSurveyRetake&&(!0===this._answerStorage.surveyCompleted||!0===this.api.getCurrentPage().complete)}restoreCompletionState(){this.setCurrentPageFlow(),this._currentPageIndex=this._pageFlow.length-1,this._currentSurveyPage=this._pageFlow[this._currentPageIndex],this.renderCurrentPage()}setLaunchPrompt(){var t=$(".survey-launch-text");""===t.html()&&t.html(this.api.parseTokens("{tk_SurveyLaunchPrompt}"))}wireLaunchPage(){$("#survey-landing-screen").addClass("ready"),this._$launcherButton=$(".survey-launch-button"),this._$launcherButton.click(this.launchSurveyModal)}wireSurvey(){this._$modalQuestionContainer=this._$modal.find(".survey-container"),this._$backButton=this._$modal.find("#survey-previous-button").addClass("survey-footer-button previous"),this._$continueButton=this._$modal.find("#survey-continue-button").addClass("survey-footer-button next"),this._$submitButton=this._$modal.find("#survey-submit-button").addClass("survey-footer-button submit"),this._$surveyPageContents=this._$modalQuestionContainer,this._$modalQuestionContainer.on("submit",this.overrideFormSubmission),this.changeSurveyPage(r.SERVICE_CALL_TYPE_CURRENT)}changeSurveyPage(t){$(".modal-saig[data-id='survey']").find(".modal-content-saig").scrollTop(0);let e=[];var i;return t!==r.SERVICE_CALL_TYPE_NEXT&&t!==r.SERVICE_CALL_TYPE_BACK&&t!==r.SERVICE_CALL_TYPE_SUBMIT||(e=this.encodeSelections()),t===r.SERVICE_CALL_TYPE_CURRENT?this.renderCurrentPage():(i=this.gatherValidationErrors(this._currentSurveyPage.items,e),!0===s.QA_PROFILING_DISABLED||_.isEmpty(i)||t===r.SERVICE_CALL_TYPE_BACK?!0!==s.QA_PROFILING_DISABLED&&0<this._requiredLinks.length&&t!==r.SERVICE_CALL_TYPE_BACK?this.showRequiredLinkAlert():(this.saveResponses(e),this.setCurrentPageFlow(),t===r.SERVICE_CALL_TYPE_BACK?this._currentPageIndex--:this._currentPageIndex++,void this.renderCurrentPage()):this.showValidationErrorAlert(i))}showValidationErrorAlert(t){if(!_.isEmpty(t)){let s="";const a=(this.api.getTemplate("SurveyValidationError").content||"").replace(/<Number[^>]+>/gim,"{{= number }}");$.each(t,(t,e)=>{var i=_.template(a);s+=i(e)}),this._currentSurveyPage&&(this._currentSurveyPage.selectionMade=!0),this.showErrorAlertModal(s)}}showErrorAlertModal(t){t={id:r.SURVEY_MODAL_ERROR_ID,header:"{tk_ValidationErrorHeader}",content:t};this._AlertManager.showAlert(new a(t))}preventSurveyExit(){return this.api.parseTokens("{tk_SurveyEarlyExitAlert}")}encodeSelections(){var e=[],i=Math.ceil(this._currentSurveyPage.latency/this._itemViewsForPage.length);for(let t=0;t<this._itemViewsForPage.length;t++){var s=this._itemViewsForPage[t],a=s.getUsersChoices();_.isEmpty(s.model.data.general.interactionId)||e.push({interactionId:s.model.data.general.interactionId,itemId:s.model.id,selectedOptionIds:a,latency:i,availableOptions:s.model.data.options,answerText:s.getAnswerText(),item:s.model})}return e}displaySurveyPage(){var t,e;this.createItemViewsForPage(this._currentSurveyPage),this.updateAnswerStore(this._currentSurveyPage),!0===this.handleSurveyCompletionActions(!0)?(t=$(".survey-completion-screen"),e=!this.processRequiredLinks(t),this._answerStorage.surveyCompleted=!0,this._ModalManager.closeModal(r.SURVEY_MODAL_ID),this.trackInteractionCompletion(),!0==e?this.trackCompletion():this.updateTrackingManager(t)):(_.isNull(this._$surveyPageContents)||this._$surveyPageContents.html(this.buildSurveyPageHTML()),this.wireUIClickHandlers(),this.wireFocusHandlers(),this.setButtonDisplay(),this.processRequiredLinks(this._$surveyPageContents))}updateAnswerStore(e){var i=e.items;for(let t=0;t<i.length;t++)i[t].answerStore=this.fetchAnswersForItemOnPage(i[t].id,e.id)}updateTrackingManager(t){this._ContentManager.updateRequiredLinkLookup(this._currentPageId,this._requiredLinks),this.api.sendEvent({destination:"RequiredLinks",type:"RequiredLink",$container:t,currentPage:this.api.getCurrentPage()})}createItemViewsForPage(t){var e=t.items;this._itemViewsForPage=[];for(let t=0;t<e.length;t++){var i=e[t],s=i.type,s=r.buildClassRef(this._itemViewClassNames[s],window.GLEPlugins,i,this.api,this.onSetCurrentSurveyPage);i.view=s,this._itemViewsForPage.push(s)}}handleSurveyCompletionActions(t){return this._surveyIsComplete=this._currentSurveyPage.surveyCompleted,!!this._surveyIsComplete&&($(".survey-completion-text").html(this.buildSurveyPageHTML()),$(".survey-state-view").addClass("complete"),$("#survey-landing-screen").removeClass("ready"),!0!==t&&this.trackCompletion(),!0)}buildSurveyPageHTML(){let e="";for(let t=0;t<this._itemViewsForPage.length;t++){var i=this._itemViewsForPage[t],i=this._templates[i.model.type];e+=this._itemViewsForPage[t].build(i)}return e}wireUIClickHandlers(){for(let t=0;t<this._itemViewsForPage.length;t++)this._itemViewsForPage[t].wireUIClickHandlers(this._$surveyPageContents)}wireFocusHandlers(){this._$surveyPageContents.on("keydown",()=>{this._keyIsDepressed=!0}),this._$surveyPageContents.on("keyup",()=>{this._keyIsDepressed=!1}),this._$surveyPageContents.find("input").focus(this.confirmItemInView)}setButtonDisplay(){this.canNavigateBackwards()?this._$backButton.attr("disabled",null):this._$backButton.attr("disabled","disabled"),this._currentSurveyPage.surveyCompleted?this._$continueButton.addClass("hidden"):this.completeOnNext()?(this._$continueButton.addClass("hidden"),this._$submitButton.removeClass("hidden")):(this._$continueButton.removeClass("hidden"),this._$submitButton.addClass("hidden"))}processRequiredLinks(e){var t=e.find("a[data-required-id]");const i=[];return this._requiredLinks=[],$.each(t,(t,e)=>{i.push($(e).data("required-id"))}),this._requiredLinks=i.filter(this.filterActiveRequiredLinks),_.each(this._requiredLinks,t=>{e.find('a[data-required-id="'+t+'"]').click(this.onRequiredLinkClick)}),!!this._requiredLinks.length}showRequiredLinkAlert(){var t={id:r.SURVEY_MODAL_REQUIRED_LINK_ID,buttons:[],content:"{tk_altRequiredLink}"};this._AlertManager.showAlert(new a(t))}gatherValidationErrors(e,i){var s=[];for(let t=0;t<e.length;t++){var a=e[t],n=this.itemIsInvalid(a,i);_.isEmpty(n)||((a={item:a,number:"Certification"===a.type?null:a.data.appearance.displayNumber,errors:[]}).errors.push(n),s.push(a))}return s}destroy(){super.destroy(),this._templates={},this._$surveyPageContents=null,this._currentSurveyPage=null,this._itemViewsForPage=[],!0===this._allowSurveyRetake&&(this._answerStorage=r.ANSWER_STORAGE[this._currentPageId]=r.createNewStorageData()),this._currentPageIndex=0,this._pageFlow=null,clearInterval(this._latencyTimer),$("html").removeClass("survey-summary-view")}saveResponses(t){this._answerStorage.answers[this._currentSurveyPage.id]=t}trackInteractionCompletion(){let t=0;this.cleanupAnswerStorage();for(const s in this._answerStorage.answers)if(Object.prototype.hasOwnProperty.call(this._answerStorage.answers,s)){var i=this._answerStorage.answers[s];let e=0;_.isEmpty(i)||(i.forEach(t=>{e+=t.latency,this._interactionCollection.push(this.defineInteraction(t))}),t+=e)}this.generateMetaInteraction(t),this.saveInteractions()}cleanupAnswerStorage(){const e=this._pageFlow.map(t=>t.id);_.each(this._surveyPages,t=>{-1!==e.indexOf(t.id)||!this._answerStorage.answers[t.id]||delete this._answerStorage.answers[t.id]})}generateMetaInteraction(t){var e=this.api.model.currentPage.id,i=this._interactionCollection.filter(t=>"incorrect"===t.result).length,s=this._interactionCollection.length,i=Math.round(100*(s-i)/s),s={latency:n.formatLatencyTime(t),interactionID:d.standardizeId(e),responses:[i.toString()],responseText:"",result:100===i?"correct":"incorrect"};this._interactionCollection.push(s)}getResponseType(t){var e=t.availableOptions;const i=t.selectedOptionIds,s=e.filter(t=>!0===t.preferred).map(t=>t.optionId);return s.length&&i.length?(t=i.filter(t=>-1===s.indexOf(t)),e=s.filter(t=>-1===i.indexOf(t)),t.length||e.length?r.RESPONSE_TYPE_INCORRECT:r.RESPONSE_TYPE_CORRECT):r.RESPONSE_TYPE_NEUTRAL}saveInteractions(){this._TrackingManager.batchSetInteractions({interactionCollection:this._interactionCollection})}setLatencyTimer(){clearInterval(this._latencyTimer),this._latencyTimer=window.setInterval(()=>{this._currentSurveyPage.latency++},1e3)}itemIsInvalid(i,s){for(let t=0,e=s.length;t<e;t++){var a=s[t];if(a.itemId===i.id&&(!0===i.data.general.answerRequired&&0===a.selectedOptionIds.length&&0===a.answerText.replace(/\s+/gim,"").length)){let t=i.view.itemUINameSpace;a="{er_Invalid_"+(t="Certification"===i.type?"crt":t)+"}";return this.api.parseTokens(a)}}return null}fetchAnswersForItemOnPage(i,t){var s=this._answerStorage.answers[t];if(s)for(let t=0,e=s.length;t<e;t++){var a=s[t];if(a.itemId===i)return a}return null}fetchTriggers(){let a=[];return this._surveyPages.forEach(i=>{const s=i.$xml.find("listOption[triggers]");s.each(t=>{const e=s.eq(t).attr("triggers").split(",");this._surveyPages.filter(t=>-1!==e.indexOf(t.id)).forEach(t=>{t.triggeringPages.push(i)}),a=a.concat(e)})}),a}getPagesTriggeredBySelections(t,e){let i=[];return t.forEach(t=>{-1!==e.indexOf(t.optionId)&&t.triggers&&(i=i.concat(t.triggers.split(",")))}),i}canNavigateBackwards(){return 0<this._currentPageIndex}completeOnNext(){return this._currentPageIndex===this._pageFlow.length-2&&this._pageFlow[this._currentPageIndex+1].surveyCompleted}getHeaderText(){var t=this.content.getChildrenOfType("Text")[0];return _.isEmpty(t)||"header"!==t.attributes.id?"":t.text}}r.ANSWER_STORAGE={},r.SURVEY_MODAL_NAV_CONFIRMATION_ID="survey-nav-confirmation",r.RESPONSE_TYPE_NEUTRAL="neutral",r.RESPONSE_TYPE_CORRECT="correct",r.RESPONSE_TYPE_INCORRECT="incorrect",r.CLASSNAME_SCALE="SurveyRadioScaleItem",r.CLASSNAME_MESSAGE="SurveyMessageItem",r.CLASSNAME_CHECKBOX="SurveyCheckboxSetItem",r.CLASSNAME_RADIO="SurveyRadioSetItem",r.CLASSNAME_DROPDOWN="SurveyDropDownListItem",r.CLASSNAME_MULTI_LINE="SurveyMultiLineTextItem",r.CLASSNAME_SINGLE_LINE="SurveySingleLineTextItem",r.CLASSNAME_CERTIFICATION="SurveyCertificationItem",r.CLASSNAME_SUMMARY="SurveySummaryItem",r.OBJECT_TYPE_SCALE="RadioButtonScale",r.OBJECT_TYPE_MESSAGE="Message",r.OBJECT_TYPE_CHECKBOX="Checkboxes",r.OBJECT_TYPE_RADIO="RadioButtons",r.OBJECT_TYPE_DROPDOWN="DropdownList",r.OBJECT_TYPE_MULTI_LINE="MultiLineText",r.OBJECT_TYPE_SINGLE_LINE="SingleLineText",r.OBJECT_TYPE_CERTIFICATION="Certification",r.OBJECT_TYPE_SUMMARY="Summary",r.SERVICE_CALL_TYPE_CURRENT="current",r.SERVICE_CALL_TYPE_NEXT="next",r.SERVICE_CALL_TYPE_BACK="back",r.SERVICE_CALL_TYPE_SUBMIT="submit",r.SURVEY_MODAL_ID="survey",r.SURVEY_MODAL_ERROR_ID="survey-error",r.SURVEY_MODAL_CONFIRMATION_ID="survey-confirmation",r.SURVEY_MODAL_REQUIRED_LINK_ID="survey-required-link-error",e.SurveyLocal=r}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.IPluggable{constructor(){super(...arguments),this.doRebuild=!1,this.swf=null}build(t,e){super.build(t,e);let i=this.content.attributes.src;i.match(/@/gim)?i=i.replace(/^.*?\.(\w+)$/gi,"$1"):i.match(/\.swf$/gim)&&(/(?:.*?)\/(\w+)\.swf$/gim.test(i),i=RegExp.$1);t=sai.PluginManager.isComponentPersistent(i),e=sai.PluginManager.persistentComponents[i];let s;var a=sai.PluginManager.lookupManifestDefinition(i,"dependencies");if(t&&e)this.doRebuild=!0,this.swf=e;else if(t){if(!(s=sai.PluginManager.lookupManifestDefinition(i,"classRef")))return"";this.swf=new s(a),sai.PluginManager.persistentComponents[i]=this.swf}else{if(!(s=sai.PluginManager.lookupManifestDefinition(i,"classRef")))return"";this.swf=new s(a)}return this.doRebuild?this.swf.rebuild(this.content,this.api):this.swf.build(this.content,this.api)}program(t){this.doRebuild?this.swf.reprogram():this.swf.program(t)}destroy(){this.swf.destroy()}}t.SWF=e}(GLEPlugins=GLEPlugins||{}),function(l){class t extends l.AbstractZone{constructor(t){super(t),this.onButtonClick=t=>{$(t.currentTarget).closest(".node").find(".node-trigger").click()},this.onItemActivate=t=>{var e=$(this._bodySelector+" .timeline-container"),t=$(t.currentTarget),i=t.closest(".node");const s=i.attr("id");var a=$(this._bodySelector).find(`.node:not(#${s})`),n=t.find(".accessible-text"),r=this._timeline.nodes.find(t=>t.id===s);s?(this._allowMultipleOpen||(this._$controls.attr("aria-describedby",null),a.addClass("collapsed"),a.find(".node-accordion").accordion({active:!1,animate:250})),r.complete=!0,i.toggleClass("collapsed"),t.attr("aria-describedby",t.attr("aria-controls")),n.attr("aria-hidden","false").html(this.api.parseTokens("{tk_TimelineItemIsComplete}")),e.find(".node-trigger").attr("tabindex","-1"),this._requiredToComplete&&this.checkCompletion()):this._$controls.attr("aria-describedby",null)},this.trackInit=()=>{this._requiredToComplete&&!this._isZone&&this._TrackingManager.setActivityStatus({status:"register",activity:{id:"timeline",complete:!1,alert:this._data.attributes.activityAlertId}})},this.trackCompletion=()=>{this._isZone?this.setZoneComplete():this._requiredToComplete&&this._TrackingManager.setActivityStatus({status:"complete",activity:{id:"timeline",complete:!0}})},this._TrackingManager=t.TrackingManager}build(t,e){super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0],this._timeline=this.buildTemplateContent(),this._requiredToComplete="true"===this._data.attributes.requiredToComplete,this._allowMultipleOpen="true"===this._data.attributes.allowMultipleOpen,this._expansionSpeed=1e3*parseFloat(this._data.attributes.expansionSpeed);t=this.api.getTemplate(this._data.attributes.templateID);return _.template(t.content)({timeline:this._timeline})}buildTemplateContent(){var t;return{header:null==(t=this.content.getFirstChildOfType("Header"))?void 0:t.text,footer:null==(t=this.content.getFirstChildOfType("Footer"))?void 0:t.text,nodes:this.content.getChildrenOfType("Node").map((t,e)=>{var e="node-"+(e+1),i=this.getImageData(t.getFirstChildOfType("Image")),s=null==(s=t.getChildByAttribute("id","label"))?void 0:s.text,a=null==(a=t.getChildByAttribute("id","content"))?void 0:a.text,n=this.getContentPosition(t,"label"),r=this.getContentPosition(t,"content"),t=this.getNodeLayout(t),o=i||a?l.TimelineNodeType.Expandable:l.TimelineNodeType.Static;return{id:e,label:s,image:i,text:a,labelPosition:n,contentPosition:r,layout:t,type:o,complete:o===l.TimelineNodeType.Static}})}}getImageData(t){return t?{src:t.attributes.src,alt:null!=(t=null==(t=t.getFirstChildOfType("Description"))?void 0:t.text)?t:""}:null}getContentPosition(t,e){var i=e+"Position",e=this._data.attributes[`default${e.substring(0,1).toUpperCase()+e.substring(1)}Position`];return t.attributes[i]||e}getNodeLayout(t){var e=t.getFirstChildOfType("Image"),i=null==(i=t.getChildByAttribute("id","content"))?void 0:i.text,t=t.attributes.layout;return e&&!i?l.TimelineNodeLayout.ImageOnly:!e&&i?l.TimelineNodeLayout.TextOnly:t||this._data.attributes.defaultLayout}program(t){super.program(t),this._bodySelector=this._isZone?`#${this._zoneData.zoneId} #Timeline-body`:"#Timeline-body",this.trackInit(),this.wireTimeline()}wireTimeline(){var t=$(this._bodySelector+" .timeline-container");this._$controls=$(this._bodySelector).find(".node-trigger"),$(this._bodySelector).find(".node-accordion").accordion({header:".node-trigger",active:!1,collapsible:!0,heightStyle:"content",beforeActivate:this.onItemActivate,activate:(t,e)=>{e.oldHeader.attr("aria-expanded","false")},animate:this._expansionSpeed}),t.find(".node-trigger").attr("tabindex","-1"),t.find(".node-button").click(this.onButtonClick)}checkCompletion(){this._timeline.nodes.some(t=>!t.complete)||this.trackCompletion()}}l.Timeline=t}(GLEPlugins=GLEPlugins||{}),function(t){var e=GLECore.KeyboardUtil,s=GLECore.AlertManager,a=GLECore.StateChangeAlert,n=GLECore.AlertData,i=GLECore.TooltipData;class r extends t.IPluggable{constructor(t){super(t),this.template=null,this.annobarHandler=()=>{this.api.sendEvent({type:r.SHOW_ANNOBAR_EVENT,$launcher_button:this._$annobarButton})},this.menuHandler=()=>{this.closeMobileMenu(),this.api.sendEvent({type:r.SHOW_MODALMENU_EVENT})},this.resourceHandler=()=>{this.closeMobileMenu(),this.api.sendEvent({type:r.SHOW_RESOURCES_EVENT,$launcher_button:this._$resourcesBtn})},this.preferencesHandler=()=>{this.closeMobileMenu(),this.api.sendEvent({type:r.SHOW_PREFERENCES_EVENT})},this.exitHandler=()=>{var t,e,i=this._AlertManager.getStateChangeAlert(a.CourseExit);_.isEmpty(i)?(e={id:t="modal_"+(e=s.ALERT_EXIT),content:"{tk_"+e+"}",buttons:this._AlertManager.generateYesNoAlertButtons(t,this.exitCallback),$launcher:this._$exitBtn,renderAsModalAlert:!1},this.closeMobileMenu(),this._AlertManager.showAlert(new n(e))):this._AlertManager.renderStateChangeAlert(i,()=>{this.exitCallback()})},this.exitCallback=()=>{this._TrackingManager.exitCourse()},this.toggleNavMenu=()=>{this.positionMobileMenu(),this._$toolbarContainer.toggleClass("open"),this._$toolbarContainer.hasClass("open")?(this._$modalMenuBtn.attr("aria-expanded","true"),e.disableRootTabs(),e.enableTabsOnTarget(this._$mobileMenuPanel)):(this._$modalMenuBtn.attr("aria-expanded","false"),e.enableRootTabs())},this.renderTooltip=t=>{t=$(t.currentTarget),t=new i(t.attr("id"),null,t.attr("aria-label"),"simple_tooltip",i.TOOLTIP_EFFECT_EXPAND,i.TOOLTIP_POSITION_BOTTOM_CENTER,i.TOOLTIP_DISMISS_MOUSEOUT,!0,"menu",t,null,null,null,!1);this.api.sendEvent({destination:"TooltipManager",type:"showTooltip",tooltip:t})},this.apiEventHandler=t=>{t.data&&("showAnnobarButton"===t.data.type?this.toggleAnnobarButton(t.data.show):"routeUpdate"===t.data.type?!1===this._RouteManager.profilingActive&&(this._useModalMenu&&this._$modalMenuBtn.show(),this._useResources)&&this._$resourcesBtn.show():"dismissMobileMenu"===t.data.type&&this._$toolbarContainer.hasClass("open")&&this.toggleNavMenu())},this._RouteManager=t.RouteManager,this._AlertManager=t.AlertManager,this._TrackingManager=t.TrackingManager}build(t,e){super.build(t,e),this._data=this.content.getChildrenOfType("Data")[0];t=this.api.populate($("#gle-toolbar").get()[0],this._data.attributes.templateID,this.content);return this.template=t.template,this.setupConfig(),this.buildLogo(),t.content}setupConfig(){this._useModalMenu="true"===this._data.attributes.useModalMenu,this._useResources="true"===this._data.attributes.useResources,this._usePreferences="true"===this._data.attributes.usePreferences,this._useExit="true"===this._data.attributes.useExit}buildLogo(){var t=this.api.model.content.getChildrenOfType("Chrome")[0];this._$logo=$(".toolbar-logo"),this._$logo.attr("src",t.children[0].attributes.src)}program(t){super.program(t),this._$toolbarContainer=$("#gle-toolbar"),this._$toolbar=$(".toolbar-menu"),this._$mobileMenuPanel=$(".mobile-nav-menu"),this.programButtons(),this.addEvents(),this.initProfiling()}programButtons(){this.programAnnoButton(),this.programMenuButton(),this.programResourcesButton(),this.programPreferencesButton(),this.programExitButton(),this._$mobileMenuBtn=$("#toolbar-menu-button"),this._$mobileMenuBtn.on("click",this.toggleNavMenu),this._$toolbar.find("button").on("mouseover focus",this.renderTooltip)}programAnnoButton(){this._$annobarButton=$("#toolbar-anno-button"),this._$annobarButton.on("click",this.annobarHandler)}programMenuButton(){this._$modalMenuBtn=$(".menu-button"),this._useModalMenu?this._$modalMenuBtn.on("click",this.menuHandler):this._$modalMenuBtn.hide()}programResourcesButton(){this._$resourcesBtn=$(".resources-button"),this._useResources?this._$resourcesBtn.on("click",this.resourceHandler):this._$resourcesBtn.hide()}programPreferencesButton(){this._$preferencesBtn=$(".preferences-button"),this._usePreferences?this._$preferencesBtn.on("click",this.preferencesHandler):this._$preferencesBtn.hide()}programExitButton(){this._$exitBtn=$(".exit-button"),this._useExit?this._$exitBtn.on("click",this.exitHandler):this._$exitBtn.hide()}addEvents(){this.api.addEvent("apiEvent",this.apiEventHandler)}closeMobileMenu(){this._$toolbarContainer.removeClass("open")}positionMobileMenu(){var t=this._$toolbar.height();this._$mobileMenuPanel.css({top:t+"px"})}initProfiling(){this._RouteManager&&this._RouteManager.profilingActive&&(this._$modalMenuBtn.hide(),this._$resourcesBtn.hide())}toggleAnnobarButton(t){t?this._$annobarButton.show():this._$annobarButton.hide()}}r.EXIT_REQUEST_EVENT="exitRequest",r.SHOW_PREFERENCES_EVENT="showPreferencesMenu",r.SHOW_MODALMENU_EVENT="showModalMenu",r.SHOW_RESOURCES_EVENT="showResourceMenu",r.SHOW_ANNOBAR_EVENT="showAnnobar",t.Toolbar=r}(GLEPlugins=GLEPlugins||{}),function(t){var l=GLECore.TooltipData,s=GLECore.Platform;class a extends t.IPluggable{constructor(t){super(t),this._tooltips=[],this.apiEventHandler=t=>{"showTooltip"===t.data.type&&this.showTooltip(t.data.tooltip)},this.onKeyDown=t=>{var e=$(".tooltip-close");"Tab"===t.key&&(t.preventDefault(),t.stopImmediatePropagation(),e.focus())},this.hideTooltip=t=>{var e=t.data.tooltip;switch(e.effect){case l.TOOLTIP_EFFECT_EXPAND:this.collapseTooltip(e);break;case l.TOOLTIP_EFFECT_FADE:this.fadeoutTooltip(e)}},this._ModalManager=t.ModalManager}build(t,e){return super.build(t,e),this._data=t.getChildrenOfType("Data")[0],this._html=this.buildContainer(),this._$rootElement=$("body"),this._html}buildContainer(){return this.api.populate(null,this._data.attributes.templateID,this.content).content}program(t){super.program(t),this.api.addEvent("apiEvent",this.apiEventHandler),this._$styles=$("#tooltip-dynamic-styles")}showTooltip(e){-1===_.findIndex(this._tooltips,t=>t.id===e.id)&&this.createTooltip(e)}createTooltip(t){var e=this.api.getDeviceType(),e=e===s.DEVICE_IOS||e===s.DEVICE_ANDROID;t.hideForMobile&&e||(this.populateTooltip(t),this.positionTooltip(t),this.programTooltip(t),this.renderTooltip(t))}populateTooltip(t){var e={id:"tooltip-"+t.id,header:t.header,body:t.content,effect:t.effect,extras:t.extraClasses},i=_.template(this.api.getTemplate(t.templateId).content),i=$(i(e));this.api.getDeviceType()===s.DEVICE_IOS&&"info_tooltip"===t.templateId&&i.attr("role","alert"),$("#tooltip-"+t.id).remove(),(t.$customParent||t.$target.parent()).append(i),t.$view=$("#tooltip-"+t.id),a.storeDerivedStyles(t),this._tooltips.push(t)}static storeDerivedStyles(t){var e=t.$view.css("transition");t.transitionSpeed=1e3*parseFloat(e.replace(/^all\s+(.*?)s.*?$/gim,"$1")),t.pointerWidthOuter=window.getComputedStyle(document.querySelector("#tooltip-"+t.id),":before").getPropertyValue("border-bottom-width"),t.pointerWidthInner=window.getComputedStyle(document.querySelector("#tooltip-"+t.id),":after").getPropertyValue("border-bottom-width")}positionTooltip(t){switch(t.position){case l.TOOLTIP_POSITION_BOTTOM_CENTER:this.positionBottomCenter(t);break;case l.TOOLTIP_POSITION_LEFT_CENTER:this.positionLeftCenter(t)}}positionLeftCenter(t){var e=t.$target,i=t.$customParent?e.offset():e.position(),s=t.$view,a=!0===this.api.model.rtl?i.left+e.outerWidth(!0):i.left-s.outerWidth(!0);let n=i.top+(e.outerHeight()/2-s.outerHeight()/2);"info_tooltip"===t.templateId&&(i=this._$rootElement.outerHeight(),e=Math.max(0,n),n=e+s.outerHeight()>i?0:e),this.clearDynamicStyles(t),this._$styles.append(".tooltip-"+t.id+" {top: "+n+"px; left: "+a+"px} ")}positionBottomCenter(t){var e=t.$target,i=e.position(),e=e.get(0).getBoundingClientRect(),s=i.top+e.height,a=t.$view;let n=i.left+e.width/2-a.outerWidth()/2;var r,i=this._$rootElement.outerWidth(),e=a.outerWidth(),o=n+e+l.TOOLTIP_HORIZONTAL_PADDING;n<l.TOOLTIP_HORIZONTAL_PADDING?(r=l.TOOLTIP_HORIZONTAL_PADDING-n,n=l.TOOLTIP_HORIZONTAL_PADDING,this._$styles.append("#tooltip-"+t.id+":before {left: calc(50% - "+t.pointerWidthOuter+" - "+r+"px);}\n"),this._$styles.append("#tooltip-"+t.id+":after {left: calc(50% - "+t.pointerWidthInner+" - "+r+"px);}")):i<o&&(r=i-o,n=i-e-l.TOOLTIP_HORIZONTAL_PADDING,this._$styles.append("#tooltip-"+t.id+":before {left: calc(50% - "+t.pointerWidthOuter+"px + "+r+"px);}\n"),this._$styles.append("#tooltip-"+t.id+":after {left: calc(50% - "+t.pointerWidthInner+"px + "+r+"px);}")),a.css("top",s+"px"),a.css("left",n+"px")}clearDynamicStyles(t){t=new RegExp("[#.]tooltip-"+t.id+".*?{.*?}","gim"),t=this._$styles.text().replace(t,"");this._$styles.text(t)}programTooltip(t){var e=t.$target;t.dismiss===l.TOOLTIP_DISMISS_MOUSEOUT?e.on("mouseleave blur",{tooltip:t},this.hideTooltip):this._$rootElement.off("click."+t.id).on("click."+t.id,{tooltip:t},this.hideTooltip),t.$customParent&&$(window).on("resize."+t.id,{tooltip:t},t=>this.positionTooltip(t.data.tooltip)),!0===t.trap&&this.trap()}trap(){$(document).on("keydown",this.onKeyDown)}untrap(){$(document).off("keydown",this.onKeyDown)}renderTooltip(t){const e=t.$view;switch(t.accessible||e.attr("aria-hidden","true").attr("role","presentation"),t.effect){case l.TOOLTIP_EFFECT_EXPAND:e.addClass("expanded"),setTimeout(()=>e.addClass("textready"),t.transitionSpeed);break;case l.TOOLTIP_EFFECT_FADE:e.addClass("fadein"),t.accessible&&!/iPad|iPhone|iPod/.test(navigator.userAgent)&&e.attr("tabindex","-1").focus()}t.creationCallback&&t.creationCallback(t)}collapseTooltip(t){const e=t.$view;e.addClass("hiding").removeClass("textready"),setTimeout(()=>e.removeClass("expanded"),t.transitionSpeed),setTimeout(()=>{this.removeTooltip(t)},2*t.transitionSpeed)}fadeoutTooltip(t){t.$view.addClass("hiding").removeClass("fadein"),setTimeout(()=>{this.removeTooltip(t)},t.transitionSpeed)}removeTooltip(t){t.$view.remove(),this.clearDynamicStyles(t),this._tooltips.splice(this._tooltips.indexOf(t),1),this.untrap(),t.dismiss===l.TOOLTIP_DISMISS_CLICK&&this._$rootElement.off("click."+t.id,this.hideTooltip),t.dismissCallback&&t.dismissCallback(t),t.$target&&t.accessible&&t.$target.focus()}}t.TooltipManager=a}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.IPluggable{constructor(){super(...arguments),this._touchSupported=!1}build(t,e){return super.build(t,e),this._touchSupported="ontouchstart"in document.documentElement,""}program(t){super.program(t),this._touchSupported&&((t=$("#page-container")).on("swipeleft",this.swipeHandler),t.on("swiperight",this.swipeHandler))}swipeHandler(t){t.preventDefault(),"swiperight"===t.type?this.api.callPreviousPage():"swipeleft"===t.type&&this.api.callNextPage()}}t.TouchManager=e}(GLEPlugins=GLEPlugins||{}),function(l){var e=GLECore.MagicButtonManager;class d{constructor(t,e,i,s,a,n){this._content=t,this._api=e,this._MagicButtonManager=i,this._dependencies=s,this._isZone=a,this._zoneId=n,this._matchAudioBulletInfo=[],this.apiEventHandler=t=>{"preferencesUpdate"===_.get(t,"data.type")&&("tg"===t.data.value.viewingMode?(d.unBindEvents(),this._MagicButtonManager.updateAllMagicButtonHtml(this._$matchAudioTGContent)):(this.bindEvents(),this._MagicButtonManager.updateAllMagicButtonHtml(this._$bulletContainer)))},this.onWindowResize=()=>{var t=$("#page-container"),e=$(this._bodySelector).find("#media-controls"),t=t.height()-e.height(),e=parseInt(this._$bigPicContainer.css("min-width"),10)/this._viewportRatio;let i=window.innerWidth,s=i/this._viewportRatio;s>t&&(i=t*this._viewportRatio,s=i/this._viewportRatio),this._$bigPicContainer.css("width",i),this._$bigPicContainer.css("height",Math.max(e,s)),l.MediaUtil.calculateCaptionPosition(this._$textCC),this._isZone&&this.calculateZoneMargin()},this._api.addEvent("apiEvent",this.apiEventHandler)}get $matchAudioTGContent(){return this._$matchAudioTGContent}get usingCarousel(){return!0===this._config.bpTGCarousel&&this._mode!==d.MATCH_AUDIO_MODE_BULLETS}get slideshow(){return this._slideshow}init(t){this._config=t,this._mode=this._config.matchAudioMode,this._tg=this._config.renderTG,this._bodySelector=this._config.bodySelector,this.initElements(),this.monitorImageLoad(),this.bindEvents(),this.buildTgMode(),this.configureBullets(),this.configureCCText()}initElements(){this._$bulletContainer=$(this._bodySelector).find("#"+this._config.matchTextTarget),this._$textCC=this._mode===d.MATCH_AUDIO_MODE_BULLETS?$(this._bodySelector).find(".captions-content"):$(this._bodySelector).find("#audio-captions"),this._$bigPicContainer=$(this._bodySelector).find(".bp-container"),this._$bigPicContinue=$(this._bodySelector).find("#txtContinue")}monitorImageLoad(){this._tg||this._$bigPicContainer.find("#gfx").on("load",()=>{this._viewportRatio=this._$bigPicContainer.width()/this._$bigPicContainer.height(),this.onWindowResize()})}bindEvents(){this._tg||$(window).resize(this.onWindowResize)}static unBindEvents(){$(window).off("resize")}calculateZoneMargin(){var t,e;this._mode===d.MATCH_AUDIO_MODE_BIG_PICTURE&&(t=this._$bigPicContainer.get(0).getBoundingClientRect(),e=this._$textCC.get(0).getBoundingClientRect(),e=Math.max(0,e.bottom-t.bottom),this._$bigPicContainer.css("marginBottom",e))}reset(){for(let t=0,e=this._matchAudioBulletInfo.length;t<e;t++)this._matchAudioBulletInfo[t].shown=!1;this._mode===d.MATCH_AUDIO_MODE_BIG_PICTURE&&this.hideOverlay(),this.clearBullets(),$(this._bodySelector).find(".match-audio-slide.first").addClass("reveal"),$(this._bodySelector).find(".match-audio-bullet.first").addClass("reveal")}buildTgMode(){this._$matchAudioTGContent=this._$bulletContainer.clone(),this._$matchAudioTGContent.attr("id",this._$bulletContainer.attr("id")+"-tg"),this._$matchAudioTGContent.html(this.createBulletTGContent()),this._mode===d.MATCH_AUDIO_MODE_BULLETS?this.buildBulletModeForTG():this.usingCarousel?this.buildCarouselTGMode():this.buildBigPictureModeForTG()}buildBigPictureModeForTG(){this.createBPContainer(),this.createBPPage(),this._$matchAudioTGContainer=$(this._bodySelector).find("#tg-container")}buildCarouselTGMode(){this._slideshow=new l.Slideshow(this._dependencies,!1);var t=this._slideshow.build(this._content,this._api);this._config.$pageContainer.append(t),this._slideshow.program(this._config.$pageContainer.get(0)),this._$matchAudioTGContent=$(this._bodySelector).find("#carousel")}createBPContainer(){var t=_.template(this._api.getTemplate("tgContainerForBigPicture").content);this._$tgContainer=$(t()),this._config.$pageContainer.append(this._$tgContainer)}createBPPage(){let t=$(this._api.model.currentPage.xmlContainer.sourceXML);this._isZone&&(e=this._zoneId.replace(/^z/,""),t=t.find(`Zone[zoneID="${e}"]`));var e=t.find('Image[id="'+this._config.matchSlideshowTGImageTarget+'"]'),e=_.template(this._api.getTemplate("tgPageForBigPicture").content)({tgTemplateId:this._config.matchSlideshowTGTemplate,headerId:this._config.matchHeaderTarget,headerText:t.find('Text[id="txtHeader"]').text(),textContentId:this._config.matchSlideshowTGTextTarget,textContent:t.find("#txtCC").text(),imageContainerId:this._config.matchImageTarget,imageSrc:e.attr("src"),imageAlt:e.find("Description").text()}),e=this._api.createXMLContainer((new DOMParser).parseFromString(e,"text/xml"));this._api.populate(this._$tgContainer.get()[0],this._config.matchSlideshowTGTemplate,e)}buildBulletModeForTG(){this._$bulletContainer.parent().append(this._$matchAudioTGContent)}configureBullets(){const s=_.template(this._api.getTemplate("matchAudioBullet").content),a=(this._matchAudioBulletInfo=[],this._config.matchImageTarget?$(this._bodySelector).find("#"+this._config.matchImageTarget):null);_.isNull(a)||a.attr("class","match-audio-slide first reveal"),$(this._content.sourceXML).find("Bullet").each((t,e)=>{var e=d.getBulletData($(e)),i=d.generateBulletMarkup(s,e,t),i=this.handleMagicButtonsInContent(i);this._$bulletContainer.append(i),this._matchAudioBulletInfo.push({time:e.time,clear:e.clear,ccText:"",shown:!1,$bullet:$(this._bodySelector).find("#match-audio-bullet-"+t),$image:null,$page:null}),this.addBulletImage(a,t,e.imageSrc)}),this._mode===d.MATCH_AUDIO_MODE_BULLETS&&_.isEmpty(this._matchAudioPages)&&this.processMatchAudioPages()}handleMagicButtonsInContent(t){return t=e.isMagicButtonInText(t)?this._MagicButtonManager.replaceMagicButtonsInTextWithHtml(t):t}processMatchAudioPages(){const i=_.template(this._api.getTemplate("matchAudioContainerPage").content);let s=$(i({pageNum:0}));this._matchAudioPages=[s],this._$bulletContainer.append(s),this._$bulletContainer.find(".match-audio-bullet").each((t,e)=>{e=$(e);this._matchAudioBulletInfo[t].clear&&(s=$(i({pageNum:this._matchAudioPages.length})),this._$bulletContainer.append(s),this._matchAudioPages.push(s)),(this._matchAudioBulletInfo[t].$page=s).append(e)})}createBulletTGContent(){var t=_.template(this._api.getTemplate("matchAudioTGContent").content);const i=[];return $(this._content.sourceXML).find("Bullet").each((t,e)=>{e=$(e).text(),e=this.handleMagicButtonsInContent(e);i.push(e)}),t({bulletContent:i})}static getBulletData(t){var e={};return e.imageSrc=t.attr("src"),e.time=parseFloat(t.attr("time")),e.level=parseInt(t.attr("level"),10),e.clear="true"===t.attr("clearBefore"),e.text=t.text(),e}static generateBulletMarkup(t,e,i){return t({index:i,level:e.level,text:e.text})}addBulletImage(t,e,i){var s,a;_.isEmpty(i)||(s="match-audio-slide-"+e,(a=t.clone()).attr("id",s),a.attr("class","match-audio-slide"),a.attr("src",i),t.parent().append(a),this._matchAudioBulletInfo[e].$image=$(this._bodySelector).find("#"+s))}configureCCText(){if(this._mode===d.MATCH_AUDIO_MODE_BIG_PICTURE){let i=$(this._content.sourceXML).find("Text#txtCC").text().split("<bbr/>");(i=i.filter(t=>0<t.length)).length===this._matchAudioBulletInfo.length&&this._matchAudioBulletInfo.forEach((t,e)=>{t.ccText=d.sanitizeCCText(i[e])}),this._$textCC.text(" ")}}static sanitizeCCText(t){let e=t.replace(/<\/*(ul|ol)>|<li>/g,"");return e=(e=e.replace(/(<br\s*\/?>)+$/g,"")).replace(/<\/li>/g,"<br/>")}timeUpdateHandler(t){this._mode===d.MATCH_AUDIO_MODE_BIG_PICTURE?this.updateBigPicture(t):this.revealBullets(t)}updateBigPicture(i){for(let t=0,e=this._matchAudioBulletInfo.length;t<e;t++){var s=this._matchAudioBulletInfo[t],a=s.time;if(a<=i&&!s.shown){s.shown=!0,this.clearBullets(),this.showBullet(s),this.showCaption(s);break}if(i<a&&s.shown){s.shown=!1;break}}this.setBigPictureCaption(i)}onAudioSeek(e){var t,i;this._mode===d.MATCH_AUDIO_MODE_BIG_PICTURE&&(t=_.last(_.filter(this._matchAudioBulletInfo,t=>t.time<=e)),i=this._matchAudioBulletInfo.indexOf(t),i=this._matchAudioBulletInfo.slice(i),_.each(i,t=>t.shown=!1),t.shown=!0,this.clearBullets(),this.showBullet(t),this.showCaption(t))}setBigPictureCaption(e){var t=_.last(_.filter(this._matchAudioBulletInfo,t=>t.time<=e));t?this.showCaption(t):this._$textCC.html("")}clearBullets(){$(this._bodySelector).find(".match-audio-slide").removeClass("reveal"),$(this._bodySelector).find(".match-audio-bullet").removeClass("reveal")}showBullet(t){var e=t.$bullet,t=t.$image;t?t.addClass("reveal"):this._mode===d.MATCH_AUDIO_MODE_BIG_PICTURE&&$(this._bodySelector).find(".match-audio-slide").removeClass("reveal"),e.addClass("reveal")}showCaption(t){""!==t.ccText&&this._$textCC.html(t.ccText),this._isZone&&this.calculateZoneMargin()}hideOverlay(){this._$bigPicContainer.addClass("hide"),this._$bigPicContinue.removeClass("reveal")}revealBullets(i){var t=$(this._bodySelector).find(".audio-content");for(let t=0,e=this._matchAudioBulletInfo.length;t<e;t++){var s=this._matchAudioBulletInfo[t],a=s.time;a<=i&&!s.shown?(s.shown=!0,this.showBullet(s),this.toggleBulletPages(s),this.autoScrollBulletContainer(s.$page,!1)):i<a&&s.shown&&(s.shown=!1,this.clearBullets())}$(this._bodySelector).find(".match-audio-bullet.reveal").text().replace(/\s+/gim,"").length?t.removeClass("empty"):t.addClass("empty")}toggleBulletPages(t){t.$page.show(),this._$bulletContainer.find(".match-audio-page").not("#"+t.$page.attr("id")).hide(),t.clear&&this.autoScrollBulletContainer(t.$page,!0)}autoScrollBulletContainer(t,e=!1){if(this._isZone)return this.autoScrollZoneContainer(t,e);t="auto"===this._config.$bulletScrollTargetLandscape.css("overflow-y")?this._config.$bulletScrollTargetLandscape:this._config.$bulletScrollTargetPortrait;t[0].scrollTop=e?0:t[0].scrollHeight}autoScrollZoneContainer(t,a){const n=$(".mz-wrapper"),r=this._$bulletContainer.closest(".zone"),o=t.find(".match-audio-bullet.reveal").last();setTimeout(()=>{var t=d.viewport(o.get(0),.25),e=r.offset(),i=n.offset(),s=o.offset();e.top,i.top,s.top,i.top;!0===a?l.MultiZone.activeZone.scrollToZone(r):!1===t&&o.get(0).scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},0)}static viewport(t,e=1){t=d.clone(t.getBoundingClientRect()),e=(t.bottom-t.top)*e;return t.bottom=t.top+e,0<=t.top&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)}static clone(t){return{top:t.top,bottom:t.bottom}}completeActions(){this._mode===d.MATCH_AUDIO_MODE_BIG_PICTURE&&(this._$bigPicContainer.removeClass("hide"),this._$bigPicContinue.addClass("reveal"),this.clearBullets(),$(this._bodySelector).find(".match-audio-slide.first").addClass("reveal"),$(this._bodySelector).find(".match-audio-bullet.first").addClass("reveal"))}mediaSlideReleased(t,e){0===t?(this.reset(),this.clearBullets(),$(this._bodySelector).find(".match-audio-slide.first").addClass("reveal"),$(this._bodySelector).find(".match-audio-bullet.first").addClass("reveal")):this.onAudioSeek(e)}destroy(){this._api.removeEvent("apiEvent",this.apiEventHandler),this._$bigPicContainer.find("#gfx").off("load"),d.unBindEvents()}}d.MATCH_AUDIO_MODE_BULLETS="bullets",d.MATCH_AUDIO_MODE_BIG_PICTURE="slideshow",l.MatchAudioHelper=d}(GLEPlugins=GLEPlugins||{}),function(t){var s=GLECore.ViewingModeManager,h=GLECore.DataUtil;class c{static calculateCaptionPosition(t,e=!1){var i=$(".page-body"),s=$("#media-progress-bar").get(0).getBoundingClientRect().bottom,s=i.height()-(s-i.offset().top),i=parseInt(t.css("min-height"),10);t.toggleClass("captions-bottom",i<s&&!e)}static forcePathToUseLanguage(t,e,i){e=new RegExp(`([\\/_])${e}([\\/_.])`,"g");return t.replace(e,`$1${i}$2`)}static imageData(t){return _.isEmpty(t)?null:{src:t.attributes.src,alt:t.getFirstChildOfType("Description").text}}static getAudioPath(t,e,i,s){let a,n,r;return t.match(/^mp3:/gim)?(a=/\/(\w+)$/gim.exec(t)[1],r=/:(.*\/)/gim,n=e+r.exec(t)[1]):t.match(/\.mp3$/gim)&&(n=t.match(/.*\//gim)[0],r=/(\w*)\.mp3/gim,a=r.exec(t)[1]),n=h.updatePathToCurrentProtocol(n),c.replaceLanguageInPath(n+a,i,s)}static getVideoPath(t,e,i,s,a,n,r=!1){let o,l,d;return t.match(/^flv:/gim)?(o=/\/(\w+)$/gim.exec(t)[1],d=/:(.*\/)/gim,l=e+d.exec(t)[1]):o=t.match(/\.flv$/gim)?(l=t.match(/.*\//gim)[0],(d=/\/(\w*)\.flv/gim).exec(t)):(l=t.match(/.*\//gim)[0],t.match(/\w+$/gim)[0]),o+=c.getVideoSuffix(a,n,r),l=h.updatePathToCurrentProtocol(l),c.replaceLanguageInPath(l+o,i,s)}static getVideoSuffix(t,e,i){i=i?e.fallback:e.hi;return t===s.VIEWING_MODE_VIDHI?i:e.lo}static replaceLanguageInPath(t,e,i){return"none"===i||i===e.currentLangId?t:(e=new RegExp(`([\\/_])${e.currentLangId}(_|\\/|$)`,"g"),t.replace(e,`$1${i}$2`))}}t.MediaUtil=c}(GLEPlugins=GLEPlugins||{}),function(t){class a{constructor(t,e){this._api=t,this._updatePreloader=e,this.processQueue=()=>{this._loading=this._queue.shift(),_.isEmpty(this._loading)?this.onQueueComplete():this._api.detectOffline()?this.loadOfflineSVG(this._loading.src):this.loadSVG(this._loading.src)},this.onItemLoadComplete=t=>{this._loading.content=t.responseText.replace(/\s+/gim," "),this._loading.viewBox=this._loading.content.replace(/^.*?viewBox=['"](.*?)['"].*?$/gim,"$1"),this.nextLoadStep()}}get svgs(){return this._svgs}get complete(){return this._svgs.length-this._queue.length}init(t){this._resolve=t,this.processQueue()}reset(t){this._api=t,this._svgs=[],this._queue=[],this._loading=null,this.loadCompiledSvgs(),this.loadCourseSvgs()}loadCompiledSvgs(){$("#svg_icons svg").find("symbol").each((t,e)=>{var i=$(e),s=a.createSvgData(i,!0),e=e.outerHTML||(new XMLSerializer).serializeToString(e);s.viewBox=i.attr("viewBox"),s.content=e.replace(/<(\/?)symbol/gim,"<$1svg"),this._api.model.svgManifest[s.src]=s})}loadCourseSvgs(){const s=[];$(this._api.model.contentXml).find("[src]").filter((t,e)=>{e=$(e);return/\.svg/gim.test(e.attr("src").toString())}).each((t,e)=>{var e=$(e),i=e.attr("src");-1===s.indexOf(i)&&(s.push(i),this._svgs.push(a.createSvgData(e,!1)))}),this._queue=this._svgs.concat()}static createSvgData(t,e){var i=t.attr("id");return{id:i||null,src:e?"#"+i:t.attr("src"),alt:t.find("Description").text()||null,viewBox:null,content:null}}loadSVG(t){const e=new XMLHttpRequest;e.open("get",t),e.onload=()=>{this.onItemLoadComplete(e)},e.send()}loadOfflineSVG(t){var t=document.getElementById(t),e=t.getElementsByTagName("svg")[0],t=(this._loading.content=t.innerHTML,e.attributes.getNamedItem("viewBox"));t&&(this._loading.viewBox=t.value),this.nextLoadStep()}nextLoadStep(){this._api.model.svgManifest[this._loading.src]=this._loading,this._updatePreloader(),this.processQueue()}onQueueComplete(){this._resolve()}}t.SVGPreloaderHelper=a}(GLEPlugins=GLEPlugins||{}),function(t){(t=t.DragAndDropImageType||(t.DragAndDropImageType={})).Vector="svg",t.Raster="(jpe?g)|(png)|(gif)"}(GLEPlugins=GLEPlugins||{}),function(t){(t=t.FlipStateType||(t.FlipStateType={})).Front="Front",t.Back="Back"}(GLEPlugins=GLEPlugins||{}),function(t){(t=t.ProgressDisplayType||(t.ProgressDisplayType={})).All="all",t.Hidden="hidden",t.HideProgress="hide-progress",t.HideNavigation="hide-nav"}(GLEPlugins=(GLEPlugins=GLEPlugins||{})||{}),function(t){var e;(e=t.TimelineNodePosition||(t.TimelineNodePosition={})).Left="left",e.Right="right",(e=t.TimelineNodeType||(t.TimelineNodeType={})).Static="static",e.Expandable="expandable",(e=t.TimelineNodeLayout||(t.TimelineNodeLayout={})).TextOnly="text-only",e.ImageOnly="image-only",e.ImageLeft="image-left",e.ImageRight="image-right"}(GLEPlugins=GLEPlugins||{}),function(t){(t=t.ZoneMode||(t.ZoneMode={})).Default="default",t.Sequential="sequential",t.Branching="branching",t.Presentation="presentation"}(GLEPlugins=GLEPlugins||{}),function(i){i.DragAndDropItemModel=class{constructor(t,e){this._source=t,this._id=this._source.attributes.id,this._index=e,this._src=this._source.attributes.src,this._alt=this._source.attributes.description,this._target=this._source.attributes.target,this._imageType=this._src.match(new RegExp(i.DragAndDropImageType.Vector))?i.DragAndDropImageType.Vector:i.DragAndDropImageType.Raster,this._hoverText=t.getChildrenOfType("RolloverText")[0].text,this._reviewText=t.getChildrenOfType("ReviewText")[0].text}get id(){return this._id}set src(t){this._src=t}get src(){return this._src}get imageType(){return this._imageType}get index(){return this._index}get alt(){return this._alt}get target(){return this._target}get hoverText(){return this._hoverText}get reviewText(){return this._reviewText}set correct(t){this._correct=t}get correct(){return this._correct}get status(){return!0===this._correct?"correct":"incorrect"}set statusHeader(t){this._statusHeader=t}get statusHeader(){return this._statusHeader}set bucket(t){this._bucket=t}get bucket(){return this._bucket}set selectedBucket(t){this._selectedBucket=t}get selectedBucket(){return this._selectedBucket}}}(GLEPlugins=GLEPlugins||{}),function(t){t.DragAndDropBucketModel=class{constructor(t,e,i,s){this._id=t,this._index=e,this._header=i,this._items=s,_.each(this._items,t=>{t.bucket=this})}get id(){return this._id}get index(){return this._index}get header(){return this._header}get items(){return this._items}}}(GLEPlugins=GLEPlugins||{}),function(t){var i=GLECore.DataUtil;class n{static makeBoolean(t){let e=!1;return _.isEmpty(t)||(t=i.convertStringToBool(t),_.isBoolean(t)&&(e=t)),e}static convertValue(t){var e=i.convertStringToBool(t);return _.isBoolean(e)?e:t}static convertTextValue(t){return sai.ApplicationController.parseTokens(t)}static processAttributesOfElement(t){if(!(t instanceof jQuery))return{};var e=t.prop("attributes"),i={};if(_.isEmpty(e))return{};for(let t=0;t<e.length;t++){var s=e[t];i[_.camelCase(s.name)]=n.convertValue(s.value)}return i}static processChildrenOfElement(t,s){t=t.children();const a={};if(!(t instanceof jQuery))return{};if(_.isUndefined(s))s=[];else if(!_.isArray(s))return{};return _.isEmpty(t)?{}:($.each(t,(t,e)=>{var e=$(e),i=_.camelCase(e.prop("nodeName"));-1===s.indexOf(i)&&(a[i]="text"===i?n.convertTextValue(e.text()):n.convertValue(e.text()))}),a)}static processValueOf(t){var e,i={};return t instanceof jQuery&&!_.isEmpty(t)?(i[e=_.camelCase(t.prop("nodeName"))]="text"===e?n.convertTextValue(t.text()):n.convertValue(t.text()),i[e]=n.convertValue(t.text()),i):{}}}t.SurveyUtility=n}(GLEPlugins=GLEPlugins||{}),function(t){t.SurveySummaryInfo=class{constructor(t,e,i,s,a){this._page=t,this._displayNumber=e,this._question=i,this._answers=s,this._useSequentialNumbers=a}get page(){return this._page}get displayNumber(){return this._displayNumber}get question(){return this._question}get answers(){return this._answers}get useSequentialNumbers(){return this._useSequentialNumbers}}}(GLEPlugins=GLEPlugins||{}),function(t){var e=GLECore.IEventDispatcher;class i extends e{constructor(t,e,i){super(),this._api=e,this._navigationCallback=i,this.model=t,this.setupHelperMethods()}renderSummaryInfo(){return new t.SurveySummaryInfo(this.model.pageModel,this.helpers.renderQuestionNumber(),this.cleanText(this.model.data.texts.text),this.getSelectedOptionText(),!this.model.data.appearance.showNumberLabels)}getSelectedOptionText(){var t=this.model.pageModel.storageData.answers[this.model.pageModel.id].filter(t=>t.itemId===this.model.id);if(_.isEmpty(t))return[];const e=t[0].selectedOptionIds;return t[0].availableOptions.filter(t=>-1!==e.indexOf(t.optionId)).map(t=>this.cleanText(t.text))}cleanText(t){return t.replace(/<\/?a(?:[^>]+)?>/gim,"")}setupHelperMethods(){this.helpers={renderRequiredSymbol:()=>this.model.data.general.answerRequired?this._api.parseTokens("{tk_RequiredCharacter}"):"",renderQuestionNumber:()=>{if(this.model.data.appearance.showNumberLabels){let t=this._api.parseTokens("{tk_ItemNumberPunctuation}");return t=t.replace(/<Number[^>]+>/gim,this.model.data.appearance.displayNumber)}return""},calcDivisor:()=>Math.min(10,this.model.data.options.length),renderLabel:t=>{var e=this.model.data;return 0===t?e.general.startText:t===Math.round(e.options.length/2)-1?e.general.midText:t===e.options.length-1?e.general.endText:""}}}build(t){_.extend(this.model.data,this.helpers),this._template=t;t=_.template(this._template);return this._html=t(this.model.data),this.preProcessHTML(),this._html}preProcessHTML(){}getItemTagId(){return i.PLUGIN_NAMESPACE+i.DELIMITER+this._itemUINameSpace+i.DELIMITER+this.model.id}getUsersChoices(){return[]}getAnswerText(){return""}get itemUINameSpace(){return this._itemUINameSpace}wireUIClickHandlers(t){_.isNull(t)||_.isEmpty(t)||t.find('input[name="'+this.getItemTagId()+'"]').click(()=>{this.model.pageModel.selectionMade=!0})}}i.PLUGIN_NAMESPACE="surv",i.DELIMITER="_",t.SurveyItemView=i}(GLEPlugins=GLEPlugins||{}),function(s){s.SurveyItemModel=class{constructor(t,e){this._$xml=t,this._data={},this._pageModel=e}set id(t){this._id=t}get id(){return this._id}get type(){return this._type}get data(){return this._data}get pageModel(){return this._pageModel}set view(t){this._view=t}get view(){return this._view}set answerStore(t){this._answerStore=t}get answerStore(){return this._answerStore}init(){this.buildModelData(),this._id=this.data.general.itemId,this._type=this.data.general.type}buildModelData(){this.setGeneralData(),this.setAppearanceData(),this.setTextData(),this.setAnswerData(),this.setValidationData(),this.setOptionsData()}setGeneralData(){this.data.general={answerRequired:!1,interactionId:"",itemId:"",type:""},_.extend(this.data.general,s.SurveyUtility.processAttributesOfElement(this._$xml)),_.extend(this.data.general,s.SurveyUtility.processChildrenOfElement($(this._$xml.children("metaData")))),_.extend(this.data.general,s.SurveyUtility.processChildrenOfElement($(this._$xml.children("instanceData")),["validationErrors","answers","listOptions","text","texts"]))}setAppearanceData(){this.data.appearance=s.SurveyUtility.processAttributesOfElement(this._$xml.children("appearanceData"))}setTextData(){var t=this._$xml.find("instanceData > text");this.data.texts=s.SurveyUtility.processChildrenOfElement(this._$xml.find("instanceData > texts")),_.isEmpty(t)||_.extend(this.data.texts,s.SurveyUtility.processValueOf(t))}setAnswerData(){this.data.answers=s.SurveyUtility.processChildrenOfElement(this._$xml.find("instanceData > answers"))}setValidationData(){this.data.validationErrors=s.SurveyUtility.processChildrenOfElement(this._$xml.find("instanceData > validationErrors"))}setOptionsData(){var t=this._$xml.find("listOption");this.data.options=[],$.each(t,(t,e)=>{var i={},e=$(e);_.extend(i,s.SurveyUtility.processAttributesOfElement(e)),_.extend(i,s.SurveyUtility.processChildrenOfElement(e)),this.data.options.push(i)})}}}(GLEPlugins=GLEPlugins||{}),function(a){a.SurveyPageModel=class{constructor(t,e,i){this._globalData=e,this._storageData=i,this._latency=0,this._triggeringPages=[],this._$xml=t,this.initVars(),this.initItems()}get canNavigateForward(){return this._canNavigateForward}get canNavigateBackward(){return this._canNavigateBackward}set surveyCompleted(t){this._surveyCompleted=t}get surveyCompleted(){return this._surveyCompleted}get completeOnNext(){return this._completeOnNext}get selectionMade(){return this._selectionMade}set selectionMade(t){this._selectionMade=t}get storageData(){return this._storageData}get items(){return this._items}get id(){return this._id}get $xml(){return this._$xml}get latency(){return this._latency}set latency(t){this._latency=t}get globalData(){return this._globalData}set triggeringPages(t){this._triggeringPages=t}get triggeringPages(){return this._triggeringPages}initVars(){this._id=this._$xml.attr("id"),this._$metaData=$(this._$xml.children("metaData").get(0)),this._canNavigateForward=a.SurveyUtility.makeBoolean(this._$metaData.children("CanNavigateForward").text()),this._canNavigateBackward=a.SurveyUtility.makeBoolean(this._$metaData.children("CanNavigateBackward").text()),this._surveyCompleted=a.SurveyUtility.makeBoolean(this._$metaData.children("SurveyCompleted").text()),this._completeOnNext=a.SurveyUtility.makeBoolean(this._$metaData.children("CompleteOnNext").text())}initItems(){let e=!1;var i=this._$xml.children("item");this._items=[];for(let t=0;t<i.length;t++){var s=new a.SurveyItemModel(i.eq(t),this);this._items.push(s),s.init(),"message"!==s.type.toLowerCase()&&(e=!0)}this._selectionMade=!e}}}(GLEPlugins=GLEPlugins||{}),function(t){class a extends t.SurveyItemView{constructor(t,e){super(t,e),this._itemUINameSpace="rcs"}getUsersChoices(){super.getUsersChoices();const i=[];var t=$('input[name="'+this.getItemTagId()+'"]:checked');return _.isEmpty(t)||$.each(t,(t,e)=>{i.push($(e).attr("value"))}),i}preProcessHTML(){super.preProcessHTML();var e=$(this._html);let i=!1;var s=this.model.answerStore?this.model.answerStore.selectedOptionIds.map(a.convertAnswerStore):this.model.data.options;for(let t=0;t<s.length;t++)s[t].isSelected&&(e.find('input[value="'+s[t].optionId+'"]').attr("checked","true"),i=!0);!0===i&&(this._html=e.get(0).outerHTML)}static convertAnswerStore(t){return{optionId:t,isSelected:!0}}}t.SurveyCheckboxSetItem=a}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.SurveyItemView{constructor(t,e){super(t,e),this._itemUINameSpace="ddl"}getUsersChoices(){super.getUsersChoices();var t=[],e=$("select#"+this.getItemTagId()).find(":selected");return _.isEmpty(e)||"default"!==(e=e.val())&&t.push(e),t}preProcessHTML(){super.preProcessHTML();var t,e=this.getSelectedOption();_.isEmpty(e)||((t=$(this._html)).find('option[value="'+e+'"]').attr("selected","true"),this._html=t.get(0).outerHTML)}wireUIClickHandlers(t){super.wireUIClickHandlers(t),_.isNull(t)||_.isEmpty(t)||(t.find("select#"+this.getItemTagId()).get()[0].onchange=()=>{this.model.pageModel.selectionMade=!0})}getSelectedOption(){if(this.model.answerStore)return this.model.answerStore.selectedOptionIds.length?this.model.answerStore.selectedOptionIds[0]:null;for(let t=0,e=this.model.data.options.length;t<e;t++)if(this.model.data.options[t].isSelected)return this.model.data.options[t].optionId;return null}}t.SurveyDropDownListItem=e}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.SurveyItemView{constructor(t,e){super(t,e)}renderSummaryInfo(){return null}}t.SurveyMessageItem=e}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.SurveyItemView{constructor(t,e){super(t,e),this._itemUINameSpace="rsi"}getUsersChoices(){super.getUsersChoices();var t=[],e=$('input[name="'+this.getItemTagId()+'"]:checked');return _.isEmpty(e)||t.push(e.val()),t}preProcessHTML(){super.preProcessHTML();var t,e=this.getSelectedOption();_.isEmpty(e)||((t=$(this._html)).find('input[value="'+e+'"]').attr("checked","true"),this._html=t.get(0).outerHTML)}getSelectedOption(){if(this.model.answerStore)return this.model.answerStore.selectedOptionIds.length?this.model.answerStore.selectedOptionIds[0]:null;for(let t=0,e=this.model.data.options.length;t<e;t++)if(this.model.data.options[t].isSelected)return this.model.data.options[t].optionId;return null}}t.SurveyRadioScaleItem=e}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.SurveyItemView{constructor(t,e){super(t,e),this._itemUINameSpace="rs"}getUsersChoices(){super.getUsersChoices();var t=[],e=$('input[name="'+this.getItemTagId()+'"]:checked');return _.isEmpty(e)||t.push(e.val()),t}preProcessHTML(){super.preProcessHTML();var t,e=this.getSelectedOption();_.isEmpty(e)||((t=$(this._html)).find('input[value="'+e+'"]').attr("checked","true"),this._html=t.get(0).outerHTML)}getSelectedOption(){if(this.model.answerStore)return this.model.answerStore.selectedOptionIds.length?this.model.answerStore.selectedOptionIds[0]:null;for(let t=0,e=this.model.data.options.length;t<e;t++)if(this.model.data.options[t].isSelected)return this.model.data.options[t].optionId;return null}}t.SurveyRadioSetItem=e}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.SurveyItemView{constructor(t,e){super(t,e),this._itemUINameSpace="sl"}build(t){return this.model.answerStore&&0<this.model.answerStore.answerText.length&&(this.model.data.answers.answer=this.model.answerStore.answerText),_.isEmpty(this.model.data.general.defaultText)&&(this.model.data.general.defaultText=this._api.parseTokens("{tk_InputPlaceholderText}")),super.build(t)}getAnswerText(t){var e=this.model.pageModel,e=_.isEmpty(e.storageData)?null:e.storageData.answers[e.id];let i;return i=!0!==t||_.isEmpty(e)?$("input#"+this.getItemTagId()).val():e.filter(t=>t.itemId===this.model.id).map(t=>t.answerText)[0],_.isEmpty(i)?"":i.replace(/\s+/gim," ").replace(/[<>]/gim,"")}renderSummaryInfo(){return new t.SurveySummaryInfo(this.model.pageModel,this.helpers.renderQuestionNumber(),this.cleanText(this.model.data.texts.text),[this.getAnswerText(!0)],!this.model.data.appearance.showNumberLabels)}wireUIClickHandlers(t){_.isNull(t)||_.isEmpty(t)||t.find("input#"+this.getItemTagId()).click(()=>{this.model.pageModel.selectionMade=!0})}}t.SurveySingleLineTextItem=e}(GLEPlugins=GLEPlugins||{}),function(t){var r=GLECore.DateUtil;class e extends t.SurveyItemView{constructor(t,e,i){super(t,e),this._navigationCallback=i,this.onQuestionLinkClick=t=>{var t=$(t.currentTarget),e=this.model.pageModel.storageData.pageFlow;const i=t.data("page").toString();t=e.filter(t=>t.id===i)[0];this._navigationCallback(t)},this.onPrintClick=()=>{window.print()},this._itemUINameSpace="rsumm",this.buildQuestions()}renderSummaryInfo(){return null}buildQuestions(){var t=this.model.pageModel.storageData.pageFlow;const i=t.indexOf(this.model.pageModel);t=t.filter((t,e)=>e<i);let e=[];_.each(t,t=>{e=e.concat(t.items.map(t=>t.view.renderSummaryInfo()))}),this.model.data.responses=e.filter(t=>!_.isEmpty(t))}wireUIClickHandlers(){var t=$(".survey-question-prompt").closest(".modal-content-saig"),e=$(".survey-summary-item-container");t.addClass("summary-page"),e.click(this.onQuestionLinkClick),this.configurePrintout()}configurePrintout(){var t=$(".survey-completion-summary-content"),e=$(".survey-completion-print-button .print"),i=this._api.trackingData?this._api.trackingData.userName:"Guest",s=r.getDate(),a=this._api.getCurrentPage().xmlContainer.getChildByAttribute("id","survey").getFirstChildOfType("Data").attributes.surveyName,n=this._html,i=_.template(this._api.getTemplate("p_survey_printout").content)({username:i,date:s,content:n,title:a});t.html(i),e.off("click.summary").on("click.summary",this.onPrintClick),e.parent().addClass("render"),$("html").addClass("survey-summary-view")}}t.SurveySummaryItem=e}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.SurveyCheckboxSetItem{constructor(t,e){t.data.general.answerRequired=!0,super(t,e)}renderSummaryInfo(){return null}}t.SurveyCertificationItem=e}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.SurveyItemView{constructor(t,e){super(t,e),this.wireUIClickHandlers=t=>{_.isNull(t)||_.isEmpty(t)||(t.find("textarea#"+this.getItemTagId()).click(()=>{this.model.pageModel.selectionMade=!0}).keydown(this.onKeyDown).keyup(this.onKeyUp),this._$counter=t.find("#"+this.getItemTagId()+"_counter > .typed"))},this.onKeyDown=t=>{var e=$(t.currentTarget).val().length+1,i=t.ctrlKey||t.metaKey;-1!==["Backspace","Delete"].indexOf(t.key)||i&&"a"===t.key||e<=this._characterLimit||t.preventDefault()},this.onKeyUp=t=>{var t=$(t.currentTarget),e=t.val();t.val(e.substring(0,this._characterLimit)),this._$counter.html(t.val().length)},this._itemUINameSpace="ml",this._characterLimit=parseInt(this.model.pageModel.globalData.attributes.multilineCharacterLimit,10)}build(t){return this.model.answerStore&&0<this.model.answerStore.answerText.length?(this.model.data.answers.answer=this.model.answerStore.answerText,this.model.data.general.characterCount=this.model.answerStore.answerText.length):this.model.data.general.characterCount=0,_.isEmpty(this.model.data.general.defaultText)&&(this.model.data.general.defaultText=this._api.parseTokens("{tk_InputPlaceholderText}")),this.model.data.general.characterLimit=this._characterLimit,super.build(t)}getAnswerText(t){var e=this.model.pageModel,e=_.isEmpty(e.storageData)?null:e.storageData.answers[e.id];let i;return i=!0!==t||_.isEmpty(e)?$("textarea#"+this.getItemTagId()).val():e.filter(t=>t.itemId===this.model.id).map(t=>t.answerText)[0],_.isEmpty(i)?"":i.replace(/\s+/gim," ").replace(/[<>]/gim,"")}renderSummaryInfo(){return new t.SurveySummaryInfo(this.model.pageModel,this.helpers.renderQuestionNumber(),this.cleanText(this.model.data.texts.text),[this.getAnswerText(!0)],!this.model.data.appearance.showNumberLabels)}}t.SurveyMultiLineTextItem=e}(GLEPlugins=GLEPlugins||{}),function(s){s.AssessmentCheckpoint=class{constructor(t,e,i,s,a){this._question=t,this._defaultsXml=e,this._metadata=i,this._onQuestionSubmit=s,this._dependencies=a}buildConstructor(){var t=this._defaultsXml.attributes,e=this._question.constructor.getChildByAttribute("id","imgQuestion")||this._defaultsXml.getChildByAttribute("id","imgQuestion"),i=_.template(sai.ApplicationController.getTemplate("QuestionConstructor").content),s={attitudinal:this._question.attitudinal,defaults:t,image:e,interactionID:this._question.constructor.attributes.interactionID,randomChoicesOnStart:this._metadata.randomizeAnswers.toString(),randomChoicesOnReset:this._metadata.randomizeAnswers.toString(),showCorrections:"none"===this._metadata.retake,metadata:this._metadata,question:this._question,options:[],feedbacks:[]};let a=0;for(var n=this._question.responses.length;a<n;a++){var r=this._question.responses[a];s.options.push({correct:r.correct.toString(),itestableID:a,interactionID:r.constructor.attributes.interactionID,text:r.text,value:r.value,src:r.src}),r.itestableID=a.toString()}let o=0;for(var l=this._question.feedback.length;o<l;o++){var d=this._question.feedback[o],h={choiceNum:null,text:d.text};s.feedbacks.push(h),(d.attributes.choiceNum||d.type)&&(h.choiceNum=parseInt(d.attributes.choiceNum,10))}t=i(s);return this._dependencies.XMLManager.deserializeXML($.parseXML(t))}static initInteractionData(t,e,i){return s.QuizUtil.initInteractionData(t,e,!0,i,"choice")}getContainerClasses(){return["checkpoint-body","page-body"].join(" ")}getWrapperClasses(){return["content-wrapper","checkpoint-wrapper"].join(" ")}buildInstance(){return new s.Checkpoint(this._dependencies,{iTestable:!0,question:this._question,onQuestionSubmit:this._onQuestionSubmit,flow:""})}}}(GLEPlugins=GLEPlugins||{}),function(a){var n=GLECore.DataUtil;class t extends a.AssessmentCheckpoint{constructor(t,e,i,s,a){super(t,e,i,s,a)}buildConstructor(){var t=this._question.constructor.closest("Page"),e=this._dependencies.XMLManager,i=super.buildConstructor(),s=this._question.constructor.getFirstChildOfType("Confidence"),a=this._question.constructor.attributes.objectiveID,i=$("<template/>").append($(i.sourceXML));return i.find("Data").attr("outcome",a),i.find("Data").attr("phase",this._question.constructor.getSiblingsByName("Data")[0].attributes.phase),i.find("Data").attr("isAssessment","true"),i.find("Data").attr("storageId",n.standardizeId(t.attributes.pageID+"_"+this._question.id)),i.find("SWF").append($.parseXML(`<Prompt>${sai.ApplicationController.parseTokens("{tk_SelectFollowingNoSubmit}")}</Prompt>`).documentElement),i.find("SWF").append($(s.sourceXML)),e.deserializeXML(i.get(0))}static initInteractionData(t,e,i){var s=t.getSiblingsByName("Data")[0].attributes.phase;return _.isEmpty(s)||(t.attributes.phase=s),a.QuizUtil.initInteractionData(t,e,!0,i,"choice")}getContainerClasses(){return["checkpoint-body","confidence-body","page-body"].join(" ")}getWrapperClasses(){return["content-wrapper","checkpoint-wrapper","confidence-wrapper"].join(" ")}buildInstance(){return new a.ConfidenceQuestion(this._dependencies,{iTestable:!0,question:this._question,onQuestionSubmit:this._onQuestionSubmit,flow:""})}}a.AssessmentConfidence=t}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.AssessmentCheckpoint{constructor(t,e,i,s,a){super(t,e,i,s,a)}getContainerClasses(){return["chexercise-body","page-body"].join(" ")}getWrapperClasses(){return["content-wrapper","chexercise-wrapper"].join(" ")}buildInstance(){return new t.Chexercise(this._dependencies,{iTestable:!0,question:this._question,onQuestionSubmit:this._onQuestionSubmit,flow:""})}}t.AssessmentChexercise=e}(GLEPlugins=GLEPlugins||{}),function(s){class t extends s.AssessmentCheckpoint{constructor(t,e,i,s,a){super(t,e,i,s,a),this._metadata.randomizeAnswers=!1}static initInteractionData(t,e,i){return s.QuizUtil.initInteractionData(t,e,!0,i,"likert")}getContainerClasses(){return["checkpoint-body","ratingscale-body","page-body"].join(" ")}getWrapperClasses(){return["content-wrapper","checkpoint-wrapper","ratingscale-wrapper"].join(" ")}buildInstance(){return new s.RatingScale(this._dependencies,{iTestable:!0,question:this._question,onQuestionSubmit:this._onQuestionSubmit,flow:""})}}s.AssessmentRatingScale=t}(GLEPlugins=GLEPlugins||{}),function(s){class o{constructor(t,e,i,s,a){this._question=t,this._defaultsXml=e,this._metadata=i,this._onQuestionSubmit=s,this._dependencies=a}buildConstructor(){var t=this._defaultsXml.attributes,e=this._question.responses,i=_.template(sai.ApplicationController.getTemplate("DragAndDropConstructor").content),s=o.checkForOverrides("txt1Label",this._defaultsXml,this._question.constructor),a=o.checkForOverrides("txt2Label",this._defaultsXml,this._question.constructor),n=o.checkForOverrides("txt3Label",this._defaultsXml,this._question.constructor),r=this._question.text,i=i({defaults:t,interactionID:this._question.constructor.attributes.interactionID,metadata:this._metadata,question:this._question,items:e,label1:s,label2:a,label3:n,rollover:r});return this._dependencies.XMLManager.deserializeXML($.parseXML(i))}static checkForOverrides(t,e,i){let s,a,n,r;for(s=0,a=e.children.length;s<a;s++)(n=e.children[s]).attributes.id===t&&(r=n);for(s=0,a=i.children.length;s<a;s++)(n=i.children[s]).attributes.id===t&&(r=n);return r}static initInteractionData(t,e,i){return s.DragAndDrop.initInteractionData(t,e,!0,i)}getContainerClasses(){return"drag-and-drop-body"}getWrapperClasses(){return["content-wrapper","drag-and-drop-wrapper"].join(" ")}buildInstance(){return new s.DragAndDrop(this._dependencies,{iTestable:!0,question:this._question,onQuestionSubmit:this._onQuestionSubmit,flow:""})}}s.AssessmentDragAndDrop=o}(GLEPlugins=GLEPlugins||{}),function(o){o.AssessmentSortable=class{constructor(t,e,i,s,a){this._question=t,this._defaultsXml=e,this._metadata=i,this._onQuestionSubmit=s,this._dependencies=a}buildConstructor(){var t=this._defaultsXml.attributes,e=this._question.constructor.getChildByAttribute("id","imgQuestion")||this._defaultsXml.getChildByAttribute("id","imgQuestion"),i=this._question.responses.map((t,e)=>({value:t.constructor.attributes.correctPosition,interactionID:t.constructor.attributes.interactionID,itestableID:e,text:t.text})),s=_.template(sai.ApplicationController.getTemplate("SortableConstructor").content),a=this._question.feedback.filter(t=>_.isEmpty(t.attributes.type)),n=this._question.feedback.filter(t=>t.attributes.type===o.Sortable.RESPONSE_CORRECT),r=this._question.feedback.filter(t=>t.attributes.type===o.Sortable.RESPONSE_INCORRECT),s=s({defaults:t,interactionID:this._question.constructor.attributes.interactionID,metadata:this._metadata,question:this._question,options:i,image:e,generalFeedback:a.length?a[0]:null,correctFeedback:a.length?null:n[0],incorrectFeedback:a.length?null:r[0]});return this._dependencies.XMLManager.deserializeXML($.parseXML(s))}static initInteractionData(t,e,i){return o.Sortable.initInteractionData(t,e,!0,i)}getContainerClasses(){return"sortable-body"}getWrapperClasses(){return["content-wrapper","sortable-wrapper"].join(" ")}buildInstance(){return new o.Sortable(this._dependencies,{iTestable:!0,question:this._question,onQuestionSubmit:this._onQuestionSubmit,flow:""})}}}(GLEPlugins=GLEPlugins||{}),function(s){s.AssessmentMatrix=class{constructor(t,e,i,s,a){this._question=t,this._defaultsXml=e,this._metadata=i,this._onQuestionSubmit=s,this._dependencies=a}buildConstructor(){var t=this._defaultsXml.attributes,e=this._question.constructor.getChildByAttribute("id","imgQuestion")||this._defaultsXml.getChildByAttribute("id","imgQuestion"),i=this._question.text,s=this._question.constructor.getFirstChildOfType("QuestionHeader"),a=this._question.constructor.getChildByAttribute("id","feedback-image"),n=_.template(sai.ApplicationController.getTemplate("MatrixConstructor").content),r=this._question.constructor.getChildrenOfType("QuestionRow").map(t=>{var e=t.getFirstChildOfType("Feedback");return{text:t.getFirstChildOfType("Text").text,interactionID:t.attributes.interactionID,correctChoiceNum:t.attributes.correctChoiceNum,feedback:_.isEmpty(e)?null:e.text}}),o=this._question.constructor.getChildrenOfType("Response").map(t=>({text:t.text,interactionID:t.attributes.interactionID})),l=this._question.constructor.getChildrenOfType("Feedback").map(t=>({type:t.attributes.type,text:t.text})),n=n({defaults:t,questionId:this._question.id,introduction:i,questionHeader:_.isEmpty(s)?null:s.text,metadata:this._metadata,image:e,questions:r,choices:o,feedbacks:l,feedbackImage:_.isEmpty(a)?null:{src:a.attributes.src,alt:a.getFirstChildOfType("Description").text}});return this._dependencies.XMLManager.deserializeXML($.parseXML(n))}static initInteractionData(t,e,i){return s.Matrix.initInteractionData(t,e,!0,i)}getContainerClasses(){return"matrix-body"}getWrapperClasses(){return["content-wrapper","matrix-wrapper"].join(" ")}buildInstance(){return new s.Matrix(this._dependencies,{iTestable:!0,question:this._question,onQuestionSubmit:this._onQuestionSubmit,flow:""})}}}(GLEPlugins=GLEPlugins||{}),function(t){class r{static buildQuestion(t,e,i,s,a,n){return new r.QUESTION_TYPES[t](e,i,s,a,n)}}r.CHECKPOINT="checkpoint",r.CHEXERCISE="chexercise",r.RATINGSCALE="ratingscale",r.SORTABLE="sortable",r.DRAGANDDROP="draganddrop",r.MATRIX="matrix",r.CONFIDENCE="confidence",r.QUESTION_TYPES={[r.CHECKPOINT]:t.AssessmentCheckpoint,[r.CHEXERCISE]:t.AssessmentChexercise,[r.RATINGSCALE]:t.AssessmentRatingScale,[r.SORTABLE]:t.AssessmentSortable,[r.DRAGANDDROP]:t.AssessmentDragAndDrop,[r.MATRIX]:t.AssessmentMatrix,[r.CONFIDENCE]:t.AssessmentConfidence},t.AssessmentQuestionBuilder=r}(GLEPlugins=GLEPlugins||{}),function(t){t.AttitudinalHelper=class{constructor(t){this._api=t,this.onExploreMore=()=>{this._config.plugin.doExploreMore()},this.onContinue=()=>{this._config.plugin.doContinue()}}init(t){this._config=t}renderFeedback(t,e){var i={showCorrections:!1,content:""},s=_.template(this._api.getTemplate("AttitudinalFeedback").content);return i.content=s({feedbackContent:t,showExploreButton:e}),i}programFeedbackPanel(){var t=this._config.plugin,t=t.zoneData?"#"+t.zoneData.zoneId:"";this._$attitudinalExploreButton=$(t+" .explore-button"),this._$attitudinalContinueButton=$(t+" .continue-button"),this._$attitudinalPanel=$(t+" .question-feedback-panel"),this._$attitudinalExploreButton.unbind("click",this.onExploreMore),this._$attitudinalContinueButton.unbind("click",this.onContinue),this._$attitudinalExploreButton.bind("click",this.onExploreMore),this._$attitudinalContinueButton.bind("click",this.onContinue),this._config.plugin.setTrackingComplete()}}}(GLEPlugins=GLEPlugins||{}),function(n){var e=GLECore.AlertData;n.AdaptiveQuestionHelper=class{constructor(t,e){this._api=t,this._AlertManager=e,this._config={},this.onZoneProfileConfirmation=()=>{this._zonedProfileConfirmation=!0,this._AlertManager.closeAlert("zone-profile-submission"),this._$submitButton.click()}}get IsLastProfilingZone(){return this._isLastProfilingZone}set $submitButton(t){this._$submitButton=t}init(t){this._config=t,this._isZone=!!this._config.zoneId,this._containerSelector=this._isZone?`#${this._config.zoneId} .question-body`:".question-body"}setProfilingZoneClasses(){this._isLastProfilingZone=this.isLastProfilingZone(),$("#"+this._config.zoneId).addClass(this._isLastProfilingZone?"profiling-last":"profiling").addClass(n.MultiZone.activeZone.mode),n.MultiZone.activeZone.hideContinueButton()}isLastProfilingZone(){var t=$(this._api.model.currentPage.xmlContainer.sourceXML),t=_.last(t.find('Data[profiling="true"]').closest("Zone")),t="z"+$(t).attr("zoneID");return this._config.zoneId===t}profiledZoneChoiceSelectHandler(s){var t=$(".profiling-last input[type='submit']:not(.restored)");let a=!0;$(".zone.profiling, .zone.profiling-last").each((t,e)=>{var e=$(e),i=0===e.find("input:checked").length;!0==i&&(a=!1),i||s.attr("id")!==e.attr("id")||n.MultiZone.activeZone.mode!==n.ZoneMode.Branching||e.find("input[type=submit]:not(.restored)").attr("disabled",null)}),t.attr("disabled",a?null:"disabled")}handleSubmitProfilingActions(){this._isLastProfilingZone&&this.submitOtherProfilingZones()}confirmZoneProfileSubmission(){var t;return!(this._zonedProfileConfirmation||!this._isLastProfilingZone||(t={id:t="zone-profile-submission",content:"{tk_ProfileZoneConfirmation}",buttons:this._AlertManager.generateYesNoAlertButtons(t,this.onZoneProfileConfirmation),$launcher:this._$submitButton,renderAsModalAlert:!1},this._AlertManager.showAlert(new e(t)),0))}submitOtherProfilingZones(){$(".zone.profiling").each((t,e)=>{$(e).find("form").submit()})}restoreZonedProfilesFromStorage(t,e){const i=[],s=t[this._config.profileId];return _.isEmpty(s)||($(""+this._containerSelector).find("input").attr("disabled","disabled").addClass("restored"),e.forEach(t=>{-1!==s.indexOf(t.profileValue)&&i.push($(this._containerSelector+" #"+t.id))})),i}restoreProfilesFromStorage(t,e){t=this._api.trackingData.profile&&this._api.trackingData.profile[this._config.profileId]?this._api.trackingData.profile:t;const i=[],s=t[this._config.profileId];return e.forEach(t=>{s&&-1!==s.indexOf(t.profileValue)&&i.push($(this._containerSelector+" #"+t.id))}),i}handleProfilingFeedback(t,e){if(!0===this._config.qaProfilingDisabled){t.splice(0,t.length-1);for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(e[i])}return this._api.sendEvent({destination:"all",type:"profiling",profileId:this._config.profileId,responses:t,pageID:this._api.model.currentPage.id,preventRouteGeneration:this._isZone&&!this._isLastProfilingZone})}handleBranchingFeedback(t){this._api.sendEvent({destination:"all",type:"branching",branchId:this._config.branchId,responses:t,pageID:this._api.model.currentPage.id,rebuildTrackingAfterRoute:!0})}}}(GLEPlugins=GLEPlugins||{}),function(t){var s=GLECore.DataUtil;t.QuestionBuilder=class{constructor(t,e,i){this.api=t,this.content=e,this._config=i,this._data=this.content.getChildrenOfType("Data")[0],this._singleSelect=i.singleSelect,this._zoneId=i.zoneId,this._isZone=!!this._zoneId}buildContainer(){var t=this.api.populate(null,this._data.attributes.templateID,this.content);return this._$container=$(t.content),this._$container}buildHeader(){var t=this.content.getFirstChildOfType("Header"),e=this._$container.find(".question-header");_.isEmpty(t)?e.parent().addClass("hidden"):e.html(t.text)}buildQuestionText(){this._$container.find(".question-text").html(this.content.getChildrenOfType("Question")[0].text)}buildPromptText(){var t=this._singleSelect?"{tk_SelectYourChoice}":"{tk_SelectAll}",t=this.api.getPromptText(this.content.getFirstChildOfType("Prompt"),t);this._$container.find(".question-prompt").html(t)}buildQuestionPanel(){var t=this._$container.find(".question-panel");t.addClass("enabled"),this.api.model.touchSupport||t.addClass("desktop")}buildQuestionImage(t="QuestionImage"){var e=this._$container.find(".question-image"),i=this.content.parent?this.content.parent.getChildByAttribute("id","imgQuestion"):null;return!_.isEmpty(i)&&(t=_.template(this.api.getTemplate(t).content),e.html(t({src:i.attributes.src,alt:i.getChildrenOfType("Description")[0].text})),!0)}buildChoices(t="QuestionChoice",e){var i=this.content.getChildrenOfType("Choice").concat();return"true"!==this._data.attributes.randomChoicesOnStart&&"true"!==this._data.attributes.randomChoicesOnStart||s.shuffleArray(i),e=e||this._$container,this.processChoices(i,t,e)}processChoices(i,s,a){var n={};let r=null;var t=i.length;for(let e=0;e<t;e++){var o,l=i[e],d=r?r.clone():a.find(".question-option"),h=this.assignIdsToOptionContents(l,d,e);let t="";_.isEmpty(l.text)||(l.text=l.attributes.src?l.text.replace(/<[^>]+>/g,""):l.text,o=_.template(this.api.getTemplate(s).content),t=o(l)),d.find(".question-option-text").html(t),d.removeClass("showSeparator"),d.removeClass("hasTextLabel"),d.removeClass("hasOptionImg"),_.isEmpty(l.text)||d.addClass("hasTextLabel"),r&&d.insertAfter(r),_.isEmpty(l.attributes.value)||d.find(".question-option-value").html(l.attributes.value),_.isEmpty(l.attributes.src)||d.addClass("hasOptionImg"),_.isEmpty(l.text)||_.isEmpty(l.attributes.value)||d.addClass("showSeparator"),n[h]={id:h,itestableID:l.attributes.itestableID,profileValue:$(l.sourceXML).attr("id"),branchingValue:$(l.sourceXML).attr("id"),interactionID:$(l.sourceXML).attr("interactionID"),correct:"true"===l.attributes.correct,feedback:this.getFeedbackForOption(l),zoneTriggers:l.attributes.zoneTriggers,target:null,targetText:""},r=d}return n}assignIdsToOptionContents(t,e,i){var i=(this._isZone?this._zoneId+"-question-option-":"question-option-")+(i+1),t=t.attributes.itestableID,s=e.find("input");return e.attr("id",i),s.attr("id",i+"-input").attr("value",i),e.find("label").attr("for",i+"-input"),t&&e.attr("data-itestableID",t),i}getFeedbackForOption(e){for(let t=0;t<this._customFeedbackData.length;t++){var i=this._customFeedbackData[t];if(i.option===e)return i.feedback}return this._defaultFeedback}buildFeedback(){var e=this.content.getChildrenOfType("Choice").concat(),i=this.content.getChildrenOfType("Feedback"),s=i.length;this._customFeedbackData=[],this._defaultFeedback=null;for(let t=0;t<s;t++){var a=i[t];a.attributes.choiceNum?this._customFeedbackData.push({feedback:a,option:e[parseInt(a.attributes.choiceNum,10)-1],type:null}):a.attributes.type?this._customFeedbackData.push({feedback:a,option:null,type:a.attributes.type}):this._defaultFeedback=a}return[this._defaultFeedback,this._customFeedbackData]}}}(GLEPlugins=GLEPlugins||{}),function(u){var a=GLECore.TimeUtil,s=GLECore.QAModeManager,p=GLECore.AlertData,r=GLECore.ModalData,c=GLECore.AnalyticsManager,g=GLECore.TrackingManager,m=GLECore.DataUtil,n=GLECore.DisplayUtil,o=GLECore.Platform,l=GLECore.delay,d=GLECore.isInViewport;class C{constructor(t,e,i){this._isNoImage=!1,this._attempts=0,this.latencyTime=0,this._hasRequiredLinks=!1,this._requiredLinksSatisfied=!1,this._profiling=!1,this._branching=!1,this._isZone=!1,this._zoneId=null,this._zoneData=null,this._modalLaunchData={},this._countdownEnabled=!1,this.defineConfiguration=t=>{this.api=t.api,this.content=t.content,this._isZone=t.isZone,this._zoneId=t.zoneId,this._testable=t.assessment.iTestable,this._assessment=t.assessment,this._isAttitudinal=t.attitudinal,this._submitHandler=t.submitHandler,this.setTrackingComplete=!1,this.data=this.content.getChildrenOfType("Data")[0],this._profiling="true"===this.data.attributes.profiling,this._profileId=this.data.attributes.profileId,this._branching="true"===this.data.attributes.branching,this._branchId=this.data.attributes.branchId,this.isCertification="true"===this.data.attributes.certification,this._modalId="true"===this.data.attributes.modalFeedback?C.MODAL_ID_ABP:C.MODAL_ID,this._modalDelay=1e3*parseFloat(this.data.attributes.modalDelay),this._scrollSpeed=1e3*parseFloat(this.data.attributes.scrollSpeed),this._scrollEase=this.data.attributes.scrollEase,this._requiredLinksSatisfied=!0===this.api.getThisPageComplete(),this._isAdaptive=this._branching||this._profiling,this._objectiveIDs=null==(t=this.data.attributes.outcome)?void 0:t.split(","),this._countdownEnabled="true"===this.data.attributes.countdownEnabled,this._countdownDuration=parseFloat(this.data.attributes.countdownDuration),this._isAttitudinal&&(this._AttitudinalHelper=new u.AttitudinalHelper(this.api),this._AttitudinalHelper.init({plugin:this._instance,img:null})),this._isAdaptive&&(this._AdaptiveHelper=new u.AdaptiveQuestionHelper(this.api,this._AlertManager),this._AdaptiveHelper.init({zoneId:this._zoneId,profileId:this._profileId,branchId:this._branchId,qaProfilingDisabled:s.QA_PROFILING_DISABLED})),this._Builder=new u.QuestionBuilder(this.api,this.content,{zoneId:this._zoneId,singleSelect:this._singleSelect})},this.build=()=>(this.$container=this._Builder.buildContainer(),this.buildQuestionPanel(),this.latencyTimer=window.setInterval(()=>{this.latencyTime++},1e3),this.$container.html()),this.program=()=>{this.programReferences(),this.programAlert(),this.trackInit(),this.restoreFromStorage(),this.api.addEvent("apiEvent",this.apiHandler),this.programClasses(),this.programCountdownTimer()},this.programChoice=t=>{var t=this._$option.eq(t).find("input"),e=t.closest("div"),i=this._choices[e.attr("id")];i.target=e,t.attr("aria-label",null),i.targetText=1<e.find("label").length?C.buildDelimitedResponse(i):e.text(),t.bind("change",this.choiceSelectHandler)},this.initializeCounter=()=>{var t=$(this._containerSelector+" .countdown-container"),e=$(this._containerSelector+" .countdown-container .progress-ring-circle");this._$countdown=t.find(".time"),n.drawCircle(e,100),e.addClass("animate")},this.onCountdownTick=()=>{var t=$(this._containerSelector+" .countdown-container"),t=d(t.get(0),50)&&t.is(":visible");this._isZone&&!t||(--this._countdownValue,this.updateCountdownDisplay(),0===this._countdownValue&&(clearInterval(this._countdownInterval),this.renderCountdownFeedback()))},this.restartCounter=()=>{this._ModalManager.closeModal(C.MODAL_ID_COUNTDOWN),this.programCountdownTimer()},this.apiHandler=t=>{var e;t.data&&("required_links"===(null==(e=t.data.activity)?void 0:e.id)&&(!1===t.data.activity.complete?(this._hasRequiredLinks=!0,this._requiredLinkAlertId=t.data.activity.alert,this._requiredLinksSatisfied=!0===this.api.getThisPageComplete()):this._requiredLinksSatisfied=!0),this._isAdaptive)&&("pageComplete"!==t.data.type||this._RouteManager.areOnLastProfilePage()||this.autoAdvancePage(),"routeAndTrackingUpdate"!==t.data.type||this._isZone||this.autoAdvancePage())},this.choiceSelectHandler=()=>{if(this._isZone&&this._profiling)return this._AdaptiveHelper.profiledZoneChoiceSelectHandler($("#"+this._zoneData.zoneId));var t=0===this.$container.find("input:checked").length;this.$submitButton.attr("disabled",t?"disabled":null)},this.submitHandler=()=>{if(this.pauseCountdown(),this._isZone&&this._profiling&&this._AdaptiveHelper.confirmZoneProfileSubmission())return[];if(this._isAdaptive&&this._AdaptiveHelper.handleSubmitProfilingActions(),!this._isZone&&this._hasRequiredLinks&&!this._requiredLinksSatisfied)return t={id:"tracking_alert",content:"{tk_"+this._requiredLinkAlertId+"}"},this._AlertManager.showAlert(new p(t)),[];this.$submitButton.attr("disabled","disabled").addClass("answered"),this._attempts++;var i=[],s=this.$container.find("input:not(.confidence):checked"),a=[];let n=[],r=[];for(let t=0,e=s.length;t<e;t++){var o=s.eq(t),l=this._choices[o.attr("value")],d=(null==(d=this._zoneData)?void 0:d.cleanTriggers(l.zoneTriggers))||[],h=(null==(h=this._zoneData)?void 0:h.groupBranches(l.zoneTriggers))||[];i.push(l),a.push(o.attr("id")),n=Array.from(new Set(n.concat(d))),r=Array.from(new Set(r.concat(h)))}var t=this._isAdaptive||u.MultiZone.activeZone instanceof u.BranchingZones,e=u.MultiZone.activeZone instanceof u.BranchingZones,c=this._isZone&&(this._isAdaptive||u.MultiZone.activeZone.mode===u.ZoneMode.Branching),e=(this._isZone&&(this._zoneData.selectedBranches=n,this._zoneData.selectedGroups=r),(e||c)&&u.MultiZone.activeZone.updateBranches(this._zoneData,t),C.calculateFeedbackType(i,this._choiceList));return C.storage[this._storageId]=this._singleSelect?a[0]:a,this._lastSelections={correct:e,selection:s,options:this._choiceList},this._testable&&"continuous"===this._assessment.flow&&(c=C.buildInteractionResponses(i),this.trackInteractionCompletion(c,e===C.FEEDBACK_CORRECT?"correct":"wrong"),this._assessment.onQuestionSubmit(this._lastSelections)),i},this.onModalClose=()=>{this.hideFeedback()},this.onContinue=()=>{this.quizComplete()},this.autoAdvancePage=(t=null)=>{var e=this.autoAdvance&&!this._isZone||this.autoAdvance&&this._AdaptiveHelper.IsLastProfilingZone,i=this.api.model.currentPage.complete;e&&(i?_.isEmpty(t)?(this.autoAdvance=!1,this.api.callNextPage()):(this.autoAdvance=!1,this.api.callPage(t)):l(()=>this.autoAdvancePage(t)))},this.attachOpenClass=()=>{this.$feedbackPanel.addClass("opened")},this.detachOpenClass=()=>{this.$feedbackPanel.removeClass("opened")},this.hideFeedback=()=>{this._ModalManager.closeModal(this._modalId),this._modalVisible=!1,this.$questionPanel.find("input").attr("disabled",null),this.$container.removeClass("feedback"),$(this._containerSelector+" .question-area").attr("aria-hidden",null),this.resetQuiz()},this.quizComplete=()=>{this._ModalManager.closeModal(this._modalId),this._testable&&"incremental"===this._assessment.flow?this._assessment.onQuestionSubmit(this._lastSelections):this._isZone&&this._isAttitudinal?(this.$container.removeClass("feedback"),this.resetQuiz()):this._isZone?this.$questionPanel.find("input").attr("disabled","disabled"):this.api.callNextPage(),this._isZone&&u.MultiZone.activeZone.mode!==u.ZoneMode.Default&&u.MultiZone.activeZone.advanceZone(this._zoneData)},this.buildFeedbackModal=(t,e)=>{let i=t.find(".fdbk-indicator-area").html();var s=t.find(".feedback-summary").html().replace(/^\s+/gim,""),t=!!t.find(".retry-button").length,t=this.buildButtonArray(t);this._modalVisible=this.api.model.currentBreakpointValue<=o.DEVICE_MEDIA_SIZE_MD_REM||"true"===this.data.attributes.modalFeedback||this._isNoImage;const a=!this._modalVisible;_.isEmpty(i)||(i=i.replace(/<(\/)?h2/gim,"<$1div"));s={id:this._modalId,header:i,content:s,srcElement:"root",buttons:t,hasExit:this._isAttitudinal,isFullScreen:!1,$launcher:this.$submitButton,exitCallback:this.onModalClose,isAlert:!1,preventClickOutsideDismiss:!0};const n=new r(s.id,s.header,s.content,s.srcElement,s.buttons,s.hasExit,s.$launcher,null,s.isFullScreen,s.isAlert,s.preventClickOutsideDismiss,s.exitCallback);this._isAttitudinal?(this.launchModal(n,e,a),this.reenableFeedbackButton()):this._modalTimeout=window.setTimeout(()=>{this.launchModal(n,e,a),this.reenableFeedbackButton()},this._modalDelay)},this.focusFeedback=t=>{var e=$(":focus");e.length&&!e.hasClass("submit-button")||(e.blur(),$(this._containerSelector+" .question-area").attr("aria-hidden","true"),this._isZone?(e=(e=$(this._containerSelector+" .question-feedback-content h2")).length?e:$(this._containerSelector+" .question-feedback-content"),$(`.zone:not(#${this._zoneData.zoneId})`).attr("aria-hidden","true"),e.attr("tabindex","-1").attr("data-focus-override","true").focus(),setTimeout(this.reenableZoneReadability,10)):$(this._containerSelector+" .question-feedback-content").attr("tabindex","-1").attr("data-focus-override","true").focus(),t.attr("tabindex","0"))},this.reenableZoneReadability=t=>{$(`.zone:not(#${this._zoneData.zoneId})`).attr("aria-hidden",null)},this.launchModal=(t,e,i=!1)=>{!0===i?(this._modalLaunchData={modalData:t,fbtype:e},$(window).on("resize",this.launchModalOnDelay)):(i=this._ModalManager.openModal(t,!0),!0!==this._isAttitudinal&&i.find("header > h2").addClass(e))},this.launchModalOnDelay=()=>{this.api.model.currentBreakpointValue<=o.DEVICE_MEDIA_SIZE_MD_REM&&($(window).off("resize",this.launchModalOnDelay),this.launchModal(this._modalLaunchData.modalData,this._modalLaunchData.fbtype))},this._instance=t,this._singleSelect=i,this._RouteManager=e.RouteManager,this._AlertManager=e.AlertManager,this._ModalManager=e.ModalManager,this._TrackingManager=e.TrackingManager}static initInteractionData(n,t,r,o,e){const l={n:t};t=$(n.sourceXML);let i=r?"_"+(o+1):"";var s=n.getFirstAncestorElementByName("Page"),a=n.getFirstAncestorElementByName("Zone");const[d,h]=c.getInteractionInfo(n,r);_.isEmpty(a)||(i="_"+a.attributes.zoneID+i),l.id=m.standardizeId(s.attributes.pageID+i),d&&(l.id=d),l.type=e,l.correct_responses=[],l.long_correct_responses=[{pattern:"{order_matters=false}"}],l.long_response_lookup={};a=t.find(r?"QuestionText":"Question").text(),l.description=a.replace(/<[^>]+>/gim,"").substr(0,255),s=r?"Response":"Choice";return n.getAllDescendantsOfType(s).forEach((t,e)=>{var i=t.attributes.value?t.attributes.value+" "+t.text:t.text,s=l.long_correct_responses[0].pattern.match(/{order_matters=false}$/gim)?"":"[,]",a=C.getOptionId(n,h,e),a=g.generateShortIdentifier(o+1,a,i,r?"CA":"");l.long_response_lookup[e]=a,"true"===t.attributes.correct&&(l.correct_responses.push({pattern:e.toString()}),l.long_correct_responses[0].pattern+=s+a),t.attributes.interactionID=e.toString(),$(t.sourceXML).attr("interactionID",e)}),g.addInteractionIdToSource(n,l.id),[l]}static getOptionId(t,e,i){t=t.getAllDescendantsOfType("ConfidenceChoice");return _.isEmpty(t)?e?e[i]:i:(i+10).toString(36)+":<confidence>"}set overrideFeedbackPanelRender(t){this._overrideFeedbackPanelRender=t}set zoneData(t){this._zoneData=t}get isAttitudinal(){return this._isAttitudinal}get lastSelections(){return this._lastSelections}get containerSelector(){return this._containerSelector}get choices(){return this._choices}buildHeader(){this._Builder.buildHeader()}buildQuestionText(){this._Builder.buildQuestionText()}buildPromptText(){this._Builder.buildPromptText()}buildQuestionPanel(){this._Builder.buildQuestionPanel()}buildQuestionImage(t){this._Builder.buildQuestionImage(t)||(this._isNoImage=!0,this._modalId=this._testable?C.MODAL_ID:C.MODAL_ID_ABP)}buildChoices(t){this._choices=this._Builder.buildChoices(t,this.$container),this._choiceList=m.objectValues(this._choices)}buildFeedback(){[this.defaultFeedback,this._customFeedbackData]=this._Builder.buildFeedback()}programReferences(){this.setContainerSelector(),this.$container=$(this._containerSelector),this.$questionForm=$(this._containerSelector+" .question-form:not(.confidence)"),this.$questionForm.submit(this._submitHandler),this.$submitButton=$(this._isZone?`#${this._zoneData.zoneId} .submit-button:not(.confidence)`:".submit-button:not(.confidence)"),this._isAdaptive&&(this._AdaptiveHelper.$submitButton=this.$submitButton),this._$option=$(this._containerSelector+" .question-option:not(.confidence)"),this._$option.each(this.programChoice)}programAlert(){this._isZone&&this._profiling&&u.MultiZone.activeZone.addNavigationAlert(this.api.parseTokens("{tk_altProfileEarlyExit}"))}setContainerSelector(){this._isZone?this._containerSelector=`#${this._zoneData.zoneId} .question-body`:this._containerSelector=this._testable?"#assessment-question-container":".question-body"}static buildDelimitedResponse(t,i="/"){var s=t.target.find("label");let a="";for(let t=0,e=s.length;t<e;t++){var n=s.eq(t).text();_.isEmpty(n)||0===n.replace(/\s+/gim,"").length||(a=_.isEmpty(a)?n:a+` ${i} `+n)}return a}programClasses(){this._isNoImage&&this.$container.addClass("noimage"),"true"===this.data.attributes.modalFeedback&&this.$container.addClass("modal-abp"),this._isZone&&this._profiling&&this._AdaptiveHelper.setProfilingZoneClasses()}programCountdownTimer(){this._countdownEnabled&&(clearInterval(this._countdownInterval),this._countdownValue=this._countdownDuration,this._countdownInterval=window.setInterval(this.onCountdownTick,1e3),this.renderTimer())}renderTimer(){var t=null!=(t=null==(t=this.content.getFirstChildOfType("CountdownPrompt"))?void 0:t.text)?t:"{tk_CountdownPrompt}",t=_.template(this.api.getTemplate("QuestionCountdownTimer").content)({time:this._countdownDuration,prompt:this.api.parseTokens(t)}),e=$(this._containerSelector+" .countdown-container");e.html(t),e.addClass("enabled"),this.initializeCounter()}pauseCountdown(){clearInterval(this._countdownInterval)}resumeCountdown(){this._countdownEnabled&&(this._countdownInterval=window.setInterval(this.onCountdownTick,1e3))}updateCountdownDisplay(){var t=$(this._containerSelector+" .countdown-container .progress-ring-circle"),e=Math.round(100*(this._countdownValue-1)/this._countdownDuration);this._$countdown.html(this._countdownValue.toString()),n.drawCircle(t,Math.max(e,0))}renderCountdownFeedback(){var t=$(this._containerSelector+" .countdown-container .progress-ring-circle"),e=null!=(e=null==(e=this.content.getFirstChildOfType("CountdownFeedbackHeader"))?void 0:e.text)?e:"{tk_CountdownFeedbackHeader}",i=this.content.getFirstChildOfType("CountdownFeedback").text,s=new ModalButton("countdown-retry",this.api.parseTokens("{tk_TryAgain}"),this.restartCounter),e=r.create({id:C.MODAL_ID_COUNTDOWN,header:this.api.parseTokens(e),content:i,buttons:[s],$launcher:null});t.removeClass("animate"),this._ModalManager.openModal(e,!0),this.api.sendEvent({destination:"Style",type:"applyPageClasses"})}restoreFromStorage(){var t;!this._isAdaptive&&this.getAdvancedZoneContext()&&this.restoreZoneResponsesFromStorage(),this._isAdaptive&&(t=this._AdaptiveHelper.restoreProfilesFromStorage(this._RouteManager.profilingResponses,this._choiceList),_.isEmpty(t)||this.deactivateActivity(t),this._isZone)&&(t=this._AdaptiveHelper.restoreZonedProfilesFromStorage(this._RouteManager.profilingResponses,this._choiceList),this.selectChoices(t),_.isEmpty(t)||this.$submitButton.hasClass("restored")||this.$submitButton.attr("disabled",null))}getAdvancedZoneContext(){var t=this.api.trackingData.bz;return!(!t||!t["p"+this.api.model.currentPage.id])}restoreZoneResponsesFromStorage(){var t=this.api.trackingData.bz["p"+this.api.model.currentPage.id][this._zoneId];_.isEmpty(t)||(t=t.map(t=>$(this._containerSelector+" #"+t)),this.selectChoices(t),this._zoneData.complete=!0)}static buildInteractionResponses(t){return t.map(t=>t.interactionID)}deactivateActivity(t,e=!1){this.selectChoices(t),this._RouteManager.profilingActive&&!0!==e||(this.$submitButton.hide(),$(this._containerSelector+" .question-panel").removeClass("enabled").addClass("disabled"),$(this._containerSelector+" .question-option").each((t,e)=>{$(e).unbind("change",this.choiceSelectHandler),$(e).find("input")[0].disabled=!0}))}selectChoices(t){t.forEach(t=>{t=t.find("input");_.isEmpty(t)||(t[0].checked=!0)})}trackInteractionCompletion(t,e,i){var s=$(this.content.sourceXML).attr("interactionID");this._TrackingManager.setScormInteraction({latency:a.formatLatencyTime(this.latencyTime),interactionID:s,objectiveIDs:this._objectiveIDs,responses:t,result:e,weighting:i}),clearInterval(this.latencyTimer)}buildFeedbackContainer(e){var i=C.calculateFeedbackType(e,this._choiceList);let s;if(this._profiling)this.handleProfilingFeedback(e);else if(this._branching)this.handleBranchingFeedback(e);else if(!0!==this.isCertification||i===C.FEEDBACK_CORRECT){this._isZone&&this.handleZoneResponseSubmission(e);let t;switch(i){case C.FEEDBACK_CORRECT:s=this.getCustomFeedback(i,e),t=this.renderFeedback(e,C.FEEDBACK_CORRECT,!0===this.isCertification?"{tk_CertificationPrompt}":"{tk_ThatIsCorrect}",s);break;case C.FEEDBACK_PARTIAL:s=this.getCustomFeedback(i,e),t=this.renderFeedback(e,C.FEEDBACK_PARTIAL,"{tk_PartiallyCorrect}",s);break;default:s=this.getCustomFeedback(i,e),t=this.renderFeedback(e,C.FEEDBACK_INCORRECT,"{tk_ThatIsIncorrect}",s)}if(!_.isEmpty(s))return t;this.autoAdvance=!0,this.setTrackingComplete=!0,this.trackCompletion()}}getCustomFeedback(t,e){t=_.find(this._customFeedbackData,{type:t});return t?t.feedback.text:this.getChoiceFeedback(e)}handleProfilingFeedback(e){this._AdaptiveHelper.handleProfilingFeedback(e,this._choices).then(()=>{this.autoAdvance=!0;var t=C.buildInteractionResponses(e);this.trackInteractionCompletion(t,C.FEEDBACK_NEUTRAL),this.setTrackingComplete=!0,this.api.model.getCurrentPage().complete&&!this._RouteManager.areOnLastProfilePage()?(t=this._RouteManager.reviewPageReference,this.autoAdvancePage(t)):(t=this._RouteManager.areOnLastProfilePage()&&!this._isZone,this.trackCompletion(t))})}handleBranchingFeedback(t){this._AdaptiveHelper.handleBranchingFeedback(t),this.autoAdvance=!0,this.setTrackingComplete=!0,this.trackCompletion()}handleZoneResponseSubmission(t){u.MultiZone.activeZone instanceof u.BranchingZones&&u.MultiZone.activeZone.updateQuestionResponses(this._zoneData,t)}getChoiceFeedback(t){return 1!==t.length?t[0].feedback.text:_.isUndefined(_.get(this._choices[t[0].id],"feedback.text"))?"":this._choices[t[0].id].feedback.text}renderFeedbackContainer(t){t=C.calculateFeedbackType(t,this._choiceList);this._isAttitudinal?this._AttitudinalHelper.programFeedbackPanel():(this.$retryButton.click(()=>{this.resumeCountdown(),this.hideFeedback()}),this.$continueButton.click(this.quizComplete)),this.displayFeedbackImage(t),this._overrideFeedbackPanelRender&&!this._branching?this._overrideFeedbackPanelRender(this.$feedbackPanel,t):(this.$container.addClass("answered"),this.$container.addClass("feedback"),this.$questionPanel.find("input").attr("disabled","disabled"),this.$container.find(".close-button").click(this.hideFeedback),this.$feedbackPanel.find(".question-feedback-content").focus(),setTimeout(this.attachOpenClass,0),this.buildFeedbackModal(this.$feedbackPanel,t))}displayFeedbackImage(t){var e,i,t=this.getFeedbackImageElement(t);t&&(e=$(this._containerSelector+" .feedback-image"),i=t.getChildrenOfType("Description")[0].text,e.attr("src",t.attributes.src),e.attr("alt",i),e.addClass("show-image"))}getFeedbackImageElement(t){this.content.getChildrenOfType("Image");var e=this.content.getChildByAttribute("id","attitudinalGFX"),i=this.content.getChildByAttribute("id","fdbkImgCorrect"),s=this.content.getChildByAttribute("id","fdbkImgPartial"),a=this.content.getChildByAttribute("id","fdbkImgIncorrect"),n=this.content.getChildByAttribute("id","fdbkImg");return e||(i&&t===C.FEEDBACK_CORRECT?i:s&&t===C.FEEDBACK_PARTIAL?s:a&&t===C.FEEDBACK_INCORRECT?a:n||null)}static calculateFeedbackType(t,e){var i=t.filter(C.filterCorrectResponses),e=e.filter(C.filterCorrectResponses);return 0===i.length?C.FEEDBACK_INCORRECT:i.length===e.length&&i.length===t.length?C.FEEDBACK_CORRECT:C.FEEDBACK_PARTIAL}static filterCorrectResponses(t){return t.correct}configureFeedbackComponents(){this.$questionPanel.removeClass("enabled"),this.$questionPanel.addClass("disabled"),this.$feedbackPanel.removeClass("correct"),this.$feedbackPanel.removeClass("incorrect"),this.$retryButton.unbind("click",this.hideFeedback),this.$retryButton.unbind("click",this.quizComplete)}renderFeedback(t,e,i,s){var a=C.buildInteractionResponses(t);if(this._isAttitudinal)return this.trackInteractionCompletion(a,"neutral"),this._AttitudinalHelper.renderFeedback(s,"true"===this.data.attributes.showExploreOther);let n,r;var a={},o=!this.needsMoreAttempts()||e===C.FEEDBACK_CORRECT;return!o||this._testable&&"continuous"===this._assessment.flow||(this.setTrackingComplete=!0,t=C.buildInteractionResponses(t),this.setInteractionCompletion(e,t),this.trackCompletion()),e===C.FEEDBACK_CORRECT?(n=!0,r=!1,a.showCorrections=!1):(n=o,r=!o,a.showCorrections=o&&"true"===this.data.attributes.showCorrections),this._isZone&&(n=!1),a.content=this.generateFeedbackHtml({indicatorClass:e,showContinueButton:n,showRetryButton:r,feedbackHeader:this.api.parseTokens(i),feedbackContent:s}),a}setInteractionCompletion(t,e){t===C.FEEDBACK_CORRECT?this.trackInteractionCompletion(e,"correct"):this.trackInteractionCompletion(e,"wrong")}renderIndicators(t){this._isAttitudinal||t.forEach(t=>{t.target.find("input").attr("aria-label",t.correct?this.api.parseTokens("{tk_Correct}"):this.api.parseTokens("{tk_Incorrect}")),t.target.addClass(t.correct?C.FEEDBACK_CORRECT:C.FEEDBACK_INCORRECT)})}needsMoreAttempts(){var t=parseInt(this.data.attributes.numAttempts,10);return this._attempts<t||-1===t}renderCorrections(e){this._choiceList.forEach(t=>{t.correct&&-1===e.indexOf(t)&&this.$questionPanel.find("#"+t.id).closest("div").addClass("correction")})}generateFeedbackHtml(t){return _.template(this.api.getTemplate("QuestionFeedbackContent").content)(t)}resetQuiz(){var t=$(this._containerSelector+" .question-option"),e=$(this._containerSelector+" .question-panel:not(.confidence)"),i=$(this._containerSelector+" .question-text");t.removeClass("correct incorrect"),t.find("input").attr("aria-label",null),e.find("input").attr("disabled",null),e.find("input:checked").each(this.clearResponses),"true"===this.data.attributes.randomChoicesOnReset&&($(this._containerSelector+" .question-option:gt(0)").remove(),this.buildChoices(),this._$option=$(this._containerSelector+" .question-option"),this._$option.each(this.programChoice)),this.detachOpenClass(),this.$submitButton.attr("disabled","disabled").removeClass("answered"),i.attr("tabindex","-1").focus()}clearResponses(){$(this).get(0).checked=!1}reenableFeedbackButton(){var t,e,i=$(this._containerSelector+" .fb-button"),s=i.closest(".question-feedback-content").find(".feedback-header"),s=i.length&&s.length?0:this._modalDelay,a=this._testable?$("#CourseAssessment1-body"):$(""+this._containerSelector);this._modalVisible||(this._isZone?(e=0===(t=a.closest(".zone")).index()?0:t.position().top,this.scrollContainer(t.closest(".mz-body"),i,s,e)):this.scrollContainer(a,i,s,0))}scrollContainer(t,e,i,s=0){t.delay(i).animate({scrollTop:s},this._scrollSpeed,this._scrollEase,()=>{this.focusFeedback(e)})}buildButtonArray(t){var e=[],i=new ModalButton("quiz-continue",this._isZone?this.api.parseTokens("{tk_CloseUpperCase}"):this.api.parseTokens("{tk_ContinueButton}"),this.onContinue.bind(this)),s="true"===this._instance.data.attributes.showExploreOther;return!0===this._isAttitudinal?(s&&e.push(new ModalButton("quiz-explore",this.api.parseTokens("{tk_Attitudinal_Explore}"),this.onModalClose.bind(this))),e.push(i)):e.push(!0===t?new ModalButton("quiz-retry",this.api.parseTokens("{tk_TryAgain}"),()=>{this.resumeCountdown(),this.onModalClose()}):i),e}destroy(){this.api.removeEvent("apiEvent",this.apiHandler),clearTimeout(this._modalTimeout),clearInterval(this._countdownInterval),$(window).off("resize",this.launchModalOnDelay)}}C.FEEDBACK_CORRECT="correct",C.FEEDBACK_PARTIAL="partial",C.FEEDBACK_INCORRECT="incorrect",C.FEEDBACK_NEUTRAL="neutral",C.MODAL_ID="quiz-feedback-modal",C.MODAL_ID_ABP="quiz-feedback-modal-abp",C.MODAL_ID_COUNTDOWN="quiz-feedback-modal-countdown",C.storage={},u.QuizUtil=C}(GLEPlugins=GLEPlugins||{}),function(t){var e=GLECore.delay;class i extends t.IPluggable{constructor(t){super(t),this.onConfidenceSelected=t=>{this._$confidence=$(t.currentTarget),this._confidence=parseInt(this._$confidence.val()),this.setViewState()},this.onSubmit=()=>{var t=this._$confidence.attr("id"),e=this._confidence;this._$container.addClass("disabled"),this._$options.attr("disabled","disabled"),this._$submit.attr("disabled","disabled"),this._resolvePromise({id:t,value:e}),this._$container.closest(".confidence-body").removeClass("revealed")}}set containerSelector(t){this._containerSelector=t}set scrollProps(t){this._scrollSpeed=t.speed,this._scrollEase=t.ease,this._scrollDelay=t.delay}set $parent(t){this._$parent=t}get confidence(){return this._confidence}selectConfidence(){return new ES6Promise(t=>{this._resolvePromise=t})}deactivate(t,e){t=_.first(t.filter(t=>t.match(/^confidence/)));this._$confidence=$(""+this._containerSelector).find("#"+t),this._$container.addClass("disabled"),this._$confidence.prop("checked",!0),this._response=e,this._$options.attr("disabled","disabled"),this.reveal(!1)}reactivate(){this._$container.removeClass("disabled"),this._response=null,this._confidence=null,this._$confidence=null,this._$options.attr("disabled",null),this._$options.prop("checked",null),this.setViewState()}build(t,e){return super.build(t,e),this.buildHtml()}buildHtml(){var t=_.template(this.api.getTemplate("p_confidence_widget").content),e=this.content.getFirstChildOfType("Intro"),i=this.content.getFirstChildOfType("Prompt"),s=this.content.getChildrenOfType("ConfidenceChoice");return t({intro:e,prompt:i,choices:s,numColumns:s.length})}program(t){super.program(t),this.storeJQueryReferences(),this.wireChoiceSelection(),this.setViewState()}storeJQueryReferences(){this._$container=$(""+this._containerSelector).find(".widget-wrapper"),this._$submit=this._$container.find(".submit-button")}wireChoiceSelection(){this._$container.find("form").submit(this.onSubmit),this._$options=this._$container.find(".question-option.confidence input"),this._$options.on("change",this.onConfidenceSelected)}setViewState(){var t=!!this._response,e=!!this._$confidence;this._$options.attr("disabled",t?null:"disabled"),this._$submit.attr("disabled",e?null:"disabled")}onChoiceSelected(t){this._response=t,this.clearConfidence(),this.setViewState(),this.reveal()}clearConfidence(){this._$confidence=null,this._$options.prop("checked",!1)}reveal(t=!0){this._$container.addClass("ready"),this._$container.closest(".confidence-body").addClass("revealed"),this._$container.find(".answer-text").html(this._response.targetText),e(()=>{this._$container.position().top;this._$container.addClass("render"),t&&this._$container.get(0).scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},this._scrollDelay)}}t.ConfidenceWidget=i}(GLEPlugins=GLEPlugins||{}),function(t){t.ZoneProfileHelper=class{constructor(t){this._RouteManager=t}get active(){return this._RouteManager.profilingActive}cleanup(t,e,i){this._RouteManager.profilingActive&&(t=(t?e.concat():e.filter(t=>!_.find(i,{zoneId:t.zoneId}))).filter(t=>$(t.content.sourceXML).find("Data[profileId]").length).map(t=>$(t.content.sourceXML).find("Data[profileId]").attr("profileId")),_.each(t,t=>delete this._RouteManager.profilingResponses[t]))}evaluate(t){var t=t.filter(t=>$(t.content.sourceXML).find("Data[profileId]").length),e=this._RouteManager.profilingResponses;if(!_.isEmpty(t)&&!_.isEmpty(e))return this.restoreZonesFromProfiles(t,e)}restoreZonesFromProfiles(t,i){let s=!1;return _.each(t,t=>{var e=$(t.content.sourceXML).find("Data[profileId]").attr("profileId");i[e]&&(t.hidden=!1,t.rendered=!0,t.complete=!0,s=!0)}),s}}}(GLEPlugins=GLEPlugins||{}),function(t){var d=GLECore.ApplicationEvent;t.ZoneBranchingHelper=class{constructor(t,e,i){this._active=t,this._Controller=e,this._TrackingManager=i}get active(){return this._active}cleanup(t,e,i){var e=t?e.concat():e.filter(t=>!_.find(i,{zoneId:t.zoneId})),s=i.map(t=>t.zoneId);const a=this._Controller.trackingData.bz["p"+this._Controller.model.currentPage.id],n=(null===a||void 0===a?void 0:a.viewed)||[];var r=$(".zone.rendered").last().attr("id"),s=s.indexOf(r);let o=!1;if(a)if(t)delete this._Controller.trackingData.bz["p"+this._Controller.model.currentPage.id],this._TrackingManager.saveAdvancedZoneBranching(),this._Controller.model.dispatchEvent(new d("apiEvent",{destination:"all",type:"saveAdvancedZoneBranching"}));else{for(let t=s+1;t<i.length;t++){var l=i[t],l=n.indexOf(l.zoneId);-1!==l&&(o=!0,n.splice(l,1))}e.forEach(t=>{var e=n.indexOf(t.zoneId);t.hasBeenViewed=!1,-1!==e&&(o=!0,n.splice(e,1)),a[t.zoneId]&&(o=!0,delete a[t.zoneId])}),o&&this._TrackingManager.saveAdvancedZoneBranching()}}evaluate(t){var e,i;return!!this.active&&(e=t.filter(t=>$(t.content.sourceXML).find("Choice[zoneTriggers]").length),i=this._Controller.trackingData.bz?this._Controller.trackingData.bz["p"+this._Controller.model.currentPage.id]:null,!_.isEmpty(e))&&!_.isEmpty(i)&&(this.renderViewedZones(t,i.viewed),this.restoreSelectionsFromStorage(e,i),this._Controller.model.currentPage.complete)}renderViewedZones(e,t){_.each(t,t=>{t=_.find(e,{zoneId:t});t&&(t.hidden=!1,t.rendered=!0)})}restoreSelectionsFromStorage(t,i){let s=!1;return _.each(t,e=>{var t=i[e.zoneId];t&&(e.selectedBranches=[],_.each(t,t=>{t=parseInt(t.replace(new RegExp("^.*?question-option-"),"")),t=$(e.content.sourceXML).find("Choice").eq(t-1),t=e.cleanTriggers(t.attr("zoneTriggers"));_.isEmpty(t)||(e.selectedBranches=e.selectedBranches.concat(t))}),e.selectedBranches=_.uniq(e.selectedBranches),e.hidden=!1,e.rendered=!0,e.complete=!0,s=!0)}),s}}}(GLEPlugins=GLEPlugins||{}),function(t){class e extends t.ZoneBranchingHelper{restoreSelectionsFromStorage(t,e){let s=!1;return _.each(t,i=>{var t=e[i.zoneId];t&&(i.selectedBranches=[],i.selectedGroups=[],_.each(t,t=>{var t=parseInt(t.replace(new RegExp("^.*?question-option-"),"")),t=$(i.content.sourceXML).find("Choice").eq(t-1),e=i.cleanTriggers(t.attr("zoneTriggers")),t=null!=(t=null==i?void 0:i.groupBranches(t.attr("zoneTriggers")))?t:[];_.isEmpty(e)||(i.selectedBranches=i.selectedBranches.concat(e),i.selectedGroups=i.selectedGroups.concat(t))}),i.selectedBranches=_.uniq(i.selectedBranches),i.selectedGroups=_.uniq(i.selectedGroups),i.hidden=!1,i.rendered=!0,i.complete=!0,s=!0)}),s}}t.ZonePresentationHelper=e}(GLEPlugins=GLEPlugins||{});
//# sourceMappingURL=plugins.js.map