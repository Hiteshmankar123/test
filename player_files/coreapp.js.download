//* GLE 2023-02-24 *//*
var GLEProfiling,pipwerks,GLECore,__awaiter=this&&this.__awaiter||function(e,r,o,l){return new(o=o||Promise)(function(i,t){function a(e){try{n(l.next(e))}catch(e){t(e)}}function s(e){try{n(l.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(a,s)}n((l=l.apply(e,r||[])).next())})};!function(e){e.contains=function(e){return!_.isEmpty(e)},e.containsNo=function(e){return _.isEmpty(e)}}(GLEProfiling=GLEProfiling||{}),function(s){function n(e,t=0){return window.setTimeout(e,t)}s.delay=n,s.trace=function(...i){if(window.location.href.match(/debug=true/))for(let e=0,t=i.length;e<t;e++)console.log(i[e])},s.isInViewport=function(e,t=100){var i;return!(!(e=null==e?void 0:e.getBoundingClientRect())||(i=window.innerHeight||document.documentElement.clientHeight,Math.floor(100-(0<=e.top?0:e.top)/-+e.height*100)<t)||Math.floor(100-(e.bottom-i)/e.height*100)<t)},s.transition=function(i,a){return new Promise(e=>{var t=null!=(t=a.delay)?t:0;n(()=>{a.type===s.TransitionType.RemoveClass?i.removeClass(a.class):i.addClass(a.class),a.callback&&a.callback()},t),n(()=>e(i),a.duration+t)})}}(GLECore=GLECore||{}),function(e){e.ApplicationEvent=class{constructor(e,t){this.type=e,this.data=t,this.target=null}}}(GLECore=GLECore||{}),function(e){var t;(t=e.BackgroundMediaType||(e.BackgroundMediaType={})).Audio="BackgroundAudio",t.Video="BackgroundVideo",(t=e.BackgroundMediaVolume||(e.BackgroundMediaVolume={}))[t.Muted=0]="Muted",t[t.Unmuted=1]="Unmuted",(t=e.BackgroundMediaState||(e.BackgroundMediaState={})).Paused="paused",t.Playing="playing",t.Play="play",t.Hidden="hidden",(t=e.AssessmentFlow||(e.AssessmentFlow={})).Continuous="continuous",t.Incremental="incremental",(t=e.FeedbackType||(e.FeedbackType={})).Correct="correct",t.Incorrect="incorrect",t.Partial="partial",t.Neutral="neutral",t.None="none",(t=e.AssessmentPhase||(e.AssessmentPhase={})).PreTest="pre",t.PostTest="post",(t=e.ConfidenceRating||(e.ConfidenceRating={}))[t.NotConfident=0]="NotConfident",t[t.LessConfident=1]="LessConfident",t[t.SomewhatCondfident=2]="SomewhatCondfident",t[t.Confident=3]="Confident",(t=e.StateChangeAlert||(e.StateChangeAlert={})).All="all",t.LanguageChange="lang",t.Navigation="nav",t.CourseExit="exit",(t=e.TrackingType||(e.TrackingType={})).Linear="linear",t.NonLinear="non-linear",(t=e.CompletionMode||(e.CompletionMode={})).Standard="c",t.RequiredPages="required_pages",(t=e.BooleanString||(e.BooleanString={})).True="true",t.False="false",(t=e.TransitionType||(e.TransitionType={})).AddClass="add",t.RemoveClass="remove"}(GLECore=GLECore||{}),function(e){e.IEventDispatcher=class{constructor(){this.__IEventDispatcher_callbacks=[]}addEventListener(t,i){for(let e=0;e<this.__IEventDispatcher_callbacks.length;e++){var a=this.__IEventDispatcher_callbacks[e];if(a.type===t&&a.handler===i&&a.target===this)return}this.__IEventDispatcher_callbacks.push({type:t,handler:i,target:this})}removeEventListener(t,i){for(let e=this.__IEventDispatcher_callbacks.length-1;0<=e;e--){var a=this.__IEventDispatcher_callbacks[e];a.type===t&&a.handler===i&&a.target===this&&this.__IEventDispatcher_callbacks.splice(e,1)}}dispatchEvent(i){const a=(i.target=this).__IEventDispatcher_callbacks;let s;var e=new ES6Promise(e=>{s=e});return a&&0<a.length&&setTimeout(()=>{for(let e=0;e<a.length;e++){var t=a[e];t.type===i.type&&t.target===i.target&&t.handler.call(this,i)}s(i)},0),e}destroy(){for(let e=this.__IEventDispatcher_callbacks.length-1;0<=e;e--){var t=this.__IEventDispatcher_callbacks[e];t.target===this&&(delete t.type,delete t.handler,this.__IEventDispatcher_callbacks.splice(e,1))}}}}(GLECore=GLECore||{}),function(a){class s{constructor(e,t){this._globals=e,this._contentMeta=t,this._tokens={},this.loadTokens()}get tokens(){return this._tokens}loadTokens(){var t=this._globals.getAllDescendantsOfType("Token"),e=this._contentMeta.getChildrenOfType("Token"),i=($.extend(t,e),t.length);for(let e=0;e<i;e++){var a=t[e];this._tokens[a.attributes.id]=a.text}}parseTokens(e){return this.extractContentTokens(e)}extractContentTokens(e){if(""===_.trim(e))return"";let t=s.convertTokens(e);if(null!==s.getTokens(t))for(;0<s.getTokens(t).length;){var i=s.getTokens(t);for(let e=0;e<i.length;e++)try{t=t.replace(i[e],this.getToken(s.getTokenId(i[e])))}catch(e){a.Trace.error("You're referring to a token that cannot be found: "+t)}t=s.convertTokens(t)}return t}static convertTokens(e){return e=e.replace(/(<Token[^>]id="(.*?)"\s*\/>)/gim,"{$2}")}getToken(e){return this._tokens[e]}static getTokens(e){let t=e.match(/{.*?}/gi);return t=null===t?[]:t}static getTokenId(e){return e.replace(/{|}|(\s*)/gi,"")}}a.TokenUtil=s}(GLECore=GLECore||{}),function(s){class r{constructor(e,t){this._courseInfo=e,this._SettingsManager=t,this._playerCSSPath="css/",this.handleCSSLoadErrors=(e,t,i,a)=>{_.isEmpty(e)||e.remove(),t?(s.Trace.warn("Missing optional css: "+i),a.resolve()):(s.Trace.error("Unable to load css: "+i),a.reject())},this._clientStyles=t.styleSettings.client,this._libraryStyles=t.styleSettings.library,this._libraryCSSPath=this._SettingsManager.getSettingValueGeneral("LibraryGlobalCSS")+"/",this._clientCSSPath=this._SettingsManager.getSettingValueGeneral("ClientGlobalCSS")+"/"+e.PlayerVersion+"/"}loadAppCss(){const e=$.Deferred(),t=$("link#"+r.LANGUAGE_ID);return $.when(this.loadPaletteCss()).done(()=>{$.when(this.loadLanguageCss("library"),this.loadLanguageCss("client"),r.clearPreviousLangCss(t),this.loadProductCss("library"),this.loadProductCss("client"),this.loadCustomFonts()).done(()=>{e.resolve()}).fail(()=>{e.reject()})}).fail(()=>{e.reject()}),e.promise()}loadPaletteCss(){const e=$.Deferred();let t="gle_"+this._courseInfo.DesignPalette,i=this._playerCSSPath;return"true"===this._clientStyles.base.loadPalette&&!0!==s.QAModeManager.QA_BLOCK_CLIENT_PALETTE_LOAD&&(_.isEmpty(this._clientStyles.base.fileName)||(t=this._clientStyles.base.fileName),i=this._clientCSSPath),$.when(this.dynamicCssLoad(r.PALETTE_ID,i+t)).done(()=>e.resolve()).fail(()=>{this.loadLibraryPalette(t,e)}),e.promise()}loadLibraryPalette(e,t){$.when(this.dynamicCssLoad(r.PALETTE_ID,this._libraryCSSPath+e)).done(()=>t.resolve()).fail(()=>t.reject())}loadLanguageCss(e){var t="gle_lang_"+this._courseInfo.LanguageCode;let i=this._libraryStyles.base.languages,a=this._playerCSSPath;var s=$.Deferred();return"client"===e&&(i=this._clientStyles.base.languages,a=this._clientCSSPath),this.isCurrentLanguageInList(i)?this.dynamicCssLoad(r.LANGUAGE_ID,a+t):s.resolve()}isCurrentLanguageInList(e){return!_.isEmpty(e)&&-1!==e.indexOf(this._courseInfo.LanguageCode)}static clearPreviousLangCss(e){var t=$.Deferred();return e.remove(),t.resolve()}loadProductCss(e){var t="gle_product_"+this._courseInfo.ProductCode;let i=this._libraryStyles.products,a=this._playerCSSPath;var s,n=$.Deferred();"client"===e&&(i=this._clientStyles.products,a=this._clientCSSPath);for(let e=0;e<i.length;e++)if(i[e].id===this._courseInfo.ProductCode)return s=i[e].languages,this.isCurrentLanguageInList(s)?(s=t+"_"+this._courseInfo.LanguageCode,this.loadMainAndLanguage(a,t,s)):this.dynamicCssLoad(r.PRODUCT_ID,a+t);return n.resolve()}loadCustomFonts(){var e=!window.location.href.match("file:///"),t=this._SettingsManager.getSettingValueGeneral(s.SettingsManager.SETTING_NAME_CUSTOM_FONT_URL),i=$.Deferred();return e&&!_.isEmpty(t)?this.webFontLoad(t):i.resolve()}loadMainAndLanguage(e,t,i){const a=$.Deferred();return $.when(this.dynamicCssLoad(r.PRODUCT_ID,e+t),this.dynamicCssLoad(r.PRODUCT_ID+"_"+r.LANGUAGE_ID,e+i)).done(()=>{a.resolve()}).fail(()=>{a.reject()}),a.promise()}webFontLoad(e){var t=$.Deferred(),e=r.createLink(r.WEBFONT_ID,e),i=$("link#"+r.WEBFONT_ID);return this.dynamicAssetLoad(e,i,t),t.promise()}dynamicCssLoad(e,t,i=!1){var a=$.Deferred(),s=(".css"!==t.substr(-4)&&(t+=".css"),Math.round(1e6*Math.random())),s=(t+="?cb="+s,$("link#"+e)),e=r.createLink(e,t);return this.dynamicAssetLoad(e,s,a,t,i),a}dynamicAssetLoad(e,t,i,a,s){$(e).on("load",e=>{r.hasLoadErrors(e)?this.handleCSSLoadErrors(t,s,a,i):(_.isEmpty(t)||t.remove(),i.resolve())}).on("error",()=>{this.handleCSSLoadErrors(t,s,a,i)}),document.getElementsByTagName("head")[0].appendChild(e)}static hasLoadErrors(e){var t=e.target.sheet;let i=null;try{i=t.cssRules}catch(e){return!1}return i&&!i.length}static createLink(e,t){var i=document.createElement("link");return i.rel="stylesheet",i.id=e,i.type="text/css",i.href=t,i.media="all",i}}r.PALETTE_ID="palette",r.LANGUAGE_ID="language",r.PRODUCT_ID="product",r.WEBFONT_ID="webfont",s.CssLoader=r}(GLECore=GLECore||{}),function(e){class a{static convertStringToBool(e){return"string"!=typeof e?e:"true"===e.toLowerCase()||"false"!==e.toLowerCase()&&e}static convertStringToInteger(e){var t;return"string"!=typeof e||(t=parseInt(e,10),isNaN(t))?e:t}static convertStringToNumber(e){var t;return"string"!=typeof e||(t=parseInt(e,10),isNaN(t))?e:t}static convertToValidHtml(e){if("string"!=typeof e)return e;let t=e;return t=t.replace(/<([^>]+?)(\s+[^>]+)?\s*\/\s*>/g,(e,t,i)=>(_.isEmpty(i)&&(i=""),-1!==a.SINGLE_TAG_FORMAT_NAME_EXCEPTIONS.indexOf(t)?e:"<"+t+i+"></"+t+">"))}static shuffleArray(e){let t=e.length;for(var i,a;0!==t;)a=Math.floor(Math.random()*t),i=e[--t],e[t]=e[a],e[a]=i;return e}static updatePathToCurrentProtocol(e){var t=location.protocol,i=/^https?:/gim,a=i.exec(e);return _.isEmpty(a)||a[0]===t?e:e.replace(i,t)}static trimTrailingSlashes(e){return _.isEmpty(e)?"":e.replace(/(?:(?:\\\s*)|(?:\/\s*))+$/g,"")}static isBase64(e){try{return btoa(atob(e))===e}catch(e){return!1}}static clone(e){return JSON.parse(JSON.stringify(e))}static getSupportedAudioExtension(){var e=document.createElement("audio");return e.canPlayType("audio/mpeg")?"mp3":e.canPlayType("audio/ogg")?"ogg":void 0}static getSupportedVideoExtension(){var e=document.createElement("video");return e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')?"mp4":e.canPlayType('video/ogg; codecs="theora, vorbis"')?"ogv":e.canPlayType('video/webm; codecs="vp8, vorbis"')?"webm":"mp4"}static objectValues(t){return Object.values?Object.values(t):Object.keys(t).map(e=>t[e])}static standardizeId(e){var i=e.split("_");if(i.length<=1)return e;for(let e=1,t=i.length;e<t;e++)isNaN(parseInt(i[e],10))||(i[e]=this.standardizeNumber(parseInt(i[e],10)));return i.join("_")}static standardizeNumber(e){return e.toString().match(/[^0-9]/gim)?e:e<10?"00"+e:e<100?"0"+e:e.toString()}}a.SINGLE_TAG_FORMAT_NAME_EXCEPTIONS="br".split(","),e.DataUtil=a}(GLECore=GLECore||{}),function(e){class t{static disableRootTabs(){$("body").find(t.ALL_ENABLED_ELEMENTS).attr("tabindex",-1).addClass("keyboard-disabled")}static enableRootTabs(){$("body").find(".keyboard-disabled").attr("tabindex",0).removeClass("keyboard-disabled")}static enableTabsOnTarget(e){e.find(t.INTERACTIVE_ELEMENTS).attr("tabindex",0)}static disableTabsOnTarget(e){e.find(t.INTERACTIVE_ELEMENTS).attr("tabindex",-1)}}t.INTERACTIVE_ELEMENTS="a,button,input,textarea,.magicBtn",t.ALL_ENABLED_ELEMENTS=t.INTERACTIVE_ELEMENTS+",*[tabindex=0]",e.KeyboardUtil=t}(GLECore=GLECore||{}),function(e){e.OfflineSVGLoader=class{static buildContainer(e){var t;_.isEmpty(e)||((t=document.createElement("div")).setAttribute("id","svg_offline"),t.style.cssText="position: absolute; display:none; left:-9999px",t.innerHTML=e,document.body.appendChild(t))}}}(GLECore=GLECore||{}),function(e){class t{constructor(){this._deviceType=t.DEVICE_DESKTOP}initialize(){this.setDeviceType()}setDeviceType(){/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints?this._deviceType=t.DEVICE_IOS:navigator.userAgent.match(/android/i)&&(this._deviceType=t.DEVICE_ANDROID)}getMediaSize(){return window.matchMedia("(max-width: "+(t.DEVICE_MEDIA_SIZE_SM_REM-.01)+"rem)").matches?t.DEVICE_MEDIA_SIZE_XS:window.matchMedia("(max-width: "+(t.DEVICE_MEDIA_SIZE_MD_REM-.01)+"rem)").matches||window.matchMedia("(max-width: "+(t.DEVICE_MEDIA_SIZE_LG_REM-.01)+"rem) and (orientation : landscape)").matches?t.DEVICE_MEDIA_SIZE_SM:window.matchMedia("(max-width: "+(t.DEVICE_MEDIA_SIZE_LG_REM-.01)+"rem)").matches||window.matchMedia("(max-width: "+(t.DEVICE_MEDIA_SIZE_XL_REM-.01)+"rem) and (orientation : portrait)").matches?t.DEVICE_MEDIA_SIZE_MD:window.matchMedia("(max-width: "+(t.DEVICE_MEDIA_SIZE_XL_REM-.01)+"rem)").matches?t.DEVICE_MEDIA_SIZE_LG:t.DEVICE_MEDIA_SIZE_XL}get deviceType(){return this._deviceType}}t.DEVICE_IOS="ios",t.DEVICE_ANDROID="android",t.DEVICE_DESKTOP="desktop",t.DEVICE_MEDIA_SIZE_XS="xs",t.DEVICE_MEDIA_SIZE_SM="sm",t.DEVICE_MEDIA_SIZE_MD="md",t.DEVICE_MEDIA_SIZE_LG="lg",t.DEVICE_MEDIA_SIZE_XL="xl",t.DEVICE_MEDIA_SIZE_ALL="all",t.DEVICE_MEDIA_SIZE_XS_REM=0,t.DEVICE_MEDIA_SIZE_SM_REM=34,t.DEVICE_MEDIA_SIZE_MD_REM=48,t.DEVICE_MEDIA_SIZE_LG_REM=62,t.DEVICE_MEDIA_SIZE_XL_REM=75,t.DEVICE_MEDIA_SIZE_SM_REM_MAX=t.DEVICE_MEDIA_SIZE_SM_REM-.01,t.DEVICE_MEDIA_SIZE_MD_REM_MAX=t.DEVICE_MEDIA_SIZE_MD_REM-.01,t.DEVICE_MEDIA_SIZE_LG_REM_MAX=t.DEVICE_MEDIA_SIZE_LG_REM-.01,t.DEVICE_MEDIA_SIZE_XL_REM_MAX=t.DEVICE_MEDIA_SIZE_XL_REM-.01,e.Platform=t}(GLECore=GLECore||{}),function(e){e.DisplayUtil=class{static drawCircle(e,t){var e=e.get(0),i=2*e.r.baseVal.value*Math.PI,t=isNaN(t)?i:i-t/100*i;e.style.strokeDasharray=i+" "+i,e.style.strokeDashoffset=t.toString()}}}(GLECore=GLECore||{}),function(e){e.XMLContainer=class{constructor(){this.attributes={},this.elements=[],this.meta=[],this.children=[],this.text="",this.type=null,this.hostElement=null,this.sourceXML=null,this.parent=null,this.complete=!1}getChildrenOfType(t){var i=[],a=this.children.length;for(let e=0;e<a;e++){var s=this.children[e];s.type===t&&i.push(s)}return i}getChildByAttribute(t,i){var a=this.children.length;for(let e=0;e<a;e++){var s=this.children[e];if(s.attributes[t]===i)return s}return null}getFirstChildOfType(e){e=this.getChildrenOfType(e);return e.length?e[0]:null}getChildrenLike(i,a,s=!0){var n=[];for(let e=0,t=this.children.length;e<t;e++){var r=this.children[e],o=(s?r.attributes:r)[i];_.isEmpty(o)||o.match(a)&&n.push(r)}return n}getAllDescendantsOfType(t,e){var i=e||[],a=this.children.length;for(let e=0;e<a;e++){var s=this.children[e];(s.type===t||Array.isArray(t)&&-1!==t.indexOf(s.type))&&i.push(s),s.getAllDescendantsOfType(t,i)}return i}getFirstAncestorElementByName(e){e=this.getAncestorElementsByName(this,e,!0);return null===e[0]||void 0===e[0]?null:e[0]}setAttribute(e,t){_.isString(e)&&(this.attributes[e]=t)}getAncestorElementsByName(e,t,i){let a=!0,s=e;for(var n=[];a;){var r=s.parent;null==r?a=!1:r.type===t?(n.push(r),i&&(a=!1)):s=r}return n}closest(e,t){return(t=t||this).parent?t.parent.type===e?t.parent:this.closest(e,t.parent):null}find(a,s=!1,n=[]){return _.each(this.children,e=>{let t=!0;for(var i in a)e.attributes[i]!==a[i]&&(t=!1);t&&n.push(e),e.find(a,s,n)}),s?_.first(n):n}getSiblingsByName(e){var t=this.parent;return t?t.getChildrenOfType(e):null}}}(GLECore=GLECore||{}),function(e){e.ViewingMode=class{constructor(){this._viewingModeValue="",this._audio="",this._subtitles="",this._audioOptionDisabled="",this._subtitleOptionDisabled="",this._audioOptionHidden="",this._subtitleOptionHidden=""}get viewingModeValue(){return this._viewingModeValue}set viewingModeValue(e){_.isEmpty(e)||(this._viewingModeValue=e.replace(/\s*/gim,""))}get audio(){return this._audio}set audio(e){null!=e&&(this._audio=e.replace(/\s*/gim,""))}get subtitles(){return this._subtitles}set subtitles(e){null!=e&&(this._subtitles=e.replace(/\s*/gim,""))}get audioOptionDisabled(){return this._audioOptionDisabled}set audioOptionDisabled(e){null!=e&&(this._audioOptionDisabled=e.replace(/\s*/gim,""))}get audioOptionHidden(){return this._audioOptionHidden}set audioOptionHidden(e){null!=e&&(this._audioOptionHidden=e.replace(/\s*/gim,""))}get subtitleOptionDisabled(){return this._subtitleOptionDisabled}set subtitleOptionDisabled(e){null!=e&&(this._subtitleOptionDisabled=e.replace(/\s*/gim,""))}get subtitleOptionHidden(){return this._subtitleOptionHidden}set subtitleOptionHidden(e){null!=e&&(this._subtitleOptionHidden=e.replace(/\s*/gim,""))}}}(GLECore=GLECore||{}),function(o){o.BackgroundMediaInstance=class{constructor(e,t,i,a,s,n,r){this._id=e,this._type=t,this._src=i,this._hideButton=a,this._autoplay=s,this._loop=n,this._selector=r,this._fallenBack=!1,this._state=o.BackgroundMediaState.Hidden,this.onMediaLoaded=()=>(this._$element.remove(),this.load()),this.checkForFallback=()=>{var e=this._loop?"loop":"";this._$element.remove(),$(this._selector).prepend($(`<video class="hidden background-video ${this._id}" muted autoplay playsinline ${e}>
									<source type="video/mp4" src="${this._fallback}.mp4" />
								</video>`)),this._$element=$(".background-video."+this._id),this._element=this._$element.get(0),this._fallenBack=!0,this._onFallback()}}get id(){return this._id}get type(){return this._type}set xmlContainer(e){this._xmlContainer=e}get xmlContainer(){return this._xmlContainer}set src(e){this._src=e}get src(){return this._src}set hideButton(e){this._hideButton=e}get hideButton(){return this._hideButton}get playing(){return!this._element.paused}get element(){return this._element}get autoplay(){return this._autoplay}set fallback(e){this._fallback=e}set onFallback(e){this._onFallback=e}get state(){return this._state}get selector(){return this._selector}destroy(){this._type===o.BackgroundMediaType.Video&&this._element.removeEventListener("error",this.checkForFallback,!1),this.pause(),this._$element.remove(),this._state=o.BackgroundMediaState.Hidden}load(){if(this._state===o.BackgroundMediaState.Hidden)return this._type===o.BackgroundMediaType.Audio?this.buildAudioElement():this.buildVideoElement(),this._state=o.BackgroundMediaState.Play,this.play()}resume(){if(this._type===o.BackgroundMediaType.Video){if(this._$element.find("source").attr("src")!==this._src+".mp4"&&!this._fallenBack)return this.updateMediaPath();this.show()}this._state=o.BackgroundMediaState.Play,this.unmute(),this.play()}hide(){this.pause(),this._$element.addClass("hidden"),this._state=o.BackgroundMediaState.Hidden}show(){this._$element.removeClass("hidden"),this._state=o.BackgroundMediaState.Play}mute(){this._type===o.BackgroundMediaType.Audio?this.pause():this._element.volume=0}unmute(){this._$element.attr("muted",null),this._element.muted=!1,this._element.volume=1}pause(){this._state=o.BackgroundMediaState.Paused,this._element.pause()}play(){return this._state=o.BackgroundMediaState.Playing,this._element.play()}onSrcUpdated(){return this._$element.remove(),this.load()}isInRenderedContainer(){return!$(this._selector).hasClass("zone")||($(".mz-container").hasClass("presentation")?"#"+$(".zone.present").last().attr("id")===this._selector:$(this._selector).hasClass("rendered"))}buildAudioElement(){var e=this._loop?"loop":"";$(this._selector).append($(`<audio class="background-audio ${this._id}" ${e}>
									<source type="audio/mpeg" src="${this._src}.mp3" />
								</audio>`)),this._$element=$(".background-audio."+this._id),this._element=this._$element.get(0)}buildVideoElement(){var e=this._loop?"loop":"";$(this._selector).prepend($(`<video class="background-video hidden ${this._id}" playsinline ${e}>
									<source type="video/mp4" src="${this._src}.mp4" />
								</video>`)).addClass("bgm-container"),this._$element=$(".background-video."+this._id),this._element=this._$element.get(0),this._$element.siblings().each((e,t)=>{var t=$(t),i=t.css("position"),a=parseInt(t.css("z-index"));"static"===i&&t.addClass("bgm-static-sibling"),0===a&&t.addClass("bgm-sibling-z")}),this._$element.find("source").get(0).addEventListener("error",this.checkForFallback,!1),this._element.addEventListener("error",this.checkForFallback,!1)}updateMediaPath(){var e=this._loop?"loop":"";this._$element.remove(),$(this._selector).prepend($(`<video class="hidden background-video ${this._id}" autoplay playsinline ${e}>
									<source type="video/mp4" src="${this._src}.mp4" />
								</video>`)),this._$element=$(".background-video."+this._id),this._element=this._$element.get(0)}}}(GLECore=GLECore||{}),function(r){class o{constructor(e){this.XMLManager=e,this._manifest=null,this._completeManifest={},this._persistentComponents=[],this.XMLManager=e}get persistentComponents(){return this._persistentComponents}set persistentComponents(e){this._persistentComponents=e}get completeManifest(){return this._completeManifest}initialize(e,t){this._manifest=e,this._api=t,this.processManifest()}processManifest(){var i=this._manifest.getElementsByTagName("plugin"),t=i.length;for(let e=0;e<t;e++){var a=$(i[e]),s=a.attr("name"),n=a.attr("map");let t;try{t=_.isFunction(window.GLEPlugins[n])?window.GLEPlugins[n]:null}catch(e){t=null}(_.isNull(t)||_.isUndefined(t))&&r.Trace.error('PluginManager (processManifest): Cannot find an object for this plugin defined in the PluginManifest:\n name -- "'+s+'"\n map -- "'+n+'"'),this._completeManifest[s]={name:s,map:n,classRef:t,autoInitialize:"true"===a.attr("autoInitialize"),dependencies:o.convertDependencyStringToObj(a.attr("dependencies")),persistent:"true"===a.attr("persistent"),srcContent:a.get(0).hasChildNodes()?this.XMLManager.deserializeXML(a.get(0)):null}}}static convertDependencyStringToObj(e){if(_.isUndefined(e))return{};var t={};for(const a of e.split(",")){var i=_.trim(a);t[i]=sai[i]}return t}fetchAutoInitializingPlugins(){const t=[];return _.each(this._completeManifest,e=>{e.autoInitialize&&t.push(e.srcContent)}),t}isComponentPersistent(e){var t=this._completeManifest[e];return!_.isUndefined(t)&&this._completeManifest[e].persistent}lookupManifestDefinition(e,t="map"){e=this._completeManifest[e];return _.isUndefined(e)?null:e[t]}createPlugin(e,t){var i=new window.GLEPlugins.SWF(null),a=this._api.model.plugins.getChildByAttribute("id",e);_.isNull(a)||(i.build(this._api.model.plugins.getChildByAttribute("id",e),this._api),i.program(t))}}r.PluginManager=o}(GLECore=GLECore||{}),function(p){p.TemplateManager=class{constructor(e){this.content=null,this.templates={},this.aliases={},this.destructibles=[],this._PluginManager=e}initialize(e,t){this._api=t,this.content=e,this.processTemplates()}populate(t,e,i,a,s,n){s&&this.destroyChildren();var s=this.templates[e],r=i.elements;let o=s.content;var l=[];for(let e=0;e<r.length;e++){var h=r[e],c=this._PluginManager.lookupManifestDefinition(h.type,"classRef"),d=this._PluginManager.lookupManifestDefinition(h.type,"dependencies");c&&(d=(c=new c(d)).build(h,this._api))&&(h="\\${"+h.attributes.id+"}",l.push(c),a&&this.destructibles.push(c),o=o.replace(new RegExp(h,"g"),d))}if(o=o.replace(/\${(.*?)}/gim,""),o=this._api.model.TokenUtil.parseTokens(o),t){n?t.innerHTML+=p.DataUtil.convertToValidHtml(o):t.innerHTML=p.DataUtil.convertToValidHtml(o);for(let e=0;e<l.length;e++){var u=l[e],g=document.getElementById(u.id),_=$(t);u.program(g||_.get(0))}}return{template:s,content:o}}getTemplate(e){if(!_.isString(e))return p.Trace.error("TemplateManager (getTemplate): Must pass in a valid template ID string."),null;let t=this.templates[e];return _.isUndefined(t)&&(t=this.aliases[e]),_.isUndefined(t)?(p.Trace.error("TemplateManager (getTemplate): Template "+e+" was not found in the list of templates."),null):t}destroyChildren(){for(let e=this.destructibles.length-1;0<=e;e--)this.destructibles[e].destroy();this.destructibles=[]}processTemplates(){var i=this.content.getElementsByTagName("Template");for(let t=0;t<i.length;t++){var a,s=i[t];const r={attributes:{}};for(let e=0;e<s.attributes.length;e++){var n=s.attributes[e];r.attributes[n.nodeName]=n.nodeValue}r.attributes.alias&&(a=r.attributes.alias.split(","),_.each(a,e=>this.assignAlias(e,r)));let e=(new XMLSerializer).serializeToString(s);e=(e=(e=(e=e.replace(/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,"<$1></$2>")).replace(/<Template[^>]+>/gim,"")).replace(/<\/Template>/,"")).replace(/\s+/g," "),r.content=e,this.templates[r.attributes.id]=r}}assignAlias(e,t){this.aliases[e]=t}}}(GLECore=GLECore||{}),function(h){class c extends h.IEventDispatcher{constructor(){super()}initialize(){}deserializeXML(e,t){var i=new h.XMLContainer;let a=t?e:e.childNodes[0];"xml"===a.nodeName&&(a=e.childNodes[1]);var s=c.filterChildren(a.childNodes),n=a.attributes;i.type=a.nodeName,i.sourceXML=a,i.parent=t;let r=n.length;for(let e=0;e<r;e++){var o=n[e];i.attributes[o.nodeName]=o.nodeValue}r=s.length;for(let e=0;e<r;e++){var l=s[e];i.elements.push(this.deserializeXML(l,i))}return i.children=i.meta.concat(i.elements),r||!a.childNodes.length||3!==(e=a.childNodes[0]).nodeType&&4!==e.nodeType||(i.text=e.nodeValue),i}static filterChildren(t){var i=[],a=t.length;for(let e=0;e<a;e++){var s=t[e];3!==s.nodeType&&4!==s.nodeType&&8!==s.nodeType&&i.push(s)}return i}loadPlayerXML(){return this._deferred=$.Deferred(),this.loadedXmlPluginManifest=sai.pluginManifestXml,this.loadedXmlLanguageDefinitions=sai.langDefinitionsXml,this.loadedXmlStyleManifest=sai.styleManifestXml,setTimeout(()=>this._deferred.resolve(),0),this._deferred.promise()}}h.XMLManager=c}(GLECore=GLECore||{}),function(n){class r{constructor(){this._magicBtnData={},this._magicBtnIds=[],this._$baseContext=$("body"),this.apiEventHandler=e=>{_.isUndefined(_.get(e,"data.type"))||"pageViewUpdate"===e.data.type&&(this.handlePageLevelButtons(e.data.currentPage),this.updateAllMagicButtonHtml(),this.showMagicButtonsOnPage(this._Controller.model.getCurrentPageId()))}}initialize(e,t,i,a){this._Controller=e,this._Controller.addEvent("apiEvent",this.apiEventHandler),this._ModalManager=t,this._ContentManager=i,this.TrackingManager=a,this.processMagicButtons()}processMagicButtons(){this.reset(),this.getButtonsFromSourceContent(),this.getButtonsFromTextContent()}getButtonsFromSourceContent(){var t=$(this._Controller.model.contentXml).find(r.MAGICBUTTON_ELEMENT_NAME);for(let e=0;e<t.length;e++)this.setupNewMagicButton($(t[e]),null)}setupNewMagicButton(e,t){var i=new n.MagicButtonData(this,e),a=i.getTooltipContent();let s;s=_.isEmpty(t)?(i.isInline=!1,e):t;e=r.findPageIdForMagicBtn(s);return _.isEmpty(e)?n.Trace.error("MagicButtonManager (setupNewMagicButton): The pageID for the ancestor Page element for a MagicButton element is empty or whitespace. Cannot determine what page it is defined on."):i.definedOnPageId=e,e&&a&&(this._ContentManager.locateLinks(e,a),i.setRequiredLinkIds()),this.addMagicButtonData(i)}static findPageIdForMagicBtn(e){e=e.parents("Page");if(!_.isEmpty(e))return e.attr("pageID");n.Trace.warn("MagicButtonManager (setupNewMagicButton): Could not find an ancestor Page element for a MagicButton element.")}addMagicButtonData(e){if(_.isEmpty(_.get(e,"id")))n.Trace.error("MagicButtonManager (addMagicButtonData): Cannot add the magic button. The ID is empty.");else{if(_.isEmpty(this._magicBtnData[e.id]))return this._magicBtnData[e.id]=e,this._magicBtnIds.push(e.id),this._magicBtnData[e.id];n.Trace.warn('MagicButtonManager (addMagicButtonData): Cannot add the magic button with ID, "'+e.id+'". It already exists.')}return null}getButtonsFromTextContent(){var t=$(this._Controller.model.contentXml).find(r.MAGICBUTTON_CONTAINER_ELEMENTS);for(let e=0;e<t.length;e++){var i=t[e];this.setupInlineButtons(i.textContent,$(i))}}reset(){this._magicBtnData={},this._magicBtnIds=[]}handlePageLevelButtons(t){var e=_.filter(this._magicBtnData,e=>!e.isInline&&e.definedOnPageId===t.id);0!==e.length&&(this.createPageLevelContainer(),this.addButtonsToPageContainer(e),this.addMBContainerToPage(t))}createPageLevelContainer(){_.isEmpty(this._$mbPageContainer)||this._$mbPageContainer.remove();var e=_.template(this.Controller.getTemplate("MBPageLevelContainer").content)({});e&&(this._$mbPageContainer=$(e))}addButtonsToPageContainer(e){e.forEach(e=>{this._$mbPageContainer.append($(e.buttonHTML))})}addMBContainerToPage(e){var t="MagicButtonManager (addMBContainerToPage): Page "+e.id,e=this.Controller.getTemplate(e.templateId),i=e.attributes.mbContainer;_.isEmpty(i)?n.Trace.warn(t+" does not have a designated hosting element for Magic Buttons"):(i=$(e.attributes.mbContainer),_.isEmpty(i)?n.Trace.error(t+" has a Magic Button container, but the container does not exist on the page."):(i.append(this._$mbPageContainer),$(".page-body").addClass("MBPage")))}updateAllMagicButtonHtml(e=this._$baseContext){for(const i of this._magicBtnIds){var t=this.getMagicButtonDataById(i);t&&t.isBuilt&&this.updateMagicButtonDisplay(t,e)}}updateMagicButtonDisplay(e,t=this._$baseContext){var i=e.getHtmlId(),t=t.find(".magicBtn").filter('[data-id="'+i+'"]');_.isEmpty(t)||e.updateHtmlButtonDisplay(t)}showMagicButtonsOnPage(e){if(!_.isEmpty(e))for(const a of this._magicBtnIds){var t=this._magicBtnData[a],i=t.getMagicButtonObj();null!==i&&t.isBuilt&&i.toggleButtonVisibility(t.shouldShowMagicBtnOnPageId(e))}}static isMagicButtonInText(e,t){return!_.isEmpty(e)&&(t=t?r.MAGICBUTTON_XML_ELEMENT_REGEX_SIMPLE:r.MAGICBUTTON_XML_ELEMENT_REGEX,-1!==e.search(t))}setupInlineButtons(e,t){e=e.match(r.MAGICBUTTON_XML_ELEMENT_REGEX);_.each(e,e=>{e=$.parseXML(e);this.setupNewMagicButton($(e.documentElement),t)})}replaceMagicButtonsInTextWithHtml(e){return e.replace(r.MAGICBUTTON_XML_ELEMENT_REGEX,e=>{var t=$.parseXML(e).documentElement.attributes.getNamedItem("id");return _.isNull(t)||_.isEmpty(this.getMagicButtonDataById(t.nodeValue))?e:this.buildMagicButton(t.nodeValue)})}getMagicButtonDataById(e){return _.isEmpty(e)?(n.Trace.error("MagicButtonManager (getMagicButtonDataById): Cannot get the magic button. The ID of the button to get is empty."),null):this._magicBtnData[e]}buildMagicButton(e){var t,i="MagicButtonManager (buildMagicButton): ";return _.isEmpty(e)?(n.Trace.error(i+"The magic button ID is empty or whitespace.  Cannot build the button."),""):null===(t=this.getMagicButtonDataById(e))?(n.Trace.error(i+'There is no magic button defined with the ID "'+e+'".'),""):t.buildMagicButtonDisplay()}static getStateId(e){return _.camelCase(e.substr(0,e.length-5))}get Controller(){return this._Controller}get ModalManager(){return this._ModalManager}}r.MAGICBUTTON_ELEMENT_NAME="MagicButton",r.MAGICBUTTON_XML_ELEMENT_REGEX=/(?:(?:<|&lt;)\s*MagicButton\s+(?:[^>]|(?!&gt;))*\/(?:>|&gt;))|(?:(?:<|&lt;)\s*MagicButton\s+(?:[^>]|(?!&gt;))*(?:>|&gt;)(?:(?!(?:<|&lt;)\s*\/?\s*MagicButton(?:(?:\s*)|(?:\s+(?:[^>]|(?!&gt;))*))(?:>|&gt;))[\s\S])*(?:<|&lt;)\s*\/\s*MagicButton\s*(?:>|&gt;))/gi,r.MAGICBUTTON_XML_ELEMENT_REGEX_SIMPLE=/(?:(?:<|&lt;)\s*MagicButton\s+(?:[^>]|(?!&gt;))*\/(?:>|&gt;))/g,r.MAGICBUTTON_HTML_ID="_magicBtn",r.MAGICBUTTON_REGISTER_ACTIVITY_ID_PREFIX="magicBtn_act_id_",r.MAGICBUTTON_CSS_CLASS_HIDDEN="hidden",r.MAGICBUTTON_CONTAINER_ELEMENTS="Text,Bullet",n.MagicButtonManager=r}(GLECore=GLECore||{}),function(g){class p{constructor(e){this.uid=1,this.requiredLinkLookup={},this.conditionalLinkLookup={},this._SettingsManager=e}initialize(){}preprocess(e){e=$(e);this.processLinks(e)}processLinks(e){const t=e.find("Page"),i=t.filter(e=>null!==t.eq(e).text().match(p.LINK_REGEX));this.requiredLinkLookup={},this.conditionalLinkLookup={},i.each(e=>{e=i.eq(e);this.locateLinks(e.attr("pageID"),e)})}locateLinks(t,e,i){const a=e.children();!0!==i&&e.get(0).nodeName.match(p.CONDITIONAL_LINK_REGEX)&&(i=!0),a.length?a.each(e=>this.locateLinks(t,a.eq(e),i)):this.applyLinkAttributes(t,e,i)}applyLinkAttributes(e,t,i){var a=t.text();let s=a,n=p.LINK_REGEX.exec(a);for(var r=n,o="true"===this._SettingsManager.getSettingValueGeneral("OpenLinksInWindow");n;){var l=n[0],h=p.hasRequiredLinks(l),c=/href\s*=\s*"(.*?)"/.exec(l),c=c?c[1]:null,d=/target\s*=\s*['"](.*?)['"]/.exec(l),d=_.isEmpty(d)?"_self":d[1],u=$(l);_.isEmpty(c)?(g.Trace.warn(`The following required link has been ignored. Please check for misspellings.
`+l),n=p.LINK_REGEX.exec(a)):(o?u.attr("href","javascript:void(0)").attr("title",c).attr("target","_self").attr("onclick",`sai.ApplicationController.handleExternalLink(event,"${c}")`):u.attr("href",c).attr("target",d),h&&u.attr("data-required-id",this.uid),s=s.replace(l,u.get(0).outerHTML),h&&this.handleRequiredLinks(e,i),n=p.LINK_REGEX.exec(a))}r&&t.text(s)}static hasRequiredLinks(e){return null!==e.match(p.REQUIRED_LINK_REGEX)}handleRequiredLinks(e,t){t=!0===t?this.conditionalLinkLookup:this.requiredLinkLookup;t[e]||(t[e]=[]),t[e].push(this.uid),this.uid++}updateRequiredLinkLookup(t,e){this.requiredLinkLookup[t]||(this.requiredLinkLookup[t]=[]),_.each(e,e=>{-1===this.requiredLinkLookup[t].indexOf(e)&&this.requiredLinkLookup[t].push(e)})}}p.REQUIRED_LINK_REGEX=/required\s*=\s*['"]true['"]/gim,p.LINK_REGEX=/<a[^>]+>.*?<\/a>/gim,p.CONDITIONAL_LINK_REGEX=/(?:surveypage)/gim,g.ContentManager=p}(GLECore=GLECore||{}),function(n){class t extends n.IEventDispatcher{constructor(){super(),this.touchMoveExceptions=[],this._pages=[],this.internalReset=!1,this.courseLoadHighWatermarkPageId="",this.touchSupport=!1,this.complete=!1,this.rtl=!1,this.testedOut=!1,this.isPhone=!1,this.deviceWidth=-1,this.courseRendered=!1,this.currentBookmark=null,this.trackingEnabled=!1,this._svgManifest={},this._sections=[],this._totalCourseTime=0,this._appVolume=1,this._isMuted=!1,this._useDynamicTime=!1,this._platform=new n.Platform}set objectiveList(e){this._objectiveList=e}get objectiveList(){return this._objectiveList}get svgManifest(){return this._svgManifest}get TokenUtil(){return this._TokenUtil}get tokens(){return this._TokenUtil.tokens}get appVolume(){return this._appVolume}set appVolume(e){e<0||_.isNaN(e)?this._appVolume=0:100<e&&(this._appVolume=100),this._appVolume=e}get isMuted(){return this._isMuted}set isMuted(e){this._isMuted=e}get currentBreakpointValue(){return this._currentBreakpointValue}set currentBreakpointValue(e){this._currentBreakpointValue=e}get currentBreakpointId(){return this._currentBreakpointId}set currentBreakpointId(e){this._currentBreakpointId=e}get useDynamicTime(){return this._useDynamicTime}get pages(){return this._pages.filter(e=>e.active)}set pages(e){this._pages=e}get sections(){return this._sections.filter(e=>e.active)}set sections(e){this._sections=e}get sectionSource(){return this._sectionsSource}get platform(){return this._platform}getClickEventType(){let e="click";return e=this.touchSupport?"touchend":e}initialize(e,t){this._XMLManager=e,this._ContentManager=t,this._useDynamicTime="true"===sai.SettingsManager.getSettingValueGeneral("UseDynamicPageTimes"),this.parseGlobalXml(),this.parseCourseContent(),this.parseTokenXML(),this.calculateCourseTime(),this.platform.initialize(),this.dispatchEvent(new n.ApplicationEvent("xmlProcessed"))}parseGlobalXml(){this.global=this._XMLManager.deserializeXML(sai.LaunchDataManager.finalGlobalXml),this.globalXmlString=(new XMLSerializer).serializeToString(this.global.sourceXML)}parseCourseContent(){this.contentXml=sai.LaunchDataManager.finalContentXml,this._ContentManager.preprocess(this.contentXml),this.contentXmlString=(new XMLSerializer).serializeToString(this.contentXml),this.content=this._XMLManager.deserializeXML(this.contentXml),this.chrome=this.content.getChildrenOfType("Chrome")[0],this.plugins=this.content.getChildrenOfType("Plugins")[0],this.meta=this.content.getChildrenOfType("Meta")[0],this.createContentInstances()}createContentInstances(){var t=this.content.getAllDescendantsOfType("Section");for(let e=0;e<t.length;e++){var i=new n.SectionModel(t[e],this),a=t[e].getAllDescendantsOfType("Page"),a=this.filterOffline(a);for(let e=0;e<a.length;e++){var s=new n.PageModel(a[e],i);i.addPage(s),this._pages.push(s)}this._sections.push(i)}this._sectionsSource=this._sections}filterOffline(e){const t=!!window.location.href.match("file:///"),i=[];for(const s of e){var a=s.attributes.offlinePage;_.isEmpty(a)||i.push(a)}return e.filter(e=>t?_.isEmpty(e.attributes.offlinePage):-1===i.indexOf(e.attributes.pageID))}parseTokenXML(){this._TokenUtil=new n.TokenUtil(this.global,this.meta)}getFirstPage(){return this.pages[0]}getCurrentPage(){return this.currentPage}getPageById(t){if(!_.isEmpty(t)&&!_.isUndefined(this.pages))for(let e=0;e<this.pages.length;e++)if(this.pages[e].id===t)return this.pages[e];return null}getPageIndexByPageId(e){return!_.isEmpty(e)&&!_.isUndefined(this.pages)&&(e=this.getPageById(e))?this.pages.indexOf(e):NaN}getCurrentPageId(){let e="";return this.currentPage?e=this.currentPage.id:n.Trace.error("ApplicationModel (getCurrentPageId): Could not get the current page ID since the current page object is not defined."),e}setCurrentPageById(e){return!_.isEmpty(e)&&(this.currentPage=this.getPageById(e),this.setCurrentSection(),this.dispatchEvent(new n.ApplicationEvent("pageUpdate",this.currentPage)),!0)}getCurrentSection(){return this.currentSection}setCurrentSection(){return _.isEmpty(this.currentPage)?(this.currentSection=null,!1):(this.currentSection=this.currentPage.parentSection,!_.isEmpty(this.currentSection)||(n.Trace.warn('ApplicationModel (setCurrentSection): Cannot set the current section. A parent Section element cannot be found for the current page element with "pageID" of "'+this.currentPage.id+'".'),this.currentSection=null,!1))}getTestOutPageOnPass(){return $(this.contentXml).find("Data[testout='true']").attr("nextPageOnPass")}addTouchMoveException(e){this.touchMoveExceptions=this.touchMoveExceptions.concat(e)}calculateCourseTime(){var e;!0===this._useDynamicTime?(e=this.pages.map(e=>e.id),this._totalCourseTime=n.TimeUtil.calculateDynamicCourseTime(this.sections,e),this.updateSectionPageContent()):this._totalCourseTime=n.TimeUtil.calculateStaticPageTime(this.sections)}updateSectionPageContent(){var e=this.pages.filter(t.filterSectionPageTemplates);_.each(e,e=>{var t=e.xmlContainer.getChildByAttribute("id","txtTime"),e=e.xmlContainer.parent;t.text=this._TokenUtil.parseTokens(e.attributes.averageTime+" {tk_TimerMinutesUnitAbbrev}")})}static filterSectionPageTemplates(e){return/SectionTitle/gi.test(e.templateId)}getTotalCourseTime(){return this._totalCourseTime}}n.ApplicationModel=t}(GLECore=GLECore||{}),function(s){class e{static getInstance(){return e._instance}constructor(){this.model=new s.ApplicationModel,this.trackingData={},this.view=new s.ApplicationView(this),this.onWindowResize=()=>{var e=this.model.platform.getMediaSize(),t=s.Platform["DEVICE_MEDIA_SIZE_"+e.toUpperCase()+"_REM"];e!==this.model.currentBreakpointId&&(this.updateCurrentBreakpoint(),this.sendEvent({type:"breakpointChange",value:{id:e,size:t}}))},this.loadFirstPage=()=>{this.TrackingManager.active?this.TrackingManager.loadFirstPage():this.callPage(this.model.getFirstPage().id)},this.callPreviousPage=()=>{var e=this.getCurrentPageIndex();return 0<e&&(e=this.model.pages[e-1],this.callPage(e.id))},this.callNextPage=()=>{var e=this.model.pages.length,t=this.getCurrentPageIndex();return t<e-1&&(e=this.model.pages[t+1],this.callPage(e.id))},this.callPage=(e,t=!1)=>{return this.TrackingManager.active&&!1===t?this.TrackingManager.callPage(e):this.setCurrentPageOnModel(e)},this.populate=(e,t,i,a,s,n)=>sai.TemplateManager.populate(e,t,i,a,s,n),this.createXMLContainer=e=>sai.XMLManager.deserializeXML(e),this.generateTranscript=()=>{this.generateDynamicContent({contentTitle:"transcript",contentUrl:"resources/Transcript.html",width:parseInt(sai.SettingsManager.getSettingValueGeneral("TranscriptPopUpWidth"),10),height:parseInt(sai.SettingsManager.getSettingValueGeneral("TranscriptPopUpHeight"),10)})},this.onAvailableLanguages=e=>{e=e.data.languages;_.isEmpty(e)&&e.push(sai.LanguageManager.currentLangId),sai.LanguageManager.sourceAvailableLanguages=e,sai.LanguageManager.buildMappedAvailableLanguages(),this.sendEvent({type:"langReady"})},e._instance=this}initialize(){this.initializeBreakpointWatcher()}initializeBreakpointWatcher(){$(window).on("resize",this.onWindowResize),this.updateCurrentBreakpoint()}updateCurrentBreakpoint(){this.model.currentBreakpointId=this.model.platform.getMediaSize(),this.model.currentBreakpointValue=s.Platform["DEVICE_MEDIA_SIZE_"+this.model.currentBreakpointId.toUpperCase()+"_REM"]}initializeCoursePreferencesObject(){var e=sai.ViewingModeManager.currentViewingMode,e={lang:sai.LanguageManager.currentLangId,viewingMode:e,audio:sai.ViewingModeManager.getAudioSetting(e),subtitles:sai.ViewingModeManager.getSubtitleSetting(e)};this.setPreferences(e)}getCurrentPage(){return this.model.getCurrentPage()}getCurrentPageIndex(){const t=this.model.getCurrentPage();return this.model.pages.findIndex(e=>e.id===t.id)}setCurrentPageOnModel(e){return this.model.setCurrentPageById(e)}reloadCurrentPage(){var e=this.model.getCurrentPage();return null!=e&&e.id?this.callPage(e.id):(s.Trace.error("ApplicationController (reloadCurrentPage): Cannot reload the page because the current page's ID cannot be determined."),!1)}getTemplate(e){return sai.TemplateManager.getTemplate(e)}sendEvent(e){e=new s.ApplicationEvent("apiEvent",e);return this.model.dispatchEvent(e)}addEvent(e,t){this.model.addEventListener(e,t)}removeEvent(e,t){this.model.removeEventListener(e,t)}parseTokens(e){return this.model.TokenUtil.parseTokens(e)}addTouchMoveException(e){const a=[];a.push($(e).attr("id")),$(e).children().each(function e(){const t=$(this).children().length;const i=$(this).attr("id");i&&a.push(i);t&&$(this).children().each(e)}),this.model.addTouchMoveException(a)}setPreferences(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(sai.LaunchDataManager.launchInfo.preferences[t]=e[t]);this.sendEvent({type:"preferencesUpdate",value:e})}getPreferences(){return sai.LaunchDataManager.launchInfo.preferences}getMediaSize(){return this.model.platform.getMediaSize()}getDeviceType(){return this.model.platform.deviceType}generateDynamicContent(e){var t=e.width||parseInt(sai.SettingsManager.getSettingValueGeneral("DefaultPopUpWidth"),10),i=e.height||parseInt(sai.SettingsManager.getSettingValueGeneral("DefaultPopUpHeight"),10),a=this.model.rtl?"rtl":"ltr",a=(e.contentUrl.match(/\?/g)?"&":"?")+"lang="+sai.LanguageManager.currentLangId+"&dir="+a;window.addEventListener("message",e=>{"send-gle-data"!==e.data||e.source instanceof MessagePort||e.source instanceof ServiceWorker||e.source.postMessage({command:"gle-data",info:{content:this.model.contentXmlString,global:this.model.globalXmlString}},"*")},!1);try{if(null===s.PopupUtil.openPopup(e.contentUrl+a,t,i,e.contentTitle,!0))return!1}catch(e){return!1}return!0}printPage(){window.print()}handleExternalLink(e,t){$(e.target).addClass("visited"),this.callWebAddress(t)}callWebAddress(...e){let t="_blank",i=(4<=arguments.length&&(t=e[3]),e[0]);_.isArray(i)&&(i=e[0][1]);var a={width:parseInt(sai.SettingsManager.getSettingValueGeneral("DefaultPopUpWidth"),10),height:parseInt(sai.SettingsManager.getSettingValueGeneral("DefaultPopUpHeight"),10)};s.PopupUtil.openWindowGeneric(i,parseInt(e[1],10),parseInt(e[2],10),t,a)}generateTextResource(...i){var i=i[0],a=/resTxtId=(.*)/,a="string"==typeof i?a.exec(i):a.exec(i[1]);if(_.isEmpty(a))s.Trace.error("ApplicationController: Resource Text Id is not valid");else{a=a[1];let e=parseInt(i[2],10),t=(_.isEmpty(e)&&(e=parseInt(sai.SettingsManager.getSettingValueGeneral("DefaultPopUpWidth"),10)),parseInt(i[3],10));_.isEmpty(t)&&(t=parseInt(sai.SettingsManager.getSettingValueGeneral("DefaultPopUpHeight"),10)),this.generateDynamicContent({contentTitle:"textresource",contentUrl:"resources/InternalResource.html?resourceID="+a,width:e,height:t})}}callJavaScript(...e){e=Array.prototype.slice.call(e);this[e.shift()].apply(window,e)}setPageCompleteById(e){e=this.getPageById(e);_.isEmpty(e)||(e.complete=!0,e.parentSection.complete=e.parentSection.pages.every(e=>e.complete))}getThisPageComplete(){return this.model.currentPage.complete}getPageById(e){return _.find(this.model.pages,{id:e})}setTouchSupport(e){this.model.touchSupport=e,window.matchMedia("(max-device-width: 640px)").matches&&(this.model.isPhone=!0,this.model.deviceWidth=640)}getCurrentSection(){return this.model.getCurrentSection()}getClickEventType(){return this.model.getClickEventType()}makeSectionOptional(t){let i=!1;return _.each(this.model.sections,e=>{if(e.id===t)return e.optional=!0,i=!0}),i||s.Trace.error("Controller (makeSectionOptional):  Section not found."),i}getSectionTitleById(t){let i="";return _.each(this.model.sections,e=>{e.id===t&&(i=e.title)}),i}getSectionTemplateData(t){const i=[];return _.each(this.model.sections,e=>{_.isUndefined(e.description)&&!0!==t||i.push({id:e.id,title:e.title,time:e.time,feature_title:e.descriptionTitle,feature_text:e.descriptionText,image:e.image,alt:e.altText,complete:!0===e.complete?"complete":"incomplete",optional:!0===e.optional?"optional":"required",optionalText:!0===e.optional?this.parseTokens("{tk_Optional}"):"",pages:this.buildPageListForSection(e),styles:e.styles})}),i}buildPageListForSection(e){const a=[];return _.each(e.pages,e=>{var t=!sai.RouteManager.pageExistsInRoute(e.id),i=e.bookmark,i=i?i.code:"??";t||a.push({id:e.id,title:e.title,status:e.complete?"complete":"incomplete",current:this.getCurrentPage()===e,bookmark:i})}),a}setTextDirection(e){this.model.rtl="rtl"===e}setCurrentBookmark(e){this.model.currentBookmark=e}setTrackingEnabled(e){this.model.trackingEnabled=e}detectSVGOverride(){return this.detectOffline()}detectIE(){var e=window.navigator.userAgent,t=e.indexOf("Trident/"),i=e.indexOf("Edge/"),a=e.indexOf("rv:");return 0<t?parseInt(e.substring(a+3,e.indexOf(".",a)),10):0<i&&parseInt(e.substring(i+5,e.indexOf(".",i)),10)}detectOffline(){return!!window.location.href.match("file:///")}getPromptText(e,t){return _.isEmpty(e)||(e=e.text,_.isEmpty(e))?this.parseTokens(t):e}}s.ApplicationController=e}(GLECore=GLECore||{}),function(e){e.ApplicationView=class{constructor(e){this._isPageViewReady=!1,this.apiEventHandler=e=>{var t;e.data&&"loadComplete"===e.data&&this.initializeCourseDisplay(),"internalReset"===(null==(t=e.data)?void 0:t.type)&&(this._$body.removeClass("loaded"),this._$pageContainer.html("")),"preferencesUpdate"===(null==(t=e.data)?void 0:t.type)&&this.handleViewingModeClass(e.data.value.viewingMode)},this.pageHandler=e=>{var t=this._currentPage;this._isPageViewReady=!1,this._currentPage=e.data,$("*:focus").blur(),this.swapPageClassId(t,this._currentPage),this.populatePage(),this.focusPageHeader()},this.closeSettingsHandler=e=>{e.data&&"precourseSettingsClosed"===e.data.type&&(this._$body.removeClass("precourse-settings"),this.renderCourseDisplay())},this._api=e,this._api.addEvent("apiEvent",this.apiEventHandler),this._api.addEvent("pageUpdate",this.pageHandler),this._api.addEvent("apiEvent",this.closeSettingsHandler)}initialize(){this._$courseWrapper=$("#course-player-wrapper"),this._$pageContainer=$("#page-container"),this._$plugins=$("#plugin-container"),this._$loader=$(".loader-container"),this._$body=$("body"),this.addTouchSupport()}addTouchSupport(){this._touchSupport="ontouchstart"in document.documentElement,this._touchSupport?this._$body.addClass("touch"):this._$body.addClass("desktop"),this._api.setTouchSupport(this._touchSupport)}handleViewingModeClass(e){_.isEmpty(e)||this._$body.toggleClass("tg-mode","tg"===e)}swapPageClassId(e,t){var i="GLE_Page_";_.isEmpty(e)||this._$body.removeClass(i+e.id),this._$body.addClass(i+t.id)}initializeCourseDisplay(){this.initGlobalPlugins(),"true"!==sai.SettingsManager.getSettingValueGeneral(e.SettingsManager.SETTING_NAME_SHOW_PRECOURSE_SETTINGS)||sai.SettingsManager.firstPreferencesDisplay?(this._api.loadFirstPage(),this.renderCourseDisplay()):(this._$body.addClass("precourse-settings"),this._api.loadFirstPage())}initGlobalPlugins(){var e=sai.PluginManager.fetchAutoInitializingPlugins();this._api.model.plugins.children=this._api.model.plugins.children.concat(e),this._api.model.plugins.elements=this._api.model.plugins.elements.concat(e),sai.PluginManager.createPlugin("toolbar",this._$courseWrapper[0]),sai.PluginManager.createPlugin("progressbar",this._$courseWrapper[0]),this._api.model.plugins.elements=_.reject(this._api.model.plugins.elements,e=>"toolbar"===e.attributes.id||"progressbar"===e.attributes.id),this._api.populate(this._$plugins.get(0),this._api.model.plugins.attributes.templateID,this._api.model.plugins)}renderCourseDisplay(){this._$loader.remove(),this._$body.addClass("loaded")}populatePage(){this._api.populate(this._$pageContainer.get()[0],this._currentPage.templateId,this._currentPage.xmlContainer,!0,!0,!1),this._api.sendEvent({type:"pageViewUpdate",$pageContainer:this._$pageContainer,currentPage:this._currentPage}),this._api.model.courseRendered=!0,this._$pageContainer.attr("data-template",this._currentPage.templateId)}focusPageHeader(){clearTimeout(this._focusTimeout),this._focusTimeout=window.setTimeout(()=>{this.getFirstVisibleFocusTarget().attr("tabindex","-1").focus()},250)}getFirstVisibleFocusTarget(){return $("[data-sr-focus]").filter((e,t)=>{t=$(t);return t.is(":visible")&&0<t.text().length}).first()}}}(GLECore=GLECore||{}),function(h){class c{constructor(){this.langMap={},this._langDefinitionsData={},this.currentLangId=null,this.availableLanguages=[],this.reverseLanguageMap={},this.sourceAvailableLanguages=[],this._SMSLanguageCodes={}}get langDefinitionsData(){return this._langDefinitionsData}get SMSLanguageCodes(){return this._SMSLanguageCodes}initialize(e,t,i){this.langDefinitionsXML=e,this._api=i,this.processLangDefinitionsXML(),this.setCurrentLangId(t),this.updateHTMLWithLanguageCode()}processLangDefinitionsXML(){0===$(this.langDefinitionsXML).find("langsDefinitions").length?h.Trace.error("Trying to process language definitions XML that is not in the right format."):$(this.langDefinitionsXML).find("langsDef").each((e,t)=>{let a=$(t).attr("id");var i=$(t).children("name").text(),s=$(t).attr("direction"),n=$(t).attr("html"),r=$(t).children("transliteration").text(),o=$(t).find('langalt[type="BCP47"]').attr("id");if(0!==a.length&&0!==i.length&&0!==s.length||h.Trace.warn("Missing id (id="+a+") or language name (name = "+i+")  or direction (direction = "+s+")"),"ltr"!==s&&"rtl"!==s)throw new Error("Invalid text direction value");a=c.cleanLangId(a),this.langMap[a]=a,$(t).find("langalt").each((e,t)=>{var t=$(t),i=c.cleanLangId(t.attr("id"));"SMS"===t.attr("type")&&(this._SMSLanguageCodes[a]=i),this.langMap[i]=a});var l={};l.id=a,l.name=i,l.engname=null!==i&&0<i.length?$(t).children("engname").text():"",l.direction=s,l.htmlLang=n,l.transliteration=r,l.bcp47=o,this._langDefinitionsData[a]=l})}setTextDirection(e){e=this._langDefinitionsData[e].direction;"rtl"===e?$("html").attr("dir","rtl").removeClass("ltr").addClass("rtl"):$("html").attr("dir","ltr").removeClass("rtl").addClass("ltr"),this._api.setTextDirection(e)}setCurrentLangId(e){e=this.mapToSupportedLangId(e);null!==e?(this.currentLangId=_.isEmpty(e)?c.DEFAULT_ENGLISH_LANG_ID:e,this.setTextDirection(this.currentLangId)):h.Trace.error("Error: Language trying to be set does not exist in a mapped form and therefore cannot be set.")}updateHTMLWithLanguageCode(){_.isNull(this.currentLangId)||$("html").attr("lang",this._langDefinitionsData[this.currentLangId].htmlLang)}mapToSupportedLangId(e){var t;return _.isEmpty(this.langMap)?(h.Trace.warn("Language Map is empty in mapToSupportedLangId()"),null):(t=c.cleanLangId(e),_.isUndefined(this.langMap[t])?(h.Trace.warn("There is no supported language to map this language ("+e+") to."),""):this.langMap[t])}isLangAvailable(e){if(_.isEmpty(e))h.Trace.warn("Language code being added to the availability list is empty!");else if(!_.isEmpty(this.availableLanguages)){const t=this.mapToSupportedLangId(e);$.each(this.availableLanguages,function(){if(this===t)return!0})}return!1}addAvailableLang(e){_.isEmpty(e)&&h.Trace.error("Empty Language ID");var t=this.mapToSupportedLangId(e);return!_.isEmpty(t)&&!this.isLangAvailable(t)&&(this.availableLanguages.push(t),this.reverseLanguageMap[t]=e,!0)}buildMappedAvailableLanguages(){if(_.isEmpty(this.sourceAvailableLanguages))this.availableLanguages=[c.DEFAULT_ENGLISH_LANG_ID];else{this.availableLanguages=[];for(const e of this.sourceAvailableLanguages)this.addAvailableLang(e);-1===this.availableLanguages.indexOf(this.currentLangId)&&this.addAvailableLang(this.currentLangId)}}getDisplayLanguages(){if(_.isEmpty(this.availableLanguages))return[];var e=[];for(const i of this.availableLanguages){var t=sai.ViewingModeManager.getLanguageLabel(i);e.push({label:t||this._langDefinitionsData[i].name,value:this._langDefinitionsData[i].id,engname:this._langDefinitionsData[i].engname,transliteration:this._langDefinitionsData[i].transliteration})}return e}getCurrentLanguageLabel(){return this._langDefinitionsData[this.currentLangId].name}getCurrentHTMLLanguageId(){return this._langDefinitionsData[this.currentLangId].htmlLang}static cleanLangId(e){return e.replace(/^\s*|\s*$/g,"").toLowerCase()}}c.DEFAULT_ENGLISH_LANG_ID="eng",h.LanguageManager=c}(GLECore=GLECore||{}),function(e){class t{constructor(){this.langDefinitionsXmlFilePath="",this.pluginManifestXmlFilePath="",this.queryStringParametersObj=t.setupQueryStringParams()}getQueryStringValue(e){return _.isUndefined(this.queryStringParametersObj)||!_.has(this.queryStringParametersObj,e)?"":this.queryStringParametersObj[e]}static setupQueryStringParams(){var t={};let e=window.location.search;var i=(e=e.slice(1)).split("&");for(let e=0;e<i.length;e++){var a=i[e].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t}}e.LaunchData=t}(GLECore=GLECore||{}),function(i){i.AlertData=class{constructor(e){this.id=null,this.content=null,this.header=null,this.buttons=[],this.hasExit=!0,this.$launcher=null,this.renderAsModalAlert=!0,this.preventClickOutsideDismiss=!1,this.autoRemove=!0,this.exitCallback=null,this.context=i.StateChangeAlert.All;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(this[t]=e[t])}}}(GLECore=GLECore||{}),function(e){e.ImageBreakpointData=class{constructor(e){this.size=null,this.src=null,this.classes=null;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(this[t]=e[t])}}}(GLECore=GLECore||{}),function(i){class e{get magicBtnType(){return this._magicBtnType}get $xmlElemSrc(){return this._$xmlElemSrc}constructor(e,t){this._MBManager=e,this._$xmlElemSrc=t,this.showOnPageIds="",this.showOnPageIdsArray=[],this._functionParameters=[],this._buttonHTML="",this._isInline=!0,this.templateObjElemId="",this.definedOnPageId="",this.id="",this.required=!1,this.isRequiredComplete=!1,this.alertID="",this.functionName="",this.isBuilt=!1,this.requiredLinksSatisfied=!0,this.requiredLinkIds=[],this._Controller=this._MBManager.Controller,this._MagicButtonFactory=new i.MBFactory(this._MBManager),this.setupPropertiesFromXmlElement(),this._magicBtnDisplayObj=new i.MagicButton(this,this._MBManager)}setupPropertiesFromXmlElement(){_.isEmpty(this._$xmlElemSrc)?i.Trace.error("MagicButtonData (setupPropertiesFromXmlElement): The _$xmlElemSrc element is null or undefined!  Cannot setup properties of MagicButton data without proper input."):(this.id=this._$xmlElemSrc.attr("id"),this.required=this._$xmlElemSrc.attr("required")&&"true"===this._$xmlElemSrc.attr("required").toLowerCase(),this.functionName=this._$xmlElemSrc.attr("function"),this.setupTemplateType(),this.setShowOnPageIds(),this.setFunctionParameters(),this.setupTooltipData())}setRequiredLinkIds(){var e=/data-required-id="(.*?)"/gim,t=this._tooltipContent.text();let i=e.exec(t);for(;i;)this.requiredLinkIds.push(parseInt(i[1],10)),i=e.exec(t);this.requiredLinkIds.length&&(this.required=!0)}setupTemplateType(){this.templateObjElemId=this._$xmlElemSrc.attr("templateObjElemId"),this._magicBtnType=this._MagicButtonFactory.createButtonClass(this.templateObjElemId)}setShowOnPageIds(){var e=this._$xmlElemSrc.attr("showOnPageIds");_.isEmpty(e)||(this.showOnPageIds=e.replace(/\s*/g,""),this.showOnPageIdsArray=_.compact(this.showOnPageIds.split(",")))}setFunctionParameters(){var e=this._$xmlElemSrc.attr("parameters");if(!_.isEmpty(e)){var t=/\\u002c/g;this._functionParameters=e.split(",");for(let e=0;e<this._functionParameters.length;e++){var i=this._functionParameters[e];this._functionParameters[e]=i.replace(t,",")}}}setupTooltipData(){var e=$(this._Controller.model.contentXml);this._tooltipID=this._$xmlElemSrc.attr("tooltipID"),this._tooltipContent=this._tooltipID?e.find('Tooltip[id="'+this._tooltipID+'"]'):null}getHtmlId(){return this.id+i.MagicButtonManager.MAGICBUTTON_HTML_ID}buildMagicButtonDisplay(){return this._buttonHTML=this._magicBtnDisplayObj.build(),this._buttonHTML}updateHtmlButtonDisplay(e){this._magicBtnDisplayObj.updateHtmlButtonObj(e)}getTooltipId(){return this._tooltipID}getTooltipContent(){return this._tooltipContent}getFunctionParameters(){return this._functionParameters}updateFunctionParameters(e,t){e>=this._functionParameters.length||e<0?this._functionParameters.push(t):this._functionParameters[e]=t}getMagicButtonObj(){return this._magicBtnDisplayObj}shouldShowMagicBtnOnPageId(e){return!(!_.isEmpty(this.showOnPageIdsArray)&&0!==this.showOnPageIdsArray.length)||-1!==this.showOnPageIdsArray.indexOf(e)}get buttonHTML(){return this._buttonHTML}set buttonHTML(e){this._buttonHTML=e}get isInline(){return this._isInline}set isInline(e){this._isInline=e}}e.TEXT_BUTTON_TEMPLATE_ID="magicBtnText1",e.PLAYER_BUTTON_TEMPLATE_ID="magicBtnGle1",e.IMAGE_BUTTON_TEMPLATE_ID="magicBtnImg1",i.MagicButtonData=e}(GLECore=GLECore||{}),function(e){e.ModalData=class t{static create(e){return new t(e.id,e.header,e.content,e.sourceElement||"root",e.buttons||[],!0===e.hasExit,e.$launcher,e.$modalEl||null,!0===e.isFullScreen,!0===e.isAlert,!0===e.preventClickOutsideDismiss,e.exitCallback||null,!1!==e.autoRemove,e.zoneId||null)}constructor(e,t,i,a,s=[],n,r,o=null,l=!1,h=!1,c=!1,d=null,u=!0,g=null){this.id=null,this.header=null,this.content=null,this.sourceElement=null,this.buttons=[],this.hasExit=!1,this.$modalEl=null,this.$launcher=null,this.isAlert=!1,this.isFullScreen=!1,this.preventClickOutsideDismiss=!1,this.scheduledForDeletion=!1,this.autoRemove=!0,this.zoneId=null,this.id=e,this.header=t,this.content=i,this.sourceElement=a,this.buttons=s,this.hasExit=n,this.isFullScreen=l,this.$launcher=r,this.$modalEl=o,this.isAlert=h,this.preventClickOutsideDismiss=c,this.exitCallback=d,this.autoRemove=u,this.zoneId=g}}}(GLECore=GLECore||{}),function(e){e.ZoneData=class{constructor(e){this._complete=!1,this._rendered=!1,this._hasBeenViewed=!1,this._registered=!1,this._conditional=!1,this._hidden=!1,this._triggers=[],this._branches=[],this._selectedBranches=[],this._selectedGroups=[],this._endpoint=!1,this._content=e,this._zoneId="z"+e.attributes.zoneID,this._templateId=e.attributes.templateID,this._arrow=_.isEmpty(e.attributes.arrow)?"c":e.attributes.arrow.toLowerCase(),this._endpoint="true"===e.attributes.endpoint,this.createTriggers(),this.createBranches()}get arrow(){return this._arrow}get content(){return this._content}get zoneId(){return this._zoneId}get templateId(){return this._templateId}get complete(){return this._complete}set complete(e){this._complete=e}get registered(){return this._registered}set registered(e){this._registered=e}get $container(){return this._$container}set container(e){this._$container=e}get rendered(){return this._rendered}set rendered(e){this._rendered=e}get hidden(){return this._hidden}set hidden(e){this._hidden=e}get triggers(){return this._triggers}set triggers(e){this._triggers=e}get branches(){return this._branches}set branches(e){this._branches=e}get selectedBranches(){return this._selectedBranches}set selectedBranches(e){this._selectedBranches=e}get selectedGroups(){return this._selectedGroups}set selectedGroups(e){this._selectedGroups=e}set conditional(e){this._conditional=e}get conditional(){return this._conditional}get hasBeenViewed(){return this._hasBeenViewed}set hasBeenViewed(e){this._hasBeenViewed=e}get endpoint(){return this._endpoint}groupBranches(e){return(null!=(e=null==e?void 0:e.split(","))?e:[]).map(e=>e.split(":").map(e=>"z"+e.replace(/\s+/gim,"")).join(":"))}cleanTriggers(e){e=null!=(e=null==e?void 0:e.split(","))?e:[];const t=[];return e.forEach(e=>{e=e.split(":").map(e=>"z"+e.replace(/\s+/gim,""));t.splice(t.length,0,...e)}),t}createBranches(){$(this._content.sourceXML).find("[zoneTriggers]").each((e,t)=>{t=this.cleanTriggers($(t).attr("zoneTriggers"));this.branches=_.uniq(this.branches.concat(t))})}createTriggers(){this.triggers=this.cleanTriggers(this.content.attributes.triggers)}}}(GLECore=GLECore||{}),function(e){class t{constructor(e,t,i,a,s,n,r,o,l,h,c,d,u,g,_){this.id=null,this.header=null,this.content=null,this.templateId=null,this.effect=null,this.dismiss=null,this.position=null,this.hideForMobile=!1,this.extraClasses=null,this.pointerWidthOuter="8px",this.pointerWidthInner="7px",this.$target=null,this.$view=null,this.accessible=!0,this.trap=!1,this.transitionSpeed=250,this.id=e,this.header=t,this.content=i,this.templateId=a,this.effect=s,this.position=n,this.dismiss=r,this.hideForMobile=o,this.extraClasses=l,this.$target=h,this.creationCallback=c,this.dismissCallback=d,this.$customParent=u,!1===g&&(this.accessible=!1),!0===_&&(this.trap=!0)}}t.TOOLTIP_EFFECT_EXPAND="expand",t.TOOLTIP_EFFECT_FADE="fade",t.TOOLTIP_EFFECT_NONE="none",t.TOOLTIP_POSITION_BOTTOM_CENTER="bottom center",t.TOOLTIP_POSITION_LEFT_CENTER="left center",t.TOOLTIP_HORIZONTAL_PADDING=2,t.TOOLTIP_DISMISS_CLICK="click",t.TOOLTIP_DISMISS_MOUSEOUT="mouseout",e.TooltipData=t}(GLECore=GLECore||{}),function(t){t.MBFactory=class{constructor(e){this._MBManager=e}createButtonClass(e){switch(e){case t.MagicButtonData.TEXT_BUTTON_TEMPLATE_ID:return new t.MBText(this._MBManager);case t.MagicButtonData.PLAYER_BUTTON_TEMPLATE_ID:return new t.MBPrimaryButton(this._MBManager);case t.MagicButtonData.IMAGE_BUTTON_TEMPLATE_ID:return new t.MBImageButton(this._MBManager);default:return void t.Trace.error("MBFactory (createButtonClass): Unsupported button type "+e)}}}}(GLECore=GLECore||{}),function(a){class s{constructor(e,t){this._magicBtnData=e,this._MBManager=t,this._isSelected=!1,this._isEnabled=!0,this._isOver=!1,this.onClickEvent=e=>{!_.isUndefined(e)&&this._isEnabled&&(e.preventDefault(),e=$(e.currentTarget),this.setSelectedState(),this.handleRequiredAction(),this.handleModal(e),this.handleButtonFunction())},this.onKeyEvent=e=>{var t=e.key,i=$(e.currentTarget);"Enter"!==t&&" "!==t||"button"!==i.attr("role")||this.onClickEvent(e)},this.satisfyRequiredLink=e=>{var e=$(e.currentTarget),e=parseInt(e.data("required-id"),10),t=this._magicBtnData.requiredLinkIds.indexOf(e);-1!==e&&(this._magicBtnData.requiredLinkIds.splice(t,1),this.handleRequiredAction())},this.closeHandler=()=>{this._MBManager.ModalManager.closeModal(this._modalId)},this.onDefaultState=e=>{!_.isUndefined(e)&&this._isEnabled&&this.setDefaultState()},this.onOverState=e=>{!_.isUndefined(e)&&this._isEnabled&&this.setOverState()},this._Controller=this._MBManager.Controller,this.checkMagicBtnFuncParameters()}checkMagicBtnFuncParameters(){var e=this._magicBtnData.getFunctionParameters().indexOf("this");0<=e&&this._magicBtnData.updateFunctionParameters(e,this)}toggleButtonVisibility(e){e?this._$button.removeClass(a.MagicButtonManager.MAGICBUTTON_CSS_CLASS_HIDDEN):(this._$button.removeClass(),this._$button.addClass(a.MagicButtonManager.MAGICBUTTON_CSS_CLASS_HIDDEN))}build(){var e=this._magicBtnData.magicBtnType,t=this._magicBtnData.shouldShowMagicBtnOnPageId(this._Controller.model.getCurrentPageId())?"":a.MagicButtonManager.MAGICBUTTON_CSS_CLASS_HIDDEN,t={id:this._magicBtnData.getHtmlId(),btnClass:e.buttonClass,visibility:t,required:this._magicBtnData.required,states:[]};return this._magicBtnData.isBuilt=!0,e.buildButton(t,this._magicBtnData.$xmlElemSrc)}updateHtmlButtonObj(e){_.isUndefined(e)?a.Trace.error("MagicButton (updateHtmlButtonObj): The input parameter for the HTML element object is null.  Cannot update the magic button."):(this._$button=$(e),this.wireEvents(),this.setInitialButtonState())}wireEvents(){this._Controller.model.touchSupport||(this._$button.off(s.MOUSE_EVENT_OVER_STATE).on(s.MOUSE_EVENT_OVER_STATE,this.onOverState),this._$button.off(s.MOUSE_EVENT_DEFAULT_STATE).on(s.MOUSE_EVENT_DEFAULT_STATE,this.onDefaultState)),this._$button.off("click",this.onClickEvent).on("click",this.onClickEvent),this._$button.off("keydown",this.onKeyEvent).on("keydown",this.onKeyEvent),this.registerRequiredEvent()}registerRequiredEvent(){var e=this._MBManager.Controller.getCurrentPage().id,t=(this._magicBtnData.required||this._magicBtnData.requiredLinkIds.length)&&!this._magicBtnData.isRequiredComplete;this._magicBtnData.definedOnPageId===e&&t&&this._MBManager.TrackingManager.setActivityStatus({status:"register",activity:{id:a.MagicButtonManager.MAGICBUTTON_REGISTER_ACTIVITY_ID_PREFIX+this._magicBtnData.getHtmlId(),complete:!1,alert:"altRequiredMagicButton"}})}setButtonState(e){let t;var i=this._$button.children();return!_.isEmpty(i)&&!!this.stateExistsInButton(e)&&(i=this._$button.children().not(".hidden"),t=1===i.length?i.attr("id"):s.STATE_DEFAULT,i=e,this._$button.removeClass(t).addClass(i),this._$button.children("#"+i).removeClass(a.MagicButtonManager.MAGICBUTTON_CSS_CLASS_HIDDEN),this._$button.children().not("#"+i).addClass(a.MagicButtonManager.MAGICBUTTON_CSS_CLASS_HIDDEN),!0)}stateExistsInButton(e){return!_.isEmpty(this._$button.find("#"+e))}enable(){this.setEnabledBehaviors(!0),this._isEnabled&&this._isSelected?this.setSelectedState():this._isEnabled&&!this._isSelected&&this.setDefaultState()}disable(){this.setEnabledBehaviors(!1),this.setDisabledState()}setEnabledBehaviors(e){this._isEnabled=e}handleRequiredAction(){!this._magicBtnData.required||this._magicBtnData.requiredLinkIds.length||this._magicBtnData.isRequiredComplete||(this._magicBtnData.isRequiredComplete=!0,this._MBManager.TrackingManager.setActivityStatus({status:"complete",activity:{id:a.MagicButtonManager.MAGICBUTTON_REGISTER_ACTIVITY_ID_PREFIX+this._magicBtnData.getHtmlId(),complete:!0}}))}handleModal(e){var t;this._modalId=this._magicBtnData.getTooltipId(),_.isUndefined(this._modalId)||(t=this._magicBtnData.getTooltipContent(),t={id:this._modalId,header:t.find("#tip_header").text(),content:t.find("#tip_body").text(),srcElement:"root",buttons:[{id:"mbModal_close",label:this._Controller.parseTokens("{tk_CloseUpperCase}"),callback:this.closeHandler}],hasExit:!0,isFullScreen:!1,$launcher:e},this._$modal=this._MBManager.ModalManager.openModal(new a.ModalData(t.id,t.header,t.content,t.srcElement,t.buttons,t.hasExit,t.$launcher,null,t.isFullScreen)),this.registerRequiredLinks())}registerRequiredLinks(){var e=this._$modal.find("a[data-required-id]");const a=this._magicBtnData.requiredLinkIds;e.each((e,t)=>{var t=$(t),i=parseInt(t.data("required-id"),10);-1!==a.indexOf(i)&&t.click(this.satisfyRequiredLink)}),this._Controller.sendEvent({destination:"RequiredLinks",type:"RequiredLink",$container:this._$modal,currentPage:this._Controller.getCurrentPage()})}handleButtonFunction(){if(!_.isEmpty(this._magicBtnData.functionName)){let e;e="calllastpage"===this._magicBtnData.functionName.toLowerCase()?"callPreviousPage":this._magicBtnData.functionName,this._Controller[e].apply(this._Controller,this._magicBtnData.getFunctionParameters())}}setInitialButtonState(){this._isEnabled?this._isOver?this.setOverState():this.setDefaultState():this.setDisabledState()}setDefaultState(){this._isOver=!1,this._isSelected?this.setSelectedState():this.setButtonState(s.STATE_DEFAULT)}setOverState(){let e=!1;this._isOver=!0,(e=this._isSelected?this.setSelectedOverState():e)||this.setButtonState(s.STATE_OVER)}setSelectedState(){this._isOver?this.setSelectedOverState():this.setButtonState(s.STATE_SELECTED),this._isSelected=!0}setSelectedOverState(){return this._isOver=!0,this.setButtonState(s.STATE_SELECTED_OVER)}setDisabledState(){this.setButtonState(s.STATE_DISABLED)}}s.STATE_DEFAULT="default",s.STATE_OVER="over",s.STATE_SELECTED="selected",s.STATE_SELECTED_OVER="selectedOver",s.STATE_DISABLED="disabled",s.STATE_XML_ATTR_INHERIT_DEFAULT_ELEMENTS="inheritDefaultElements",s.MOUSE_EVENT_DEFAULT_STATE="mouseleave",s.MOUSE_EVENT_OVER_STATE="mouseenter",a.MagicButton=s}(GLECore=GLECore||{}),function(s){class i{constructor(e){this._MBManager=e,this._buttonClass="TextMagicBtn",this._hasInlineImage=!1}get buttonClass(){return this._buttonClass}buildButton(e,t){e.states=this.buildStates(t),t=this._hasInlineImage?i.BUTTON_INLINE_TEMPLATE_ID:i.BUTTON_TEMPLATE_ID;return _.template(this._MBManager.Controller.getTemplate(t).content)(e)}buildStates(e){const a=[];var t=e.find("#btnText").text();return this._hasInlineImage=-1!==t.search(/<img([\w\W]+?)\/>/g),this._hasInlineImage?e.children().each((e,t)=>{var i=$(t).find("Text").text(),t={id:s.MagicButtonManager.getStateId(t.tagName),text:i};a.push(t)}):a.push({text:e.find("#btnText").text()}),a}}i.BUTTON_TEMPLATE_ID="MBButtonTextType",i.BUTTON_INLINE_TEMPLATE_ID="MBButtonTextWithInlineImageType",s.MBText=i}(GLECore=GLECore||{}),function(e){class i{constructor(e){this._MBManager=e,this._buttonClass="PrimaryMagicBtn"}get buttonClass(){return this._buttonClass}buildButton(e,t){return e.states=i.buildStates(t),_.template(this._MBManager.Controller.getTemplate(i.BUTTON_TEMPLATE_ID).content)(e)}static buildStates(e){var t=[];return t.push({text:e.find("#textBtnFace").text()}),t}}i.BUTTON_TEMPLATE_ID="MBButtonPrimaryType",e.MBPrimaryButton=i}(GLECore=GLECore||{}),function(n){class i{constructor(e){this._MBManager=e,this._buttonClass="ImageMagicBtn"}get buttonClass(){return this._buttonClass}buildButton(e,t){return e.states=this.buildStates(t),_.template(this._MBManager.Controller.getTemplate(i.BUTTON_TEMPLATE_ID).content)(e)}buildStates(e){const s=[];return e.children().each((e,t)=>{var i=t.getElementsByTagName("Image")[0],a=i.getElementsByTagName("Description")[0],t={id:n.MagicButtonManager.getStateId(t.tagName),imgSrc:i.getAttribute("src"),imgDescription:_.isUndefined(a)?"":a.textContent,text:""};s.push(t)}),s}}i.BUTTON_TEMPLATE_ID="MBButtonImageType",n.MBImageButton=i}(GLECore=GLECore||{}),function(t){class s extends t.IEventDispatcher{constructor(e){super(),this._api=e,this._$playButton=null,this._$pauseButton=null,this._$ccButton=null,this._$volumeButton=null,this._$volumeSlider=null,this._$volumeThumb=null,this._$thumb=null,this._$thumbContainer=null,this._$progressBar=null,this._$highWaterBar=null,this._$progressBarFill=null,this._$fullScreen=null,this._$mediaTrack=null,this._$container=null,this._keyScrubAmount=10,this._scrubLock=s.PROGRESS_SCRUB_LIMIT,this._thumbDragging=!1,this._highWaterMark=null,this._isMuted=!1,this._captionsOn=!1,this._hasVolume=!0,this._volumeTimeout=0,this._zoneId=null,this.apiEventHandler=e=>{_.isUndefined(_.get(e,"data.type"))||"volumeChange"===e.data.type&&e.data.source!==this&&(this._$volumeThumb.val(e.data.volume),this.adjustVolume(null,!1),this._api.model.appVolume=e.data.volume)},this.doTogglePlayback=()=>{this._plugin.togglePlayback()},this.doToggleFullscreen=()=>{this._plugin.mediaFullscreen()},this.doVolumeToggle=()=>{this._hasVolume&&(this._$volumeButton.hasClass("muted")?(this.doUnMuteUI(),this._plugin.unMuteMedia(),this._api.sendEvent({destination:"All",type:"volumeChange",volume:this._api.model.appVolume,source:this})):(this.doMuteUI(),this._plugin.muteMedia(),this._api.sendEvent({destination:"All",type:"volumeChange",volume:0,source:this})))},this.startDrag=()=>{this._thumbDragging=!0,$(document).on("mousemove touchmove",this.updateThumbPosition),$(document).on("mouseup touchend",this.stopDrag)},this.listenForKeySeek=()=>{$(document).on("keydown.seek",t=>{if("ArrowLeft"===t.key||"ArrowRight"===t.key){var i="ArrowRight"===t.key&&this._scrubLock===s.PROGRESS_SCRUB_LIMIT,a=this._$mediaTrack.get(0).getBoundingClientRect();let e=a.left+parseInt(this._$thumb.css("left"),10)+("ArrowRight"===t.key?1:-1)*this._keyScrubAmount;i&&(e=Math.min(e,a.left+this._$highWaterBar.width())),this.updateThumbPosition({pageX:e}),this.stopDrag();t=this._$thumb.data("seek-to");this._$thumb.attr("aria-valuenow",t),this._$thumb.attr("aria-valuetext",t+"%")}})},this.disableKeySeek=()=>{$(document).off("keydown.seek")},this.updateThumbPosition=t=>{t=this.getDeviceSelectPoint(t);if(0!==t){var i=this._$mediaTrack.get(0).getBoundingClientRect(),t=100*(t-i.left),a=Math.round(this._$highWaterBar.width()/i.width*100),t=Math.round(t/i.width);let e=this._scrubLock===s.PROGRESS_SCRUB_LIMIT?Math.min(t,a):t;e<0?e=0:100<e&&(e=100),this._$thumb.css("left",e+"%").attr("aria-valuenow",e).attr("aria-valuetext",e+"%").data("seek-to",e)}},this.stopDrag=()=>{var e=this._$thumb.data("seek-to");this._plugin.mediaSlideReleased(e),this._thumbDragging=!1,$(document).off("mousemove touchmove",this.updateThumbPosition),$(document).off("mouseup touchend",this.stopDrag)},this.adjustVolume=(e,t=!0)=>{var i;this._hasVolume&&(clearTimeout(this._volumeTimeout),i=parseFloat(this._$volumeThumb.get(0).value),this._plugin.mediaVolumeAdjusted(i),0<i?this.doUnMuteUI():this.doMuteUI(),!0===t)&&this._api.sendEvent({destination:"All",type:"volumeChange",volume:i,source:this})},this.hideVolumeSlider=()=>{clearTimeout(this._volumeTimeout),this._$volumeSlider.hide(),this._$volumeButton.removeClass("slider-active")},this.showVolumeSlider=()=>{clearTimeout(this._volumeTimeout),this._$volumeSlider.show(),this._$volumeButton.addClass("slider-active")},this.exitVolumeSlider=()=>{clearTimeout(this._volumeTimeout),this._volumeTimeout=window.setTimeout(this.hideVolumeSlider,1e3)},this.doCaptionsToggle=()=>{this._$ccButton.hasClass("selected")?this.doCaptionsOff():this.doCaptionsOn()}}get $progressBar(){return this._$progressBar}init(e){this.configureSettings(e),this.configureButtons(),this.configureProgressBar(),this.configureVolumeControls(),this.configureCaptions()}configureSettings(e){e.mediaScrub===s.PROGRESS_SCRUB_FULL?this._scrubLock=s.PROGRESS_SCRUB_FULL:e.mediaScrub===s.PROGRESS_SCRUB_LIMIT?this._scrubLock=s.PROGRESS_SCRUB_LIMIT:e.mediaScrub===s.PROGRESS_SCRUB_NONE&&(this._scrubLock=s.PROGRESS_SCRUB_NONE),this._zoneId=e.zoneId,this._plugin=e.plugin}configureButtons(){this._$container=this._zoneId?$("#"+this._zoneId):$("body"),this._$playButton=this._$container.find("#play-button"),this._$pauseButton=this._$container.find("#pause-button"),this._$fullScreen=this._$container.find("#video-fullscreen"),this._$ccButton=this._$container.find("#media-cc"),this._$playButton.click(this.doTogglePlayback),this._$pauseButton.click(this.doTogglePlayback),this._$fullScreen.click(this.doToggleFullscreen),this._$ccButton.click(this.doCaptionsToggle)}configureProgressBar(){this._$progressBar=this._$container.find("#media-progress-bar"),this._$thumbContainer=this._$container.find("#media-progress-slider"),this._$thumb=this._$container.find("#media-progress-slider-thumb"),this._$highWaterBar=this._$container.find("#media-progress-bar-hw"),this._$progressBarFill=this._$container.find("#media-progress-bar-fill"),this._$duration=this._$container.find("#media-counter-duration"),this._$elapsed=this._$container.find("#media-counter-elapsed"),this._$mediaTrack=this._$container.find("#media-progress-bar-track"),this._scrubLock!==s.PROGRESS_SCRUB_NONE&&(this._$thumb.on("mousedown touchstart",this.startDrag),this._$thumb.on("focus",this.listenForKeySeek),this._$thumb.on("blur",this.disableKeySeek),this._$thumb.on("transitionend",()=>{this._$thumb.removeClass("reset-thumb")})),this._api.model.touchSupport&&this._$thumb.addClass("large"),this._api.addTouchMoveException(this._$container.find("#media-controls"))}configureVolumeControls(){this._hasVolume=this._api.getDeviceType()===t.Platform.DEVICE_DESKTOP,this._hasVolume?(this._$volumeButton=this._$container.find("#media-volume-btn"),this._$volumeSlider=this._$container.find("#volume-slider"),this._$volumeThumb=this._$container.find(".vol-slider"),this._$volumeThumb.on("change input",this.adjustVolume),this._$volumeButton.click(this.doVolumeToggle),this._$volumeButton.on("mouseenter",this.showVolumeSlider),this._$volumeButton.on("mouseleave",this.exitVolumeSlider),this._$volumeSlider.on("mouseenter",this.showVolumeSlider),this._$volumeSlider.on("mouseleave",this.exitVolumeSlider)):this._$container.find(".volume-container").hide(),0===this._api.model.appVolume&&this.doMuteUI(),this._api.addEvent("apiEvent",this.apiEventHandler)}configureCaptions(){"on"===sai.LaunchDataManager.launchInfo.preferences.subtitles&&this._$container.find("#media-cc").click()}doMuteUI(){this._isMuted=!0,this._$volumeButton.addClass("muted").attr("aria-label",this._$volumeButton.attr("data-aria-unmute-label")),this._$volumeThumb.get(0).value="0"}doUnMuteUI(){this._isMuted=!1,this._$volumeButton.removeClass("muted").attr("aria-label",this._$volumeButton.attr("data-aria-mute-label")),this._$volumeThumb.get(0).value=this._api.model.appVolume.toString()}setVolume(e){this._hasVolume&&(e<0?e=0:1<e&&(e=1),0===e||this._api.model.isMuted||sai.LaunchDataManager.launchInfo.preferences.audio===t.SettingsManager.SETTING_VAL_OFF?this.doMuteUI():(this.doUnMuteUI(),this._$volumeThumb.get(0).value=e.toString()))}getDeviceSelectPoint(e){if(!_.isUndefined(e.pageX))return e.pageX;let t=0;return _.isEmpty(e.changedTouches)||_.each(e.changedTouches,e=>{e.target===this._$thumb[0]&&(t=e.pageX)}),t}doCaptionsOn(){this._captionsOn=!0,this._$ccButton.addClass("selected"),this._$ccButton.attr("aria-label",this._$ccButton.attr("data-aria-ccoff-label")),this._plugin.mediaCCOn()}doCaptionsOff(){this._captionsOn=!1,this._$ccButton.removeClass("selected"),this._$ccButton.attr("aria-label",this._$ccButton.attr("data-aria-ccon-label")),this._plugin.mediaCCOff()}setCaptionsOn(){this.doCaptionsOn()}setCaptionsOff(){this.doCaptionsOff()}removeCaptions(){this._$ccButton.hide()}setBuffering(e){e=Math.round(100*e),this._$progressBarFill.css("width",e+"%")}setProgress(e,t){this._$elapsed.text(s.formatTime(e)),this._$duration.text(s.formatTime(t));e=this.positionThumb(e,t);this.setHighwaterMark(e)}static formatTime(e){return(_.isNaN(e)?0:Math.floor(Math.round(e)/60))+":"+(_.isNaN(e)?0:Math.round(e)%60).toString().padStart(2,"0")}positionThumb(e,t){return this._thumbDragging?0:(0===(e=0===t?0:Math.round(100*e/t))&&this._$thumb.addClass("reset-thumb"),this._$thumb.css("left",e+"%").attr("aria-valuenow",e).attr("aria-valuetext",e+"%"),e)}setHighwaterMark(e){e>this._highWaterMark&&(this._$highWaterBar.width(e+"%"),this._highWaterMark=e)}toggleVolume(){this.doVolumeToggle()}toggleCaptions(){this.doCaptionsToggle()}togglePlayback(){this.doTogglePlayback()}completeActions(){this.positionThumb(0,0),this._api.sendEvent({destination:"All",type:s.MEDIA_END_EVENT,zoneId:this._zoneId})}destroy(){this._api.removeEvent("apiEvent",this.apiEventHandler)}get captionsOn(){return this._captionsOn}}s.PROGRESS_SCRUB_NONE="none",s.PROGRESS_SCRUB_LIMIT="limit",s.PROGRESS_SCRUB_FULL="full",s.MEDIA_END_EVENT="ended",t.MediaControls=s}(GLECore=GLECore||{});class ModalButton{constructor(e,t,i,a){this._id=e,this._label=t,this._callback=i,this._data=a}get id(){return this._id}get label(){return this._label}get data(){return this._data}get callback(){return this._callback}}!function(e){e.Bookmark=class{constructor(e){this._code="",this._value=0,this._date="no date",this._type="",this._page="",this._alert="",this._activityAlertId="",this._complete=!1,this._profiling=null,this._branching=null,this._time=0,this._activities=[],this._track=!0,this._hasIncompleteActivities=!1,this._bkmObject=e,this.code=this._bkmObject.code,this.value=this._bkmObject.value,this.date=this._bkmObject.date,this.type=this._bkmObject.type,this.page=this._bkmObject.page,this.alert=this._bkmObject.alert,this.activityAlertId=this._bkmObject.activityAlertId,this.complete=this._bkmObject.complete,this.profiling=this._bkmObject.profiling,this.time=this._bkmObject.time,this.activities=this._bkmObject.activities,this.track=this._bkmObject.track}get code(){return this._code}set code(e){_.isString(e)&&!_.isEmpty(e)&&(this._code=e.toUpperCase())}get value(){return this._value}set value(e){_.isUndefined(e)||(this._value=e)}get date(){return this._date}set date(e){_.isString(e)&&e.match(/^(\d{2})\/(\d{2})\/(\d{4})$/)&&(this._date=e)}get type(){return this._type}set type(e){_.isString(e)&&!_.isEmpty(e)&&(this._type=e)}get page(){return this._page}set page(e){_.isString(e)&&!_.isEmpty(e)&&(this._page=e)}get alert(){return this._alert}set alert(e){_.isString(e)&&!_.isEmpty(e)&&(this._alert=e)}get activityAlertId(){return this._activityAlertId}set activityAlertId(e){_.isString(e)&&!_.isEmpty(e)&&(this._activityAlertId=e)}get complete(){return this._complete}set complete(e){_.isBoolean(e)&&(this._complete=e)}get profiling(){return this._profiling}set profiling(e){_.isString(e)&&!_.isEmpty(e)&&(this._profiling=e)}get branching(){return this._branching}set branching(e){_.isString(e)&&!_.isEmpty(e)&&(this._branching=e)}get time(){return this._time}set time(e){_.isNumber(e)&&(this._time=e)}get activities(){return this._activities}set activities(e){_.isArray(e)&&!_.isEmpty(e)&&(this._activities=e)}get track(){return this._track}set track(e){_.isBoolean(e)&&(this._track=e)}get hasIncompleteActivities(){return this._hasIncompleteActivities}set hasIncompleteActivities(e){_.isBoolean(e)&&(this._hasIncompleteActivities=e)}}}(GLECore=GLECore||{}),function(e){class a{constructor(e){this._items=e,this._item=e[0].item,this._zoneID=_.isEmpty(e[0].zoneID)?null:e[0].zoneID,this._classes=this.buildClasses(),this._styles=this.buildStyles()}get itemReference(){return _.first(this._items)}get item(){return this._item}get classes(){return this._classes}get styles(){return this._styles}get zoneID(){return this._zoneID}buildClasses(){const i={};return _.each(this._items,e=>{const t=e.classes;_.isEmpty(t)||(e=e.breakPoints,_.each(e,e=>{_.isUndefined(i[e])&&(i[e]=[]),i[e]=i[e].concat(t)}))}),i}buildStyles(){const i={};return _.each(this._items,e=>{const t=e.styles;_.isEmpty(t)||(e=e.breakPoints,_.each(e,e=>{_.isUndefined(i[e])&&(i[e]=[]),i[e]=i[e].concat(a.processDeclarations(t))}))}),i}static processDeclarations(e){return a.addImportantRule(e)}static addImportantRule(e){return e.map(e=>e+" !important;")}}e.StyleData=a}(GLECore=GLECore||{}),function(i){class t{constructor(e){this._pageID=e.pageID,this._zoneID=_.isEmpty(e.zoneID)?null:e.zoneID,this._item=e.item,this._breakPoints=this.getBreakPoint(e.bp),this._classes=t.getClasses(e.classes),this._styles=t.getStyles(e.styles),this._altText=e.altText}getBreakPoint(e){var t=e.toLowerCase().split(",");return this.isSupportedBreakPoint(t)?t:(i.Trace.error("CourseStyle (setBreakPoint): The breakpoint '"+e+"' is not supported in page: "+this._pageID+"."),[i.Platform.DEVICE_MEDIA_SIZE_ALL])}isSupportedBreakPoint(e){return 0<e.filter(e=>-1!==i.StyleManager.SUPPORTED_SIZES.indexOf(e)||e===i.Platform.DEVICE_MEDIA_SIZE_ALL).length}static getClasses(e){return _.isEmpty(e)||(e=e.replace(/\s+/g,""),_.isEmpty(e))?[]:e.split(",")}static getStyles(e){var t;return _.isEmpty(e)||(t=_.trimEnd(e,";"),_.isEmpty(e))?[]:t.split(";")}get pageID(){return this._pageID}get zoneID(){return this._zoneID}get item(){return this._item}get breakPoints(){return this._breakPoints}get classes(){return this._classes}get styles(){return this._styles}get altText(){return this._altText}}i.CourseStyle=t}(GLECore=GLECore||{}),function(i){i.GleServiceLayerClient=class{constructor(e,t=1e4){this.handleServiceOutput=e=>{if(null!=e){var t={};if(null!=t){for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);this._gleServiceOutputObj=t}else this._gleServiceOutputObj=null}"function"==typeof this._afterSuccessFunc&&(null!==this._afterSuccessFuncArgs&&void 0!==this._afterSuccessFuncArgs||(this._afterSuccessFuncArgs=[null]),this._afterSuccessFunc.apply(this,this._afterSuccessFuncArgs))},this._gleDataProcessorProxyObj=new i.GleServiceProxy(i.DataUtil.trimTrailingSlashes(e)+"/DataProcessor.svc/"),this._gleDataProcessorProxyObj.requestTimeoutValMilliSec=t}get gleServiceOutputObj(){return this._gleServiceOutputObj}callProcessDataMethod(e,t,i,a,s){this._afterSuccessFunc=t,this._afterSuccessFuncArgs=i,this._afterErrorFunc=a,this._afterErrorFuncArgs=s,this._gleDataProcessorProxyObj.invokeService("ProcessData",{serviceInputs:e},this.handleServiceOutput,this.handleServiceError)}handleServiceError(e){_.isFunction(this._afterErrorFunc)?(_.isEmpty(this._afterErrorFuncArgs)?null!=e&&(this._afterErrorFuncArgs=[e.Message]):null!=e&&this._afterErrorFuncArgs.push(e.Message),this._afterErrorFunc.apply(this,this._afterErrorFuncArgs)):null!=e&&alert(e.Message)}}}(GLECore=GLECore||{}),function(t){t.GleServiceProxy=class{constructor(e){this.requestTimeoutValMilliSec=1e4,this.serviceUrl=t.DataUtil.trimTrailingSlashes(e)}invokeService(e,t,a,i){t=JSON.stringify(t),e=this.serviceUrl+"/"+e;const s="GLE Service Layer Error:\n\n";$.ajax({url:e,data:t,type:"POST",processData:!1,contentType:"application/json",timeout:this.requestTimeoutValMilliSec,dataType:"text",success(i){if(a){let e=null,t=!1;try{e=JSON.parse(i)}catch(e){t=!0,alert(s+"Encountered error while parsing result from service:\nName: "+e.name+"\nMessage: "+e.message)}t||setTimeout(()=>{a(e)},0)}},error(e,t){i&&(e.responseText?(e=JSON.parse(e.responseText))&&null!==e.Message&&void 0!==e.Message?(e.Message=s+e.Message,i(e)):i({Message:s+"Unknown server error."}):null!=t&&"timeout"===t&&i({Message:s+"A network timeout has occurred. Please relaunch."}))}})}}}(GLECore=GLECore||{}),function(i){i.ProfileQuery=class a{static convertStandardProfiles(e){const t=[];return e.forEach(e=>t.push(e.attributes.id+"="+e.attributes.value)),new a(t.join(" and "))}static convertJQueryProfiles(e){const i=[];return e.each((e,t)=>{t=$(t),i.push(t.attr("id")+"="+t.attr("value"))}),new a(i.join(" and "))}constructor(e){this._query=e,this._statements=[],this.buildProfileQuery()}buildProfileQuery(){var e=this._query.split(";");this._statements=_.map(e,e=>new i.ProfileQueryStatement(e))}evaluate(t){var e=_.filter(this._statements,e=>e.evaluate(t));return i.contains(e)}}}(GLEProfiling=GLEProfiling||{}),function(a){class s{constructor(e){this._statement=e,this.buildProfileStatement()}buildProfileStatement(){var e=this._statement.split(/ (?:and|or) /g);this._type=this._statement.match(/ or /)?s.TYPE_OR:s.TYPE_AND,this._conditions=e.map(e=>new a.ProfileQueryCondition(e))}evaluate(t){let e;var i;return e=this._type===s.TYPE_OR?(i=_.filter(this._conditions,e=>e.evaluate(t)),a.contains(i)):(i=_.reject(this._conditions,e=>e.evaluate(t)),a.containsNo(i))}}s.TYPE_AND="and",s.TYPE_OR="or",a.ProfileQueryStatement=s}(GLEProfiling=GLEProfiling||{}),function(t){class i{constructor(e){this._condition=e,this.buildCondition()}buildCondition(){var e=this._condition.split(/!?=/);this._type=this._condition.match(/!=/)?i.TYPE_NOT_EQUALS:i.TYPE_EQUALS,this._profileId=e[0],this._values=e[1].split(",")}get profileId(){return this._profileId}evaluate(e){e=e[this._profileId],e=_.intersection(e,this._values);return this._type===i.TYPE_NOT_EQUALS?t.containsNo(e):t.contains(e)}}i.TYPE_EQUALS="=",i.TYPE_NOT_EQUALS="!=",t.ProfileQueryCondition=i}(GLEProfiling=GLEProfiling||{}),function(e){e.SectionModel=class{constructor(e,t){this._optional=!1,this._complete=!1,this._pages=[],this._active=!0,this._averageTime=0,this._xml=e,this._model=t,this._id=e.attributes.id,this._title=this.getTitleText(),this._profile=this.extractProfileFromXml(),this._branch=this.extractBranchFromXml(),this.setDescriptionProperties(),this.setImageProperties(),this.setTime(),this.getStyles()}extractProfileFromXml(){var t={},e=this._xml.getChildrenOfType("Meta")[0];if(_.isEmpty(e))return{};var i=e.getAllDescendantsOfType("Profile");if(_.isEmpty(i))return{};for(let e=0;e<i.length;e++){var a=i[e];t[a.attributes.id]=a.attributes.value.split(",")}return t}extractBranchFromXml(){var t={},e=this._xml.getChildrenOfType("Meta")[0];if(_.isEmpty(e))return{};var i=e.getAllDescendantsOfType("Branch");if(_.isEmpty(i))return{};for(let e=0;e<i.length;e++){var a=i[e];t[a.attributes.id]=a.attributes.value.split(",")}return t}getTitleText(){var e=this._xml.getChildrenOfType("Title")[0];return _.isEmpty(e)?"":e.text}setDescriptionProperties(){this._description=this.getDescription(),this._description&&(this._descriptionTitle=this._description.getChildByAttribute("id","header").text,this._descriptionText=this._description.getChildByAttribute("id","body").text)}setTime(){var e;!0!==this._model.useDynamicTime||_.isEmpty(this._xml.attributes.averageTime)?this._description&&(e=this._description.getChildByAttribute("id","footer"),this._time=e?null==(e=e.getChildByAttribute("id","time"))?void 0:e.text:null):this._time=this._model.TokenUtil.parseTokens(this._xml.attributes.averageTime+" {tk_TimerMinutesUnitAbbrev}")}getDescription(){var e=this._xml.getChildrenOfType("Description");if(!_.isEmpty(e))return e[0]}setImageProperties(){var e;this._description&&(e=this._description.getChildrenOfType("Icon")[0])&&(this._image=e.attributes.src,this._altText=e.getChildrenOfType("Description")[0].text)}addPage(e){-1===this._pages.indexOf(e)&&this._pages.push(e)}getStyles(){this._styles=this._xml.getChildrenOfType("Styles")}updateTime(e){this._xml.attributes.averageTime=e.toString(),this.setTime()}getAllPages(){return this._pages}get id(){return this._id}set id(e){this._id=e}get optional(){return this._optional}set optional(e){this._optional=e}get complete(){return this._complete}set complete(e){this._complete=e}get xml(){return this._xml}set xml(e){this._xml=e}get profile(){return this._profile}get branch(){return this._branch}get title(){return this._title}set title(e){this._title=e}get pages(){return this._pages.filter(e=>e.active)}set pages(e){this._pages=e}get description(){return this._description}get descriptionTitle(){return this._descriptionTitle}get descriptionText(){return this._descriptionText}get time(){return this._time}get image(){return this._image}get altText(){return this._altText}get active(){return this._active}set active(e){this._active=e}get averageTime(){return this._averageTime}set averageTime(e){this._averageTime=e}get styles(){return this._styles}set styles(e){this._styles=e}}}(GLECore=GLECore||{}),function(e){e.PageModel=class{constructor(e,t){this._lastPageInSection=!1,this._active=!0,this._complete=!1,this._xmlContainer=e,this._id=e.attributes.pageID,this._templateId=e.attributes.templateID,this._trackingData=e.getFirstChildOfType("Tracking"),this._section=t,this._lastPageInSection=_.last(e.parent.getChildrenOfType("Page")).attributes.pageID===this._id,this._title=e.getChildrenOfType("Title")[0].text,this._profile=this.extractProfileFromXml(),this._branching=this.extractBranchingFromXml(),this._offlinePage=e.attributes.offlinePage}extractProfileFromXml(){var t={},i=this._xmlContainer.getAllDescendantsOfType("Profile");if(_.isEmpty(i))return this._section.profile;for(let e=0;e<i.length;e++){var a=i[e];t[a.attributes.id]=a.attributes.value.split(",")}return t}extractBranchingFromXml(){var t={},i=this._xmlContainer.getAllDescendantsOfType("Branch");if(_.isEmpty(i))return this._section.branch;for(let e=0;e<i.length;e++){var a=i[e];t[a.attributes.id]=a.attributes.value.split(",")}return t}get id(){return this._id}get templateId(){return this._templateId}set templateId(e){this._templateId=e}get complete(){return this._complete}set complete(e){this._complete=e}get xmlContainer(){return this._xmlContainer}get profile(){return this._profile}get trackingData(){return this._trackingData}get bookmark(){return this._bookmark}set bookmark(e){this._bookmark=e}get Section(){return this._section}get lastPageInSection(){return this._lastPageInSection}get title(){return this._title}get active(){return this._active}set active(e){this._active=e}get parentSection(){return this._section}get offlinePage(){return this._offlinePage}get branching(){return this._branching}}}(GLECore=GLECore||{}),function(i){class e{constructor(){this._preStateChangeAlerts=[]}initialize(e,t){this._ModalManager=t,this._api=e}showAlert(e){var t;return _.isEmpty(this._ModalManager.getModalDataById(e.id))?(t={id:e.id,header:this._api.parseTokens(e.header),content:this._api.parseTokens(e.content),srcElement:"root",buttons:e.buttons,hasExit:e.hasExit,isFullScreen:!1,$launcher:null!=(t=e.$launcher)?t:$(":focus"),isAlert:e.renderAsModalAlert,preventClickOutsideDismiss:e.preventClickOutsideDismiss,autoRemove:e.autoRemove,exitCallback:e.exitCallback},this._api.sendEvent({type:"modalOpened",value:{modalType:"alert"}}),this._ModalManager.openModal(new i.ModalData(t.id,t.header,t.content,t.srcElement,t.buttons,t.hasExit,t.$launcher,null,t.isFullScreen,t.isAlert,t.preventClickOutsideDismiss,t.exitCallback,t.autoRemove))):null}closeAlert(e){this._ModalManager.closeModal(e),this._api.sendEvent({type:"modalClosed",value:{modalType:"alert"}})}generateYesNoAlertButtons(t,i,a){return[new ModalButton("alert_no",this._api.parseTokens("{tk_No}"),e=>{a?a(e):this.closeAlert(t)}),new ModalButton("alert_yes",this._api.parseTokens("{tk_Yes}"),e=>{i?i(e):this.closeAlert(t)})]}addStateChangeAlert(e){this._preStateChangeAlerts.push(e)}getStateChangeAlert(e=i.StateChangeAlert.All){var t=this._preStateChangeAlerts.length;return t&&(t=this._preStateChangeAlerts[t-1],e===i.StateChangeAlert.All||t.context===i.StateChangeAlert.All||e===t.context)?t:null}removeStateChangeAlert(t){var e=this._preStateChangeAlerts.filter(e=>e.id===t);_.isEmpty(e)||(e=this._preStateChangeAlerts.indexOf(e[0]),this._preStateChangeAlerts.splice(e,1))}renderStateChangeAlert(t,i,e){t.buttons=this.generateYesNoAlertButtons(t.id,e=>{this.removeStateChangeAlert(t.id),i(e),t.exitCallback&&t.exitCallback(e,t.id)},e),this.showAlert(t)}}e.ALERT_EXIT="altCourseExit",i.AlertManager=e}(GLECore=GLECore||{}),function(i){class t{constructor(){this.gleServiceLayerHostname=window.location.hostname,this.gleServiceLayerRequestTimeout=3e4,this.onGleServiceLayerDataReady=()=>{var e;this.launchDataObj.gleServiceLayerOutputData=this.serviceLayerClient.gleServiceOutputObj,this.launchDataObj.gleServiceLayerOutputData.IsServiceProcessSuccessful&&this.launchDataObj.gleServiceLayerOutputData.LogContents&&(e="Service log results:\n"+this.launchDataObj.gleServiceLayerOutputData.LogContents,this.launchDataObj.gleServiceLayerOutputData.IsServiceProcessSuccessful?i.Trace.info(e):i.Trace.error(e)),this.processServiceOutputData()},this.onGleServiceLayerError=e=>{i.Trace.error("LaunchDataManager (onGleServiceLayerError): "+e)},this.processServiceOutputData=()=>{var e=this.launchDataObj.gleServiceLayerOutputData;_.isEmpty(e)?t.displayServiceError("The GLE service layer output data object is undefined.  It is required to load the engine.",""):_.isEmpty(e.FinalEnvironmentXml)?t.displayServiceError("There is no data to load for the final Environment XML.  It is required.",e.LogContents):(this.finalEnvironmentXml=$.parseXML(e.FinalEnvironmentXml),_.isEmpty(e.FinalContentXml)?t.displayServiceError("There is no data to load for the final content XML.  It is required.",e.LogContents):(this.finalContentXml=$.parseXML(e.FinalContentXml),_.isEmpty(e.FinalGlobalXml)?t.displayServiceError("There is no data to load for the final global XML.  It is required.",e.LogContents):(this.finalGlobalXml=$.parseXML(e.FinalGlobalXml),_.isEmpty(e.FinalFunctionXml)?t.displayServiceError("There is no data to load for the final functional XML.  It is required.",e.LogContents):(this.finalFunctionalXml=$.parseXML(e.FinalFunctionXml),_.isEmpty(e.FinalTemplateLibraryXml)?t.displayServiceError("There is no data to load for the final TemplateLibrary XML.  It is required.",e.LogContents):(this.finalTemplateLibraryXml=$.parseXML(e.FinalTemplateLibraryXml),this.launchDataLoadComplete())))))},this.launchDataLoadComplete=()=>{this.launchInfo=this.launchDataObj.gleServiceLayerOutputData.CourseInfo,this.launchInfo.preferences={},this.setLMSData(),_.isFunction(this.onCompleteCallback)&&this.onCompleteCallback()}}get LaunchInputs(){return this._launchInputs}initialize(e,t,i){this._launchInputs=e,this._preDefinedLaunchData=t,this.onCompleteCallback=i,this.buildLaunchDataObj(),this.courseInputData=this.launchDataObj.courseInputDataObj,this.initializeGleServiceLayer()}buildLaunchDataObj(){this.launchDataObj=new i.LaunchData,this.launchDataObj.courseInputDataObj=this._launchInputs,this._preDefinedLaunchData&&(this.launchDataObj.gleServiceLayerOutputData=this._preDefinedLaunchData,this.launchDataObj.gleServiceLayerOutputData.predefined=!0)}initializeGleServiceLayer(){_.isEmpty(this.launchDataObj.gleServiceLayerOutputData)?(this.serviceLayerClient=new i.GleServiceLayerClient(this.getServiceUrl(),this.gleServiceLayerRequestTimeout),this.serviceLayerClient.callProcessDataMethod(this.buildServiceInput(),this.onGleServiceLayerDataReady,[],this.onGleServiceLayerError,[])):this.processServiceOutputData()}getServiceUrl(){let t="";if(_.isEmpty(this._launchInputs.gsl_path)){let e="GleServiceLayer";"trunk"===this.launchDataObj.courseInputDataObj.playerVersion&&(e+="Trunk"),t=this.gleServiceLayerHostname+"/"+e+"/"}else t=this._launchInputs.gsl_path;return location.protocol+"//"+t}buildServiceInput(){return{ClientCode:this.courseInputData.clientCode,CourseCode:this.courseInputData.courseCode,DataProcessingTypeValuesArray:["content","function","global","template"],EnvironmentDefaultXmlRelativeFilePath:"Environment.xml",EnvironmentSecondaryXmlRelativeFilePath:t.PLAYER_ROOT_DIR+"/{PlayerVersionDirName}/xml/Environment_player.xml",LanguageCode:this.courseInputData.languageCode,ManifestRelativeDirPath:"ProductContent/_Asset_Library/course_manifests",OutputFormatTypeValueString:"html5",OverrideVersions:"true"===this.courseInputData.previewMode?"":this.courseInputData.courseOverrideVersion,OverrideVersionsToAppend:"lms_"+this.courseInputData.lmsId.toLowerCase(),OverrideVersionsToExclude:this.courseInputData.overrideVersionExclusions,OverrideVersionsEngine:"gle,html5,4x",PlayerVersion:this.courseInputData.playerVersion,PlayerStyleFilesRelativeDirPath:"",SearchSubFoldersForStyleFiles:!1,CssStyleElementDefinitions:[],DynamicCourseOverrideXml:this.courseInputData.courseOverride,DynamicCourseOverrideVersion:this.courseInputData.courseOverrideVersion}}static displayServiceError(e,t){t=t.replace(/.*(WARNING|INFO).*\r?\n|\r/g,"");i.Trace.error(`LaunchDataManager (processServiceOutputData): ${e}

			`+t)}setLMSData(){var e=this.courseInputData.lmsId.toUpperCase();_.isEmpty(this.launchInfo.lms)?_.isUndefined(this._launchInputs)?this.launchInfo.lms={lmsId:e}:this.launchInfo.lms={availableLangs:this._launchInputs.availableLangs,completionType:this._launchInputs.completionType,exitType:this._launchInputs.exitType,languageCode:this._launchInputs.languageCode,lmsId:this._launchInputs.lmsId,useInteractions:this._launchInputs.useInteractions,useObjectives:this._launchInputs.useObjectives,forceScore:this._launchInputs.forceScore,timebombDate:this._launchInputs.timebombDate,encodeResponses:this._launchInputs.encodeResponses}:_.isEmpty(this.launchInfo.lms.lmsId)&&(this.launchInfo.lms.lmsId=e)}}t.PLAYER_ROOT_DIR="Player-HTML5",i.LaunchDataManager=t}(GLECore=GLECore||{}),function(d){class u{get firstPreferencesDisplay(){return this._firstPreferencesDisplay}set firstPreferencesDisplay(e){this._firstPreferencesDisplay=e}get styleSettings(){return this._styleSettings}constructor(e){this._generalSettings={},this._firstPreferencesDisplay=!1,this._LaunchDataManager=e}initialize(e){this._ViewingModeManager=e}setFinalEnvironmentXml(e){_.isUndefined(e)?d.Trace.error("SettingsManager (setFinalEnvironmentXml): Cannot set the final Environment XML.  The input XML document is not defined."):(this._$finalEnvXml=$(e),this.processEnvironmentXml(this._$finalEnvXml))}setConfigGlobalXml(e){_.isUndefined(e)?d.Trace.error("SettingsManager (setConfigGlobalXml): Cannot set the final config global XML.  The input XML document is not defined."):(this._$finalConfigGlobalXml=$(e),this.handleSettings(),e=0<(null==(e=this._explicitSettings)?void 0:e.length),this.applyContentSettings(),this.addGeneralSettings(this._$finalConfigGlobalXml),this.addViewingModeDefinitionSettings(this._$finalConfigGlobalXml),e?this.addViewingModeSettingsExplicit():this.addViewingModeSettings(this._$finalConfigGlobalXml),this.addStyleSettings(this._$finalConfigGlobalXml))}handleSettings(){var e=this._$finalConfigGlobalXml.find(u.XML_ELEMENT_NAME_SETTINGS);let t;0!==e.length&&(t=1===e.length?e.first():e.filter(()=>"player"!==$(this).attr("source")).last(),this._explicitSettings=t.children(u.XML_ELEMENT_NAME_SETTING))}getConfigGlobalXml(){return this._$finalConfigGlobalXml}getSettingValueGeneral(e){return _.isUndefined(this._generalSettings[e])?(d.Trace.error('SettingsManager (getSettingValueGeneral): Cannot get the value of the general setting with name "'+e+'".  It does not exist in the settings.'),""):this._generalSettings[e]}processEnvironmentXml(e){_.isUndefined(e)?d.Trace.error("SettingsManager (processEnvironmentXml): Cannot process the final Environment XML data.  The input jQuery object instance is not defined."):(this.addGeneralSettings(e),this.addViewingModeDefinitionSettings(e),this.addViewingModeSettings(e))}applyContentSettings(){$(this._LaunchDataManager.finalContentXml).find("Config > datum").each((e,t)=>{var t=$(t),i=t.attr("name"),t=t.attr("value");this._$finalConfigGlobalXml.find(`general > datum[name=${i}]`).attr("value",t)})}addGeneralSettings(e){if(_.isUndefined(e))d.Trace.error("SettingsManager (addGeneralSettings): Cannot process the XML data to add general settings.  The input jQuery object instance is not defined.");else{var t=e.find(u.XML_ELEMENT_NAME_GENERAL_SETTING_GROUP).children(u.XML_ELEMENT_NAME_DATUM);for(let e=0;e<t.length;e++){var i=$(t[e]),a=i.attr(u.XML_ATTR_NAME_DATUM_NAME);_.isEmpty(a)?d.Trace.error("SettingsManager (addGeneralSettings): Cannot add the general setting. The setting name is null, undefined, empty or whitespace"):this._generalSettings[a]=i.attr(u.XML_ATTR_NAME_DATUM_VALUE)}}}addViewingModeSettings(e){var t=this._ViewingModeManager.availableViewingModesLang,i=this._ViewingModeManager.availableViewingModesLangSorted,a=e.find(u.XML_ELEMENT_NAME_VIEWINGMODES_GROUP).children(u.XML_ELEMENT_NAME_DATUM);for(let e=0;e<a.length;e++){var s=$(a[e]),n=s.attr(u.XML_ATTR_NAME_DATUM_NAME);if(_.isEmpty(n))d.Trace.error("SettingsManager (addViewingModeSettings): Cannot add the viewing mode language setting. The setting language ID is null, undefined, empty or whitespace");else{s=s.attr(u.XML_ATTR_NAME_DATUM_VALUE);if(_.isEmpty(s))d.Trace.error('SettingsManager (addGeneralSettings): Cannot add the viewing modes for language with ID "'+n+'". The setting value of the viewing modes for language is null, undefined, empty or whitespace.  At least one viewing mode needs to be specified.');else{s=s.replace(/\s*/g,"").replace(/,{2,}/g,"");if(0<s.length){var r=s.split(",");i[n]=r,t[n]={};for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[n][r[o]]=r[o])}}}}this._ViewingModeManager.availableViewingModesLang=t,this._ViewingModeManager.availableViewingModesLangSorted=i}addViewingModeSettingsExplicit(){var t={},i={},a={};for(let e=0;e<this._explicitSettings.length;e++){var s=$(this._explicitSettings[e]);if("false"!==s.attr("enabled")){var n=$(this._explicitSettings[e].attributes),r=s.attr(u.XML_ELEMENT_NAME_VIEWINGMODE),o=s.attr(u.XML_ELEMENT_NAME_LANG);t[o]||(t[o]={}),i[o]||(i[o]=[]),a[o]||(a[o]={}),a[o][r]||(a[o][r]={}),-1===i[o].indexOf(r)&&i[o].push(r),t[o][r]||(t[o][r]=r);for(let e=0;e<n.length;e++){var l=n[e];a[o][r][l.name]=l.value}}}this._ViewingModeManager.explicitViewingModeSettings=a,this._ViewingModeManager.availableViewingModesLang=t,this._ViewingModeManager.availableViewingModesLangSorted=i}addViewingModeDefinitionSettings(e){if(_.isUndefined(e))d.Trace.error("SettingsManager (addViewingModeDefinitionSettings): Cannot process the XML data to add viewing mode definition settings settings.  The input jQuery object instance is not defined.");else{let i=e.find(u.XML_ELEMENT_NAME_VIEWINGMODES_GROUP).children(u.XML_ELEMENT_NAME_VIEWINGMODE);var e=e.find(u.XML_ELEMENT_NAME_SETTINGS+" > "+u.XML_ELEMENT_NAME_SETTING+"["+u.XML_ELEMENT_NAME_LANG+"="+this._LaunchDataManager.launchInfo.Course.LanguageCode+"]"),a=0<e.length;a&&(i=e);for(let t=0;t<i.length;t++){var s,n,r,o,l,h,c=$(i[t]);let e="";e=a?c.attr(u.XML_ELEMENT_NAME_VIEWINGMODE):c.attr(u.XML_ATTR_NAME_VIEWINGMODE_ID),_.isEmpty(e)?d.Trace.error('SettingsManager (addGeneralSettings): Cannot add the viewing mode definition setting. The viewing mode "'+u.XML_ATTR_NAME_VIEWINGMODE_ID+'" attribute is null, undefined, empty or whitespace'):(s=c.attr(u.XML_ATTR_NAME_VIEWINGMODE_AUDIO),n=c.attr(u.XML_ATTR_NAME_VIEWINGMODE_SUBTITLES),r=c.attr(u.XML_ATTR_NAME_VIEWINGMODE_AUDIO_OPTION_DISABLED),o=c.attr(u.XML_ATTR_NAME_VIEWINGMODE_SUBTITLE_OPTION_DISABLED),l=c.attr(u.XML_ATTR_NAME_VIEWINGMODE_AUDIO_OPTION_HIDDEN),c=c.attr(u.XML_ATTR_NAME_VIEWINGMODE_SUBTITLE_OPTION_HIDDEN),(h=new d.ViewingMode).viewingModeValue=e,h.audio=s,h.subtitles=n,h.audioOptionDisabled=r,h.subtitleOptionDisabled=o,h.audioOptionHidden=l,h.subtitleOptionHidden=c,this._ViewingModeManager.addViewingModeObj(h))}}}addStyleSettings(e){_.isUndefined(e)?d.Trace.error("SettingsManager (addStyleSettings): Cannot process the XML data to add style settings.  The input jQuery object instance is not defined."):this._styleSettings={library:this.processStyleGroup(e.find("library")),client:this.processStyleGroup(e.find("client"))}}processStyleGroup(e){return _.isEmpty(e)?{}:{base:u.processBaseStyles(e.find("base")),products:this.processStyleCollection(e.find("products"),"product"),courses:this.processStyleCollection(e.find("courses"),"course")}}static processBaseStyles(e){var t=u.processStyleEntry(e);return t.loadPalette=e.attr("loadPalette"),t}processStyleCollection(e,t){if(_.isEmpty(t))return d.Trace.error("SettingsManager (processStyleCollection): Child selector is not set"),[];e=e.children(t);const i=[];return _.each(e,e=>{i.push(u.processStyleEntry($(e)))}),i}static processStyleEntry(e){if(_.isEmpty(e))return{};var t=e.attr("id"),i=e.attr("languages");let a=e.attr("fileName");return{id:t,languages:_.isEmpty(i)?[]:i.split(","),fileName:a=_.isEmpty(a)?t:a}}}u.SETTING_VAL_ON="on",u.SETTING_VAL_OFF="off",u.SETTING_NAME_SHOW_PRECOURSE_SETTINGS="ShowPrecourseSettings",u.SETTING_NAME_HIDE_LANGUAGE_SELECTOR="HideLanguageSelector",u.SETTING_NAME_HIDE_VIEWING_MODE_SELECTOR="HideViewingModeSelector",u.SETTING_NAME_DEFAULT_VIEW_MODE="DefaultViewingMode",u.SETTING_NAME_CUSTOM_FONT_URL="CustomFontUrl",u.SETTING_NAME_HIDE_SECTION_TIME="HideSectionTime",u.SETTING_NAME_TRACKING_MODE="TrackingMode",u.SETTING_NAME_COMPLETION_MODE="CompletionMode",u.XML_ELEMENT_NAME_GENERAL_SETTING_GROUP="general",u.XML_ELEMENT_NAME_DATUM="datum",u.XML_ATTR_NAME_DATUM_NAME="name",u.XML_ATTR_NAME_DATUM_VALUE="value",u.XML_ELEMENT_NAME_VIEWINGMODES_GROUP="viewingmodes",u.XML_ELEMENT_NAME_LANG="lang",u.XML_ELEMENT_NAME_SETTINGS="settings",u.XML_ELEMENT_NAME_SETTING="setting",u.XML_ELEMENT_NAME_VIEWINGMODE="viewingMode",u.XML_ATTR_NAME_VIEWINGMODE_ID="id",u.XML_ATTR_NAME_VIEWINGMODE_AUDIO="audio",u.XML_ATTR_NAME_VIEWINGMODE_SUBTITLES="subtitles",u.XML_ATTR_NAME_VIEWINGMODE_AUDIO_OPTION_DISABLED="audioOptionDisabled",u.XML_ATTR_NAME_VIEWINGMODE_SUBTITLE_OPTION_DISABLED="subtitleOptionDisabled",u.XML_ATTR_NAME_VIEWINGMODE_AUDIO_OPTION_HIDDEN="audioOptionHidden",u.XML_ATTR_NAME_VIEWINGMODE_SUBTITLE_OPTION_HIDDEN="subtitleOptionHidden",d.SettingsManager=u}(GLECore=GLECore||{}),function(a){class s{set availableViewingModesLang(e){this._availableViewingModesLang=e}get availableViewingModesLang(){return this._availableViewingModesLang}set availableViewingModesLangSorted(e){this._availableViewingModesLangSorted=e}get availableViewingModesLangSorted(){return this._availableViewingModesLangSorted}set explicitViewingModeSettings(e){this._explicitViewingModeSettings=e}get explicitViewingModeSettings(){return this._explicitViewingModeSettings}get currentViewingMode(){return this._currentViewingMode}constructor(e){this.defaultViewingMode="",this.viewingModes={},this.availableViewingModesAll={},this.availableViewingModesAllSetting="",this._availableViewingModesLang={},this._availableViewingModesLangSorted={},this._currentViewingMode="",this._explicitViewingModeSettings={},this._SettingsManager=e}initialize(e,t,i){this._LanguageManager=e,this._api=t,this.setUpDefaultViewingMode(this._LanguageManager.currentLangId,i)}getAvailableViewingModesAll(){var e=this._SettingsManager.getSettingValueGeneral(s.SETTING_NAME_ALL_VIEWING_MODES);if(_.isUndefined(this.availableViewingModesAll)&&_.isEmpty(e))this.availableViewingModesAll={};else if((_.isUndefined(this.availableViewingModesAll)||this.availableViewingModesAllSetting!==e)&&!_.isEmpty(e)){var t=(this.availableViewingModesAllSetting=e).replace(/\s*/g,"").replace(/,{2,}/g,",").split(",");this.availableViewingModesAll={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(this.availableViewingModesAll[t[i]]=t[i])}return this.availableViewingModesAll}setCurrentViewingMode(e){var t;this.currentViewingMode!==e&&(t=this._LanguageManager.currentLangId,this.isViewingModeInLang(e,t)?this._currentViewingMode=e:(this._currentViewingMode=_.last(this._availableViewingModesLangSorted[t]),a.Trace.warn(`ViewingModeManager (setCurrentViewingMode): Cannot set the current viewing mode to "${e}" because it is not valid for the current language ID "${this._LanguageManager.currentLangId}". Defaulting to last list viewing mode.`)))}addViewingModeObj(e){return!_.isUndefined(e)&&(this.viewingModes[e.viewingModeValue]=e,!0)}getViewingModeObj(e){return _.isEmpty(e)?{valid:!1}:{valid:!0,viewingMode:this.viewingModes[e]}}getAudioSetting(e){return this.isViewingModeValid(e)&&!_.isUndefined(this.viewingModes[e])?this.viewingModes[e].audio:""}getAudioHiddenSetting(e){return this.isViewingModeValid(e)&&!_.isUndefined(this.viewingModes[e])?this.viewingModes[e].audioOptionHidden:""}getAudioDisabledSetting(e){return this.isViewingModeValid(e)&&!_.isUndefined(this.viewingModes[e])?this.viewingModes[e].audioOptionDisabled:""}getSubtitleSetting(e){return this.isViewingModeValid(e)&&!_.isUndefined(this.viewingModes[e])?this.viewingModes[e].subtitles:""}getSubtitleHiddenSetting(e){return this.isViewingModeValid(e)&&!_.isUndefined(this.viewingModes[e])?this.viewingModes[e].subtitleOptionHidden:""}getSubtitleDisabledSetting(e){return this.isViewingModeValid(e)&&!_.isUndefined(this.viewingModes[e])?this.viewingModes[e].subtitleOptionDisabled:""}isViewingModeValid(e){return this.getAvailableViewingModesAll()[e]===e}isViewingModeInLang(e,t){return!(_.isUndefined(this.availableViewingModesLang[t])||!this.isViewingModeValid(e))&&this.availableViewingModesLang[t][e]===e}setUpDefaultViewingMode(e,t){this.defaultViewingMode&&!0!=!this.defaultViewingMode.length||(t?this.defaultViewingMode=t:(this.defaultViewingMode=this._SettingsManager.getSettingValueGeneral(a.SettingsManager.SETTING_NAME_DEFAULT_VIEW_MODE),""===this.defaultViewingMode&&(this.defaultViewingMode=t||this.getDisplayViewingModes(e)[0].value)),this.setCurrentViewingMode(this.defaultViewingMode))}getDisplayViewingModes(e){var t=[];if(_.isUndefined(this.availableViewingModesLangSorted[e]))a.Trace.error('ViewingModeManager (getDisplayViewingModes): There are no viewing modes defined for the language with ID "'+e+'".'),t.push({label:"",value:""});else for(const i in this.availableViewingModesLangSorted[e])this.isViewingModeValid(this.availableViewingModesLangSorted[e][i])&&t.push({label:this._api.parseTokens("{tk_"+this.availableViewingModesLangSorted[e][i]+"}"),value:this.availableViewingModesLangSorted[e][i]});return t}getTooltipTextHeader(){return this._api.parseTokens("{"+s.TOKEN_TOOLTIP_TEXT_HEADER+"}")}getTooltipTextIntro(){return this._api.parseTokens("{"+s.TOKEN_TOOLTIP_TEXT_INTRO+"}")}getViewingModeTooltipText(e){return this._api.parseTokens("{tk_"+e+"_tt}")}createViewingModesForLang(e){if(!_.isEmpty(this.explicitViewingModeSettings)){this.viewingModes={};e=this.explicitViewingModeSettings[e];if(!_.isUndefined(e)){let t;_.forEach(e,e=>{(t=new a.ViewingMode).viewingModeValue=e[a.SettingsManager.XML_ELEMENT_NAME_VIEWINGMODE],t.audio=e[a.SettingsManager.XML_ATTR_NAME_VIEWINGMODE_AUDIO],t.subtitles=e[a.SettingsManager.XML_ATTR_NAME_VIEWINGMODE_SUBTITLES],t.audioOptionDisabled=e[a.SettingsManager.XML_ATTR_NAME_VIEWINGMODE_AUDIO_OPTION_DISABLED],t.audioOptionHidden=e[a.SettingsManager.XML_ATTR_NAME_VIEWINGMODE_AUDIO_OPTION_HIDDEN],t.subtitleOptionDisabled=e[a.SettingsManager.XML_ATTR_NAME_VIEWINGMODE_SUBTITLE_OPTION_DISABLED],t.subtitleOptionHidden=e[a.SettingsManager.XML_ATTR_NAME_VIEWINGMODE_SUBTITLE_OPTION_HIDDEN],this.addViewingModeObj(t)})}}}getLanguageLabel(e){e=this._explicitViewingModeSettings[e];if(!e)return"";let t="";return _.each(e,e=>{e.label&&(t=e.label)}),t}}s.SETTING_NAME_ALL_VIEWING_MODES="AllViewingModes",s.TOKEN_TOOLTIP_TEXT_HEADER="tk_ViewingModeTTHeader",s.TOKEN_TOOLTIP_TEXT_INTRO="tk_ViewingModeTTIntro",s.VIEWING_MODE_VIDHI="vidhi",s.VIEWING_MODE_TG="tg",a.ViewingModeManager=s}(GLECore=GLECore||{}),function(e){class r{constructor(){this.modals=[],this.rootClass="rootClass",this.attachOpenClass=e=>{const t=e.$modalEl;t.addClass("opened").find(".modal-window").attr("tabindex","-1"),setTimeout(()=>{(!0===e.isAlert?t.find(".modal-content-saig"):t.find("h2").first()).attr("tabindex","-1").focus()},500),this.Controller.sendEvent({destination:"Style",type:"applyPageClasses"})},this.updateKeyListeners=(e=null,t=!1)=>{var i=e?e.$modalEl:null,a=this.modals.filter(e=>!e.scheduledForDeletion);this.$rootElement.off("keydown",this.onKeyDown),_.isEmpty(e)||e.scheduledForDeletion?(a.length?(e=_.last(a),this.$rootElement.on("keydown",{$modal:i},this.onKeyDown),this.$rootElement.find(r.INTERACTIVE_ELEMENTS).attr("tabindex",t?0:-1),e.$modalEl):this.$rootElement).find(r.INTERACTIVE_ELEMENTS).attr("tabindex",0):(this.$rootElement.on("keydown",{$modal:i},this.onKeyDown),this.$rootElement.find(r.INTERACTIVE_ELEMENTS).attr("tabindex",t?0:-1),i.find(r.INTERACTIVE_ELEMENTS).attr("tabindex",0),i.attr("tabindex",-1).focus())},this.updateDocumentListeners=(e=null)=>{var t=e?e.$modalEl:null;_.isEmpty(t)||t.on("click",{modalData:e},this.onModalClicked)},this.onModalClicked=e=>{var t=e.data.modalData,i=t.$modalEl.find(".modal-window").get(0),e=$(e.target).get(0);$.contains(i,e)||!0===t.preventClickOutsideDismiss||this.closeModal(t.id)},this.onKeyDown=e=>{var t=e.data.$modal.find(r.INTERACTIVE_ELEMENTS).filter(":visible"),i=t.first(),t=t.last(),a=$(e.target),s=i.get(0)===a.get(0)||a.is(".modal-window"),n=t.get(0)===a.get(0),a=a.closest(".modal-saig");"Tab"===e.key&&n&&!e.shiftKey?(e.preventDefault(),i.focus()):"Tab"===e.key&&s&&e.shiftKey?(e.preventDefault(),t.focus()):"Escape"===e.key&&(n=_.find(this.modals,{id:a.data("id")}))&&!1===n.preventClickOutsideDismiss&&this.closeModal(a.data("id"))},this.onModalClosed=e=>{if(e.data.modalData.exitCallback)return e.data.modalData.exitCallback(e,e.data.modalData.id);this.closeModal(e.data.modalData.id)},this.closeModal=e=>{var t=_.filter(this.modals,{id:e});_.isEmpty(t)?(this.updateKeyListeners(),this.$engineContentContainer.attr("aria-hidden","false")):((t=(t=this.modals.filter(e=>!e.scheduledForDeletion))[t.length-1]).scheduledForDeletion=!0,this.removeModal(t),this.modals.length<=1?(this.updateKeyListeners(),this.$engineContentContainer.attr("aria-hidden","false"),t.$launcher.attr("tabindex",0).focus()):(null!=(t=t.$launcher)&&t.attr("tabindex",0).focus(),this.updateKeyListeners(this.modals[this.modals.length-1]))),$("#course-player-wrapper").attr("aria-hidden","false"),this.Controller.sendEvent({type:r.MODAL_CLOSED,modalId:e})},this.onPageUpdate=()=>{this.modals.forEach(e=>{e.autoRemove&&this.removeModal(e)}),this.$engineContentContainer.attr("aria-hidden","false")}}initialize(e){this.Controller=e,this.Controller.addEvent("pageUpdate",this.onPageUpdate),this.$rootElement=$("body"),this.$engineContentContainer=$("#course-player-wrapper")}getModalDataById(e){return _.find(this.modals,{id:e})}openModal(e,t=!1){return _.isNull(e.$modalEl)&&(e.$modalEl=this.preBuildModal(e)),this.initTransition(e),this.Controller.sendEvent({type:r.MODAL_OPENED,modalId:e.id}),"root"===e.sourceElement&&this.$engineContentContainer.attr("aria-hidden","true"),!0===t&&this.updateKeyListeners(e),$("#course-player-wrapper").attr("aria-hidden","true"),e.$modalEl}preBuildModal(e,t=!1){return e.$modalEl=this.buildModal(e),this.wireButtons(e),this.addModalToStack(e),this.updateKeyListeners(e,t),this.updateDocumentListeners(e),e.$modalEl}reenableTabIndexes(){this.$rootElement.find(r.INTERACTIVE_ELEMENTS).attr("tabindex",0)}buildModal(e){e.$launcher||(t=$(":focus"),e.$launcher=t.length?t:$("#page-top"));var t=this.setSourceElement(e.sourceElement),i={id:e.id,isAlert:e.isAlert,isFullScreen:e.isFullScreen,hasExit:e.hasExit,header:e.header,content:e.content,buttons:e.buttons,$launcher:e.$launcher,rootClass:e.isAlert?"saig-alert":t.rootClass,zoneId:e.zoneId},i=(this.modalTemplate=_.template(this.Controller.getTemplate("ModalTemplate").content),$(this.modalTemplate(i)));return i.attr("data-id",e.id),t.$element.append(i).children().last()}initTransition(e){setTimeout(this.attachOpenClass,0,e)}setSourceElement(e){var t={};return t.$element="root"===e?this.$rootElement:$(e),t.rootClass="root"===e?this.rootClass:"",t}addModalToStack(e){this.modals.push(e)}wireButtons(t){t.$modalEl.find(".close-button").on("click",{modalData:t},this.onModalClosed),_.forEach(t.buttons,e=>{t.$modalEl.find("#"+e.id+"-button").on("click",{modal:t.$modalEl,buttonData:e.data},e.callback)})}removeModalObjectById(t){this.modals=_.reject(this.modals,e=>e.id===t)}removeModal(t){t.$modalEl.hide(),setTimeout(()=>{var e=this.modals.indexOf(t);t.$modalEl.remove(),-1!==e&&this.modals.splice(e,1)},0)}}r.INTERACTIVE_ELEMENTS="a,button,input,textarea,select,.magicBtn,.srt-item,.focusable",r.MODAL_CLOSED="modal_closed",r.MODAL_OPENED="modal_opened",e.ModalManager=r}(GLECore=GLECore||{}),function(i){class c{constructor(){this._interactionData={},this._showInteractionDetail=!1,this._enabledOnLaunch=!1,this._allowKeypress=!0,this._trackingDisabledOnLaunch=!0,this.onKeyHandler=e=>{this._allowKeypress&&e.key&&"shift"!==e.key.toLowerCase()&&(this._keysPressed+=e.key,this._keysPressed.match(c.QA_LAUNCH_KEY_PATTERN))&&this.startQAMode()},this.onClickHandler=e=>{this._allowKeypress&&(e=$(e.currentTarget),this._buttonsPressed+=e.hasClass("logo-container")?"1":"2",this._buttonsPressed.match(c.QA_LAUNCH_TOUCH_PATTERN))&&this.startQAMode()},this.onPageUpdate=()=>{this.clearAssessmentInformation(),this.updateStateInformation(),this.renderStateInformation()},this.onApiEvent=e=>{if("langChange"===e.data.type)this.Controller=null,this.ApplicationModel=null,this.onClosePanel();else if("internalReset"===e.data.type)this._$logo.off("click",this.onClickHandler),this._$footer.off("click",this.onClickHandler);else{if("breakpointChange"===e.data.type)this._$container.find(".bgImagePath > .value").html(this.getCurrentBGSource(this.ApplicationModel.currentPage));else if("assessmentQuestionChange"!==e.data.type)return;e=e.data.value;_.isEmpty(e)&&!_.isEmpty(this._$container)?this.onPageUpdate():(this.updateStateInformation(),this._isAssessmentScreen=!0,this._questionCategoryName=e.category.name,this._questionCategorySectionId=e.category.sectionId,this._questionCategoryScore=e.category.passingScore,_.isEmpty(this._$container)||this.renderStateInformation())}},this.tick=()=>{this._pageComplete=!!this.ApplicationModel.currentPage&&this.ApplicationModel.currentPage.complete,this._$pageComplete.html(this._pageComplete.toString())},this.onClickBookmark=e=>{e=$(e.currentTarget).data("page").toString();this.Controller.callPage(e)},this.onResetPalette=()=>{var e=_.find(this._paletteOptions,e=>e.default);c.QA_BLOCK_CLIENT_PALETTE_LOAD=!1,this.loadPalette(e)},this.onSelectPalette=e=>{const t=$(e.currentTarget);e=_.find(this._paletteOptions,e=>e.selector===t.data("palette"));c.QA_BLOCK_CLIENT_PALETTE_LOAD=!0,this.loadPalette(e)},this.onToggleCMIDetails=()=>{this._showInteractionDetail=!this._showInteractionDetail,this.configureCMIDetailView()},this.onToggleProfile=()=>{if(!0===c.QA_PROFILING_DISABLED)return alert("Once deactivated, profiling cannot be turned back on. Please relaunch the course to restore standard functionality.");c.QA_PROFILING_DISABLED=!0,this._$profileToggle.removeClass("off"),this.Controller.sendEvent({type:c.QA_EVENT_PROFILE_CHANGE,value:c.QA_PROFILING_DISABLED})},this.onToggleTracking=()=>{!0===c.QA_TRACKING_MODE_DISABLED?(c.QA_TRACKING_MODE_DISABLED=!1,this._$trackingToggle.removeClass("off").addClass("on")):(c.QA_TRACKING_MODE_DISABLED=!0,this._$trackingToggle.removeClass("on").addClass("off"))},this.onToggleAssessment=()=>{!0===c.QA_ALL_ASMT_ENABLED?(c.QA_ALL_ASMT_ENABLED=!1,this._$asmtToggle.removeClass("on").addClass("off")):(c.QA_ALL_ASMT_ENABLED=!0,this._$asmtToggle.removeClass("off").addClass("on"))},this.onToggleBranchingZones=()=>{if(!0===c.QA_ALL_BRANCHING_ZONES_ENABLED)return alert("Advanced Zone Branching cannot be re-enabled. Please relaunch the course to restore standard functionality.");var e=sai.PluginManager.completeManifest.MultiZone;sai.PluginManager.completeManifest.BranchingZones.classRef=e.classRef,this.ApplicationModel.pages.filter(e=>e.templateId.match(/BranchingZone/)).forEach(e=>{var t=e.xmlContainer,i=t.getFirstChildOfType("SWF"),a=i.getFirstChildOfType("Data");i.attributes.id="multizone",a.attributes.mode="default",a.attributes.templateID="p_multizone",t.attributes.templateID="MultiZone1",e.templateId="MultiZone1"}),c.QA_ALL_BRANCHING_ZONES_ENABLED=!0,this._$bzToggle.removeClass("off").addClass("on"),this.Controller.reloadCurrentPage()},this.onTogglePanel=()=>{this._$container.toggleClass("collapsed")},this.onClosePanel=()=>{clearInterval(this._ticker),this.clearStateInformation(),this._$container.remove(),this._$container=null,this._keysPressed="",this._$rootElement.on("keyup",this.onKeyHandler),c.QA_MODE_ENABLED=!1,this.Controller&&this.Controller.removeEvent("pageUpdate",this.onPageUpdate),_.isEmpty(c.trackingObject)||c.trackingObject.removeEventListener("qaTrackingDataUpdate",this.handleTrackingUpdate),c.trackingObject=null},this.handleTrackingUpdate=t=>{var e=t.data.id.replace(/_.*?$/,""),e=(_.isEmpty(this._interactionData[e])&&(this._interactionData[e]=[]),this._interactionData[e]),i=_.findIndex(e,e=>e.id===t.data.id);-1!==i?e.splice(i,1,t.data):e.push(t.data),this.updateStateInformation(),_.isEmpty(this._$container)||this.renderStateInformation()}}initialize(e,t,i,a,s){this.Controller=e,this.LaunchDataManager=t,this.SettingsManager=i,this.BackgroundMediaManager=a,this.TrackingManager=s,this.ApplicationModel=this.Controller.model,this._enabledOnLaunch="true"===this.SettingsManager.getSettingValueGeneral("QAModeEnable"),this._allowKeypress="false"!==this.SettingsManager.getSettingValueGeneral("QAModeAllowKeyPress"),this._trackingDisabledOnLaunch="true"===this.SettingsManager.getSettingValueGeneral("QAModeTrackingDisabled"),this._keysPressed="",this._buttonsPressed="",this._$logo=$(".logo-container"),this._$footer=$("#gle-progressbar"),this._$rootElement=$("body"),this._$rootElement.off("keyup",this.onKeyHandler).on("keyup",this.onKeyHandler),this._$logo.off("click",this.onClickHandler).on("click",this.onClickHandler),this._$footer.off("click",this.onClickHandler).on("click",this.onClickHandler),_.isEmpty(this._designPalette)&&(this._designPalette=this.LaunchDataManager.launchInfo.Course.DesignPalette),this._paletteOptions=[],"false"===this.LaunchDataManager.courseInputData.trackingConfiguration&&(this._trackingDisabledOnLaunch=!0,c.QA_TRACKING_MODE_DISABLED=!0),!0===this._enabledOnLaunch&&(this.startQAMode(),this.onTogglePanel())}startQAMode(){_.isEmpty(this.Controller)&&(this.Controller=sai.ApplicationController),_.isEmpty(this.ApplicationModel)&&(this.ApplicationModel=this.Controller.model),this.Controller.addEvent("pageUpdate",this.onPageUpdate),this.Controller.addEvent("apiEvent",this.onApiEvent),this._$rootElement.off("keyup",this.onKeyHandler),this._ticker=window.setInterval(this.tick,1e3),this._keysPressed="",this._buttonsPressed="",c.QA_MODE_ENABLED=!0,this.createPalettes(),this.createTrackingObject(),this.updateStateInformation(),this.renderStateInformation(),!0===this._trackingDisabledOnLaunch&&(c.QA_TRACKING_MODE_DISABLED=!0,this._$trackingToggle.removeClass("on").addClass("off")),this.ApplicationModel.currentPage.templateId.match(/zone/i)&&this.Controller.reloadCurrentPage()}createPalettes(){var e,t=c.QA_LAUNCH_PALETTE||this.ApplicationModel.content.attributes.palette,i=this.ApplicationModel.content.attributes.palette,a=$("link#palette").attr("href"),s=i.replace(/^([A-Z]+).*?$/i,"$1");_.isEmpty(c.QA_LAUNCH_PALETTE)&&(e=this.ApplicationModel.meta.getFirstChildOfType("CourseInfo").getFirstChildOfType("BasePalette"),c.QA_LAUNCH_PALETTE=t,c.QA_LAUNCH_BASE_PALETTE=_.isEmpty(e)?t:e.text),this._paletteOptions=[];for(let e=1;e<=16;e++){var n=e.toString().padStart(2,"0"),r="SAI"+n;this._paletteOptions.splice(e-1,0,{selector:"sai-"+n,label:r,custom:!1,default:"SAI"===s&&t.replace(/[AB]$/,"")===r,active:!("SAI"!==s||!i.match(r)),href:`css/gle_${r}.css?cb=`+Math.round(1e5*Math.random())}),this._paletteOptions.push({selector:`sai-${n}CP`,label:r=`SAI${n}CP`,custom:!1,default:"SAI"===s&&t.replace(/[AB]$/,"")===r,active:!("SAI"!==s||!i.match(r)),href:`css/gle_${r}.css?cb=`+Math.round(1e5*Math.random())})}this._paletteOptions.some(e=>!0===e.default)||this._paletteOptions.push({selector:"",label:t,custom:!0,default:!0,active:!0,href:a})}clearAssessmentInformation(){this._questionCategoryName=null,this._questionCategorySectionId=null,this._questionCategoryScore=null,this._isAssessmentScreen=!1}static applyMobileHeightCalc(){var e=$("#gle-toolbar"),t=".qa-panel-container:not(.collapsed) { height: calc(100% - "+e.outerHeight()+"px); } ";t+="@media only screen and (min-width: 48rem) { .qa-panel-container:not(.collapsed) { height: auto; max-height: calc(100% - "+e.outerHeight()+"px);} }",$("#qa-dynamic-style").text(t)}updateStateInformation(){var e,t,i,a,s,n,r,o,l=this.ApplicationModel.currentPage,h=this.ApplicationModel.currentSection;l&&(o=l.bookmark,e=l.xmlContainer.getAllDescendantsOfType("Image"),t=l.xmlContainer.getChildByAttribute("src","@MediaPlugins.AudioPlayer"),i=l.xmlContainer.getChildByAttribute("src","@MediaPlugins.FLVPlayer"),a=this.BackgroundMediaManager.currentMedia,s=$(l.xmlContainer.sourceXML).find("Data[branching='true']"),r=_.find(this.ApplicationModel.objectiveList,{id:l.parentSection.id}),n=this.LaunchDataManager.courseInputData.playerVersion,this.clearStateInformation(),this._currentPage=l,this._currentObjective=r,this._trackingEnabled=this.ApplicationModel.trackingEnabled,this._sectionId=h?h.id:null,this._pageId=l.id,this._zoneIds=_.map(l.xmlContainer.getAllDescendantsOfType("Zone"),e=>e.attributes.zoneID).join(", "),this._bookmark=o?o.code:"??",this._branch=s.length?"true":"false",this._requiredLink=c.findRequiredLinks(l),this._pageTimerValue=this.ApplicationModel.currentBookmark?this.ApplicationModel.currentBookmark.value:null,this._pageComplete=!!l.complete,this._imageSourcePath=e.length?e[0].attributes.src:null,this._audioSourcePath=t?c.getDataAttribute(t,"src"):null,this._videoSourcePath=i?c.getDataAttribute(i,"media_src"):null,this._currentBGImagePath=this.getCurrentBGSource(l),this._currentBGMediaPath=a?a.map(e=>({id:e.id,src:e.src})):null,this._interactionsEnabled=this.LaunchDataManager.LaunchInputs.useInteractions?"true":"false",this._objectivesEnabled=this.LaunchDataManager.LaunchInputs.useObjectives.toString(),this._buildVersion="trunk"===n?`DEBUG BUILD (${n})`:`RELEASE BUILD (${n})`,this._palette=_.find(this._paletteOptions,e=>e.active),this._templateId=l.templateId,this._sections=this.Controller.getSectionTemplateData(!0),this._completionBookmarkExists=this.checkForCompletionBookmark(),this._overrideVersions=this.LaunchDataManager.launchDataObj.gleServiceLayerOutputData.CourseInfo.Course.OverrideVersions,this._overrideVersionsEngine=this.LaunchDataManager.launchDataObj.gleServiceLayerOutputData.CourseInfo.Course.OverrideVersionsEngine,h=(r=this.SettingsManager.getConfigGlobalXml().find("plugin#p_assessment")).find("datum[name=preAssessPassingScore]"),o=r.find("datum[name=passingScore]"),this._preScore=h.attr("value"),this._postScore=o.attr("value"))}getCurrentBGSource(e){const t=e.xmlContainer.getFirstChildOfType("Background");return t?(e=[this.Controller.getMediaSize(),i.Platform.DEVICE_MEDIA_SIZE_ALL].map(e=>t.getChildByAttribute("breakpoint",e)).filter(e=>null!==e)[0])?e.attributes.src:"":null}renderStateInformation(){var{objectiveLabel:e,objectiveStatus:t}=this.getObjectiveStrings(),i=this._interactionData[this._currentPage.id],e={sectionId:this._sectionId,pageId:this._pageId,zoneIds:this._zoneIds,objectiveLabel:e,objectiveStatus:t,cmidata:this.generateCmiDataString(i),bookmark:this._bookmark,branch:this._branch,requiredLink:this._requiredLink?this._requiredLink.join(", "):"",pageTimerValue:this._pageTimerValue,pageComplete:this._pageComplete,imageSourcePath:this._imageSourcePath,audioSourcePath:this._audioSourcePath,videoSourcePath:this._videoSourcePath,bgImagePath:this._currentBGImagePath,bgMediaPath:this.generateBGMediaList(),trackingEnabled:this._trackingEnabled,buildVersion:this._buildVersion,objectivesEnabled:this._objectivesEnabled,interactionsEnabled:this._interactionsEnabled,palette:this._palette.label,designPalette:this._designPalette,paletteSelections:this.generatePaletteString(),templateId:this._templateId,bookmarkString:this.generateBookmarkString(this._sections),completionBookmarkExists:this._completionBookmarkExists,overrideVersions:this._overrideVersions,overrideVersionsEngine:this._overrideVersionsEngine,categoryName:this._questionCategoryName,passingScore:this._questionCategoryScore,categorySectionId:this._questionCategorySectionId||"Undefined for this category",preScore:this._preScore,postScore:this._postScore};this._$container?this.updateDOM(e):this.addQAToDOM(e),this._requiredLink?this._$requiredLink.show():this._$requiredLink.hide(),!0===this._isAssessmentScreen?this._$assessmentData.show():this._$assessmentData.hide(),this.configureCMIDetailView(),this._$container.find(".toggle-cmi-details").click(this.onToggleCMIDetails),this._$container.find(".section-bookmark").click(this.onClickBookmark),this._$container.find(".palette-btn").click(this.onSelectPalette),this._$container.find(".palette-default").off("click",this.onResetPalette).on("click",this.onResetPalette)}addQAToDOM(e){e=_.template(this.Controller.getTemplate("QAPanel").content)(e);$("#gle-toolbar").append(e),this._$container=$(".qa-panel-container"),this._$pageTimerValue=this._$container.find(".pageTimerValue > .value"),this._$pageComplete=this._$container.find(".pageComplete > .value"),this._$requiredLink=this._$container.find(".required-note"),this._$profileToggle=this._$container.find(".profile-toggle"),this._$trackingToggle=this._$container.find(".tracking-toggle"),this._$asmtToggle=this._$container.find(".asmt-toggle"),this._$bzToggle=this._$container.find(".bz-toggle"),this._$assessmentData=this._$container.find(".assessment-data"),this._$container.find(".qa-panel-toggle").click(this.onTogglePanel),this._$container.find(".qa-panel-close").click(this.onClosePanel),this._$profileToggle.on("click",this.onToggleProfile),this._$trackingToggle.on("click",this.onToggleTracking),this._$asmtToggle.on("click",this.onToggleAssessment),this._$bzToggle.on("click",this.onToggleBranchingZones),!0===c.QA_PROFILING_DISABLED&&this._$profileToggle.removeClass("off"),!0===c.QA_TRACKING_MODE_DISABLED&&this._$trackingToggle.addClass("off"),!0===c.QA_ALL_ASMT_ENABLED&&this._$asmtToggle.removeClass("off"),!0===c.QA_ALL_BRANCHING_ZONES_ENABLED&&this._$bzToggle.removeClass("off"),c.applyMobileHeightCalc()}loadPalette(e){var t=e.label.match(/SAI/)?e.label:c.QA_LAUNCH_BASE_PALETTE;this.Controller.sendEvent({type:"paletteChange",value:{paletteId:e.label,basePaletteId:t}}),this.Controller=null,this.ApplicationModel=null,this._palette.active=!1,this._palette=e,this._palette.active=!0,this.onClosePanel()}configureCMIDetailView(){this._showInteractionDetail?(this._$container.find(".cmidata button").html("Hide"),this._$container.find(".cmidata .list").removeClass("hidden")):(this._$container.find(".cmidata button").html("Show"),this._$container.find(".cmidata .list").addClass("hidden"))}updateDOM(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(e[t]?this._$container.find("."+t+" > .value").html(e[t].toString()):this._$container.find("."+t+" > .value").html(""))}clearStateInformation(){this._sectionId=null,this._pageId=null,this._zoneIds=null,this._templateId=null,this._bookmark=null,this._branch=null,this._requiredLink=null,this._pageTimerValue=null,this._pageComplete=null,this._imageSourcePath=null,this._audioSourcePath=null,this._videoSourcePath=null,this._sections=null,this._preScore=null,this._postScore=null}static findRequiredLinks(e){var i=[],a=/<((?:MagicButton)|a)[^>]+required=['"]true['"].*?>/gim,s=$(e.xmlContainer.sourceXML).text();let n=a.exec(s);for(;n;){var r=n[0],o=n[1],l=/href=['"](.*?)['"]/gim,h=/callWebAddress\(['"](.*?)['"]/gim,c=/javascript:void/,d=/title=['"](.*?)['"]/gim;let e,t;t="MagicButton"===o?(e=/id=['"](.*?)['"]/gim.exec(r))[1]+"_magicBtn":(r.match(h)?e=h.exec(r):e=(r.match(c)?d:l).exec(r))[1],i.push(t),n=a.exec(s)}return i.length?i:null}generatePaletteString(){return _.template(this.Controller.getTemplate("QAPanelPalettes").content)({paletteOptions:this._paletteOptions.filter(e=>!e.custom)})}generateBookmarkString(e){return _.template(this.Controller.getTemplate("QAPanelBookmarks").content)({sections:e})}getObjectiveStrings(){return _.isEmpty(this._currentObjective)?{objectiveLabel:"",objectiveStatus:""}:{objectiveLabel:this._currentObjective.label,objectiveStatus:"completed"===this._currentObjective.status?"completed":"incomplete"}}generateCmiDataString(e){return _.template(this.Controller.getTemplate("QAPanelCMITrackingData").content)({cmidata:e})}checkForCompletionBookmark(){var t=this.ApplicationModel.pages;for(let e=t.length-1;0<=e;e--){var i=t[e].bookmark;if(i&&"C"===i.code)return!0}return!1}createTrackingObject(){_.isEmpty(c.trackingObject)&&(c.trackingObject=new i.Tracking_SCORM(this.LaunchDataManager.launchInfo.lms,this.LaunchDataManager.launchInfo.Course.BaseCourseCode,this.TrackingManager),c.trackingObject.qaMode=!0,c.trackingObject.addEventListener("qaTrackingDataUpdate",this.handleTrackingUpdate))}static getDataAttribute(e,t){return e.getChildrenOfType("Data")[0].attributes[t]}generateBGMediaList(){let t="<ul>";return this._currentBGMediaPath.forEach(e=>{t+=`<li><b>${e.id}: </b> <span class="value">${e.src}</span></li>`}),t+="</ul>"}}c.QA_MODE_ENABLED=!1,c.QA_TRACKING_MODE_DISABLED=!1,c.QA_PROFILING_DISABLED=!1,c.QA_ALL_ASMT_ENABLED=!1,c.QA_ALL_BRANCHING_ZONES_ENABLED=!1,c.QA_LAUNCH_TOUCH_PATTERN=/12121/gim,c.QA_LAUNCH_KEY_PATTERN=/@\(\^_\^\)@/gim,c.QA_EVENT_PROFILE_CHANGE="qaProfileChange",c.QA_LAUNCH_PALETTE=null,c.QA_LAUNCH_BASE_PALETTE=null,c.QA_BLOCK_CLIENT_PALETTE_LOAD=!1,i.QAModeManager=c}(GLECore=GLECore||{}),function(t){class i{constructor(){this._enabled=!1,this.onUserActivity=()=>{clearTimeout(this._exitTimeout),clearTimeout(this._idleTimeout),this._idleTimeout=window.setTimeout(this.showIdleTimeoutModal,1e3*this._idleTimeoutDuration)},this.showIdleTimeoutModal=()=>{var e=i.IDLE_ALERT_ID,e={id:e,content:"{tk_sessionIdleMessage}",buttons:this._AlertManager.generateYesNoAlertButtons(e,this.onContinueCourse,this.onExitCourse),$launcher:$(":focus"),renderAsModalAlert:!1};this._AlertManager.showAlert(new t.AlertData(e)),this._Controller.model.addEventListener("apiEvent",this.onAlertClose),this.unwireIdleTimeout(),this.wireExitTimeout()},this.showExitTimeoutModal=()=>{var e={id:i.EXIT_ALERT_ID,content:"{tk_sessionExitMessage}",buttons:[new ModalButton("alert_ok",this._Controller.parseTokens("{tk_Exit}"),this.onExitCourse)],renderAsModalAlert:!1};this._AlertManager.showAlert(new t.AlertData(e))},this.onAlertClose=e=>{"modal_closed"===e.data.type&&e.data.modalId===i.IDLE_ALERT_ID?this.restartIdleTimeout():"modal_closed"===e.data.type&&e.data.modalId===i.EXIT_ALERT_ID&&this.onExitCourse()},this.onContinueCourse=()=>{this._AlertManager.closeAlert(i.IDLE_ALERT_ID),this.restartIdleTimeout()},this.onExitCourse=()=>{this._TrackingManager.exitCourse()}}initialize(e,t,i,a,s){this.reset(),this._Controller=e,this._SettingsManager=t,this._AlertManager=i,this._LaunchDataManager=a,this._TrackingManager=s,this._enabled="true"===this._SettingsManager.getSettingValueGeneral("SessionTimeoutEnable")&&("false"!==this._SettingsManager.getSettingValueGeneral("EnvironmentTimeoutEnable")||this._LaunchDataManager.courseInputData.packaged),this._idleTimeoutDuration=parseInt(this._SettingsManager.getSettingValueGeneral("SessionTimeoutIdleDuration"),10)||0,this._exitTimeoutDuration=parseInt(this._SettingsManager.getSettingValueGeneral("SessionTimeoutExitDuration"),10)||0,this._enabled&&this._idleTimeoutDuration&&this.wireIdleTimeout()}reset(){clearTimeout(this._idleTimeout),clearTimeout(this._exitTimeout),this._$document&&this._$document.off("click keyup",this.onUserActivity),this._Controller&&this._Controller.model.removeEventListener("apiEvent",this.onAlertClose)}wireIdleTimeout(){this._$document=$(document),this._$document.off("click keyup",this.onUserActivity).on("click keyup",this.onUserActivity),this.onUserActivity()}wireExitTimeout(){this._exitTimeout=window.setTimeout(this.showExitTimeoutModal,1e3*this._exitTimeoutDuration)}unwireIdleTimeout(){this._$document.off("click keyup",this.onUserActivity)}restartIdleTimeout(){this._Controller.model.removeEventListener("apiEvent",this.onAlertClose),this.wireIdleTimeout()}}i.IDLE_ALERT_ID="session-idle-alert",i.EXIT_ALERT_ID="session-exit-alert",t.SessionManager=i}(GLECore=GLECore||{});let SAIG_GLE_API;!function(i){class a{constructor(){this.launchDataObj=null,this.internalReset=!1,this._qaModeInitialized=!1,this.onPreviewDataReady=e=>{_.isEmpty(_.get(e,"data.courseOverride"))?i.Trace.error("InitializationManager: Preview Data is not valid."):(this._launchInputs.courseOverride=e.data.courseOverride,this._launchInputs.courseOverrideVersion=e.data.courseOverrideVersion,this._launchInputs.overrideVersionExclusions=e.data.overrideVersionExclusions,sai.LaunchDataManager.initialize(this._launchInputs,this._preDefinedLaunchData,this.onLaunchDataLoadComplete))},this.onLaunchDataLoadComplete=()=>{this.launchDataObj=sai.LaunchDataManager.launchDataObj,a.configureXML(),$.when(a.loadCSS()).done(()=>{a.loadPlayerXML(),this.initMVC(),a.initializeManagers(),this.internalReset=!1,_.isEmpty(sai.LaunchDataManager.launchInfo.preferences)&&sai.ApplicationController.initializeCoursePreferencesObject(),sai.ApplicationController.addEvent("apiEvent",this.apiEventHandler),sai.ApplicationController.addEvent("pageUpdate",this.onPageChangeHandler),this.validateCourseDate()&&(sai.ApplicationController.detectOffline()&&i.OfflineSVGLoader.buildContainer(sai.offlineSvgs.SvgList),sai.ApplicationController.sendEvent("loadComplete"))}).fail(()=>{i.Trace.error("Unable to load Engine.")})},this.apiEventHandler=e=>{var t,i,a,s;e&&e.data&&e.data.value&&(i=(t=e.data.value.lang)&&t!==this.launchDataObj.courseInputDataObj.languageCode,a="preferencesUpdate"===e.data.type,s="paletteChange"===e.data.type,a&&i?this.onLanguageChange(t):s&&this.onPaletteChange(e.data.value.paletteId,e.data.value.basePaletteId))},this.onPageChangeHandler=()=>{this._qaModeInitialized||(sai.QAModeManager.initialize(sai.ApplicationController,sai.LaunchDataManager,sai.SettingsManager,sai.BackgroundMediaManager,sai.TrackingManager),this._qaModeInitialized=!0)}}initialize(e,t){_.isUndefined(e)?i.Trace.error("InitializationManager: No Course Launch Input Data.  Cannot run course."):(this._launchInputs=e,this._preDefinedLaunchData=t,a.createManagers(),a.initLib(),"true"===this._launchInputs.previewMode?this.initPreviewMode():sai.LaunchDataManager.initialize(this._launchInputs,this._preDefinedLaunchData,this.onLaunchDataLoadComplete))}initPreviewMode(){window.addEventListener("message",this.onPreviewDataReady,!1),window.parent.postMessage("launchReady","*")}static createManagers(){sai.LaunchDataManager=new i.LaunchDataManager,sai.LanguageManager=new i.LanguageManager,sai.StyleManager=new i.StyleManager,sai.SettingsManager=new i.SettingsManager(sai.LaunchDataManager),sai.ViewingModeManager=new i.ViewingModeManager(sai.SettingsManager),sai.XMLManager=new i.XMLManager,sai.ContentManager=new i.ContentManager(sai.SettingsManager),sai.MagicButtonManager=new i.MagicButtonManager,sai.ModalManager=new i.ModalManager,sai.AlertManager=new i.AlertManager,sai.ConnectivityManager=new i.ConnectivityManager,sai.PluginManager=new i.PluginManager(sai.XMLManager),sai.TemplateManager=new i.TemplateManager(sai.PluginManager),sai.RouteManager=new i.RouteManager,sai.QAModeManager=new i.QAModeManager,sai.SessionManager=new i.SessionManager,sai.BackgroundMediaManager=new i.BackgroundMediaManager,sai.AnalyticsManager=new i.AnalyticsManager,sai.TrackingManager=new i.TrackingManager}static initLib(){_.templateSettings={evaluate:/{{(.+?)}}/g,interpolate:/{{=(.+?)}}/g,escape:/{{-(.+?)}}/g}}static loadPlayerXML(){return sai.XMLManager.loadPlayerXML()}static loadCSS(){return new i.CssLoader(sai.LaunchDataManager.launchInfo.Course,sai.SettingsManager).loadAppCss()}static configureXML(){sai.SettingsManager.initialize(sai.ViewingModeManager),sai.SettingsManager.setFinalEnvironmentXml(sai.LaunchDataManager.finalEnvironmentXml),sai.SettingsManager.setConfigGlobalXml(sai.LaunchDataManager.finalFunctionalXml)}initMVC(){var e=sai.LaunchDataManager.launchInfo.preferences;sai.ApplicationController=new i.ApplicationController,sai.ApplicationController.initialize(),sai.ApplicationModel=sai.ApplicationController.model,sai.ApplicationModel.initialize(sai.XMLManager,sai.ContentManager),_.isEmpty(e)||(sai.LaunchDataManager.launchInfo.preferences=e),sai.ApplicationView=sai.ApplicationController.view,sai.ApplicationView.initialize(),sai.ApplicationModel.internalReset=this.internalReset,SAIG_GLE_API=new i.GLE_API(sai.ApplicationController)}static initializeManagers(){sai.TemplateManager.initialize(sai.LaunchDataManager.finalTemplateLibraryXml,sai.ApplicationController),sai.PluginManager.initialize(sai.XMLManager.loadedXmlPluginManifest,sai.ApplicationController),sai.RouteManager.initialize(sai.ApplicationController,sai.TrackingManager),sai.LanguageManager.initialize(sai.XMLManager.loadedXmlLanguageDefinitions,sai.LaunchDataManager.launchInfo.Course.LanguageCode,sai.ApplicationController),sai.StyleManager.initialize(sai.XMLManager.loadedXmlStyleManifest,sai.ApplicationController),sai.ViewingModeManager.initialize(sai.LanguageManager,sai.ApplicationController,sai.LaunchDataManager.launchInfo.preferences.viewingMode),sai.ModalManager.initialize(sai.ApplicationController),sai.ContentManager.initialize(),sai.MagicButtonManager.initialize(sai.ApplicationController,sai.ModalManager,sai.ContentManager,sai.TrackingManager),sai.AlertManager.initialize(sai.ApplicationController,sai.ModalManager),sai.ConnectivityManager.initialize(sai.ApplicationController,sai.SettingsManager,sai.AlertManager,sai.TrackingManager),sai.SessionManager.initialize(sai.ApplicationController,sai.SettingsManager,sai.AlertManager,sai.LaunchDataManager,sai.TrackingManager),sai.BackgroundMediaManager.initialize(sai.ApplicationController,sai.SettingsManager,sai.LanguageManager,sai.ViewingModeManager),sai.AnalyticsManager.initialize(sai.ApplicationController,sai.SettingsManager,sai.TrackingManager),sai.TrackingManager.initialize(sai.ApplicationController,sai)}validateCourseDate(){var e;if(this._launchInputs&&this._launchInputs.timebombDate&&(new Date).getTime()>this._launchInputs.timebombDate)return e={id:"modal_expiredCourse",header:"{tk_expirationHeader}",content:"{tk_expirationMessage}",$launcher:$("body"),hasExit:!1,renderAsModalAlert:!1},sai.AlertManager.showAlert(new i.AlertData(e)),!1;return!0}onPaletteChange(e,t){sai.LaunchDataManager.launchDataObj.courseInputDataObj.courseOverride=`<overrides id="default"> <overrideSets target="content"> <Set id="content_overrides"> <Override path="." palette="${e}"></Override> <Override path="Meta.CourseInfo.BasePalette">${t}</Override> </Set> </overrideSets> </overrides>`,sai.LaunchDataManager.launchDataObj.courseInputDataObj.courseOverrideVersion="qamode",this.onInternalReset()}onLanguageChange(e){sai.LaunchDataManager.launchDataObj.courseInputDataObj.languageCode=e,this.onInternalReset()}onInternalReset(){var e=this.launchDataObj.gleServiceLayerOutputData.predefined;this.internalReset=!0,sai.ApplicationController.sendEvent({type:"internalReset"}),this._qaModeInitialized=!1,this.launchDataObj.gleServiceLayerOutputData=null,void 0!==e?this.loadNewLaunchData(sai.LaunchDataManager.launchDataObj.courseInputDataObj.languageCode):this.reinitializeLaunchData()}loadNewLaunchData(e){var t=document.getElementsByTagName("head")[0],i=document.getElementById("reference"),a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src","../../data/launch_data_"+e+".js"),void 0===this._packaged&&(this._packaged=sai.LaunchDataManager.LaunchInputs.packaged),$(a).on("load",()=>{var e;this._packaged&&(sai.launchInputs=_.extend(sai.launchInputs,null==(e=sai.mockGleServiceLayerResults)?void 0:e.CourseInfo.lms)),sai.launchInputs.resumePageId=sai.ApplicationModel.getCurrentPageId(),sai.LaunchDataManager.initialize(sai.launchInputs,sai.mockGleServiceLayerResults,this.onLaunchDataLoadComplete)}).on("error",()=>{alert("Cannot load launch data for "+e)}),t.insertBefore(a,i)}reinitializeLaunchData(){this.launchDataObj.courseInputDataObj.resumePageId=sai.ApplicationModel.getCurrentPageId(),sai.LaunchDataManager.initialize(this.launchDataObj.courseInputDataObj,null,this.onLaunchDataLoadComplete)}}i.InitializationManager=a}(GLECore=GLECore||{}),function(n){var r=GLEProfiling.ProfileQuery;class o{constructor(){this.profilingLastPages=[],this.profiling=!1,this.profilingActive=!1,this.profilingResponses={},this._reviewPageReference=null,this.reinitializingProfiling=!1,this._profileSelectionStorage={},this._filterOptional=!1,this._updatedFromStorage=!1,this.branchResponses={},this.apiEventHandler=e=>{e.data&&"profiling"===e.data.type?this.updateProfiling(e.data):e.data&&"branching"===e.data.type?this.updateBranching(e.data):e.data&&"newModelObject"===e.data.type?(this._api.model.addEventListener("xmlProcessed",this.processXML),this._api.model.addEventListener("apiEvent",this.apiEventHandler),e.data.cachedModel.removeEventListener("xmlProcessed",this.processXML),e.data.cachedModel.removeEventListener("apiEvent",this.apiEventHandler)):e.data&&"reinitialize-profiling"===e.data.type?(this.reinitializingProfiling=!0,this.processXML()):e.data&&"updateCourseFlow"===e.data.type?this.generateRoute():e.data&&"requestCourseFlowUpdate"===e.data.type?this.generateRoute(!1,e.data):e.data&&e.data.type===n.QAModeManager.QA_EVENT_PROFILE_CHANGE&&this._updatedFromStorage?(this.reinitializingProfiling=!0,this._filterOptional=!1,this.generateRoute(),this._api.reloadCurrentPage()):e.data&&e.data.type===n.QAModeManager.QA_EVENT_PROFILE_CHANGE&&(this.updateBranching(e.data),this._api.reloadCurrentPage())},this.processXML=()=>{this._filterOptional="true"===sai.SettingsManager.getSettingValueGeneral("HideOptionalContent");var e=$(this._api.model.contentXml),t=e.find("Section");this._profilingPages=e.find('Data[profiling="true"]').closest("Page"),!0!==this.reinitializingProfiling&&(this._profilingPages=$(_.filter(this._profilingPages,this.filterTestOut))),this._profilingPages.length&&(this.addAsLastProfilePage(this._profilingPages.last().attr("pageID")),this.profiling=!0,this.profilingActive=!0,this.initializeProfilingXML(t))},this.filterTestOut=e=>!(1<this._profilingPages.length&&$(e).find('Data[testout="true"]').length)}get profilingPages(){return this._profilingPages}get reviewPageReference(){return this._reviewPageReference}set reviewPageReference(e){this._reviewPageReference=e}initialize(e,t){this._api=e,this._api.model.addEventListener("xmlProcessed",this.processXML),this._api.model.addEventListener("apiEvent",this.apiEventHandler),this._TrackingManager=t,this.hideBranches(this._api.model.pages),this._api.model.calculateCourseTime()}hideBranches(e){e.forEach(e=>e.active=_.isEmpty(e.branching))}addAsLastProfilePage(e){-1===this.profilingLastPages.indexOf(e)&&this.profilingLastPages.push(e)}initializeProfilingXML(e){e.each((e,t)=>{t=$(t);const i=t.children("Meta").find("Profiling"),a=i.find("Profile, ProfileQuery");t.find("Page").each((e,t)=>{t=$(t);const s=t.find("Profiling");s.find("Profile, ProfileQuery").length?a.each((e,t)=>{var t=$(t),i=t.prop("nodeName").toLowerCase(),a=!!s.find("ProfileQuery").length;!!s.find("Profile").length||"profilequery"!==i?a||"profile"!==i||(a=t.attr("id"),s.find('Profile[id="'+a+'"]').length)||s.append(t.clone()):(i=t.attr("value"),s.find('ProfileQuery[value="'+i+'"]').length||s.append(t.clone()))}):t.find("Meta").append(i.clone())})})}updateProfilingFromStorage(e){var i=e.split("|");for(let e=0,t=i.length;e<t;e++){var a=/^(.*?):(.*?)$/gim,s=i[e],a=a.exec(s),s=a[1];this.profilingResponses[s]=a[2].split(",")}this._api.trackingData.profile=this.profilingResponses,this._updatedFromStorage=!0,_.size(this.profilingResponses)>=this._profilingPages.length&&this.generateRoute(!0)}updateProfiling(e){var i=e.responses,a=e.profileId;this.profilingResponses[a]=[];for(let e=0,t=i.length;e<t;e++){var s=i[e];this.profilingResponses[a].push(s.profileValue)}!0!==e.preventRouteGeneration&&(this._api.trackingData.profile=this.profilingResponses,this._api.TrackingManager.saveProfile()),!0!==e.preventRouteGeneration&&-1!==this.profilingLastPages.indexOf(e.pageID)&&this.generateRoute()}updateBranching(e){var i=e.responses,a=e.branchId;if(this.branchResponses[a]=[],_.isEmpty(i))this.generateRoute(!1,{rebuildTrackingAfterRoute:!0});else{for(let e=0,t=i.length;e<t;e++){var s=i[e];this.branchResponses[a].push(s.branchingValue)}this.generateRoute(!1,e)}}generateRoute(e,t){var i=this._api.model.sectionSource,t=this.shouldRebuildTracking(t);for(let e=0,t=i.length;e<t;e++){var a=i[e];!this.evaluateProfiles(a.xml)||this._filterOptional&&a.optional?(a.active=!1,a.pages.forEach(e=>e.active=!1)):(a.active=!0,a.getAllPages().forEach(e=>{var t=e.xmlContainer;e.active=this.evaluateProfiles(t)&&this.evaluateBranches(t)}))}this._api.model.calculateCourseTime(),!1!==o.routeContainsTestOut(this._api.model.pages)&&!e||(this.profilingActive=!1),this._api.model.dispatchEvent(new n.ApplicationEvent("apiEvent",{destination:e?"all":"plugins",type:"routeUpdate",sections:this._api.model.sections,pages:this._api.model.pages,rebuildTracking:t})),e||this._TrackingManager.onRouteUpdate(t)}isPageProfilingQuestion(e){return-1!==e.xmlContainer.getAllDescendantsOfType("Data").findIndex(e=>"true"===e.attributes.profiling)}shouldRebuildTracking(e){let t=!0;return void 0!==e?t=e.rebuildTrackingAfterRoute:this._filterOptional||this.profilingActive||(t=!1),t}static routeContainsTestOut(e){for(const t of e)if(o.pageIsTestOut(t.xmlContainer)&&!0!==t.complete)return!0;return!1}static pageIsTestOut(e){return 0<$(e.sourceXML).find('Data[testout="true"]').length}evaluateProfiles(e){var t=$(e.sourceXML).children("Meta").find("Profile"),i=$(e.sourceXML).children("Meta").find("ProfileQuery"),e=o.pageIsTestOut(e);let a=!0,s;return i.length?(s=new r(i.attr("value")),a=s.evaluate(this.profilingResponses)):t.length&&(s=r.convertJQueryProfiles(t),a=s.evaluate(this.profilingResponses)),!0===n.QAModeManager.QA_PROFILING_DISABLED&&(a=!0),e&&!a&&(this.profilingResponses[o.TESTOUT_PROFILE_ID]=[o.TESTOUT_SKIPPED]),a}evaluateBranches(e){var t,e=$(e.sourceXML).children("Meta").find("Branch");return!(!_.isEmpty(e)&&!0!==n.QAModeManager.QA_PROFILING_DISABLED&&(t=e.attr("id"),e=e.attr("value"),t=this.branchResponses[t],_.isEmpty(t)||-1===t.indexOf(e)))}sectionExistsInRoute(e){var i=this._api.model.sections,a=e?e.attributes.id:null;for(let e=0,t=i.length;e<t;e++){var s=i[e];if(s.id===a&&this._filterOptional&&s.optional)return!1;if(s.id===a)return!0}return!1}pageExistsInRoute(i){var a=this._api.model.pages;for(let e=0,t=a.length;e<t;e++)if(a[e].id===i)return!0;return!1}areOnLastProfilePage(){return-1!==this.profilingLastPages.indexOf(this._api.model.getCurrentPageId())}addToStorage(e,t){this._profileSelectionStorage[e]=t}getFromStorage(e){return _.isEmpty(this._profileSelectionStorage[e])?[]:this._profileSelectionStorage[e]}}o.TESTOUT_PROFILE_ID="testOut",o.TESTOUT_PASSED="passed",o.TESTOUT_FAILED="failed",o.TESTOUT_SKIPPED="skipped",n.RouteManager=o}(GLECore=GLECore||{}),function(a){class s{get selectorMap(){return this._selectorMap}initialize(e,t){this._$styleManifestXML=$(e),this._api=t,this._templateManifest={},this._courseStyles={},this._globalSelectors={},this._selectorMap={},this.processStyleManifestXML(),this.processCourseStyles()}processStyleManifestXML(){_.isEmpty(this._$styleManifestXML)?a.Trace.error("StyleManager (processStyleManifestXML): Invalid style XML."):(this.defineGlobalSelectors(this._$styleManifestXML.find("global_selectors").first()),this.defineSelectorMap(this._$styleManifestXML.find("pss_maps").first()),this.processTemplates())}defineGlobalSelectors(e){_.isEmpty(e)?a.Trace.error("StyleManager (defineGlobalSelectors): Missing global selector XML."):_.each(e.find("selector"),e=>{var e=$(e),t=e.attr("id");_.isEmpty(t)||(e=e.attr("value"),_.isEmpty(e))||(this._globalSelectors[t]=e)})}defineSelectorMap(e){e.find("map").each((e,t)=>{const i=$(t).attr("classes").split(",");_.each(i,e=>this._selectorMap[e]=i)})}processTemplates(){var t=this._$styleManifestXML.find("template");for(let e=0;e<t.length;e++){var i=$(t[e]),a=i.attr("id");this._templateManifest[a]=this.getTemplateData(i)}}getTemplateData(e){if(_.isEmpty(e))return[];var t=e.find("item"),i=[];for(let e=0;e<t.length;e++){var a=$(t[e]);i.push({id:a.attr("id"),selector:this.processSelector(a.attr("selector"))})}return i}processSelector(e){var t=e.match(/{([a-z-]+)}/);return _.isEmpty(t)?e:(t=this._globalSelectors[t[1]],_.isEmpty(t)&&a.Trace.error("StyleManager (processSelector): Global selector for "+e+" not found."),t)}processCourseStyles(){var e=this._api.model.meta.getChildrenOfType("Styles");if(!_.isEmpty(e)){var t=e[0].getChildrenOfType("st");if(!_.isEmpty(t))for(let e=0;e<t.length;e++){var i=t[e];this.addToCourseStyles(s.createStyleData(i.attributes))}}}addToCourseStyles(e){if(!s.hasValidStyle(e))return!1;_.isUndefined(this._courseStyles[e.pageID])&&(this._courseStyles[e.pageID]=[]);var t=new a.CourseStyle(e);return _.find(this._courseStyles[e.pageID],t)||this._courseStyles[e.pageID].push(t),!0}static hasValidStyle(e){return _.isEmpty(e)?(a.Trace.error("StyleManager (validateCourseStyle): There is a 'st' tag with no attributes."),!1):_.isEmpty(e.pageID)?(a.Trace.error("StyleManager (validateCourseStyle): There is a 'st' tag with no pageID.  It is required."),!1):!_.isEmpty(e.item)||(a.Trace.error("StyleManager (validateCourseStyle): There is a 'st' tag for page "+e.pageID+" with no item.  It is required."),!1)}getTemplateStyle(e){return _.isEmpty(e)||(e=this._templateManifest[e],_.isEmpty(e))?[]:e}getStyleForPage(e){return _.isEmpty(e)||(e=this._courseStyles[e],_.isEmpty(e))?[]:this.buildStylePackage(e)}buildStylePackage(e){e=_.groupBy(e,e=>e.zoneID?e.item+"-"+e.zoneID:e.item);const t=[];return _.each(e,e=>{t.push(new a.StyleData(e))}),t}addCourseStyle(e){this.addToCourseStyles(e)}getTemplateStyleByItem(e,t){var i=this.handleContentIdSelector(t);if(!_.isEmpty(i))return i;let a=t;a.match(/\$+\d{1,2}/)&&(a=a.replace(/\$+\d{1,2}/,"$n"));i=_.find(e,{id:a});return _.isEmpty(i)?{}:a!==t?s.handleNthItems(i,t):i}handleContentIdSelector(e){return 0===e.indexOf("#")?(e=e.replace(/^#\S*/,"$&"+s.TARGETABLE),{id:"contentSelector",selector:this._globalSelectors["page-body"]+" "+e}):{}}static handleNthItems(e,t){t=t.match(/\$+(\d{1,2})/);return t?e.selector.match(/\$n/)?{id:e.id,selector:e.selector.replace("$n",t[1])}:(a.Trace.warn("handleNthItems: selector is not set up as an nth item selector."),e):e}static writeStrictMediaQuery(e,t,i){return _.isEmpty(e)?"":t===a.Platform.DEVICE_MEDIA_SIZE_ALL?s.writeStyle(i,e.join("")):s._selectors[t.toUpperCase()]+"{"+s.writeStyle(i,e.join(""))+"}"}static writeStyle(e,t){return e+"{"+t+"}"}static createStyleData(e){return{pageID:e.pageID||"",zoneID:e.zoneID||"",item:e.item||"",bp:e.bp||"",classes:e.classes||"",styles:e.styles||"",altText:e.altText||""}}}s.SUPPORTED_SIZES=[a.Platform.DEVICE_MEDIA_SIZE_XS,a.Platform.DEVICE_MEDIA_SIZE_SM,a.Platform.DEVICE_MEDIA_SIZE_MD,a.Platform.DEVICE_MEDIA_SIZE_LG,a.Platform.DEVICE_MEDIA_SIZE_XL],s.TARGETABLE=".p-style-target",s._selectors={XS:"@media only screen and (min-width: "+a.Platform.DEVICE_MEDIA_SIZE_XS_REM+"rem) and (max-width: "+a.Platform.DEVICE_MEDIA_SIZE_SM_REM_MAX+"rem)",SM:"@media only screen and (min-width: "+a.Platform.DEVICE_MEDIA_SIZE_SM_REM+"rem) and (max-width: "+a.Platform.DEVICE_MEDIA_SIZE_MD_REM_MAX+"rem),only screen and (max-width: "+(a.Platform.DEVICE_MEDIA_SIZE_LG_REM-.01)+"rem) and (orientation : landscape)",MD:"@media only screen and (min-width: "+a.Platform.DEVICE_MEDIA_SIZE_MD_REM+"rem) and (max-width: "+a.Platform.DEVICE_MEDIA_SIZE_LG_REM_MAX+"rem) and (orientation : portrait),only screen and (min-width: "+a.Platform.DEVICE_MEDIA_SIZE_LG_REM+"rem) and (max-width: "+(a.Platform.DEVICE_MEDIA_SIZE_XL_REM-.01)+"rem) and (orientation : portrait)",LG:"@media only screen and (min-width: "+a.Platform.DEVICE_MEDIA_SIZE_LG_REM+"rem) and (max-width: "+a.Platform.DEVICE_MEDIA_SIZE_XL_REM_MAX+"rem) and (orientation : landscape)",XL:"@media only screen and (min-width: "+a.Platform.DEVICE_MEDIA_SIZE_XL_REM+"rem)"},a.StyleManager=s}(GLECore=GLECore||{}),function(t){class s{constructor(){this._enabled=!1,this.onPageChange=()=>{window.navigator.onLine||this.showConnectivityModal()},this.showConnectivityModal=()=>{var e={id:s.MODAL_ID,content:_.template(this._Controller.getTemplate("p_connectivity").content)({content:this._Controller.parseTokens("{tk_connectivityMessage}")}),buttons:[new ModalButton("alert_exit",this._Controller.parseTokens("{tk_Exit}"),this.onExitCourse),new ModalButton("alert_retry",this._Controller.parseTokens("{tk_connectivityRetry}"),this.onRetry)],$launcher:$(":focus"),renderAsModalAlert:!1,hasExit:!1,preventClickOutsideDismiss:!0};this._$alert=this._AlertManager.showAlert(new t.AlertData(e))},this.onRetry=()=>{this._$alert.addClass("checking"),this._checkTimeout=window.setTimeout(()=>{window.navigator.onLine?this._AlertManager.closeAlert(s.MODAL_ID):this._$alert.removeClass("checking")},1e3*this._checkTimeoutDuration)},this.onExitCourse=()=>{this._TrackingManager.exitCourse()}}initialize(e,t,i,a){this.reset(),this._Controller=e,this._SettingsManager=t,this._AlertManager=i,this._TrackingManager=a,this._enabled="true"===this._SettingsManager.getSettingValueGeneral("ConnectivityCheckEnable")&&!this._Controller.detectOffline(),this._checkTimeoutDuration=parseInt(this._SettingsManager.getSettingValueGeneral("ConnectivityCheckDuration"),10)||0,this._enabled&&(s.enabled=!0,this.wireConnectivityCheck())}reset(){this._Controller&&this._Controller.removeEvent("pageUpdate",this.onPageChange)}wireConnectivityCheck(){this._Controller.addEvent("pageUpdate",this.onPageChange)}}s.enabled=!1,s.MODAL_ID="connectivity-check",t.ConnectivityManager=s}(GLECore=GLECore||{}),function(l){class s{constructor(){this._MediaUtil=window.GLEPlugins.MediaUtil,this._initialized=!1,this._audioEnabled=!0,this._audioLoop=!0,this._videoEnabled=!0,this._videoLoop=!0,this._videoHiSuffix=null,this._videoLoSuffix=null,this._videoFallbackSuffix=null,this._volume=l.BackgroundMediaVolume.Unmuted,this._autoplay=!0,this._fallbackPath=null,this._forcedLanguage=null,this._lastState=null,this._$button=null,this._hadFallback=!1,this.apiEventHandler=e=>{var t;if(!_.isUndefined(_.get(e,"data.type")))if(this._initialized||"langReady"!==e.data.type){var i=this.preferences()["audioOff"],a=(null==(t=this._lastState)?void 0:t.audioOff)&&!i;switch(e.data.type){case"NewZonesRendered":_.isEmpty(this._$button)||this.disableToolbarButton(),this.destroyZoneMedia(),this.wireBackgroundMedia();break;case"ZoneFadedDown":_.isEmpty(this._currentMedia)||this.pauseMediaForZone(e.data.id);break;case l.ModalManager.MODAL_OPENED:return void this.modalOpenedHandler();case l.ModalManager.MODAL_CLOSED:_.isEmpty(this._currentMedia)&&a?this.setCurrentVolume(l.BackgroundMediaVolume.Unmuted):this.modalClosedHandler();break;case"viewingModeChange":_.isEmpty(this._currentMedia)&&this.updateMediaPaths();break;case"paletteChange":_.isEmpty(this._currentMedia)||this.pauseMedia()}}else this._initialized=!0,this.storeBackgroundMedia()},this.onPageChange=()=>{_.isEmpty(this._$button)||this.disableToolbarButton(),this.stopMediaPlayback(),this.wireBackgroundMedia()},this.onVideoFallback=()=>{this._hadFallback=!0;var e=this.preferences()["tg"];e?(this.muteMedia(),this.hideMedia()):this._volume===l.BackgroundMediaVolume.Muted?this.playMediaQuietly():this.playMedia()},this.onMediaLoaded=()=>{this.toggleMediaVisibility(),this.setMediaEndEvent()},this.onToggleMediaState=()=>{switch(this._currentState){case"playing":this._autoplay=!1,this.setCurrentVolume(l.BackgroundMediaVolume.Muted),this.muteMedia(),this.setCurrentState(l.BackgroundMediaState.Paused);break;case"play":case"paused":this.setCurrentVolume(l.BackgroundMediaVolume.Unmuted),this.resumeMedia(),this.setCurrentState(l.BackgroundMediaState.Playing),this._autoplay=!0}},this.onMediaComplete=()=>{this.setCurrentState(l.BackgroundMediaState.Play)}}get currentMedia(){return this._currentMedia}initialize(e,t,i,a){!0===this._initialized&&this.reset(),this._Controller=e,this._SettingsManager=t,this._LanguageManager=i,this._ViewingModeManager=a,this._manifest={},this._autoplay="true"===this._SettingsManager.getSettingValueGeneral("BackgroundMediaAutoplay"),this._audioEnabled="true"===this._SettingsManager.getSettingValueGeneral("BackgroundAudioEnabled"),this._audioLoop="true"===this._SettingsManager.getSettingValueGeneral("BackgroundAudioLoop"),this._videoEnabled="true"===this._SettingsManager.getSettingValueGeneral("BackgroundVideoEnabled"),this._videoLoop="true"===this._SettingsManager.getSettingValueGeneral("BackgroundVideoLoop"),this._videoFallbackSuffix=this._SettingsManager.getSettingValueGeneral("BackgroundVideoFallbackSuffix"),this._videoHiSuffix=this._SettingsManager.getSettingValueGeneral("BackgroundVideoHiSuffix"),this._videoLoSuffix=this._SettingsManager.getSettingValueGeneral("BackgroundVideoLoSuffix"),this._fallbackPath=this._SettingsManager.getSettingValueGeneral("BackgroundMediaFallbackPath"),this._forcedLanguage=this._SettingsManager.getSettingValueGeneral("BackgroundMediaForcedLanguage"),s.ENABLED=this._audioEnabled||this._videoEnabled,!0===this._initialized&&this.storeBackgroundMedia(),this._Controller.addEvent("pageUpdate",this.onPageChange),this._Controller.addEvent("apiEvent",this.apiEventHandler)}reset(){this._volume=l.BackgroundMediaVolume.Unmuted,this._Controller&&(this._Controller.removeEvent("pageUpdate",this.onPageChange),this._Controller.removeEvent("apiEvent",this.apiEventHandler)),this._$button&&this._$button.off("click",this.onToggleMediaState),this._$button=null}storeBackgroundMedia(){!0===this._audioEnabled&&this.storeBackgroundAudio(),!0===this._videoEnabled&&this.storeBackgroundVideo(),s.BGMEDIA_EXISTS=!_.isEmpty(this._manifest)}storeBackgroundAudio(){this._Controller.model.pages.forEach(t=>{this.buildAudioObject(t.id,t.xmlContainer),t.xmlContainer.getAllDescendantsOfType("Zone").forEach(e=>{this.buildAudioObject(`bgm${t.id}_`+e.attributes.zoneID,e)})})}storeBackgroundVideo(){this._Controller.model.pages.forEach(t=>{this.buildVideoObject(t.id,t.xmlContainer),t.xmlContainer.getAllDescendantsOfType("Zone").forEach(e=>{this.buildVideoObject(`bgm${t.id}_`+e.attributes.zoneID,e)})})}buildAudioObject(e,t){var i,a,s,t=t.getFirstChildOfType("BackgroundAudio");_.isEmpty(t)||(i=this._MediaUtil.getAudioPath(t.attributes.src,this._fallbackPath,this._LanguageManager,this._forcedLanguage),a="true"===t.attributes.hideButton,s=t.attributes.BackgroundAudioLoop?l.DataUtil.convertStringToBool(t.attributes.BackgroundAudioLoop):this._audioLoop,t=t.attributes.BackgroundMediaAutoplay?l.DataUtil.convertStringToBool(t.attributes.BackgroundMediaAutoplay):this._autoplay,this._manifest[e]=new l.BackgroundMediaInstance(e,l.BackgroundMediaType.Audio,i,a,t,s,"body"))}buildVideoObject(e,t){var i,a,s,n,r={hi:this._videoHiSuffix,lo:this._videoLoSuffix,fallback:this._videoFallbackSuffix},o=t.getFirstChildOfType("BackgroundVideo");_.isEmpty(o)||(n=this._MediaUtil.getVideoPath(o.attributes.src,this._fallbackPath,this._LanguageManager,this._forcedLanguage,this._ViewingModeManager.currentViewingMode,r),i="true"===o.attributes.hideButton,r=this._MediaUtil.getVideoPath(o.attributes.src,this._fallbackPath,this._LanguageManager,this._forcedLanguage,this._ViewingModeManager.currentViewingMode,r,!0),a=o.attributes.BackgroundVideoLoop?l.DataUtil.convertStringToBool(o.attributes.BackgroundVideoLoop):this._videoLoop,s=o.attributes.BackgroundMediaAutoplay?l.DataUtil.convertStringToBool(o.attributes.BackgroundMediaAutoplay):this._autoplay,t=t.attributes.zoneID?"#z"+t.attributes.zoneID:"#page-container > .page-body",t=_.isEmpty(o.attributes.target)?t:o.attributes.target,(n=new l.BackgroundMediaInstance(e,l.BackgroundMediaType.Video,n,i,s,a,t)).xmlContainer=o,n.fallback=r,n.onFallback=this.onVideoFallback,this._manifest[e]=n)}updateMediaPaths(){var e={hi:this._videoHiSuffix,lo:this._videoLoSuffix,fallback:this._videoFallbackSuffix};for(const i in this._manifest){var t=this._manifest[i];t.type!==l.BackgroundMediaType.Audio&&(t.src=this._MediaUtil.getVideoPath(t.xmlContainer.attributes.src,this._fallbackPath,this._LanguageManager,this._forcedLanguage,this._ViewingModeManager.currentViewingMode,e))}}modalOpenedHandler(){var{preferences:e,audioOff:t,tg:i}=this.preferences();this._lastState={media:this._currentState,audioOff:t,lang:e.lang,tg:i,viewingMode:this._ViewingModeManager.currentViewingMode},!0===i&&(this._lastState.media=l.BackgroundMediaState.Play)}modalClosedHandler(){var e,t,i,a,s,n;_.isEmpty(this._currentMedia)||({audioOff:e,langChange:t,tg:n}=this.preferences(),i=this._lastState.audioOff&&!e,a=this._lastState.tg&&!n,s=this._lastState.viewingMode!==this._ViewingModeManager.currentViewingMode,!0===n||t?(this.pauseMedia(),this.disableToolbarButton(),this.hideMedia()):(this.enableToolbarButton(),s&&this.updateMediaPaths(),this.handlePlayPauseOnResume(),this.playMedia(),n=this._lastState.media&&this._lastState.media!==l.BackgroundMediaState.Playing,a||i||!e&&!n?this.playMedia():this.playMediaQuietly()))}playMedia(){this.setCurrentState(l.BackgroundMediaState.Playing),this.resumeMedia(),this.setCurrentVolume(l.BackgroundMediaVolume.Unmuted)}playMediaQuietly(){this.setCurrentState(l.BackgroundMediaState.Paused),this.resumeMedia(),this.setCurrentVolume(l.BackgroundMediaVolume.Muted),this.muteMedia()}pauseMedia(){this.setCurrentState(l.BackgroundMediaState.Paused),this.muteMedia(),this.setCurrentVolume(l.BackgroundMediaVolume.Muted)}stopMediaPlayback(){_.isEmpty(this._currentMedia)||this.destroyAllMedia()}wireBackgroundMedia(){return __awaiter(this,void 0,void 0,function*(){var e,t;this._hadFallback=!1,this._currentMedia=this.getCurrentMedia(),_.isEmpty(this._currentMedia)?($("#page-container").attr("data-bgm","false"),$("#gle-toolbar").attr("data-bgm","false")):($("#page-container").attr("data-bgm","true"),$("#gle-toolbar").attr("data-bgm","true"),this.enableToolbarButton(),this.isMediaDisabled()||(e=this.determineInitialMediaState(),t=this.loadMedia(),this.setCurrentState(e),yield Promise.all(t).catch(e=>{this._hadFallback||(l.Trace.error(e),this.setCurrentState(l.BackgroundMediaState.Play))}),this.onMediaLoaded()))})}getCurrentMedia(){const t=this._Controller.model.currentPage;return[t.id,...t.xmlContainer.getAllDescendantsOfType("Zone").map(e=>`bgm${t.id}_`+e.attributes.zoneID)].map(e=>this._manifest[e]).filter(e=>!_.isEmpty(e)&&e.isInRenderedContainer())}setCurrentState(e){this._currentState=e,this._$button.attr("data-state",e),this.setButtonTooltip(e)}enableToolbarButton(){var e;if(!_.isEmpty(this._currentMedia))return e=this.preferences()["tg"],_.isEmpty(this._$button)&&(this._$button=$("#gle-toolbar .bgm-button"),this._$button.click(this.onToggleMediaState)),!0===e?this.disableToolbarButton():($("#page-container").attr("data-bgm","true"),$("#gle-toolbar").attr("data-bgm","true"),this._currentMedia.some(e=>e.hideButton)?this.hideToolbarButton():(this.setButtonTooltip(this._currentState),void this._$button.addClass("render")))}setButtonTooltip(e){e=e===l.BackgroundMediaState.Playing?"{tk_BgmMuteLabel}":"{tk_BgmUnmuteLabel}";this._$button.attr("aria-label",this._Controller.parseTokens(e))}disableToolbarButton(){$("#page-container").attr("data-bgm","false"),$("#gle-toolbar").attr("data-bgm","false"),this.setCurrentState(l.BackgroundMediaState.Hidden),this.hideToolbarButton()}hideToolbarButton(){this._$button.removeClass("render")}determineInitialMediaState(){return this.getCurrentVolume()===l.BackgroundMediaVolume.Muted?l.BackgroundMediaState.Paused:l.BackgroundMediaState.Playing}setCurrentVolume(e){this._volume=e}getCurrentVolume(){return this._volume}handlePlayPauseOnResume(){const t=this.preferences()["audioOff"],i=this._lastState.audioOff&&!t;this._currentMedia.forEach(e=>{e.type===l.BackgroundMediaType.Audio&&(t||this._lastState.media!==l.BackgroundMediaState.Playing?e.type===l.BackgroundMediaType.Audio&&(i&&this.playMedia(),t)&&this.pauseMedia():this.playMedia())})}preferences(){var e=sai.LaunchDataManager.launchInfo.preferences;return{preferences:e,audioOff:e.audio===l.SettingsManager.SETTING_VAL_OFF,langChange:!!this._lastState&&e.lang!==this._lastState.lang,tg:e.viewingMode===l.ViewingModeManager.VIEWING_MODE_TG}}loadMedia(){const t=[];return this._currentMedia.forEach(e=>t.push(e.load())),t}hideMedia(){this._currentMedia.forEach(e=>e.hide())}muteMedia(){this._currentMedia.forEach(e=>e.mute())}resumeMedia(){this._currentMedia.forEach(e=>e.resume())}destroyZoneMedia(){this._currentMedia.filter(e=>!_.isEmpty(e)&&!e.isInRenderedContainer()).forEach(e=>e.destroy())}destroyAllMedia(){this._currentMedia.forEach(e=>e.destroy())}toggleMediaVisibility(){const t=this.preferences()["tg"];this._currentMedia.forEach(e=>{!0===t&&e.type===l.BackgroundMediaType.Video?e.hide():e.show()})}isMediaDisabled(){return this._currentMedia.some(e=>e.type===l.BackgroundMediaType.Audio&&!1===this._audioEnabled||e.type===l.BackgroundMediaType.Video&&!1===this._videoEnabled)}setMediaEndEvent(){this._currentMedia.forEach(e=>e.element.onended=this.onMediaComplete)}pauseMediaForZone(t){var e=this._currentMedia.find(e=>e.selector==="#"+t);e&&e.hide()}}s.ENABLED=!1,s.BGMEDIA_EXISTS=!1,s.DEFAULT_SELECTOR_PAGE="#page-container > .page-body",l.BackgroundMediaManager=s}(GLECore=GLECore||{}),function(a){class r{constructor(){this._enabled=!1}static getInteractionInfo(e,t){var i=r._instance.getAnalyticsInfo(e,t)["phase"];return _.isEmpty(i)?[null,null]:[r._instance.getInteractionId(e,t),r.getResponses(e,t)]}getInteractionId(e,t){return this.getStorageId(e,t)+r.getInteractionSuffix(e,t)}static getInteractionSuffix(e,t){var{phase:e,outcome:t}=r._instance.getAnalyticsInfo(e,t),t=r.terminalOutcomeId===t?":TERM_OUTCOME":"";return":"+e.toUpperCase()+t}static getResponses(e,t){let i=e.getChildrenOfType(t?"Response":"Choice");t=e.getAllDescendantsOfType("ConfidenceChoice");return(i=_.isEmpty(t)?i:t).map(e=>"confidence"+e.attributes.confidence)}replaceConfidenceToken(e,t){return e.replace("<confidence>","confidence"+t)}fetchAnalyticsObjectives(){return r.enabled?[this._terminalOutcome,...this._objectives].map((e,t)=>{return{id:e.attributes.id,section:null,pages:null,complete:!1,time:0,index:t,label:e.text}}):[]}initialize(e,t,i){this.reset(),this._Controller=e,this._SettingsManager=t,this._TrackingManager=i,this._terminalOutcome=this._Controller.model.meta.getAllDescendantsOfType("TerminalOutcome")[0],this._objectives=this._Controller.model.meta.getAllDescendantsOfType("LearningObjective"),r.enabled=this._enabled=this.isAnalyticsEnabled(),r.terminalOutcomeId=null==(e=this._terminalOutcome)?void 0:e.attributes.id}isAnalyticsEnabled(){return"true"===this._SettingsManager.getSettingValueGeneral("AnalyticsEnabled")&&!_.isEmpty(this._terminalOutcome)&&!_.isEmpty(this._objectives)}restoreDataFromStorage(e){_.isEmpty(e)||(this._Controller.trackingData.analytics={},e=e.split("|"),_.each(e,e=>{var e=/^(.*?):(.*?)$/.exec(e),t=e[1];this._Controller.trackingData.analytics[t]=e[2].split(",")}))}fetchQuestionResponse(e){return this.getAnalyticsInfo(e).response}fetchQuestionResponseById(e){return store[e]}submitQuestionResponse(e,t){var{outcome:e,storageId:i}=this.getAnalyticsInfo(e),a=null!=(a=this._Controller.trackingData.analytics)?a:{};return!_.isEmpty(e)&&(a[i]=t,this._Controller.trackingData.analytics=a,this._TrackingManager.saveAnalytics(),!0)}getAnalyticsInfo(e,t=!1){var i=!_.isEmpty(e.parent),a=e.getFirstChildOfType("Data"),s=null!=(s=this._Controller.trackingData.analytics)?s:{},n=a?a.attributes.outcome:e.attributes.objectiveID;return _.isEmpty(n)||!r.enabled?{outcome:null,phase:null,storageId:null,response:null,isAssessment:null}:{outcome:n,phase:(t&&i?e.getSiblingsByName("Data")[0]:a).attributes.phase,storageId:n=this.getStorageId(e,t),response:s[n],isAssessment:t}}getStorageId(e,t){var i=e.getFirstChildOfType("Data");return null!=i&&i.attributes.storageId?i.attributes.storageId:(i=e.closest("Page").attributes.pageID,t?a.DataUtil.standardizeId(i+"_"+e.attributes.id):i)}clearStorageOfType(t){var e;const i=null!=(e=this._Controller.trackingData.analytics)?e:{},a={};Object.keys(i).filter(e=>-1===e.indexOf(t)).forEach(e=>{a[e]=i[e]}),this._Controller.trackingData.analytics=a,this._TrackingManager.saveAnalytics()}reset(){r._instance=this}}r.enabled=!1,a.AnalyticsManager=r}(GLECore=GLECore||{}),function(e){class s{static getDate(e){var e=e||new Date,t=sai.LanguageManager.currentLangId,i=$(sai.ApplicationModel.global.sourceXML).find('lang[codes*="'+t+'"]');return s.writeDateFormat(i,e,t)}static writeDateFormat(e,t,i){let a=e.find("date_format_template").text();return!0==!_.isEmpty(a.match(/<LocaleDate\/?>/gim))?(i=s.writeLocaleDateFormat(t,i),a.replace(/<LocaleDate\/?>/i,i)):a=(a=(a=a.replace(/\[(do_)?d*]/gi,s.getDayFormat(e.find("day_setup"),t.getDate().toString(),"yes"===e.find("day_setup").attr("show_zero")))).replace(/\[(do_)?m*]/gi,s.getMonthFormat(e.find("month_setup"),String(t.getMonth()+1),"yes"===e.find("month_setup").attr("show_zero")))).replace(/\[(do_)?y*]/gi,s.getYearFormat(e.find("year_setup"),t.getFullYear().toString()))}static writeLocaleDateFormat(e,t){t=sai.LanguageManager.langDefinitionsData[t].bcp47;return e.toLocaleDateString(t)}static getYearFormat(e,t){return 0<e.find('year[num="'+t+'"]').length?e.find('year[num="'+t+'"]').text():t}static getMonthFormat(e,t,i){return 0<e.find('month[num="'+t+'"]').length?e.find('month[num="'+t+'"]').text():i&&1===t.length?"0"+t:t}static getDayFormat(e,t,i){return 0<e.find('day[num="'+t+'"]').length?e.find('day[num="'+t+'"]').text():i&&1===t.length?"0"+t:t}}e.DateUtil=s}(GLECore=GLECore||{}),function(e){class s{static formatLatencyTime(e,t=!1,i=!1){let a=Math.floor(e/60).toString();e=(e%60).toString().padStart(2,"0");return 1!==a.length||i||(a=a.padStart(2,"0")),!0===t?a+":"+e:"00:"+a+":"+e}static getContentTime(e){var t;return _.isUndefined(e)?"":(t=$(e).find("Time"),_.isEmpty(t.attr("average"))?(t.length?t:$(e).find("Text#time")).text():t.attr("average"))}static getContentTimeAsInt(e){let t=0;e=s.getContentTime(e);return t=""===e||isNaN(parseInt(e,10))?t:parseInt(e.match(/\d+/)[0],10)}static replaceTotalCourseTime(e,t){let i;var a=e.match(/\d+/);return i=null!==a?e.replace(a[0],t.toString()):(e=t+" {tk_TimerMinutesUnitAbbrev}",sai.ApplicationController.parseTokens(e))}static calculateStaticPageTime(t){var i;let a=0;for(let e=0;e<t.length;e++)t[e].description&&(i=s.getContentTimeAsInt(t[e].description.sourceXML),a+=i);return a}static calculateDynamicCourseTime(i,a){let s=0;for(let e=0,t=i.length;e<t;e++){var n=i[e],r=n.pages.filter(e=>-1!==a.indexOf(e.id)),r=this.calculateDynamicSectionTime(r);s+=r,n.updateTime(r)}return s}static calculateDynamicSectionTime(i){let a=0;for(let e=0,t=i.length;e<t;e++){var s=i[e],n=$(s.xmlContainer.sourceXML).find("Time"),n=_.isEmpty(n.attr("average"))?0:parseInt(n.attr("average"),10);s.xmlContainer.attributes.averageTime=n.toString(),a+=n}let e=Math.round(a/60);return e=0<a&&0===e?1:e}static secondsToCMITimespan(e){let t,i;var a=e%60,s=(e-=a)%3600;e-=s,a=Math.round(100*a)/100;let n=String(a),r=n,o="";return-1!==n.indexOf(".")&&(r=n.substring(0,n.indexOf(".")),o=n.substring(n.indexOf(".")+1,n.length)),r.length<2&&(r="0"+r),n=r,o.length&&(n=n+"."+o),t=e%3600!=0?"0":(e/3600).toString(),i=s%60!=0?"0":(s/60).toString(),String(t).length<2&&(t="0"+t),String(i).length<2&&(i="0"+i),t+":"+i+":"+n}static centisecsToISODuration(e,t=!1){let i="P",a=0,s=0,n,r=e=Math.max(e,0);r=Math.round(r),n=(!0===t||(a=Math.floor(r/315576e4),r-=315576e4*a,s=Math.floor(r/26298e4),r-=26298e4*s),Math.floor(r/864e4)),r-=864e4*n;e=Math.floor(r/36e4),r-=36e4*e,t=Math.floor(r/6e3);return r-=6e3*t,0<a&&(i+=a+"Y"),0<s&&(i+=s+"M"),0<n&&(i+=n+"D"),(0<e||0<t||0<r)&&(i+="T",0<e&&(i+=e+"H"),0<t&&(i+=t+"M"),0<r)&&(i+=r/100+"S"),i="P"===i?"PT0H0M0S":i}static HHSSMMToSecond_10_0(e){var t=new Date,i=t.getFullYear(),a=t.getMonth()+1,t=t.getDate();let s,n;return s=a<10?"0"+a.toString():a.toString(),n=t<10?"0"+t.toString():t.toString(),i+"-"+s+"-"+n+"T"+e}}e.TimeUtil=s}(GLECore=GLECore||{}),function(e){class t{static info(e){console.log(e)}static object(...e){console.dir(e)}static warn(e){console.warn(e)}static error(e){console.error(e)}}t.DEBUG=!1,e.Trace=t}(GLECore=GLECore||{}),function(e){class n{static openPopup(e,t,i,a,s,n,r){var o=screen.availWidth,l=screen.availHeight,o=(t=t||o,i=i||l,n=n||(o-t)/2-5,r=r||(l-i)/2-14,a=a||""+Math.floor(1000001*Math.random()),window.open(e,a,"width="+t+",height="+i+",scrollbars=yes,resizable=yes,top="+r+",left="+n));if(o.focus(),s)return o}static openWindowGeneric(e,t,i,a,s){t||_.isEmpty(s)||(t=s.width),i||_.isEmpty(s)||(i=s.height),a=a||"W"+n.winCount++;try{if(null===n.openPopup(e,t,i,a,!0))return!1}catch(e){return!1}return!0}}n.winCount=0,e.PopupUtil=n}(GLECore=GLECore||{}),function(e){e.BookmarkSpec=class{constructor(e,t,i,a){this._code=e.toUpperCase(),_.isUndefined(t)?this._description=e:this._description=t,_.isUndefined(i)&&!_.isNaN(i)?this._order=i:this._order=++a}get code(){return this._code}set code(e){_.isString(e)&&!_.isEmpty(e)&&(this._code=e.toUpperCase())}get description(){return this._description}set description(e){_.isString(e)&&!_.isEmpty(e)&&(this._description=e)}get order(){return this._order}set order(e){_.isNumber(e)&&(this._order=e)}toString(){return"[code:"+this._code+" description: "+this._description+" order:"+this._order+"]"}}}(GLECore=GLECore||{}),function(n){class e extends n.IEventDispatcher{constructor(){super(...arguments),this._scheme=[],this._userProgress=[],this._courseCode="",this._courseComplete=!1,this._suspendData={}}get config(){return this._config}get courseCode(){return this._courseCode}get suspendData(){return this._suspendData}getTrackingData(){this._userProgress=[]}getBookmark(t){if(!_.isEmpty(t)){t=t.toUpperCase();for(let e=0;e<this._userProgress.length;e++)if(this._userProgress[e].code===t)return this._userProgress[e]}}getLastBookmark(){return 0===this._userProgress.length?0===this._scheme.length?void 0:new n.Bookmark({code:null}):this._userProgress[this._userProgress.length-1]}sendTrackingInitEvent(e){this.dispatchEvent(new n.ApplicationEvent("trackingInit",{hasSucceeded:e,userProgress:this._userProgress,lastBookmarkCode:this.getLastBookmark().code}))}sendTrackingQuitEvent(e){this.dispatchEvent(new n.ApplicationEvent("trackingQuit",{hasSucceeded:e}))}sendAvailableLanguages(e){_.isArray(e)?this.dispatchEvent(new n.ApplicationEvent("availableLanguages",{languages:e})):n.Trace.error("sendAvailableLanguages: Languages parameter is not an array.")}isInScheme(e){return _.isObject(e)?_.isString(e.code)?0<_.filter(this._scheme,{code:e.code}).length:(n.Trace.error("isInScheme: Invalid code format."),!1):(n.Trace.error("isInScheme: Bookmark parameter is not an object."),!1)}makeBookmarkDateString(){var e=new Date,t=e.getMonth()+1,i=e.getDate();let a="",s="";return t<10&&(a="0"+t),i<10&&(s="0"+i),a+"/"+s+"/"+e.getFullYear()}destroy(){n.IEventDispatcher.prototype.destroy.call(this),this._scheme=null,this._userProgress=null}splitAndSwapNames(e){let t=e;e=t.split(",");return t=2===e.length?$.trim(e[1])+" "+$.trim(e[0]):t}encodeTrackingDataObject(e,i){if(!_.isPlainObject(e))return n.Trace.error("encodeTrackingDataObject:  Expected to encode an object."),"";if(!_.isPlainObject(i))return n.Trace.error("encodeTrackingDataObject:  Expected a set of delimeters to work with."),"";let a="";return _.each(e,(e,t)=>{a+=t+i.propAndValue+e+i.sets}),a.substr(0,a.lastIndexOf(i.sets))}decodeTrackingDataObject(e,t){if(!_.isString(e))return n.Trace.error("decodeTrackingDataObject:  Expected to decode a string."),{};if(!_.isPlainObject(t))return n.Trace.error("decodeTrackingDataObject:  Expected a set of delimiters to work with."),{};if(_.isEmpty(e))return n.Trace.error("decodeTrackingDataObject: Data object as string is empty.  Using empty object."),{};var i={},a=e.split(t.sets);for(let e=0;e<a.length;e++){var s=a[e];i[s.substr(0,s.indexOf(t.propAndValue))]=s.substr(s.indexOf(t.propAndValue)+1)}return i}}n.TrackingObject=e}(GLECore=GLECore||{}),function(r){class s extends r.TrackingObject{constructor(e,t,i){super(),this._TrackingManager=i,this._apiWrapperPath="javascript/libs/pipwerks/SCORM_API_wrapper.js",this._bookmarkCodes=[],this._launchData={},this._sessionStartTime=$.now(),this._zeroTime="00:00:00.0",this._zeroTime2004="PT0H0M0S",this._suspendDataDelimiters={propAndValue:"=",sets:";"},this._launchDataDelimiters={propAndValue:"=",sets:"&"},this._persistData=!0,this._launched=!1,this._score=100,this._qaMode=!1,this._qaNValue=0,this._progressCheckInterval=5e3,this._assessmentComplete=!1,this.quitHandler=()=>{$(window).off("beforeunload",this.quitHandler),this.quit()},this.checkForPersistSuccess=()=>{window.clearInterval(this._progressCheckTimer),391===this._scormWrapper.debug.getCode()&&this._TrackingManager.generateTrackingAlert("altNoTrackProgress")},this._config=e,this._exitType=this._config.exitType||"",this._completionType=this._config.completionType||"completed",this._useObjectives=!0===this._config.useObjectives,this._useInteractions=!0===this._config.useInteractions,this._forceScoreOnComplete=this._config.forceScore||!1,this._availableLangs=this._config.availableLangs||"",this._lmsId=this._config.lmsId,this._courseCode=t,$(window).on("beforeunload",this.quitHandler)}set qaMode(e){this._qaMode=e}init(e,t,i){this._gleAPI=t,this._bookmarkIds=e,this._objectiveData=i,_.isUndefined(pipwerks)?this.loadAPIWrapper():this.initTracking()}loadAPIWrapper(){$.getScript(this._apiWrapperPath).done(()=>{this.initTracking(),this.initObjectives()}).fail(()=>{r.Trace.error("Api Wrapper Load Result: Could not load SCORM API Wrapper"),this.sendTrackingInitEvent(!1)})}initTracking(){let e=!0;var t;this._scormWrapper=pipwerks.SCORM,this._scormWrapper.version="SCORM2004"===this._lmsId?"2004":"1.2",this._scormWrapper.exitType=this._exitType,this._scormWrapper.handleExitMode=!1,(e=this._scormWrapper.connection.isActive?e:this._scormWrapper.init())&&("incomplete"===this._scormWrapper.status("get")&&(this.setExitStatus(!1),this._scormWrapper.save()),"null"===(t=this._scormWrapper.get("cmi.launch_data"))||_.isEmpty(t)?this._launchData={}:this._launchData=this.decodeTrackingDataObject(t,this._launchDataDelimiters),"null"===(t=this._scormWrapper.get("cmi.suspend_data"))||_.isEmpty(t)?this._suspendData={}:this._suspendData=this.decodeTrackingDataObject(t,this._suspendDataDelimiters),this.setScheme(this._bookmarkIds),this.getTrackingData()),this.sendTrackingInitEvent(e)}initObjectives(){if(!this._useObjectives)return!0;let i=!1;var a="SCORM2004"===this._lmsId?".completion_status":".status",s=this._objectiveData.listing;for(let e=0,t=s.length;e<t;e++){var n=s[e];i=(i=this._scormWrapper.set("cmi.objectives."+n.index+".id",n.id))&&this._scormWrapper.set("cmi.objectives."+n.index+a,"not attempted"),"SCORM2004"===this._lmsId&&(i=i&&this._scormWrapper.set("cmi.objectives."+n.index+".description",n.label.substr(0,250)))}return i}quit(){!1===this.setSessionTime()&&r.Trace.error("quit: Unable to set session time.");var e=this._scormWrapper.quit();e?this._launched=!1:r.Trace.error("quit: Unable to terminate session."),this.sendTrackingQuitEvent(e)}getUserName(){var e="SCORM2004"===this._lmsId?"cmi.learner_name":"cmi.core.student_name",e=this._scormWrapper.get(e);let t;return t="null"===e||_.isEmpty(e)?"Test User":this.splitAndSwapNames(e)}getUserId(){var e="SCORM2004"===this._lmsId?"cmi.learner_id":"cmi.core.student_id";let t=this._scormWrapper.get(e);return t="null"!==t&&!_.isEmpty(t)?t:"xyztest"}getScore(){var e="SCORM2004"===this._lmsId?"cmi.score.scaled":"cmi.core.score.raw";let t=this._scormWrapper.get(e);return t="null"!==t&&!_.isEmpty(t)?t:""}getFirstTimeLoad(){var e="SCORM2004"===this._lmsId?"cmi.entry":"cmi.core.entry";return"ab-initio"===this._scormWrapper.get(e)?"yes":"no"}getExitPath(){return"./exit.htm"}getTrackingData(){if(super.getTrackingData(),!_.isString(this._suspendData.bkm)||_.isEmpty(this._suspendData.bkm))r.Trace.warn("getTrackingData: No recorded bookmarks or invalid."),this._suspendData.bkm="";else{this._bookmarkCodes=this._suspendData.bkm.split(",");for(let e=0;e<this._scheme.length;e++)-1!==this._bookmarkCodes.indexOf(this._scheme[e].code)&&this._userProgress.push(new r.Bookmark({code:this._scheme[e].code,complete:!0,date:this.makeBookmarkDateString()}))}}getTotalTime(){var e="SCORM2004"===this._lmsId?"cmi.total_time":"cmi.core.total_time";let t=this._scormWrapper.get(e);return t="null"!==t&&t.length?t:"SCORM2004"===this._lmsId?this._zeroTime2004:this._zeroTime}getCompletionDate(){let e=this._launchData.completionDate;var t,i,a,s=new Date;return(_.isUndefined(e)||_.isEmpty(e))&&(r.Trace.warn("getCompletionDate: No completion date was found in launch data.  Checking suspend data."),e=this._suspendData.completionDate,_.isUndefined(e)||_.isEmpty(e))?(r.Trace.warn("getCompletionDate: No completion date was found in suspend data.  This is ok if the user has not completed the course."),null):8!==e.length||isNaN(parseInt(e,10))?(r.Trace.error("getCompletionDate: Completion Date is not a valid date format.  Invalid Date: "+e),null):(t=parseInt(e.substr(0,4),10),i=parseInt(e.substr(4,2),10)-1,a=parseInt(e.substr(6,2),10),s.setFullYear(t,i,a),s)}getComplete(){var e="SCORM2004"===this._lmsId?"cmi.completion_status":"cmi.core.lesson_status";return this._courseComplete=this._scormWrapper.get(e)===this._completionType,this._courseComplete}getAvailableLanguages(){var e=this._launchData.availableLanguages;let t=[];function i(e){return(e=e.replace(/\s/g,"")).split(",")}return _.isEmpty(e)||"null"===e?_.isEmpty(this._availableLangs)||(t=i(this._availableLangs)):t=i(e),this.sendAvailableLanguages(t),t}getProfileData(){return this._suspendData.profiles}getAnalyticsData(){return this._suspendData.analytics}getAdvancedZoneBranchingData(){return this._suspendData.bz}getTakingForCredit(){let e=!0;var t="SCORM2004"===this._lmsId?"cmi.mode":"cmi.core.lesson_mode",i="SCORM2004"===this._lmsId?"cmi.credit":"cmi.core.credit";return e="browse"!==this._scormWrapper.get(t)&&"no-credit"!==this._scormWrapper.get(i)?e:!1}getAssessmentData(e){return this._suspendData[e]}setScheme(t){if(_.isEmpty(t))r.Trace.error("setScheme: Scheme is empty.");else for(let e=0;e<t.length;e++)this._scheme.push(new r.BookmarkSpec(t[e],t[e]+" bkmk",e+1))}setBookmark(t,e){let i=!1;var a;if(!_.isObject(t))return r.Trace.error("setBookmark: Bookmark is not valid."),!1;if(!_.isArray(this._bookmarkCodes))return r.Trace.error("setBookmark: Bookmark list is not valid."),!1;if(!1===this.isInScheme(t))return r.Trace.error("setBookmark: Bookmark not in scheme."),!1;if(!this.setPageCompletionPercentage(e))return!1;if("C"===t.code&&!1===this.setComplete())return!1;let s=!1,n=0;for(let e=0;e<this._userProgress.length;e++)if(n=e,this._userProgress[e].code===t.code){this._userProgress[e]=t,i=this.sendBookmark(t),s=!0;break}return s||(this._userProgress[n]=t,i=this.sendBookmark(t)),e=this.setSessionTime(),a=this.persistSessionData(),i&&e&&a}setPageCompletionPercentage(e){return"SCORM2004"!==this._lmsId||this._scormWrapper.set("cmi.progress_measure",e)}sendBookmark(e){return _.isEmpty(e)||_.isEmpty(e.code)?(r.Trace.error("sendBookmark: Invalid or empty bookmark object."),!1):(-1<this._bookmarkCodes.indexOf(e.code)?this._persistData=!1:(this._persistData=!0,this._bookmarkCodes.push(e.code)),this._suspendData.bkm=this._bookmarkCodes.toString(),this._scormWrapper.set("cmi.suspend_data",this.encodeTrackingDataObject(this._suspendData,this._suspendDataDelimiters)))}setComplete(){let i=!0;if(!1!==this._courseComplete)return r.Trace.warn("setComplete: Already complete."),!0;var a="SCORM2004"===this._lmsId?"cmi.completion_status":"cmi.core.lesson_status",s=this._score>=this._passingScore?"passed":"failed",a=this._scormWrapper.set(a,this._completionType);if(i=i&&a,"SCORM2004"===this._lmsId&&(i=i&&this._scormWrapper.set("cmi.success_status",this._assessmentComplete?s:"passed")),this._forceScoreOnComplete&&""===this.getScore()&&(i=i&&a&&this.setScore(this._score)),_.isUndefined(this._suspendData.completionDate)){s=new Date,a=s.getFullYear().toString();let e=(s.getMonth()+1).toString(),t=s.getDate().toString();1===e.length&&(e="0"+e),1===t.length&&(t="0"+t),this._suspendData.completionDate=a+e+t,i=i&&this._scormWrapper.set("cmi.suspend_data",this.encodeTrackingDataObject(this._suspendData,this._suspendDataDelimiters))}return i=(i=i&&this.setObjectivesComplete())&&this.setExitStatus(!0)}setSessionTime(){var e="SCORM2004"===this._lmsId?"cmi.session_time":"cmi.core.session_time";return this._scormWrapper.set(e,this.computeTime())}setAssessmentData(e,t,i){if("pre"!==e&&"post"!==e)return r.Trace.error("setAssessmentData: Assessment must be set to pre or post."),!1;if(_.isEmpty(t))return r.Trace.error("setAssessmentData: Assessment data string can't be empty."),!1;this._suspendData[e]=t;var a=this._scormWrapper.set("cmi.suspend_data",this.encodeTrackingDataObject(this._suspendData,this._suspendDataDelimiters)),t=this.extractScoreFromSuspendData(t);return null!==t&&"null"!==t?(this._assessmentComplete=!0,this._score=parseInt(t,10),this._passingScore=parseInt(i.passingScore.toString(),10),(!this.shouldSaveScore(this._score,e,i)||this.setScore(this._score))&&a):void 0}extractScoreFromSuspendData(e){e=this.decodeTrackingDataObject(e,{propAndValue:":",sets:"|"});return _.isUndefined(e.score)?null:e.score}shouldSaveScore(e,t,i){var a=this.getScore();let s=""===a;if("post"===t)if(!0==!!i.saveBestScore){if(("SCORM2004"===this._lmsId?parseFloat(a):parseInt(a,10))<("SCORM2004"===this._lmsId?e/100:e))return!0}else s=!i.suppressScore;else s=!i.suppressScore;return s}setObjectiveStatus(e,t,i){if(!this._useObjectives)return!0;this._persistData=!0;var a="SCORM2004"===this._lmsId?".completion_status":".status",a=this._scormWrapper.set("cmi.objectives."+e.index+a,t);return"SCORM2004"!==this._lmsId?a:(t=this._scormWrapper.set(`cmi.objectives.${e.index}.progress_measure`,i),a&&t)}createQAInteractionData(e){this.store2004Interaction(this._qaNValue++,e)}setInteraction(t,i=!0){var a={hasSet:!0,hasSaved:!0};if(this._useInteractions){var s=this._scormWrapper.get("cmi.interactions._count");if("null"===s)return r.Trace.error("setInteraction: Could not get valid interactions count."),{hasSet:!1,hasSaved:!1};"SCORM2004"===this._lmsId?a.hasSet=this.store2004Interaction(s,t):a.hasSet=this.store12Interaction(s,t);let e=0;for(var n=t.correct_responses.length;e<n;e++)a.hasSet=a.hasSet&&this._scormWrapper.set("cmi.interactions."+s+".correct_responses."+e+".pattern",t.correct_responses[e].pattern);i&&(a.hasSaved=this.persistSessionData())}return a}store12Interaction(e,t){let i=!0;return i=(i=(i=(i=(i=(i=i&&this._scormWrapper.set("cmi.interactions."+e+".id",t.id))&&this._scormWrapper.set("cmi.interactions."+e+".type",t.type))&&this._scormWrapper.set("cmi.interactions."+e+".time",t.time))&&this._scormWrapper.set("cmi.interactions."+e+".latency",t.latency))&&this._scormWrapper.set("cmi.interactions."+e+".student_response",t.response))&&this._scormWrapper.set("cmi.interactions."+e+".result",t.result),i=isNaN(t.weighting)?i:i&&this._scormWrapper.set("cmi.interactions."+e+".weighting",t.weighting)}store2004Interaction(i,e){let a=!0;var t;return _.isEmpty(_.get(e,"time"))||(e.time=r.TimeUtil.HHSSMMToSecond_10_0(e.time)),_.isEmpty(_.get(e,"latency"))||(t=60*+(t=e.latency.split(":"))[0]*60+60*+t[1]+ +t[2],e.latency=r.TimeUtil.centisecsToISODuration(100*t)),"wrong"===e.result&&(e.result="incorrect"),e=this.convertInteractionToLongFormResponses(e),!0===this._qaMode?this.dispatchEvent(new r.ApplicationEvent("qaTrackingDataUpdate",e)):(this._config.encodeResponses&&(e.response=s.handleResponseEncoding(e.type,e.response)),a=(a=(a=(a=(a=(a=a&&this._scormWrapper.set("cmi.interactions."+i+".id",e.id))&&this._scormWrapper.set("cmi.interactions."+i+".type",e.type))&&this._scormWrapper.set("cmi.interactions."+i+".timestamp",e.time))&&this._scormWrapper.set("cmi.interactions."+i+".latency",e.latency))&&this._scormWrapper.set("cmi.interactions."+i+".learner_response",e.response))&&this._scormWrapper.set("cmi.interactions."+i+".result",e.result),_.isEmpty(e.description)||(a=a&&this._scormWrapper.set("cmi.interactions."+i+".description",e.description)),isNaN(e.weighting)||(a=a&&this._scormWrapper.set("cmi.interactions."+i+".weighting",e.weighting)),_.isEmpty(e.objectiveIDs)||e.objectiveIDs.forEach((e,t)=>{a=a&&this._scormWrapper.set("cmi.interactions."+i+".objectives."+t+".id",e)})),a}static handleResponseEncoding(e,t){return-1!==["choice","likert","sequencing"].indexOf(e)?encodeURIComponent(t.replace(/\s+/gim,"_")):t}convertInteractionToLongFormResponses(i){return(i=_.extend({},i)).correct_responses=i.long_correct_responses,"choice"===i.type||"likert"===i.type||"sequencing"===i.type?i.response=i.response.split(",").map(e=>i.long_response_lookup[parseInt(e,10)]).join("[,]"):"matching"===i.type&&(i.response=i.response.split("[,]").map(e=>{var e=e.split("[.]"),t=e[0],e=e[1],t=i.long_response_lookup.items[t],e=i.long_response_lookup.buckets[e];return(this._config.encodeResponses?encodeURIComponent(t):t)+"[.]"+(this._config.encodeResponses?encodeURIComponent(e):e)}).join("[,]")),i.type.match(/fill-in/gim)&&(i.type="long-fill-in"),i}setScore(e){let t=!1;var i="SCORM2004"===this._lmsId?1:100,a="SCORM2004"===this._lmsId?"cmi.score.scaled":"cmi.core.score.raw",e="SCORM2004"===this._lmsId?e/100:e;return 0<=e&&e<=i&&(t=this._scormWrapper.set(a,e),this._persistData=!0),t}setProfileData(e){return!!_.isEmpty(e)||(this._suspendData.profiles=e,this._scormWrapper.set("cmi.suspend_data",this.encodeTrackingDataObject(this._suspendData,this._suspendDataDelimiters))&&this.persistSessionData())}setAnalyticsData(e){return!!_.isEmpty(e)||(this._suspendData.analytics=e,this._scormWrapper.set("cmi.suspend_data",this.encodeTrackingDataObject(this._suspendData,this._suspendDataDelimiters))&&this.persistSessionData())}setAdvancedZoneBranchingData(e){return this._suspendData.bz=e,this._scormWrapper.set("cmi.suspend_data",this.encodeTrackingDataObject(this._suspendData,this._suspendDataDelimiters))&&this.persistSessionData()}getStandardZoneBookmarkForPage(t){var e,i=this._suspendDataDelimiters.sets;return((null==(e=this._suspendData.zbkm)?void 0:e.split(i))||[]).filter(e=>e.match(t+"_")).map(e=>e.replace(t+"_",""))}setStandardZoneBookmark(e){var t=this._suspendDataDelimiters.sets,i=(null==(i=this._suspendData.zbkm)?void 0:i.split(t))||[],i=_.uniq(i.concat([e])),e=(this._suspendData.zbkm=i.join(t),this._scormWrapper.set("cmi.suspend_data",this.encodeTrackingDataObject(this._suspendData,this._suspendDataDelimiters)));return e&&this.persistSessionData()}setLaunchLanguage(e){this._suspendData.launchLang=e,this._scormWrapper.set("cmi.suspend_data",this.encodeTrackingDataObject(this._suspendData,this._suspendDataDelimiters))}setExitLanguage(e){this._suspendData.exitLang=e,this._scormWrapper.set("cmi.suspend_data",this.encodeTrackingDataObject(this._suspendData,this._suspendDataDelimiters))}persistSessionData(){let e;try{!0===this._persistData?(e=this._scormWrapper.save(),"SCORM2004"===this._lmsId&&(window.clearInterval(this._progressCheckTimer),this._progressCheckTimer=window.setInterval(this.checkForPersistSuccess,this._progressCheckInterval))):e=!0}catch(e){return r.Trace.error("Tracking_SCORM (persistSessionData): Unable to persist session data due to exception."),!1}return e}setObjectivesComplete(){let t=!0;return this._objectiveData.listing.forEach(e=>{e.complete||(e.complete=!0,t=t&&this.setObjectiveStatus(e,"completed",1))}),t}computeTime(){let e;var t;return e=_.isNumber(this._sessionStartTime)?(t=$.now()-this._sessionStartTime,t="SCORM2004"===this._lmsId?t/10:t/1e3,"SCORM2004"===this._lmsId?r.TimeUtil.centisecsToISODuration(t,!0):r.TimeUtil.secondsToCMITimespan(t)):"SCORM2004"===this._lmsId?this._zeroTime2004:this._zeroTime}setExitStatus(e){var t="SCORM2004"===this._lmsId?"cmi.exit":"cmi.core.exit",e=e?this._exitType:"suspend";return this._scormWrapper.set(t,e)}}r.Tracking_SCORM=s}(GLECore=GLECore||{}),function(a){class e extends a.TrackingObject{constructor(e,t,i){super(),this._TrackingManager=i,this._courseCode=t,this._config=e}init(e){this.setScheme(e),this.getTrackingData(),this.getSuspendData(),this.sendTrackingInitEvent(!0)}quit(){this.sendTrackingQuitEvent(!0)}getUserName(){let e=this.getURLParam("name");return e=_.isEmpty(e)?"GLE Dev User":unescape(e)}getUserId(){return"xyztest"}getScore(){return""}getFirstTimeLoad(){return"yes"}getExitPath(){return"./exit.htm"}getTrackingData(){super.getTrackingData();for(let t=0;t<this._scheme.length;t++){let e="";store.enabled&&(e=store.get(this.getStoredBookmarkCodePrefix()+this._scheme[t].code)),_.isUndefined(e)||_.isNull(e)||this._userProgress.push(new a.Bookmark({code:this._scheme[t].code,complete:!0,date:this.makeBookmarkDateString()}))}}getStoredBookmarkCodePrefix(){return"GLE_"+this._courseCode+"_"}getTotalTime(){return 0}getCompletionDate(){return null}getComplete(){let t=!1;for(let e=0;e<this._userProgress.length;e++)"C"===this._userProgress[e].code&&!0===this._userProgress[e].complete&&(t=!0);return t}getBookmark(){}getAvailableLanguages(e){let t;return t=_.isEmpty(e)?["acno","aeng","afr","ara","ause","ben","bsil","bstn","bel","bul","cdng","ces","dan","deu","ell","eng","est","fin","fra","frac","hat","heb","hin","hrv","hun","ind","isl","ita","jpn","kan","khmr","kor","lao","lav","lit","mal","mar","mkd","mlt","mly","mxno","mya","nan","nld","nob","pol","por","ron","rus","slk","slv","spa","srp","swe","tam","tgl","tha","tur","ukr","urd","vie","vls","zho","zzou"]:e.split(","),this.sendAvailableLanguages(t),t}getProfileData(){return this._suspendData.profiles}getAnalyticsData(){return this._suspendData.analytics}getAdvancedZoneBranchingData(){return this._suspendData.bz}getTakingForCredit(){return!0}getAssessmentData(e){return this._suspendData[e]}setScheme(t){for(let e=0;e<t.length;e++)this._scheme.push(new a.BookmarkSpec(t[e],t[e]+" bkmk",e+1))}setBookmark(e,t){var i;return!1===this.isInScheme(e)?(a.Trace.error("setBookmark: Bookmark not in scheme."),!1):("C"!==e.code||!1!==this.setComplete())&&(store.enabled&&(i=this.getStoredBookmarkCodePrefix(),store.set(""+i+e.code,1)),!0)}setComplete(){return!0}setSessionTime(){return!0}setAssessmentData(e,t){return this._suspendData[e]=t,this.setSuspendData(),!0}setProfileData(e){return _.isEmpty(e)||(this._suspendData.profiles=e,this.setSuspendData()),!0}setAnalyticsData(e){return _.isEmpty(e)||(this._suspendData.analytics=e,this.setSuspendData()),!0}setAdvancedZoneBranchingData(e){return this._suspendData.bz=e,this.setSuspendData(),!0}getStandardZoneBookmarkForPage(e){var t=[],i=this.getStoredBookmarkCodePrefix()+(e+"_");for(const a in store.getAll())a.match(i)&&t.push(a.replace(i,""));return t}setStandardZoneBookmark(e){var t;return store.enabled&&(t=this.getStoredBookmarkCodePrefix(),store.set(""+t+e,1)),!0}setInteraction(){return{hasSet:!0,hasSaved:!0}}setObjectiveStatus(){return!0}setLaunchLanguage(e){this._suspendData.launchLang=e,this.setSuspendData()}setExitLanguage(e){this._suspendData.exitLang=e,this.setSuspendData()}setScore(){return!0}getSuspendData(){let e="";store.enabled&&(e=store.get(this.getStoredBookmarkCodePrefix()+"_suspend")),_.isUndefined(e)||(this._suspendData=this.decodeTrackingDataObject(e,{propAndValue:"=",sets:";"}))}setSuspendData(){if(_.isEmpty(this._suspendData))return a.Trace.error("setSuspendData: Suspend Data is empty."),!0;var e=this.encodeTrackingDataObject(this._suspendData,{propAndValue:"=",sets:";"});store.enabled&&store.set(this.getStoredBookmarkCodePrefix()+"_suspend",e)}getURLParam(e){const a={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,(e,t,i)=>a[t]=i),a[e]}}a.Tracking_TEST=e}(GLECore=GLECore||{}),function(o){class l{static evaluateTestoutStatus(e){let t=o.ApplicationController.getInstance().model.getFirstPage().id,i=null;return!1===_.isEmpty(e)&&(e=e[o.RouteManager.TESTOUT_PROFILE_ID],_.isEmpty(e)||(e[0]===o.RouteManager.TESTOUT_PASSED&&(o.ApplicationController.getInstance().model.testedOut=!0,""!==(t=o.ApplicationController.getInstance().model.getTestOutPageOnPass()))&&(l.testOutUser({nextPageOnPass:t}),i=t),l.readInAssessmentData("pre",{result:e[0],nextPageOnPass:t,categoryScores:{}}))),i}static testOutUser(e){e.modular?l.testOutModularCourse(e):l.testOutFullCourse(e.nextPageOnPass)}static testOutModularCourse(e){const t=o.TrackingManager.getInstance();var i=e.categoryScores;const a=e.result;e=e.nextPageOnPass;let s=!1;_.isEmpty(i)||(_.each(i,e=>{e.passed&&("failed"===a&&t.markSectionComplete(e.sectionId),o.ApplicationController.getInstance().makeSectionOptional(e.sectionId),s=!0)}),"passed"===a&&l.testOutFullCourse(e),s&&o.ApplicationController.getInstance().sendEvent({type:"requestCourseFlowUpdate",rebuildTrackingAfterRoute:"passed"!==a}))}static testOutFullCourse(e){var t=o.TrackingManager.getInstance(),i=t.bookmarks,a=t.currentBookmark;let s;s=_.isUndefined(a)||_.isNull(a)?o.ApplicationController.getInstance().model.pages[0].id:a.page;a=_.findIndex(i,{page:s}),i=_.findIndex(i,{page:e});t.module.setPagesComplete(a,i)}static readInAssessmentData(e,t){var i=o.TrackingManager.getInstance().trackingObject;i&&(i=l.deserializeAssessmentData(i.getAssessmentData(e)),_.isEmpty(i)||(t.categoryScores=l.deserializeAssessmentCategoryData(i.categoryScores),l.testOutModularCourse(t)))}static deserializeAssessmentData(e){var t={};if(e&&0<e.length){var i=o.TrackingManager.getStoredDataString(e).split("|");for(let e=0;e<i.length;e++){var a=i[e].split(":");t[a[0]]=a[1]}}return t}static serializeAssessmentCategoryData(e){if(_.isEmpty(e))return"";let i="";return _.each(e,(e,t)=>{i+=t+","+e.sectionId+","+(e.passed?"P":"F")+","+e.score+"^"}),i.substring(0,i.length-1)}static deserializeAssessmentCategoryData(e){if(_.isEmpty(e))return{};var t=-1===e.indexOf("^")?";":"^",i=e.split(t),a={};for(let e=0;e<i.length;e++){var s=i[e].split(","),n=s[0],r=s[1],o="P"===s[2],s=s[3];a[n]={score:s,passed:o,sectionId:r}}return a}static convertAssessmentDataToString(e){let t="";var i=l._assessmentData[e].categoryScores;return _.isEmpty(this._assessmentData[e])||(t+="score:"+l._assessmentData[e].score,_.isEmpty(i))||(t+="|categoryScores:"+i),t}}l._assessmentData={pre:{},post:{}},l.setAssessmentData=t=>{var i=o.TrackingManager.getInstance();if(i.active){var a=t.score,s=t.suppressScore,n=t.pre?"pre":"post",r=t.categoryScores;let e=!0;l._assessmentData[n].score=a,l._assessmentData[n].categoryScores=l.serializeAssessmentCategoryData(r),t.persist&&(a=l.convertAssessmentDataToString(n),e=i.trackingObject.setAssessmentData(n,a,{suppressScore:s,saveBestScore:t.saveBestScore,passingScore:t.passingScore})),!1===e&&i.generateTrackingAlert("altNoTrackProgress",{forceExit:!0})}},o.AssessmentHelper=l}(GLECore=GLECore||{}),function(n){class i{static addInteractionIdToSource(e,t){e.attributes.interactionID=t,$(e.sourceXML).attr("interactionID",t)}static generateShortIdentifier(e,t,i,a){return _.isEmpty(i)?null:(t="number"==typeof t?(t+10).toString(36):t,((a||"")+n.DataUtil.standardizeNumber(e)+"_"+t+"_"+i.replace(/\s+/gim,"_")).replace(/_+/gim,"_").replace(/_$/gim,"").replace(/[.,]/gim,"").substring(0,250))}static getFormattedDate(e){return e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0")+":"+e.getSeconds().toString().padStart(2,"0")}static createTrackingObjectName(e){"SCORM_1.2"===e?e="SCORM":"CD"===e&&(e="TEST");let t=e.toUpperCase();return"Tracking_"+(t=-1!==e.indexOf("SCORM")?"SCORM":t)}constructor(e){this._AnalyticsManager=e,this._objectiveData={lookup:{},completion:{},sections:{},listing:[],initialized:!1},this._interactionData={lookup:{},listing:[]},this._objectivesInitialized=!1,this._interactionDefinition={Checkpoint:{regex:/Checkpoint/g,class:window.GLEPlugins.QuizUtil,type:"choice"},Chexercise:{regex:/Chexercise/g,class:window.GLEPlugins.QuizUtil,type:"choice"},Confidence:{regex:/Confidence/g,class:window.GLEPlugins.QuizUtil,type:"choice"},RatingScale:{regex:/RatingScale/g,class:window.GLEPlugins.QuizUtil,type:"likert"},OpenResponse:{regex:/OpenResponse/g,class:window.GLEPlugins.OpenResponse},InteractiveVideo:{regex:/InteractiveVideo/g,class:window.GLEPlugins.InteractiveVideo,type:"choice"},Sortable:{regex:/Sortable/g,class:window.GLEPlugins.Sortable},Matrix:{regex:/Matrix/g,class:window.GLEPlugins.Matrix},Survey:{regex:/Survey/g,class:window.GLEPlugins.SurveyLocal},DragAndDrop:{regex:/DragAndDrop/g,class:window.GLEPlugins.DragAndDrop},CourseAssessment:{regex:/CourseAssessment/g,class:window.GLEPlugins.CourseAssessment}},this._api=n.ApplicationController.getInstance()}set objectivesInitialized(e){this._objectivesInitialized=e}get objectivesInitialized(){return this._objectivesInitialized}get objectiveData(){return this._objectiveData}get interactionData(){return this._interactionData}initializeObjectives(){this._objectiveData={lookup:{},completion:{},sections:{},listing:[],initialized:this._objectivesInitialized},this.storeObjectiveData()}initializeInteractions(){this._interactionData={lookup:{},listing:[]},this.storeInteractionData()}completeObjective(e){var t,i=this.objectiveData.lookup[e];let a=this.objectiveData.completion[e]?"completed":"incomplete",s=0;return"completed"===(a=!0===n.QAModeManager.QA_TRACKING_MODE_DISABLED?"completed":a)?(i.complete=!0,s=1):null!=(e=i.pages)&&e.length&&(e=i.pages.filter(e=>e.active),t=i.pages.filter(e=>e.active&&e.complete).length,s=parseFloat((t/e.length).toFixed(2))),{objective:i,objectiveStatus:a,objectivePercentageComplete:s}}updateInteractionWithAnalytics(i){const a=this.interactionData.lookup[i.interactionId];var e;_.isEmpty(a)?n.Trace.error("TrackingManager (updateInteractionWithAnalytics): unable to find interaction with id of "+i.interactionId):(a.long_correct_responses.forEach((e,t)=>{a.long_correct_responses[t].pattern=this._AnalyticsManager.replaceConfidenceToken(e.pattern,i.confidence)}),e=a.long_response_lookup,n.DataUtil.objectValues(e).forEach((e,t)=>{a.long_response_lookup[t]=this._AnalyticsManager.replaceConfidenceToken(e,i.confidence)}))}setScormInteraction(e){var t,i=n.TrackingManager.getInstance();i.active&&e.interactionID&&(e=this.buildInteractionData({latency:e.latency,interactionID:e.interactionID,responses:e.responses,responseText:e.responseText,result:e.result,weighting:e.weighting,objectiveIDs:e.objectiveIDs}),t=i.trackingObject.setInteraction(e),_.isEmpty(n.QAModeManager.trackingObject)||n.QAModeManager.trackingObject.createQAInteractionData(e),!1===t.hasSaved)&&i.generateTrackingAlert("altNoTrackProgress",{forceExit:!0})}batchSetInteractions(t){var i=n.TrackingManager.getInstance();if(i.active)for(let e=0;e<t.interactionCollection.length;e++){var a=this.buildInteractionData(t.interactionCollection[e]);i.trackingObject.setInteraction(a,!1),_.isEmpty(n.QAModeManager.trackingObject)||n.QAModeManager.trackingObject.createQAInteractionData(a)}}buildInteractionData(e){var t=this.interactionData.lookup[e.interactionID];if(t)return t.latency=e.latency,t.time=i.getFormattedDate(new Date),t.result=e.result,t.response=e.responseText||e.responses.join(","),t.weighting=e.weighting,t.objectiveIDs=e.objectiveIDs,t;n.Trace.error("Could not find interaction data for: "+e.interactionID)}storeObjectiveData(){this._objectiveData.listing=this._AnalyticsManager.fetchAnalyticsObjectives(),this._api.model.sectionSource.forEach(e=>{var t=e.id,i=e.getAllPages();if(i.length){const a={id:t,section:$(e.xml.sourceXML),pages:i,complete:!1,time:0,index:this._objectiveData.listing.length,label:e.title};this._objectiveData.completion[i[i.length-1].id]=a,this._objectiveData.sections[t]=a,this._objectiveData.listing.push(a),i.forEach(e=>{this._objectiveData.lookup[e.id]=a})}}),this._api.model.objectiveList=this._objectiveData.listing}storeInteractionData(){let s=0;this._api.model.content.getAllDescendantsOfType("SWF").filter(e=>{return!(null==(e=e.getChildrenOfType("Data")[0])||!e.attributes.isInteraction)}).forEach((e,t)=>{var i=[],a=e.attributes.src,a=this.getApplicableInteraction(a);null!==a&&i.push(...a.class.initInteractionData(e,s,!1,t,a.type)),this._interactionData.listing.push(...i),s+=i.length}),this._interactionData.lookup=this._interactionData.listing.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.id]:t}),{})}getApplicableInteraction(t){let i=null;return n.DataUtil.objectValues(this._interactionDefinition).every(e=>!t.match(e.regex)||(i=e,!1)),i}}n.LMSHelper=i}(GLECore=GLECore||{}),function(s){s.RouteHelper=class n{static validateProfile(e){var t=s.TrackingManager.getInstance(),i=s.ApplicationController.getInstance(),a=t.bookmarks.filter(n.filterProfileBookmarks);return!a.length||!(t.bookmarks.indexOf(a.pop())<_.findIndex(t.bookmarks,{page:e})&&_.isEmpty(i.trackingData.profile))}static filterProfileBookmarks(e){return!_.isEmpty(e.profiling)}static isProfilingPage(e){e=e.getAllDescendantsOfType("SWF");let t=null;return e.forEach(e=>{(e=e.getChildrenOfType("Data")).length&&"true"===e[0].attributes.profiling&&!(t=e[0].attributes.profileId)&&(e=e[0].attributes.testout,t="true"===e?"testout":null)}),t}}}(GLECore=GLECore||{}),function(e){class a{static restoreDataFromStorage(e){if(!_.isEmpty(e))return e=e.split("|"),_.each(e,e=>{var e=/^(.*?)-(.*?):(.*?)$/.exec(e),t=e[1],i=e[2];a.storage[t]=a.storage[t]||{},a.storage[t][i]=e[3].split(",")}),a.storage}static isBranchingPage(e){e=e.getAllDescendantsOfType("SWF");let t=null;return e.forEach(e=>{e=e.getChildrenOfType("Data");e.length&&"true"===e[0].attributes.branching&&(t=e[0].attributes.branchId)}),t}}a.storage={},e.ZoneHelper=a}(GLECore=GLECore||{}),function(e){e.TrackingModule=class{set bookmarks(e){this._bookmarks=e}get bookmarks(){return this._bookmarks}}}(GLECore=GLECore||{}),function(e){class t extends e.TrackingModule{constructor(e,t,i){super(),this._defaultAlert=e,this.api=t,this._LaunchDataManager=i.LaunchDataManager}canAdvanceToPage(e,t){var e=_.find(this.bookmarks,{page:e}),t=this.bookmarks.indexOf(t),i=this.bookmarks.indexOf(e),a=t+1<i&&-1!==t;let s=!0,n=null;for(let e=0;e<i;e++){var r=this.bookmarks[e];r.complete||(n=this.getAlertForBookmark(r,a),s=!1)}return{allowed:s,alert:n}}getResumePage(t,i){if(i){var a=this.bookmarks.map(e=>e.code),s=a.indexOf(t);let e=this.bookmarks.map(e=>e.page).indexOf(i);if(this.api.trackingData.isComplete&&(e=a.length-1,t=_.last(a)),e>s)return this.determineResumeState(a[e])}return this.determineResumeState(t)}setBookmarkCompletions(e){e=_.isEmpty(e)?this.bookmarks[0]:_.find(this.bookmarks,{code:e}),e=this.bookmarks.indexOf(e);this.api.trackingData.isComplete?this.setPagesComplete(0,this.bookmarks.length):0<e&&this.setPagesComplete(0,e+1)}setPagesComplete(t,i){for(let e=t;e<i;e++)this.bookmarks[e].complete=!0,this.api.setPageCompleteById(this.bookmarks[e].page)}determineResumeState(e){let t;var e=_.find(this.bookmarks,{code:e}),e=(this._highwater=t=this.api.model.getFirstPage().id,_.isEmpty(e)||(this._highwater=t=e.page),this._LaunchDataManager.launchDataObj.courseInputDataObj.resumePageId),i=_.find(this.bookmarks,{page:e}),a=this.bookmarks.indexOf(i),s=_.findIndex(this.bookmarks,{page:this._highwater});return e&&i&&(this._highwater=s<a?e:this._highwater,t=e),this.api.trackingData.isComplete&&(this._highwater=_.last(this.api.model.pages).id,t=this._highwater),this.api.model.courseLoadHighWatermarkPageId=this._highwater,t}getAlertForBookmark(e,t){var i;let a=this._defaultAlert;return null!=(i=_.first(e.activities))&&i.alert?a=_.first(e.activities).alert:e.alert&&!t&&(a=e.alert),a}}e.LinearTrackingModule=t}(GLECore=GLECore||{}),function(l){class e{static getInstance(){return e._instance}static addInteractionIdToSource(e,t){l.LMSHelper.addInteractionIdToSource(e,t)}static generateShortIdentifier(e,t,i,a){return l.LMSHelper.generateShortIdentifier(e,t,i,a)}get content(){return this._content}get api(){return this._api}get active(){return this._trackingActive}get currentBookmark(){return this._currentBookmark}get module(){return this._module}get bookmarks(){return this._bookmarks}constructor(){this._bookmarks=[],this._bookmarkMemory={},this._trackingObject=null,this._scheme=[],this._pageJumpAlert=null,this._currentBookmark=null,this._canCallPage=!0,this.callPage=e=>{var t,i,a;return!!this._canCallPage&&(t=this.getBookmarkByPageId(e),!0===l.QAModeManager.QA_TRACKING_MODE_DISABLED?this.handleQAPageRequest(e):({allowed:i,alert:a}=this._module.canAdvanceToPage(e,this._currentBookmark),i?("S"!==t.type||t.complete||(t.complete=!0),this.completePageRequest(t,e)):(this.generateTrackingAlert(a),!1)))},this.loadFirstPage=()=>{this._trackingObject.addEventListener("trackingInit",this.onTrackingInit),this.initTracking()},this.onTrackingInit=e=>{let t=null;if(e.data.hasSucceeded){if(this._lmsHelper.objectivesInitialized=!0,this._trackingActive=this._trackingObject.getTakingForCredit()&&"true"===this._data.attributes.active,this.api.trackingData.userName=this._trackingObject.getUserName(),this.api.trackingData.totalTime=this._trackingObject.getTotalTime(),this.api.trackingData.isComplete=this._trackingObject.getComplete(),this.api.trackingData.completionDate=this._trackingObject.getCompletionDate(),this.api.trackingData.availableLanguages=this._trackingObject.getAvailableLanguages(this._LaunchDataManager.courseInputData.availableLangs),this.api.trackingData.userId=this._trackingObject.getUserId(),this.api.trackingData.profile=this._trackingObject.getProfileData(),this.api.trackingData.analytics=this._trackingObject.getAnalyticsData(),this.api.trackingData.bz=this._trackingObject.getAdvancedZoneBranchingData(),!_.isEmpty(this.api.trackingData.profile)){this.initProfiling(),this.buildScheme(),this.buildBookmarks(),this._trackingObject.setScheme(this._scheme),this._trackingObject.getTrackingData();for(let e=0,t=this._bookmarks.length;e<t;e++){var i=this._bookmarks[e];i.profiling&&this.api.trackingData.profile[i.profiling]&&(i.complete=!0,this.api.setPageCompleteById(i.page))}t=l.AssessmentHelper.evaluateTestoutStatus(this._RouteManager.profilingResponses)}_.isEmpty(this.api.trackingData.analytics)||this.initAnalytics(),_.isEmpty(this.api.trackingData.bz)||this.initAdvancedZoneBranching(),this._resumePage=this._module.getResumePage(e.data.lastBookmarkCode,t),this._module.setBookmarkCompletions(e.data.lastBookmarkCode)}else this.generateTrackingAlert("altNoTrackInit");this.api.setTrackingEnabled(this._trackingActive)},this.callResumePage=e=>(this.setCurrentBookmark(this.getBookmarkByPageId(e)),this.setTrackTimerInterval(),this.api.callPage(e,!0)),this.tick=()=>{!0===this.api.model.courseRendered&&this._currentBookmark&&"time"===this._currentBookmark.type&&(this._currentBookmark.time++,this._currentBookmark.time>=this._currentBookmark.value&&!this._currentBookmark.activities.length&&!this._currentBookmark.hasIncompleteActivities&&(clearInterval(this._ticker),this.api.sendEvent({type:"pageComplete",value:{}}),this.setPageComplete()),this.api.model.dispatchEvent(new l.ApplicationEvent("tick",{bookmark:this._currentBookmark})))},this.apiHandler=e=>{if("TrackingManager"===e.data.destination||"all"===e.data.destination)switch(e.data.type){case"routeUpdate":this.onRouteUpdate(!0===e.data.rebuildTracking);break;case"precourseSettingsClosed":this.apiPrecourseSettingsClosed();break;case"langChange":this.apiLangChange()}},this.saveProfile=()=>{var e;this._trackingActive&&(e=this._trackingObject.setProfileData(this.convertResponseDataToString(this.api.trackingData.profile)),this.handleTrackingSuccess(e))},this.saveAnalytics=()=>{var e;this._trackingActive&&(e=this._trackingObject.setAnalyticsData(this.convertResponseDataToString(this.api.trackingData.analytics)),this.handleTrackingSuccess(e))},this.saveAdvancedZoneBranching=()=>{var e,t;this._trackingActive&&(e=this.api.trackingData.bz[t="p"+this.api.model.currentPage.id],e=this.convertResponseDataToString(e,t+"-"),t=this._trackingObject.setAdvancedZoneBranchingData(e),this.handleTrackingSuccess(t))},this.setActivityStatus=e=>{var t;this._trackingActive&&("complete"!==(t=e.status)||this._currentBookmark.complete?"register"!==t||this._currentBookmark.complete?"clearAll"===t&&(this._currentBookmark.hasIncompleteActivities=!1,this._currentBookmark.activities.splice(0,this._currentBookmark.activities.length)):this.registerActivity(e.activity):this.setActivityComplete(e.activity))},this.exitCourse=()=>{top.location.href=this._trackingObject.getExitPath()},this.setAssessmentData=e=>{l.AssessmentHelper.setAssessmentData(e)},this.testout=e=>{l.AssessmentHelper.testOutUser(e)},this.apiPrecourseSettingsClosed=()=>{this._trackingActive&&(this._trackingObject.setLaunchLanguage(this.api.getPreferences().lang),this._trackingObject.setExitLanguage(this.api.getPreferences().lang))},this.apiLangChange=()=>{clearInterval(this._ticker),this._trackingActive&&this._trackingObject.setExitLanguage(this.api.getPreferences().lang)},e._instance=this}initialize(e,t){this._LaunchDataManager=t.LaunchDataManager,this._RouteManager=t.RouteManager,this._AlertManager=t.AlertManager,this._AnalyticsManager=t.AnalyticsManager,this._SettingsManager=t.SettingsManager,this._XMLManager=t.XMLManager,this._lmsHelper=new l.LMSHelper(t.AnalyticsManager),this._api=e,(this._api.TrackingManager=this)._content=this.getTrackingManagerConfig(),this._trackingActive=!0,this._data=this.content.getChildrenOfType("Data")[0],this._defaultPageAlert=this._data.attributes.defaultPageTimeAlert,this._forceExitingOnError=this._data.attributes.forceExitingOnError,this._pageJumpAlert=this._data.attributes.defaultPageJumpAlert,this._completionMode=this._SettingsManager.getSettingValueGeneral(l.SettingsManager.SETTING_NAME_COMPLETION_MODE),this._SettingsManager.getSettingValueGeneral(l.SettingsManager.SETTING_NAME_TRACKING_MODE)!==l.TrackingType.NonLinear&&(this._module=new l.LinearTrackingModule(this._pageJumpAlert,this.api,t)),this.initializeTrackingObject(),this.configureScorm(),this.buildScheme(),this.buildBookmarks(),this.api.model.addEventListener("apiEvent",this.apiHandler)}getTrackingManagerConfig(){return this._api.model.content.find({id:"tracking"},!0)}get trackingObject(){return this._trackingObject}initializeTrackingObject(){this._trackingObject&&this._trackingObject.destroy(),this._trackingObject=this.createTrackingObject(),this._trackingObject.addEventListener("availableLanguages",this.api.onAvailableLanguages)}createTrackingObject(){var e=this._LaunchDataManager.launchInfo.lms.lmsId,t=l.LMSHelper.createTrackingObjectName(e);if("function"==typeof window.GLECore[t])return new window.GLECore[t](this._LaunchDataManager.launchInfo.lms,this._LaunchDataManager.launchInfo.Course.BaseCourseCode,this);l.Trace.error("TrackingManager (createTrackingObject): Cannot find an object for this LMS_ID "+e)}handleQAPageRequest(e){var t=this.getBookmarkByPageId(e);return this.setPageComplete(),this.completePageRequest(t,e),this.setPageComplete(),!0}completePageRequest(e,t){return this.setCurrentBookmark(e),this._currentBookmark.activities=[],this.setTrackTimerInterval(),this.api.setCurrentPageOnModel(t)}setCurrentBookmark(e){this._currentBookmark=e,this.api.setCurrentBookmark(e)}setTrackTimerInterval(){clearInterval(this._ticker),this._currentBookmark&&0===this._currentBookmark.value&&this.api.model.courseRendered?this.tick():this._ticker=window.setInterval(this.tick,1e3)}initTracking(){this._trackingObject.init(this._scheme,this.api,this._lmsHelper.objectiveData)}initProfiling(){this._RouteManager.updateProfilingFromStorage(e.getStoredDataString(this._trackingObject.getProfileData()))}initAnalytics(){this._AnalyticsManager.restoreDataFromStorage(this._trackingObject.getAnalyticsData())}initAdvancedZoneBranching(){this.api.trackingData.bz=l.ZoneHelper.restoreDataFromStorage(this._trackingObject.getAdvancedZoneBranchingData())}configureScorm(){this._lmsHelper.initializeObjectives(),this._lmsHelper.initializeInteractions()}buildScheme(){this._scheme=[];for(let e=0;e<this.api.model.pages.length;e++){var t=this.api.model.pages[e].xmlContainer.getFirstChildOfType("Tracking");_.isEmpty(t)||this._scheme.push(t.attributes.bookmark)}}buildBookmarks(){var e=[];this._bookmarks.forEach(e=>this._bookmarkMemory[e.code]=e.complete);for(let i=0;i<this.api.model.pages.length;i++){var a=this.api.model.pages[i],s=a.id,n=this.getBookmarkByPageId(s);if(null!==n&&this.isBookmarkComplete(n))a.bookmark=n,e.push(n);else{var n=a.xmlContainer.getChildrenOfType("Tracking")[0],r=l.RouteHelper.isProfilingPage(a.xmlContainer),o=l.ZoneHelper.isBranchingPage(a.xmlContainer);let t;if(_.isUndefined(n))t=new l.Bookmark({code:s,type:"time",page:s,alert:this._defaultPageAlert,activityAlertId:"",profiling:r,branching:o,value:r?1:2,complete:!1,time:0,activities:[],track:!1,date:""});else{let e=l.DataUtil.convertStringToNumber(n.attributes.value);e===n.attributes.value&&(e=0),t=new l.Bookmark({code:n.attributes.bookmark.toString(),type:n.attributes.type,page:this.api.model.pages[i].id,alert:this._defaultPageAlert,activityAlertId:n.attributes.activityAlertId,value:e,profiling:r,branching:o,complete:!1,time:0,activities:[],track:!0,date:""})}"C"===t.code&&(t.time=0),this._bookmarkMemory[t.code]&&(t.complete=!0),a.bookmark=t,e.push(t)}}this._bookmarks=e,this._module.bookmarks=e,_.isEmpty(this._currentBookmark)||(this._currentBookmark=_.find(this._bookmarks,{code:this._currentBookmark.code})||this._currentBookmark)}isBookmarkComplete(e){var t=e.complete,i=-1!==this._scheme.indexOf(e.code),a=null!==e.profiling,e=null!==e.branching;return t&&(i||a||e)}onRouteUpdate(e){e&&(this.initializeTrackingObject(),this.buildScheme(),this.buildBookmarks(),this.initTracking(),e=this.restoreResponseData(),this.api.sendEvent({type:"routeAndTrackingUpdate",value:{}}),this.handleTrackingSuccess(e))}handleTrackingSuccess(e,t){var i;if(e)try{!this._LaunchDataManager.LaunchInputs.hasOpener||null!=(i=window.top)&&i.opener||this.generateTrackingAlert("altNoParentWindow")}catch(e){l.Trace.info("TrackingManager: Unable to check for parent window and therefore cannot detect if launcher window closed.")}else this.generateTrackingAlert("altNoTrackProgress",t)}restoreResponseData(){var e,t;return!this._trackingActive||(e=this._trackingObject.setProfileData(this.convertResponseDataToString(this.api.trackingData.profile)),t=this._trackingObject.setAnalyticsData(this.convertResponseDataToString(this.api.trackingData.analytics)),e&&t)}updateInteractionWithAnalytics(e){this._lmsHelper.updateInteractionWithAnalytics(e)}getStandardZoneBookmarkForPage(e){return this._trackingObject.getStandardZoneBookmarkForPage(e)}saveStandardZoneBookmark(e,t){this._trackingActive&&(e=this._trackingObject.setStandardZoneBookmark(e+"_"+t),this.handleTrackingSuccess(e))}setScormInteraction(e){this._lmsHelper.setScormInteraction(e)}batchSetInteractions(e){this._lmsHelper.batchSetInteractions(e)}setCourseComplete(){return this._trackingObject.setComplete()}startCourse(){this.callResumePage(this._resumePage),l.RouteHelper.validateProfile(this._currentBookmark.page)||this.generateTrackingAlert("altNoTrackProgress",{forceExit:!0})}convertResponseDataToString(e,t=""){let i="";for(const s in e){var a;Object.prototype.hasOwnProperty.call(e,s)&&(a=e[s],i+=(i.length?"|":"")+t+s+":"+a.join(","))}return i}getBookmarkByPageId(t){var i=this._bookmarks.length;for(let e=0;e<i;e++){var a=this._bookmarks[e];if(a.page===t)return a}return null}setPageComplete(){var e,t,i;!0!==this._currentBookmark.complete&&(this._currentBookmark.complete=!0,this.api.setPageCompleteById(this._currentBookmark.page),{objective:i,objectiveStatus:e,objectivePercentageComplete:t}=this._lmsHelper.completeObjective(this._currentBookmark.page),(i=!this._trackingActive||this._trackingObject.setObjectiveStatus(i,e,t))?this._currentBookmark.track&&this._trackingActive&&(e=this._bookmarks.filter(e=>e.complete).length,t="C"===this._currentBookmark.code?1:parseFloat((e/this._bookmarks.length).toFixed(2)),i=i&&this._trackingObject.setBookmark(this._currentBookmark,t),this.handleTrackingSuccess(i,{forceExit:!0})):this.generateTrackingAlert("altNoTrackProgress"))}markSectionComplete(t){_.each(this.api.model.sections,e=>{e.id===t&&(e.complete=!0,(e=e.pages).length)&&_.each(e,e=>{var t=this.getBookmarkByPageId(e.id);null!==t&&(t.complete=!0,e.complete=!0)})})}setActivityComplete(t){var i=this._currentBookmark.activities;for(let e=i.length-1;0<=e;e--)i[e].id===t.id&&i.splice(e,1);i.length||(this._currentBookmark.hasIncompleteActivities=!1),this.tick()}registerActivity(i){var a=this._currentBookmark.activities;for(let e=0,t=a.length;e<t;e++)if(a[e].id===i.id)return;i.alert&&(this._currentBookmark.activityAlertId=i.alert),a.unshift(i),this._currentBookmark.complete||(this._currentBookmark.hasIncompleteActivities=!0)}generateTrackingAlert(e,t){if(!l.ConnectivityManager.enabled||!1!==window.navigator.onLine){const i="tracking_alert";t=t&&!0===t.forceExit,e={id:i,content:"{tk_"+e+"}",preventClickOutsideDismiss:t,autoRemove:!1,exitCallback:()=>{this.api.sendEvent({type:"trackingAlertDismissed"}),this._AlertManager.closeAlert(i)}},e=this._AlertManager.showAlert(new l.AlertData(e));t&&(this._canCallPage=!1,null!=e)&&e.find(".close-button").on("click",()=>{"true"===this._forceExitingOnError&&this.exitCourse()}),this.api.sendEvent({type:"trackingAlertShown"})}}static getStoredDataString(e){return e=l.DataUtil.isBase64(e)?window.atob(e):e}}l.TrackingManager=e}(GLECore=GLECore||{}),function(t){class a{constructor(){this._launchInputs={useObjectives:!0,useInteractions:!0,exitType:"",completionType:"completed",courseCode:a.getUrlParameter("coco"),clientCode:a.getUrlParameter("clco"),playerVersion:a.getUrlParameter("plver"),languageCode:a.getUrlParameter("lang"),availableLangs:"",lmsId:a.getUrlParameter("lms_id"),previewMode:"false",trackingConfiguration:"",forceScore:!1,encodeResponses:!1,courseOverride:"",courseOverrideVersion:a.getUrlParameter("override_version"),overrideVersionExclusions:"",resumePageId:"",timebombDate:0,gsl_path:"",packaged:!1,hasOpener:!1}}initHosted(){var e="true"===a.getUrlParameter("preview_mode");this._launchInputs.availableLangs="TEST"!==a.getUrlParameter("lms_id")||e?a.getUrlParameter("avail_langs"):"",this._launchInputs.previewMode=a.getUrlParameter("preview_mode"),this._launchInputs.trackingConfiguration=a.getUrlParameter("tracking"),this._launchInputs.gsl_path=a.getUrlParameter("gsl_path"),this.init()}initPackaged(){var e=sai.mockGleServiceLayerResults.CourseInfo.lms;this._launchInputs.availableLangs=e.availableLangs,this._launchInputs.completionType=e.completionType,this._launchInputs.exitType=e.exitType,this._launchInputs.forceScore=e.forceScore,this._launchInputs.lmsId=e.lms_id,this._launchInputs.timebombDate=e.timebombDate,this._launchInputs.useInteractions=e.useInteractions,this._launchInputs.useObjectives=e.useObjectives,this._launchInputs.packaged=!0,this.init()}init(){a.setupViewportOnFrameset(),this.checkForOpener(),$("#appleLoader").css("display","block"),this._initMan=new t.InitializationManager,this._initMan.initialize(this._launchInputs,this._preDefinedLaunchData)}static setupViewportOnFrameset(){try{!window.frameElement||"FRAME"!==window.frameElement.nodeName&&"IFRAME"!==window.frameElement.nodeName||(window.top.document.querySelector("meta[name=viewport]")?$("meta[name='viewport']",window.top.document).attr("content","width=device-width, initial-scale=1.0, user-scalable=no"):$("head",window.top.document).append('<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />'))}catch(e){t.Trace.info("Startup: Unable to add viewport meta to parent.")}}checkForOpener(){var e;try{null!=(e=window.top)&&e.opener&&(this._launchInputs.hasOpener=!0)}catch(e){t.Trace.info("Startup: Unable to check for parent window and therefore cannot detect if launcher window closes.")}}loadLaunchData(){var e=document.getElementsByTagName("head")[0],t=document.getElementById("reference"),i=document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src","../../data/launch_data_"+a.getUrlParameter("lang")+".js"),$.holdReady(!0),$(i).on("load",()=>{this._preDefinedLaunchData=sai.mockGleServiceLayerResults,$.holdReady(!1)}),e.insertBefore(i,t)}static getUrlParameter(e){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}buildQSObject(){var e={};return e.coco=this._launchInputs.courseCode,e.clco=this._launchInputs.clientCode,e.plver=this._launchInputs.playerVersion,e.lms_id=this._launchInputs.lmsId,e}}t.StartUp=a}(GLECore=GLECore||{}),function(e){e.GLE_API=class{constructor(e){this._api=e}callPage(e){return this._api.callPage(e)}}}(GLECore=GLECore||{});
//# sourceMappingURL=coreapp.js.map